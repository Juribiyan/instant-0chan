{"version":3,"sources":["es6/src/kusaba.new.js"],"names":["style_cookie","style_cookie_txt","style_cookie_site","kumod_set","ispage","is_entering","_messages","en","noLocalStorage","oops","blankResponse","expandingThread","newThread","NewThread","replyTo","cancel","update","updatingCounts","couldntFetch","noNewPosts","replies","settings_fxEnabled","settings_showReplies","settings_sfwMode","settings_expandImgFull","settings_constrainWidth","enterCaptcha","selectText","dcls","watchOn","captcharot","threadUpdationAutomatically","stopFuckingDolls","del","delandban","ban","stickthread","unstickthread","lockthread","unlockthread","returnDesktop","returnTouch","forceDesktop","okay","captchalang","reply","imageDownscaledBy","videoDownscaledBy","toFit","newReplies","newThreadsAvailable","loading","anonymous","sortBy","bumpOrder","lastReply","creationDate","replyCount","doStick","showHidden","doNotStick","hideHidden","search","threadOnPage","goToThread","smallPics","largePics","legacyMode","threads","comments","active_since","last_active","active_on","tryAgain","xhrError","details","thread","post","posts","deleted","deletedMulti","report","reported","reportedMulti","fileRemoved","file","files","collapse","asMod","asOP","historyEmpty","noDataLoaded","unable_load_20","captchaLangChanged","found","links","selectMultiple","selected","directLink","quoteLink","maxAttNumReached","unsupportedFileType","hideName","removeFile","spoilerOnOff","hidePost","unhidePost","settings_hideCompletely","pinUnpin","hideForm","collapseExpand","notEmpty","showName","showSubject","showEmbeds","showPassword","showTTL","attachFile","classicSimplifiedForm","showMarkup","refreshCatalog","cancelTimer","saved","savedMulti","password","captcha","captchaImage","refreshCaptcha","showCaptcha","captchaExpired","ru","odc","_l","locale","hasOwnProperty","onReady","pushTask","fn","isReady","tasks","push","ready","forEach","Array","prototype","indexOf","elt","len","length","from","Number","arguments","Math","ceil","floor","Utf8","encode","string","replace","utftext","n","c","charCodeAt","String","fromCharCode","decode","i","c1","c2","c3","Cookie","name","regexp","RegExp","hit","exec","document","cookie","unescape","replaceAll","value","days","expires","date","Date","setTime","getTime","toGMTString","str","to","idx","_lastActiveForm","Object","defineProperty","window","get","getClientRects","updateActiveForm","set","el","querySelectorAll","a","classList","remove","form","_findParent","add","contains","toggleFormCollapse","floating","querySelector","lastActiveForm","findClosest","selector","height","innerHeight","hh","list","closest","map","call","rect","offset","abs","y","filter","sort","e1","e2","insert","text","breakBefore","breakAfter","textarea","start","selectionStart","end","selectionEnd","pre","substr","charBefore","charAfter","selectionRange","setSelectionRange","focus","markup","$target","istart","iend","element","find","startPos","endPos","substring","bullets","bullet","$area","val","split","newtxt","quotes","type","areaVal","tag","quote","b","v","eval","checkhighlight","match","location","toString","$","highlight","id","offTimeout","removeClass","this_board_dir","$post","parents","addClass","setTimeout","bcr","getBoundingClientRect","docHeight","documentElement","clientHeight","bottom","top","postX","scrollTop","spaceAround","scrollTo","password_length","get_password","pass","getCookie","randomString","togglePassword","passwordbox_html","html","toLowerCase","newhtml","show","set_cookie","Styles","all","titles","init","_","each","getElementsByTagName","link","getAttribute","_default","hasAttribute","custom","current","customBypass","in_array","initiated","decide","testingCSS","LSfetchJSON","title","addStyle","url","setStyle","$clink","click","ev","preventDefault","quitTest","parent","slideUp","$cancelLink","append","setCustom","sc","setDefault","change","stylename","removeBypass","addBypass","oldcookie","newcookie","brd","join","scrollAnchor","save","sheet","disabled","restore","onTest","m","capitalize","escape","$link","testStyle","pups","succ","time","confirmLongTermTest","localStorage","setItem","JSON","stringify","removeItem","HiddenItems","hideCompletely","ls","kind","lists","write","buildCSS","unhide","hide","hiddenPosts","node","updateCSS","injector","inject","isHidden","hideItem","saveList","unhideItem","hideThread","inCatalog","slideDown","$thread","$form","promise","done","toggleFormFloating","unhideThread","expandthread","threadid","board","expandFrom","data","expandTo","$omitted","prependTo","HTMLoader","getThread","err","replaceWith","replyMap","showReplies","newposts","busy","options","defaults","expectedPost","silent","onError","onSuccess","timestamp","execute","task","next","replies_container","$newposts_get","$lastQrl","last","lastpost","idb","bd","Infinity","insertAdjacentHTML","unreadCounter","refreshTimestamp","info","stack","shift","flyTo","dest","destBox","destX","x","width","destY","elBox","style","transformOrigin","Promise","resolve","reject","getComputedStyle","transition","oldBox","offRight","right","innerWidth","toggle","box","newWidth","left","toggleFormRow","btn","dataset","row","rem","isRowEmpty","_originalTitle","focal","inputs","checked","trim","updateReminders","float","pinner","getParentPost","f","then","drags","mousedown","e","stopPropagation","dragsOff","prop","hidePostForm","_preview","_pinned","toggleFormSimplify","simplify","simplified","clonePostForm","anchorID","preview","boardName","getPostbox","Captcha","enabled","state","newForm","oldForm","cloneNode","innerText","blotter","onclick","uniqueId","l","newid","input","setAttribute","resetForm","richFileInput","initForm","maybePost","_findPrevious","matches","skip","anchor","pinned","ondragstart","ondrop","quickreply","$this","threadID","postID","fromExternalBoard","is_overboard","$preview","isPreview","needInsert","_findNext","formExists","formHidden","formFloating","isOpen","quotation","getPostQuotation","parentElement","insertAdjacentElement","existingForm","_getSelection","getSelection","selection","selectedText","anchorNode","getLocalSelection","sel","_isChildOf","popupMessage","content","delay","console","warn","forceEnable","captchaTimeout","addImgLoadListener","cw","onClick","bind","addEventListener","evt","onFieldClick","onload","onImageLoad","evType","onAnimationEnd","_state","s","offsetWidth","clear","refresh","ctrlKey","altKey","target","switch_lang","cColor","css","slice","ku_boardspath","random","img","src","formatFileSize","bytes","round","handleFiles","fromClipboard","maxfiles","slotsLeft","filesLeft","fileAttached","handleFile","fx","ns","ext","pop","allowedFiletypes","fname","sizeFormatted","size","reader","FileReader","result","addFile","readAsDataURL","extra","index","store","recalcForm","thisEl","updateInfo","toUpperCase","naturalWidth","naturalHeight","onerror","_ext","updateTitle","count","innerHTML","$el","hasClass","serialize","fd","fe","_this","on","$entry","toggleClass","select","items","clipboardData","originalEvent","arr","item","getAsFile","nodeName","dataTransfer","Sortable","create","animation","handle","removeAttribute","area","previousElementSibling","clearStore","handleCtrlEnter","activeElement","Ajax","submitPost","redirectTo","href","sage","hcaptcha","async","response","key","actuallySubmitPost","catch","error","shownErrors","hCaptchaResponse","alertsToRemove","clone","closeByID","showError","showWarning","captchafield","FormData","xr","XMLHttpRequest","postToken","open","action","status","res","parse","error_verbose","error_type","ku_cgipath","badatt","error_data","attachmenttype","position","nokoInput","noko","thread_replyto","post_id","reload","send","reportPost","callback","forms","delform","postsReported","postErrors","success","msg","message","timerToken","postsSaved","$reply","modThread","$a","$li","$posthead","$extrabtns","prepend","makeIcon","deleteItems","has","delToken","inspectFormData","formData","entries","pair","log","classes","bare","addCaptchaToMenu","$menu","keydown","expandimg","postnum","imgurl","thumburl","imgw","imgh","thumbw","thumbh","getElementById","$element","$postbody","$fc_filename","fc_width","event","which","Settings","expandImgFull","max_w","clientWidth","body","offset_el","offsetLeft","offsetParent","new_w","ratio","zoom","new_h","notice","createElement","textDecoration","textNode","createTextNode","appendChild","insertBefore","maxWidth","PostPreviews","zindex","_parseLink","cl","_mouseover","isCatalog","parsedURL","parentid","postid","previewid","children","first","before","mouseleave","_mouseout","mouseover","mouseOverPreview","attr","clientY","pageY","clientX","pageX","zIndex","cursor","getPost","ebtns","pin","$pre","is","clearTimeout","fadeout","nodelay","predelay","_timings","fade","set_inputs","savedName","em","postpassword","set_delpass","special","load","nodeType","tagName","complete","readyState","handler","apply","trigger","jQuery","_checkbox","clicked","settingName","defaultValue","perBoard","settingNameGeneral","removeAttr","fxEnabled","changed","off","is_catalog","sfwMode","constrainWidth","rswap","swap","after","setCaptchaLang","lang","offClick","readyset","isTouch","pf","chpok","LatexIT","checkgotothread","checknamesave","bnrs","processNodeInsertion","cloud20","mouseenter","menu_show","add_mob_menu","head","js","OpenLatexEditor","expandVideo","xl","animate","htm","stripHTML","ref","postnode","formBoard","postBody","qoutation","unwrapEmbed","wrapEmbed","countries","$fig","$fsz","pause","itemCount","$postnode","isOP","opmod","visible","$boundTo","ofs","offsetTop","outerHeight","outerWidth","__menuProps","fileid","isFile","$md","isShown","menu","$item","$pass","$c","special_error","errors","cssLink","styleName","isTrip","resize","$fileMenu","textbox","onfocus","onblur","animationName","catalog","appendTo","trip","getJSON","formatDate","fadeIn","fail","liveupd_ena","io","updater","doubletap","bindType","delegateType","handleObj","targetData","now","delta","lastTouch","touches","origType","property","changedTouches","NTP","calc","t0","t1","t2","t3","sync","force","pending","valueOf","ajax","servertime","synced","timeWithOffset","getServerTime","externallyResolvingPromise","promiseResolve","promiseReject","$node","prettyPrint","render","iv","updateTTL","ms_left","srvTime","min_left","h_left","padLeft","markOnly","clearInterval","setInterval","atLoad","audio","play","noop","newThreads","socket","connect","liveupd_api","subscribeTo","liveupd_sitename","thr","dispatch","emit","writable","configurable","token","notifyAboutNewThreads","notifyAboutNewRepliesOnBoardPage","showNewReplies","hasFocus","board_desc","new_thread_id","showNewThreads","room","repliesOnBoardPage","reply_id","refreshNewRepliesCount","$counter","clearCounter","loadNewReplies","$freshReplies","freshReplies","__alreadyLoading","$wta","bySelf","postsDeleted","insideDeletedThread","filesDeleted","fileErrors","deletedClasses","by_op","by_mod","itemtype","prev","thread_id","kumod","$mov","movieurl","dt","uid","video","checkd","doc","navigatepages","docloc","keyCode","page","docloc_trimmed","lastIndexOf","docloc_valid","relativepost","maxthreads","getElementsByName","newrelativepost","attachEvent","NodeList","Element","parentNode","nextElementSibling","Node","root","postNum","repliesContainer","container","linkData","className","linkDestBoard","linkPostNum","includes","elements","dimensions","scrollY","_top","mid","elMap","parentBCR","elems","relativeVisibleWidth","pos","relativeVisibleHeight","dx","dy","primaryVisibility","secondaryVisibility","primaryOffset","secondaryOffset","bcrBefore","loaded","requestAnimationFrame","bcrAfter","scrollBy","lastTime","vendors","cancelAnimationFrame","currTime","timeToCall","max","menu_current","menu_last","dl","queue","clearQueue","menu_pin","toggle_oldmenu","mode","implementation","hasFeature","eqn","txt","atxt","extxt","r","g","replaceWithSrc","$scope","scope","normalizergb","toFixed","normalizergba","needle","haystack","opt","extend","$drag","z_idx","drg_h","drg_w","pos_y","pos_x","onMove","$iw","paddingBottom","code","iframeOptions","enccode","encodeURI","$ew","empty","isClone","fields","field","onchange","indicator","embedLinks","process","site","nextCheckbox","exp","onmouseleave","hideTimeout","onmouseenter","cms","areaID","ro","readOnly","sub","ttl","min","fileButton","alias","existing","styleSheet","cssText","removeChild","chars","mm","$mmw","overboard_dir","overboard_desc","cats","boards10","getBoards","order","boards","b20","cat","ix","dir","desc","R","sqrt","scale","allboards","o","toexpand","sd","sect","section","rs","rj","query","display","opts","ku_boardsfolder","reduced","bnr","path","toDisplay","randomItem","getRandomInt","array","sites","rx","fruit","conf","layout","respectStickied","expandOnHover","saveConfig","myConf","refreshBtn","sortBtns","v_d_i","pinBtns","hideBtns","layoutBtns","searchInput","$card","getEmbedThumb","currentTarget","threadIX","findIndex","model","hidden","rendered","$group","build","gallery","fileTypes","image","jpgThumb","iconsAvailable","embed","authorities","short","Dow","dateLocal","dows","getDay","yy","getFullYear","mo","getMonth","Mon","mons","dd","getDate","getHours","getMinutes","ss","getSeconds","entry","sortByOrder","sby","repeat","buildEntry","thumbnail_url","outerHTML","thumbnail_medium","processed","expanderBtn","playerBtn","embeds","smallThumb","file_type","thumb_w","thumb_h","ftype","thumbURL","vartype","bigThumb","smallSrc","expandable","op","repliesLabel","reply_count","last_reply","images","countersCombined","posterauthority","nameDatePriority","tripcode","poster","this_board_defaultName","dn","dateCompact","searchData","subject","buildIndicators","layouts","stickied","lock","locked","deathmark","deleted_timestamp","burger","and","indicatorsCombined","tmp","createHTMLDocument","textContent","overboard","boardid","_boards","unique","idFromName","built","lastvisits","last_ts","parseInt","dataType","valstr","$brd","loadThread","boardID","force_html_nocache","thrno","postMap","cached","threadMaps","secondTry","cachedPost","range","threadMap","reduce","cachedPostboxes","pb","firstChild","switchFileType","exts","buildAlert","marginTop","timeout","onHold","old","reverse","ar","ae","holdOffTimeout","scheduleClose","aid","byID","cooldown","upd","cls","contentsOnly","contents","iconMap","historyToggle","destroy","overflow","defaultTimeout","container_id","pupclass","historySize","cloneDeep","junkProperty"],"mappings":"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","file":"kusaba.new.js","sourcesContent":["'use strict';\r\n\r\nvar style_cookie;\r\nvar style_cookie_txt;\r\nvar style_cookie_site;\r\nvar kumod_set=false;\r\nvar ispage;\r\nvar is_entering=false;\r\n\r\nvar _messages = {\r\n  en: {\r\n    noLocalStorage: \"Your browser does not support LocalStorage\",\r\n    oops: \"Something went wrong...\",\r\n    blankResponse: \"blank response\",\r\n    expandingThread: \"Expanding thread...\",\r\n    newThread: \"new thread\",\r\n    NewThread: \"New thread\",\r\n    replyTo: \"reply to\",\r\n    cancel: \"Cancel\",\r\n    update: \"Update\",\r\n    updatingCounts: \"Updating...\",\r\n    couldntFetch: \"Could not fetch this post\",\r\n    noNewPosts: \"No new posts\",\r\n    replies: \"Replies\",\r\n    settings_fxEnabled: \"Animation effects\",\r\n    settings_showReplies: \"Show replies inside posts\",\r\n    settings_sfwMode: \"NSFW mode\",\r\n    settings_expandImgFull: \"Expand images to full size\",\r\n    settings_constrainWidth: \"Constrain content width\",\r\n    enterCaptcha: \"Please enter captcha.\",\r\n    selectText: \"Select some text\",\r\n    dcls: \"Double click to show source\",\r\n    watchOn: \"Watch on\",\r\n    captcharot: \"Captcha has rotted\",\r\n    threadUpdationAutomatically: \"Tread is being updated automatically.\",\r\n    stopFuckingDolls: \"<b>Отключите AJAX-отправку постов и AJAX-обновление треда.</b><br />(Кликните, чтобы закрыть)\",\r\n    del: \"Delete\",\r\n    delandban: \"Delete and ban\",\r\n    ban: \"Ban\",\r\n    stickthread: \"Stick thread\",\r\n    unstickthread: \"Unstick thread\",\r\n    lockthread: \"Lock thread\",\r\n    unlockthread: \"Unlock thread\",\r\n    returnDesktop: \"Switch to desktop interface\",\r\n    returnTouch: \"Switch to touch interface\",\r\n    forceDesktop: \"Force Desktop interface\",\r\n    okay: \"Okay\",\r\n    captchalang: \"Captcha language\",\r\n    reply: \"Reply\",\r\n    imageDownscaledBy: \"Image was downscaled by\",\r\n    videoDownscaledBy: \"Video was downscaled by\",\r\n    toFit: \"to feet screen\",\r\n    newReplies: \"New replies\",\r\n    newThreadsAvailable: \"New threads available.\",\r\n    loading: \"Loading\",\r\n    anonymous: \"Anonymous\",\r\n    sortBy: \"Sort by\",\r\n    bumpOrder: \"Bump order\",\r\n    lastReply: \"Last reply\",\r\n    creationDate: \"Creation date\",\r\n    replyCount: \"Reply count\",\r\n    doStick: \"Respect stickied\",\r\n    showHidden: \"Show hidden\",\r\n    doNotStick: \"Ignore stickied\",\r\n    hideHidden: \"Hide hidden\",\r\n    search: \"Search\",\r\n    threadOnPage: \"Thread is on page\",\r\n    goToThread: \"Go to thread\",\r\n    smallPics: \"Small pictures\",\r\n    largePics: \"Large pictures\",\r\n    legacyMode: \"Legacy mode\",\r\n    threads: \"Threads\",\r\n    comments: \"Replies\",\r\n    active_since: \"Active since\",\r\n    last_active: \"Last seen\",\r\n    active_on: \"Active on\",\r\n    tryAgain: \"Try again\",\r\n    xhrError: \"XHR error\",\r\n    details: \"details\",\r\n    thread: \"Thread\",\r\n    post: 'Post',\r\n    posts: \"Posts\",\r\n    deleted:'has been deleted',\r\n    deletedMulti: 'have been deleted',\r\n    report: 'Report',\r\n    reported:'has been reported',\r\n    reportedMulti: 'have been reported',\r\n    fileRemoved: 'File<br>removed.',\r\n    file: 'File',\r\n    files: 'Files',\r\n    collapse: 'Collapse',\r\n    asMod: 'as Mod',\r\n    asOP: 'as OP',\r\n    historyEmpty: 'History is empty',\r\n    noDataLoaded: 'No data was loaded',\r\n    unable_load_20: 'Unable to load 2.0 boards list',\r\n    captchaLangChanged: 'Captcha laguage changed',\r\n    found: 'Found',\r\n    links: 'Links',\r\n    selectMultiple: 'Select multiple',\r\n    selected: 'Selected',\r\n    directLink: 'Direct link',\r\n    quoteLink: 'Quote link',\r\n    maxAttNumReached: 'Attachments number limit reached.',\r\n    unsupportedFileType: 'unsupported file type',\r\n    hideName: 'Hide file name',\r\n    removeFile: 'Remove file',\r\n    spoilerOnOff: 'Spoier On/Off',\r\n    hidePost: 'Hide post',\r\n    unhidePost: 'Unhide post',\r\n    settings_hideCompletely: 'Hide items completely',\r\n    pinUnpin: 'Pin/Unpin',\r\n    hideForm: 'Hide form',\r\n    collapseExpand: 'Collapse/Expand',\r\n    notEmpty: 'Not empty',\r\n    showName: 'Show/hide name/trip field',\r\n    showSubject: 'Show/hide subject field',\r\n    showEmbeds: 'Show/hide embeds',\r\n    showPassword: 'Show/hide password field',\r\n    showTTL: 'Show/hide time-to-live field',\r\n    attachFile: 'Attach file...',\r\n    classicSimplifiedForm: 'Classic/simplified form',\r\n    showMarkup: 'Show/hide markup',\r\n    refreshCatalog: 'Refresh catalog',\r\n    cancelTimer: 'Cancel timer',\r\n    saved:'saved from deletion',\r\n    savedMulti: 'saved from deletion',\r\n    password: 'Password',\r\n    captcha: 'Captcha',\r\n    captchaImage: 'Captcha image',\r\n    refreshCaptcha: 'Refresh captcha',\r\n    showCaptcha: 'Show captcha',\r\n    captchaExpired: 'Captcha has expired.'\r\n  },\r\n  ru: {\r\n    noLocalStorage: \"localStorage не поддерживается браузером\",\r\n    oops: \"Что-то пошло не так...\",\r\n    blankResponse: \"пустой ответ\",\r\n    expandingThread: \"Разворачиваем тред...\",\r\n    newThread: \"новый тред\",\r\n    NewThread: \"Создать тред\",\r\n    replyTo: \"ответ на\",\r\n    cancel: \"Отмена\",\r\n    update: \"Обновить\",\r\n    updatingCounts: \"Ищем новые посты...\",\r\n    couldntFetch: \"Не удалось загрузить этот пост\",\r\n    noNewPosts: \"Нет новых постов\",\r\n    replies: \"Ответы\",\r\n    settings_fxEnabled: \"Анимированные эффекты\",\r\n    settings_showReplies: \"Показывать ответы внутри поста\",\r\n    settings_sfwMode: \"Мамка в комнате\",\r\n    settings_expandImgFull: \"Разворачивать картинки до исходного размера\",\r\n    settings_constrainWidth: \"Ограничивать ширину контента\",\r\n    enterCaptcha: \"Пожалуйста, введите капчу.\",\r\n    selectText: \"Текст не выделен\",\r\n    dcls: \"Double click to show source\",\r\n    watchOn: \"Смотреть на\",\r\n    odc: \"javascript:LatexIT.replaceWithSrc(this);\",\r\n    captcharot: \"Капча протухла\",\r\n    threadUpdationAutomatically: \"Тред обновляется автоматически\",\r\n    stopFuckingDolls: \"<b>Отключите AJAX-отправку постов и AJAX-обновление треда.</b><br />(Кликните, чтобы закрыть)\",\r\n    del: \"Удалить\",\r\n    delandban: \"Удалить и забанить\",\r\n    ban: \"Забанить\",\r\n    stickthread: \"Прикрепить тред\",\r\n    unstickthread: \"Отлепить тред\",\r\n    lockthread: \"Закрыть тред\",\r\n    unlockthread: \"Открыть тред\",\r\n    returnDesktop: \"Переключиться на десктопный интерфейс\",\r\n    returnTouch: \"Переключиться на тач-интерфейс\",\r\n    forceDesktop: \"Force Desktop interface\",\r\n    okay: \"Ясно\",\r\n    captchalang: \"Язык капчи\",\r\n    reply: \"Ответить\",\r\n    imageDownscaledBy: \"Картинка ужата на\",\r\n    videoDownscaledBy: \"Видео ужато на\",\r\n    toFit: \"по размеру окна\",\r\n    newReplies: \"Новых ответов\",\r\n    newThreadsAvailable: \"Доступны новые треды.\",\r\n    loading: \"Загружаем\",\r\n    anonymous: \"Аноним\",\r\n    sortBy: \"Сортировать по\",\r\n    bumpOrder: \"бампам\",\r\n    lastReply: \"дате ответов\",\r\n    creationDate: \"дате создания\",\r\n    replyCount: \"числу ответов\",\r\n    doStick: \"Прикреплять\",\r\n    showHidden: \"Показывать скрытые\",\r\n    doNotStick: \"Не прикреплять\",\r\n    hideHidden: \"Скрывать скрытые\",\r\n    search: \"Поиск\",\r\n    threadOnPage: \"Тред располагается на странице\",\r\n    goToThread: \"Перейти в тред\",\r\n    smallPics: \"Мелкие картинки\",\r\n    largePics: \"Большие картинки\",\r\n    legacyMode: \"Олдфажный режим\",\r\n    threads: \"Тредов\",\r\n    comments: \"Ответов\",\r\n    active_since: \"Присоединился\",\r\n    last_active: \"Был активен\",\r\n    active_on: \"Активен на\",\r\n    tryAgain: \"Попробовать снова\",\r\n    xhrError: \"Ошибка XHR\",\r\n    details: \"подробности\",\r\n    thread: \"Тред\",\r\n    post: 'Пост',\r\n    posts: 'Посты',\r\n    deleted:'удален',\r\n    deletedMulti: 'удалены',\r\n    report: 'Пожаловаться',\r\n    reported:': жалоба отправлена',\r\n    reportedMulti: ': жалобы отправлены',\r\n    fileRemoved: 'Файл<br>удален.',\r\n    file: 'Файл',\r\n    files: 'Файлы',\r\n    collapse: 'Свернуть',\r\n    asMod: 'от лица модератора',\r\n    asOP: 'от лица ОПа',\r\n    historyEmpty: 'История пуста',\r\n    noDataLoaded: 'Данные не загружены',\r\n    unable_load_20: 'Unable to load 2.0 boards list',\r\n    captchaLangChanged: 'Язык капчи изменен',\r\n    found: 'Найдено',\r\n    links: 'Ссылки',\r\n    selectMultiple: 'Выбрать несколько',\r\n    selected: 'Выбрано',\r\n    directLink: 'Прямая ссылка на пост',\r\n    quoteLink: 'Ссылка для цитирования',\r\n    maxAttNumReached: 'Превышено допустимое число вложений.',\r\n    unsupportedFileType: 'недопустимый тип файла',\r\n    hideName: 'Скрыть имя файла',\r\n    removeFile: 'Удалить файл',\r\n    spoilerOnOff: 'Спойлер Вкл/Выкл',\r\n    hidePost: 'Скрыть пост',\r\n    unhidePost: 'Раскрыть пост',\r\n    settings_hideCompletely: 'Скрывать треды и посты полностью',\r\n    pinUnpin: 'Прикрепить/Открепить',\r\n    hideForm: 'Скрыть форму',\r\n    collapseExpand: 'Свернуть/Развернуть',\r\n    notEmpty: 'Содержит данные',\r\n    showName: 'Показать/скрыть поле имени',\r\n    showSubject: 'Показать/скрыть поле темы',\r\n    showEmbeds: 'Показать/скрыть вложения',\r\n    showPassword: 'Показать/скрыть поле ввода пароля',\r\n    showTTL: 'Показать/скрыть время жизни',\r\n    attachFile: 'Прикрепить файл...',\r\n    classicSimplifiedForm: 'Упрощенная/классическая форма',\r\n    showMarkup: 'Показать/скрыть разметку',\r\n    refreshCatalog: 'Обновить каталог',\r\n    cancelTimer: 'Отменить таймер',\r\n    saved:'спасен от удаления',\r\n    savedMulti: 'спасены от удаления',\r\n    password: 'Пароль',\r\n    captcha: 'Captcha',\r\n    captchaImage: 'Captcha image',\r\n    refreshCaptcha: 'Обновить капчу',\r\n    showCaptcha: 'Показать капчу',\r\n    captchaExpired: 'Капча протухла.'\r\n  }\r\n}\r\nvar _l = (typeof locale !== 'undefined' && _messages.hasOwnProperty(locale)) ? _messages[locale] : _messages.ru;\r\n\r\nvar onReady = {\r\n  pushTask: function(fn) {\r\n    if (this.isReady)\r\n      fn()\r\n    else\r\n      this.tasks.push(fn)\r\n  },\r\n  tasks: [],\r\n  ready: function() {\r\n    this.isReady = true\r\n    this.tasks.forEach(fn=>fn())\r\n  }\r\n}\r\n\r\n/* IE/Opera fix, because they need to go learn a book on how to use indexOf with arrays */ // Is this still relevant tho?\r\nif (!Array.prototype.indexOf) {\r\n  Array.prototype.indexOf = function(elt /*, from*/) {\r\n  var len = this.length;\r\n\r\n  var from = Number(arguments[1]) || 0;\r\n  from = (from < 0)\r\n     ? Math.ceil(from)\r\n     : Math.floor(from);\r\n  if (from < 0)\r\n    from += len;\r\n\r\n  for (; from < len; from++) {\r\n    if (from in this &&\r\n      this[from] === elt)\r\n    return from;\r\n  }\r\n  return -1;\r\n  };\r\n}\r\n\r\n/* Utf8 strings de-/encoder */\r\nvar Utf8 = {\r\n  // public method for url encoding\r\n  encode : function (string) {\r\n    string = string.replace(/\\r\\n/g,\"\\n\");\r\n    var utftext = \"\";\r\n    for (var n = 0; n < string.length; n++) {\r\n      var c = string.charCodeAt(n);\r\n      if (c < 128) {\r\n        utftext += String.fromCharCode(c);\r\n      }\r\n      else if((c > 127) && (c < 2048)) {\r\n        utftext += String.fromCharCode((c >> 6) | 192);\r\n        utftext += String.fromCharCode((c & 63) | 128);\r\n      }\r\n      else {\r\n        utftext += String.fromCharCode((c >> 12) | 224);\r\n        utftext += String.fromCharCode(((c >> 6) & 63) | 128);\r\n        utftext += String.fromCharCode((c & 63) | 128);\r\n      }\r\n    }\r\n    return utftext;\r\n  },\r\n  // public method for url decoding\r\n  decode : function (utftext) {\r\n    var string = \"\", i = 0, c = 0, c1 = 0, c2 = 0, c3 = 0\r\n    while ( i < utftext.length ) {\r\n      c = utftext.charCodeAt(i);\r\n      if (c < 128) {\r\n        string += String.fromCharCode(c);\r\n        i++;\r\n      }\r\n      else if((c > 191) && (c < 224)) {\r\n        c2 = utftext.charCodeAt(i+1);\r\n        string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\r\n        i += 2;\r\n      }\r\n      else {\r\n        c2 = utftext.charCodeAt(i+1);\r\n        c3 = utftext.charCodeAt(i+2);\r\n        string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\r\n        i += 3;\r\n      }\r\n    }\r\n    return string;\r\n  }\r\n}\r\n\r\nfunction Cookie(name) {\r\n  if (arguments.length == 1) {\r\n    // with(document.cookie) {\r\n      var regexp=new RegExp(\"(^|;\\\\s+)\"+name+\"=(.*?)(;|$)\");\r\n      var hit=regexp.exec(document.cookie);\r\n      if(hit&&hit.length>2) return Utf8.decode(unescape(replaceAll(hit[2],'+','%20')));\r\n      else return '';\r\n    // }\r\n  } else {\r\n    var value = arguments[1]\r\n    , days = arguments[2]\r\n    , expires=\"\"\r\n    if(days) {\r\n      var date=new Date();\r\n      date.setTime(date.getTime()+(days*24*60*60*1000));\r\n      expires=\"; expires=\"+date.toGMTString();\r\n    }\r\n    document.cookie=name+\"=\"+value+expires+\"; path=/\";\r\n  }\r\n}\r\n\r\nfunction replaceAll(str, from, to) {\r\n  var idx = str.indexOf( from );\r\n  while ( idx > -1 ) {\r\n    str = str.replace( from, to );\r\n    idx = str.indexOf( from );\r\n  }\r\n  return str;\r\n}\r\n\r\nvar _lastActiveForm = false\r\nObject.defineProperty(window, 'lastActiveForm', {\r\n  get: function() {\r\n    if (!_lastActiveForm || !_lastActiveForm.getClientRects().length) {\r\n      updateActiveForm()\r\n    }\r\n    return _lastActiveForm\r\n  },\r\n  set: function(el) {\r\n    document.querySelectorAll('.qrf-active').forEach(a => a.classList.remove('qrf-active'))\r\n    if (el) {\r\n      let form = el._findParent('form') // _findParent retuns element itself if in matches the selector\r\n      form.classList.add('qrf-active')\r\n      if (form.classList.contains('collapsed')) {\r\n        toggleFormCollapse(form, false/*← uncollapse*/, false/*← no focus*/)\r\n      }\r\n      _lastActiveForm  = form\r\n    }\r\n    else\r\n      _lastActiveForm = false\r\n  }\r\n})\r\nfunction updateActiveForm() {\r\n  let floating = document.querySelector('.qrf-floating:not(.collapsed)')\r\n  if (floating) {\r\n    lastActiveForm = floating\r\n    return\r\n  }\r\n  lastActiveForm = findClosest('.qrf-floating.collapsed, .quick-reply-form textarea')\r\n  return\r\n}\r\n\r\nfunction findClosest(selector) {\r\n  let height = window.innerHeight\r\n  , hh = height / 2\r\n  , list = document.querySelectorAll(selector)\r\n  if (!list) return false\r\n  let closest = [].map.call(list, el => {\r\n    let rect = el.getClientRects()\r\n    , offset = rect.length\r\n      ? Math.abs(hh - (rect[0].y + rect[0].height/2))\r\n      : null\r\n    return { el: el, offset: offset }\r\n  })\r\n  .filter(a => a.offset !== null)\r\n  .sort((e1, e2) => e1.offset < e2.offset ? -1 : 1)\r\n  return closest.length ? closest[0].el : false\r\n}\r\n\r\nfunction insert(text, breakBefore=true, breakAfter=true) {\r\n  let form = lastActiveForm || document.querySelector('#postform')\r\n  , textarea = form && form.querySelector('textarea')\r\n  if(textarea) {\r\n    if (form.classList.contains('collapsed')) {\r\n      toggleFormCollapse(form, false/*← uncollapse*/, false/*← no focus*/)\r\n    }\r\n    let start = textarea.selectionStart\r\n    , end = textarea.selectionEnd\r\n    , pre = textarea.value.substr(0,start)\r\n    , post = textarea.value.substr(end)\r\n    , charBefore = pre[pre.length-1]\r\n    , charAfter = post[0]\r\n    if (breakBefore && text[0] !== \"\\n\" && charBefore && charBefore !== \"\\n\")\r\n      text = \"\\n\"+text\r\n    if (breakAfter && text[text.length-1] !== \"\\n\" && charAfter !== \"\\n\")\r\n      text += \"\\n\"\r\n    let selectionRange = start + text.length\r\n    textarea.value = pre + text + post\r\n    textarea.setSelectionRange(selectionRange, selectionRange)\r\n    textarea.focus()\r\n  }\r\n}\r\n\r\nfunction markup($target, start, end, istart, iend) {\r\n  let element = $target.find('textarea').get(0);\r\n  if (element.selectionStart || element.selectionStart == '0') {\r\n    element.focus();\r\n    let startPos = element.selectionStart\r\n    , endPos = element.selectionEnd\r\n    , selected = element.value.substring(startPos, endPos);\r\n    if(selected.indexOf('\\n') === (-1) && typeof istart !== \"undefined\" && typeof iend !== \"undefined\") {\r\n      start = istart; end = iend;\r\n    }\r\n    element.value = element.value.substring(0, startPos) + start + element.value.substring(startPos, endPos) + end + element.value.substring(endPos, element.value.length);\r\n  } else {\r\n    element.value += start + end;\r\n  }\r\n}\r\n\r\nfunction bullets($target, bullet, istart, iend) {\r\n  let $area = $target.find('textarea')\r\n  , element = $area[0]\r\n  , startPos = element.selectionStart\r\n  , endPos = element.selectionEnd\r\n  , selected = $area.val().substring(startPos, endPos)\r\n  if(!~selected.indexOf('\\n') && typeof istart !== \"undefined\" && typeof iend !== \"undefined\") {\r\n    element.value = element.value.substring(0, startPos) + istart + element.value.substring(startPos, endPos) + iend + element.value.substring(endPos, element.value.length);\r\n  }\r\n  else {\r\n    selected = $area.val().substring(startPos, endPos).split('\\n');\r\n    var newtxt = \"\";\r\n    for(var i=0; i<selected.length; i++) {\r\n      newtxt += (bullet + selected[i]);\r\n      if(i < (selected.length - 1)) newtxt += '\\n';\r\n    }\r\n    $area.val(\r\n      $area.val().substring(0, startPos)\r\n      + newtxt +\r\n      $area.val().substring(endPos)\r\n    );\r\n  }\r\n}\r\n\r\nfunction quotes($target, type) {\r\n  let $area = $target.find('textarea')\r\n  , areaVal = $area.val()\r\n  , element = $area[0]\r\n  , startPos = element.selectionStart\r\n  , endPos = element.selectionEnd\r\n  , selected = areaVal.substring(startPos, endPos)\r\n  , newtxt = \"\"\r\n  if (~selected.indexOf('\\n')) { // multiline quoting\r\n    selected = areaVal.substring(startPos, endPos).split('\\n')\r\n    for(var i=0; i<selected.length; i++) {\r\n      let bullet = (type=='g') ? '>'\r\n        : (type=='r') ? '<'\r\n          : (i%2) ? '<'\r\n            : '>'\r\n      newtxt += (bullet + ' ' + selected[i])\r\n      if(i < (selected.length - 1)) newtxt += '\\n'\r\n    }\r\n  }\r\n  else { // inline quoting\r\n    let tag = type=='r' ? 'rq' : 'q'\r\n    newtxt = `[${tag}]${selected}[/${tag}]`\r\n  }\r\n  element.value =\r\n    areaVal.substring(0, startPos)\r\n    + newtxt +\r\n    areaVal.substring(endPos)\r\n}\r\n\r\nfunction quote(b, a) {\r\n  var v = eval(\"document.\" + a + \".message\");\r\n  v.value += \">>\" + b + \"\\n\";\r\n  v.focus();\r\n}\r\n\r\nfunction checkhighlight() {\r\n  var match;\r\n  if(match=/#i([0-9]+)/.exec(document.location.toString()))\r\n    if(!$('#postform textarea').val())\r\n      insert(\">>\"+match[1]);\r\n  if(match=/#([0-9]+)/.exec(document.location.toString()))\r\n    highlight(match[1]);\r\n}\r\n\r\nfunction highlight(id, offTimeout=5000) {\r\n  $('.highlight').removeClass('highlight');\r\n  if (!(''+id).split('-')[1])\r\n    id += '-'+this_board_dir\r\n  let $post = $(`#postbody${id}`).parents('.reply')\r\n  if (!$post.length) return false;\r\n  let post = $post[0]\r\n  $post.addClass('highlight');\r\n  if (offTimeout) {\r\n    setTimeout(() => $post.removeClass('highlight'), offTimeout)\r\n  }\r\n  // Scroll to post\r\n  let bcr = post.getBoundingClientRect()\r\n  , docHeight = document.documentElement.clientHeight\r\n  if (bcr.bottom > docHeight || bcr.top < 0) {\r\n    let postX = bcr.top + document.documentElement.scrollTop\r\n    , spaceAround = docHeight - bcr.height\r\n    window.scrollTo(0, postX - (spaceAround ? Math.ceil(spaceAround/2) : 0))\r\n  }\r\n  return true\r\n}\r\n\r\nconst password_length = 20;\r\n\r\nfunction get_password(name) {\r\n  let pass = getCookie(name);\r\n  if(pass) return pass;\r\n  pass = randomString(password_length)\r\n  Cookie(name, pass, 365);\r\n  return(pass);\r\n}\r\n\r\nfunction togglePassword() {\r\n  var passwordbox_html = $(\"#passwordbox\").html().toLowerCase();\r\n  var newhtml = '<td></td><td></td>';\r\n  if (passwordbox_html == newhtml) {\r\n    newhtml = '<td class=\"postblock\">Mod</td><td><input type=\"text\" name=\"modpassword\" size=\"28\" maxlength=\"75\">&nbsp;<acronym title=\"Display staff status (Mod/Admin)\">D</acronym>:&nbsp;<input type=\"checkbox\" name=\"displaystaffstatus\" checked>&nbsp;<acronym title=\"Lock\">L</acronym>:&nbsp;<input type=\"checkbox\" name=\"lockonpost\">&nbsp;&nbsp;<acronym title=\"Sticky\">S</acronym>:&nbsp;<input type=\"checkbox\" name=\"stickyonpost\">&nbsp;&nbsp;<acronym title=\"Raw HTML\">RH</acronym>:&nbsp;<input type=\"checkbox\" name=\"rawhtml\">&nbsp;&nbsp;<acronym title=\"Name\">N</acronym>:&nbsp;<input type=\"checkbox\" name=\"usestaffname\"></td>';\r\n  }\r\n  $(\"#passwordbox\").html(newhtml).show();\r\n  return false;\r\n}\r\n\r\n// proxied functions\r\nfunction getCookie(name)                {   return Cookie(name)                     }\r\nfunction set_cookie(name,value,days)    {   return Cookie(name,value,days)          }\r\n\r\nvar Styles = {\r\n  all: [], titles: [],\r\n  init: function() {\r\n    _.each(document.getElementsByTagName(\"link\"), function(link) {\r\n      if(link.getAttribute(\"rel\").indexOf(\"style\")!=-1 && link.getAttribute(\"title\")) {\r\n        this.all.push(link);\r\n        this.titles.push(link.getAttribute(\"title\"));\r\n        if(link.getAttribute(\"rel\").indexOf(\"alternate\")===-1) {\r\n          this._default = link.getAttribute(\"title\");\r\n        }\r\n        if(link.hasAttribute(\"data-custom\")) {\r\n          this.custom = link.getAttribute(\"title\");\r\n        }\r\n      }\r\n    }, this);\r\n    this.current = this._default;\r\n    var customBypass = getCookie('bypasscustom');\r\n    this.customBypass = (customBypass.length && typeof this_board_dir !== 'undefined' && in_array(this_board_dir, customBypass.split('|'))) ? true : false;\r\n    this.initiated = true\r\n  },\r\n  decide: function() {\r\n    this.init();\r\n    var testingCSS = LSfetchJSON('testing-css')\r\n    if(testingCSS) {\r\n      let title = this.addStyle(testingCSS.url, testingCSS.title)\r\n      this.setStyle(title)\r\n      var $clink = $('<a href=\"#\">Отключить тестирование '+title+'.css</a>')\r\n      $clink.click(function(ev) {\r\n        ev.preventDefault()\r\n        Styles.quitTest()\r\n        $(this).parent().slideUp()\r\n      })\r\n      this.$cancelLink = $('<div style=\"font-weight: bold\"></div>').append($clink)\r\n      return\r\n    }\r\n    if(this.hasOwnProperty('custom') && !this.customBypass)\r\n      return this.setCustom();\r\n    var sc = getCookie(style_cookie);\r\n    if(sc && in_array(sc, this.titles))\r\n      this.setStyle(sc);\r\n    else {\r\n      this.setDefault();\r\n      set_cookie(\"kustyle_site\",this._default,365);\r\n      set_cookie(\"kustyle\",this._default,365);\r\n    }\r\n  },\r\n  change: function(stylename) {\r\n    if(!in_array(stylename, this.titles) || this.current === stylename) return;\r\n    this.setStyle(stylename);\r\n    if(this.hasOwnProperty('custom') && this.custom === stylename) {\r\n      this.removeBypass();\r\n    }\r\n    else {\r\n      if(this.hasOwnProperty('custom'))\r\n        this.addBypass();\r\n      set_cookie(\"kustyle_site\",stylename,365);\r\n      set_cookie(\"kustyle\",stylename,365);\r\n    }\r\n  },\r\n  removeBypass: function() {\r\n    if(!this.customBypass || typeof this_board_dir === 'undefined') return;\r\n    this.customBypass = false;\r\n    var oldcookie = getCookie('bypasscustom').split('|'), newcookie = [];\r\n    _.each(oldcookie, function(brd) {\r\n      if(brd !== this_board_dir) newcookie.push(brd);\r\n    });\r\n    newcookie = newcookie.length ? newcookie.join('|') : '';\r\n    set_cookie(\"bypasscustom\",newcookie,365);\r\n  },\r\n  addBypass: function() {\r\n    if(this.customBypass || typeof this_board_dir === 'undefined') return;\r\n    this.customBypass = true;\r\n    var cookie = getCookie('bypasscustom').split('|');\r\n    if(!in_array(this_board_dir, cookie)) {\r\n      cookie.push(this_board_dir);\r\n      set_cookie(\"bypasscustom\",cookie.join('|'),365);\r\n    }\r\n  },\r\n  setDefault: function() {\r\n    if(this.hasOwnProperty('_default') && this.current !== this._default)\r\n      this.setStyle(this._default);\r\n  },\r\n  setCustom: function() {\r\n    if(this.hasOwnProperty('custom'))\r\n      this.setStyle(this.custom);\r\n  },\r\n  setStyle: function(stylename) {\r\n    if(!in_array(stylename, this.titles)) return;\r\n    if (scrollAnchor && scrollAnchor.save)\r\n      scrollAnchor.save('setstyle', '.postnode')\r\n    _.each(this.all, function(sheet) {\r\n      sheet.disabled=true;    // Hello IE\r\n      if(sheet.getAttribute(\"title\") === stylename)\r\n        sheet.disabled=false;\r\n    });\r\n    if (scrollAnchor && scrollAnchor.restore)\r\n      scrollAnchor.restore('setstyle')\r\n    this.current = stylename;\r\n  },\r\n  onTest: null,\r\n  addStyle: function(url, title='') {\r\n    if (! title) {\r\n      let m = /(?:.+\\/)?(.+)\\.css/i.exec(url)\r\n      if(!m) return;\r\n      title = m[1]\r\n    }\r\n    title = _.capitalize(_.escape(title))\r\n    if(!in_array(title, this.titles)) {\r\n      var $link = $('<link rel=\"stylesheet\" type=\"text/css\" href=\"'+url+'\" title=\"'+title+'\" disabled>')\r\n      $('head').append($link);\r\n      this.titles.push(title)\r\n      this.all.push($link[0])\r\n    }\r\n    return title\r\n  },\r\n  testStyle: function(url, title) {\r\n    title = this.addStyle(url, title)\r\n    this.setStyle(title)\r\n    this.onTest = {\r\n      url: url,\r\n      title: title\r\n    }\r\n    pups.succ(`Установлен стиль ${title}.\r\n      <div class=\"styletest-form\">\r\n        <button onclick=\"Styles.confirmLongTermTest()\">OK</button>\r\n        <button onclick=\"Styles.quitTest()\">${_l.cancel}</button>\r\n      </div>`, {time: 0, save: true})\r\n  },\r\n  confirmLongTermTest: function() {\r\n    if(this.onTest)\r\n      localStorage.setItem('testing-css', JSON.stringify(this.onTest))\r\n  },\r\n  quitTest: function() {\r\n    localStorage.removeItem('testing-css')\r\n    this.decide()\r\n  }\r\n}\r\nif(style_cookie) Styles.decide();\r\n\r\nvar HiddenItems = {\r\n  init: function() {\r\n    this.hideCompletely = localStorage['hideCompletely.'+this_board_dir]=='true'\r\n    ;['posts', 'threads'].forEach(kind => {\r\n      let ls = localStorage[`hidden${_.capitalize(kind)}`]\r\n      , list = ls ? ls.split(',').filter(a => a) : []\r\n      this.lists[kind] = list\r\n    })\r\n    document.write(`<style id=\"injector:hideitems\">${this.buildCSS()}</style>`)\r\n  },\r\n  buildCSS: function() {\r\n    let unhide = [], hide = [], hiddenPosts = []\r\n    ;['posts', 'threads'].forEach(kind => {\r\n      this.lists[kind].forEach(id => {\r\n        if (kind==\"posts\") {\r\n          let node = `#postnode${id}`\r\n          hiddenPosts.push(node)\r\n          if (this.hideCompletely)\r\n            hide.push(node)\r\n          else\r\n            hide.push(`#postbody${id}`)\r\n        }\r\n        else if(ispage) {\r\n          hide.push(`#thread${id}`)\r\n          if (this.hideCompletely) {\r\n            hide.push(`#unhidethread${id}`)\r\n            hide.push(`#thread${id} + br`)\r\n            hide.push(`#thread${id} + br + hr`)\r\n          }\r\n          else {\r\n            unhide.push(`#unhidethread${id}`)\r\n          }\r\n        }\r\n      })\r\n    })\r\n    if (hiddenPosts.length) {\r\n      onReady.pushTask(() => {\r\n        $(hiddenPosts.join(',')).addClass('post-hidden')\r\n      })\r\n    }\r\n    return (hide.length ? hide.join(',') + '{ display: none }' : '') +\r\n      (unhide.length ? unhide.join(',') + '{ display: inline-block }' : '')\r\n  },\r\n  updateCSS: function() {\r\n    injector.inject('hideitems', this.buildCSS())\r\n  },\r\n  hideCompletely: false,\r\n  lists: {},\r\n  isHidden: function(kind, id) {\r\n    return this.lists[kind+'s'].indexOf(id.toString()) != -1 \r\n  },\r\n  hideItem: function(kind, id) {\r\n    if (this.isHidden(kind, id)) return;\r\n    this.lists[kind+'s'].push(id)\r\n    this.saveList(kind)\r\n  },\r\n  unhideItem: function(kind, id) {\r\n    if (!this.isHidden(kind, id)) return;\r\n    this.lists[kind+'s'] = this.lists[kind+'s'].filter(a => a!=id)\r\n    this.saveList(kind)\r\n  },\r\n  hideThread: function(id, inCatalog=false) {\r\n    this.hideItem('thread', id)\r\n    $('#unhidethread' + id).slideDown()\r\n    let $thread = $('#thread' + id)\r\n    , $form = $thread.find('.qrf-floating')\r\n    $thread.slideUp().promise().done(updateActiveForm)\r\n    if ($form.length)\r\n      toggleFormFloating($form[0], false /* ← float=off*/, false /* ← no focus*/)\r\n  },\r\n  unhideThread: function(id, inCatalog=false) {\r\n    this.unhideItem('thread', id)\r\n    $('#thread' + id).slideDown()\r\n    $('#unhidethread' + id).slideUp()\r\n  },\r\n  hidePost: function(id) {\r\n    this.hideItem('post', id)\r\n    $('#postbody' + id).slideUp('fast')\r\n  },\r\n  unhidePost: function(id) {\r\n    this.unhideItem('post', id)\r\n    $('#postbody' + id).slideDown('fast')\r\n  },\r\n  saveList: function(kind) {\r\n    localStorage[`hidden${_.capitalize(kind)}s`] = this.lists[kind+'s'].join(',')\r\n  }\r\n}\r\nHiddenItems.init()\r\n\r\nfunction expandthread(threadid, board, ev) {\r\n  ev.preventDefault()\r\n  let $thread = $(`#thread${threadid}-${board}`)\r\n  if ($thread.length) {\r\n    let expandFrom = + $thread.find('.postnode.op').data('id')\r\n    , expandTo = + $thread.find('.postnode:not(.op):first').data('id')\r\n    , $omitted = $thread.find('.omittedposts')\r\n    $omitted.find('a').hide()\r\n    if (! $omitted.find('span').length) {\r\n      $(`<div class=\"spinner\"></div><span>${_l.loading}...</span>`).prependTo($omitted)\r\n    }\r\n    else {\r\n      $omitted.find('.spinner').show()\r\n    }\r\n    HTMLoader.getThread(board, +threadid, [expandFrom, expandTo], (err, posts) => {\r\n      if (posts) {\r\n        $thread.find('.omittedposts').replaceWith(posts)\r\n        replyMap.showReplies()\r\n      }\r\n      else {\r\n        setTimeout(() => $omitted.find('.spinner').hide(), 1000)\r\n        $omitted.find('span').text(_l.oops + (err !== false ? ` (${err})` : ''))\r\n        $omitted.find('a').text(_l.tryAgain).show()\r\n      }\r\n    })\r\n  }\r\n  return false;\r\n}\r\n\r\nvar newposts = {\r\n  busy: false,\r\n  get: function(options={}) {\r\n    options = _.defaults(options, {\r\n      threadid: null,\r\n      expectedPost: null,\r\n      silent: false,\r\n      onError: err => pups.err(`Error geting new posts (${err})`),\r\n      onSuccess: null,\r\n      timestamp: null\r\n    })\r\n    if (!options.threadid) {\r\n      if (ispage)\r\n        return options.onError()\r\n      options.threadid = +$('input[name=replythread]').val()\r\n    }\r\n    this.pushTask(options)\r\n    return false\r\n  },\r\n  execute: function(task) {\r\n    this.busy = true\r\n    let threadid = ''+task.threadid\r\n    , expectedPost = task.expectedPost\r\n    , onError = err => {\r\n      this.next()\r\n      task.onError(err)\r\n    }\r\n    if (!threadid.split('-')[1])\r\n      threadid += '-'+this_board_dir\r\n    let replies_container, $newposts_get\r\n    if (!ispage) {\r\n      $newposts_get = $('#newposts_get')\r\n      $newposts_get.removeClass('upd-counting').addClass('upd-updating')\r\n      replies_container = document.querySelector('.replies')\r\n    }\r\n    else {\r\n      replies_container = document.querySelector(`#thread${threadid} .replies`)\r\n      if (!replies_container) return onError('No replies container!');\r\n    }\r\n    // If post is already there, skip the entire thing\r\n    if (expectedPost && highlight(expectedPost)) {\r\n      $newposts_get.removeClass('upd-updating')\r\n      this.next()\r\n      return\r\n    }\r\n    let $lastQrl = $(`.qrl[data-parent=\"${threadid}\"]`).last()\r\n    , lastpost = ($lastQrl.data('postnum') || $lastQrl.data('parent'))+''\r\n    if (! lastpost) return onError();\r\n    let idb = threadid.split('-')\r\n    , id = idb[0], bd = idb[1]\r\n    HTMLoader.getThread(bd, id, [+(lastpost.split('-')[0]),Infinity], (err, posts) => {\r\n      if (!ispage) {\r\n        $newposts_get.removeClass('upd-updating')\r\n      }\r\n      if (posts) {\r\n        replies_container.insertAdjacentHTML('beforeend', posts)\r\n        replyMap.showReplies()\r\n        unreadCounter.refreshTimestamp(task.timestamp || null, bd)\r\n        if (task.onSuccess)\r\n          task.onSuccess()\r\n      }\r\n      else {\r\n        if (!task.silent) {\r\n          pups.info(posts === '' ? _l.noNewPosts : _l.oops + (err !== false ? ` (${err})` : ''), {time: 1})\r\n        }\r\n      }\r\n      if (expectedPost && !highlight(expectedPost)) {\r\n        return onError('No target reply!');\r\n      }\r\n      this.next()\r\n    }, false, true)\r\n  },\r\n  pushTask: function(task) {\r\n    if (this.busy)\r\n      this.stack.push(task)\r\n    else\r\n      this.execute(task)\r\n  },\r\n  next: function() {\r\n    let next = this.stack.shift()\r\n    if (next)\r\n      this.execute(next)\r\n    else\r\n      this.busy = false\r\n  }, \r\n  stack: []\r\n}\r\n\r\n// Hiding animation\r\nfunction flyTo(el, dest) {\r\n  let destBox = dest.getBoundingClientRect()\r\n  , destX = destBox.x + (destBox.width / 2)\r\n  , destY = destBox.y + (destBox.height / 2)\r\n  , elBox = el.getBoundingClientRect()\r\n  el.style.transformOrigin = `${(destX - elBox.x) + 'px'} ${(destY - elBox.y) + 'px'}`\r\n  el.classList.add('fly-to-zero')\r\n  return new Promise((resolve, reject) => {\r\n    setTimeout(() => {\r\n      el.classList.remove('fly-to-zero')\r\n      el.style.transformOrigin = null\r\n      resolve(el)\r\n    }, (+getComputedStyle(el).transition.match(/transform ([0-9\\.]+)/)[1] * 1000) + 100 )\r\n  })\r\n}\r\n\r\nfunction toggleFormCollapse(form, collapse = !form.classList.contains('collapsed'), focus = !collapse) {\r\n  let oldBox = form.getBoundingClientRect()\r\n  , offRight = oldBox.right - (window.innerWidth - 32)\r\n  form.classList.toggle('collapsed', collapse)\r\n  let box = form.getBoundingClientRect()\r\n  , newWidth = box.width\r\n  form.style.left = \r\n    box.left \r\n    + (oldBox.width - newWidth) \r\n    - (offRight > 0 ? offRight : 0) \r\n    + 'px'\r\n  form.querySelector('.collapser').classList.toggle('collapsed', collapse)\r\n  if (focus) {\r\n    form.querySelector('textarea').focus()\r\n  }\r\n}\r\n\r\nfunction toggleFormRow(form, btn) {\r\n  let id = btn.dataset.toggle\r\n  , row = form.querySelector(`.${btn.dataset.toggle}-row`)\r\n  if (! row) return;\r\n  let show = row.classList.toggle('row-shown')\r\n  btn.querySelector('svg').classList.toggle('pressed', show)\r\n  let rem = show ? 0 : isRowEmpty(row, id)\r\n  btn.classList.toggle('button-with-reminder', rem)\r\n  if (rem) {\r\n    if (! btn._originalTitle)\r\n      btn._originalTitle = btn.title\r\n    btn.title = `${btn._originalTitle} (${_l.notEmpty})`\r\n  }\r\n  else if (btn._originalTitle)\r\n    btn.title = btn._originalTitle\r\n  if (show) { // focus on field\r\n    let focal = null\r\n    if (id == 'subject-send') {\r\n      let i = form.querySelector('input[name=subject]')\r\n      if (!i.value)\r\n        focal = i\r\n    }\r\n    if (id == 'name') {\r\n      let i = form.querySelector('input[name=name]')\r\n      if (!i.value && !i.disabled)\r\n        focal = i\r\n    }\r\n    if (id == 'embed') {\r\n      let inputs = [].filter.call(form.querySelectorAll('input[type=text][name^=embed]'), \r\n        el => el.getClientRects().length && !el.value)\r\n      if (inputs.length)\r\n        focal = inputs[0]\r\n    }\r\n    if (focal)\r\n      focal.focus()\r\n  }\r\n}\r\n\r\nfunction isRowEmpty(row, id) {\r\n  return !!(\r\n    (id == 'name' &&\r\n      row.querySelector('input[name=name]').value != ''\r\n      &&\r\n      !row.querySelector('input[name=disable_name]').checked\r\n    ) ||\r\n    (id == 'subject-send' &&\r\n      row.querySelector('input[name=subject]').value != ''\r\n    ) ||\r\n    (id == 'embed' &&\r\n      [].find.call(row.querySelectorAll('input[type=text]'), i => i.value.trim())\r\n    ) ||\r\n    (id == 'ttl' &&\r\n      row.querySelector('input[name=ttl-enable]').checked\r\n    )\r\n  )\r\n}\r\n\r\nfunction updateReminders(form) {\r\n  ['name', 'subject-send', 'embed', 'ttl'].forEach(id => {\r\n    let row = form.querySelector(`.${id}-row:not(.row-shown)`)\r\n    , btn = row && form.querySelector(`.simplified-toggle[data-toggle=\"${id}\"]`)\r\n    if (btn)\r\n      btn.classList.toggle('button-with-reminder', isRowEmpty(row, id))\r\n  })\r\n}\r\n\r\nfunction toggleFormFloating(form, float, focus=true) {\r\n  let pinner = form.querySelector('.pinner')\r\n  pinner.classList.toggle('pinned', !float)\r\n  pinner.classList.toggle('unpinned', float)\r\n  if (float) { // Make the form floating\r\n    // Pin other forms\r\n    scrollAnchor.save('toggleFormFloating', form.getParentPost())\r\n    document.querySelectorAll('.qrf-floating').forEach(f => toggleFormFloating(f, false))\r\n    scrollAnchor.restore('toggleFormFloating')\r\n    .then(() => { // When all scrolling is settled\r\n      let box = form.getBoundingClientRect()\r\n      form.classList.add('qrf-floating')\r\n      form.classList.remove('qrf-builtin', 'qrf-builtin-back')\r\n      form.style.top = box.top + 'px'\r\n      form.style.left = box.left + 'px'\r\n      $(form).drags()\r\n      .find('input, textarea, select, label, .fe-sort-wrapper, button, .b-icon').mousedown(function(e) {\r\n        e.stopPropagation()\r\n      })\r\n    })\r\n  }\r\n  else { // Build the form back in\r\n    form.classList.remove('qrf-floating', 'collapsed')\r\n    form.querySelector('.collapser').classList.remove('collapsed')\r\n    form.classList.add('qrf-builtin', 'qrf-builtin-back')\r\n    $(form).dragsOff()\r\n    ;['top', 'left', 'zIndex'].forEach(prop => form.style[prop] = null)\r\n  }\r\n  if (focus)\r\n    form.querySelector('textarea').focus()\r\n}\r\n\r\nfunction hidePostForm(form) {\r\n  form.classList.add('hidden')\r\n  toggleFormFloating(form, false)\r\n  toggleFormCollapse(form, false)\r\n  setTimeout(() => {\r\n    form.classList.remove('qrf-builtin-back')\r\n  }, 200)\r\n  if (form._preview) {\r\n    let pinner = form._preview.querySelector('.pinner')\r\n    if (pinner) {\r\n      pinner.classList.remove('pinned')\r\n      pinner.classList.add('unpinned')\r\n    }\r\n    form._preview._pinned = false\r\n  }\r\n  updateActiveForm()\r\n}\r\n\r\nfunction toggleFormSimplify(form, simplify) {\r\n  let simplified = form.classList.toggle('postform-simplified', simplify)\r\n  if (simplified)\r\n    updateReminders(form)\r\n}\r\n\r\nfunction clonePostForm(anchorID, preview, boardName=null) {\r\n  return new Promise((resolve, reject) => {\r\n    HTMLoader.getPostbox(boardName).then(oldForm => {\r\n      if (Captcha.enabled)\r\n        Captcha.state = 'init' // Destroy old captcha because it will be inevitably reloaded at form cloning\r\n      let newForm = oldForm.cloneNode(true)\r\n      newForm.id = anchorID + '_qrf'\r\n      newForm.dataset.anchorID = anchorID\r\n      newForm.classList.remove('main-reply-form')\r\n      newForm.querySelector('.simplified-send-row .primary span').innerText = _l.reply\r\n      newForm.querySelector('input[name=\"postpassword\"]').value = get_password('postpassword')\r\n      newForm.querySelector('input.primary').value = _l.reply\r\n      newForm.querySelector('.noko-row').remove()\r\n      let blotter = newForm.querySelector('.blotter-row')\r\n      if (preview)\r\n        newForm._preview = preview\r\n      blotter.insertAdjacentHTML('afterend', `\r\n        <span class=\"extrabtns simplified-extras\">\r\n          ${newForm.querySelector('.name-row') ? `\r\n            <a href=\"#\" class=\"simplified-toggle\" data-toggle=\"name\" title=\"${_l.showName}\">\r\n              <svg class=\"icon b-icon\"><use xlink:href=\"#i-name\"></use></svg>\r\n            </a>\r\n          ` : ''}\r\n          <a href=\"#\" class=\"simplified-toggle\" data-toggle=\"subject-send\" title=\"${_l.showSubject}\">\r\n            <svg class=\"icon b-icon\"><use xlink:href=\"#i-subject\"></use></svg>\r\n          </a>\r\n          <a href=\"#\" class=\"s-markup\" data-toggle=\"password\" title=\"${_l.showMarkup}\">\r\n            <svg class=\"icon b-icon\"><use xlink:href=\"#i-markup\"></use></svg>\r\n          </a>\r\n          ${newForm.querySelector('.embed-row') ? `\r\n            <a href=\"#\" class=\"simplified-toggle\" data-toggle=\"embed\" title=\"${_l.showEmbeds}\">\r\n              <svg class=\"icon b-icon\"><use xlink:href=\"#i-embed\"></use></svg>\r\n            </a>\r\n          ` : ''}\r\n          <a href=\"#\" class=\"simplified-toggle\" data-toggle=\"password\" title=\"${_l.showPassword}\">\r\n            <svg class=\"icon b-icon\"><use xlink:href=\"#i-password\"></use></svg>\r\n          </a>\r\n          ${newForm.querySelector('.ttl-row') ? `\r\n            <a href=\"#\" class=\"simplified-toggle\" data-toggle=\"ttl\" title=\"${_l.showTTL}\">\r\n              <svg class=\"icon b-icon\"><use xlink:href=\"#i-timer\"></use></svg>\r\n            </a>\r\n          ` : ''}\r\n        </span>`)\r\n      // Name reminder\r\n      updateReminders(newForm)\r\n      // Enabling extra inputs in simplified form\r\n      newForm.querySelectorAll('.simplified-toggle').forEach(a => {\r\n        a.onclick = ev => {\r\n          ev.preventDefault()\r\n          toggleFormRow(newForm, a)\r\n        }\r\n      })\r\n      newForm.querySelector('.s-markup').onclick = function(ev) {\r\n        ev.preventDefault()\r\n        this.querySelector('.icon').classList.toggle('pressed')\r\n        newForm.querySelector('.message-row').classList.toggle('markup-enabled')\r\n      }\r\n      blotter.remove()\r\n      // Rename label[for]s and corresponding inputs\r\n      let add = '_'+_.uniqueId()\r\n      // newForm.id = 'postform'+add\r\n      newForm.querySelectorAll('label').forEach(l => {\r\n        let id = l.getAttribute('for')\r\n        , newid = id + add\r\n        , input = newForm.querySelector('#'+id)\r\n        if (input)\r\n          input.id = newid\r\n        l.setAttribute('for', newid)\r\n      })\r\n      newForm.classList.add('quick-reply-form') // New general class to tell qr form apart from the main form\r\n      newForm.classList.add('postform-simplified')\r\n      // Clear fields\r\n      resetForm(newForm, true /* ← isClone */)\r\n      // Init rich file input\r\n      richFileInput.initForm(newForm)\r\n      // Add extra buttons\r\n      newForm.insertAdjacentHTML('beforeend', `\r\n        <span class=\"extrabtns postboxcontrol\">\r\n          <svg class=\"icon form-handle-icon\"><use xlink:href=\"#i-handle\"></use></svg>\r\n          <a href=\"#\" title=\"${_l.classicSimplifiedForm}\" class=\"simplify-qr-form\">\r\n            <svg class=\"icon b-icon\">\r\n              <use class=\"use-simplify\" xlink:href=\"#i-simplify\"></use>\r\n              <use class=\"use-complicate\" xlink:href=\"#i-complicate\"></use>\r\n            </svg>\r\n          </a>\r\n          <a href=\"#\" title=\"${_l.collapseExpand}\" class=\"collapse-qr-form collapser\">\r\n            <svg class=\"icon b-icon\">\r\n              <use class=\"use-collapse\" xlink:href=\"#i-collapse\"></use>\r\n              <use class=\"use-uncollapse\" xlink:href=\"#i-uncollapse\"></use>\r\n            </svg>\r\n          </a>\r\n          <a href=\"#\" class=\"pinner\" title=\"${_l.pinUnpin}\">\r\n            <svg class=\"icon b-icon\">\r\n              <use class=\"use-pin\" xlink:href=\"#i-float\"></use>\r\n              <use class=\"use-unpin\" xlink:href=\"#i-unfloat\"></use>\r\n            </svg>\r\n          </a>\r\n          &nbsp;\r\n          <a href=\"#\" title=\"${_l.hideForm}\" class=\"hide-qr-form\">\r\n            <svg class=\"icon b-icon\"><use xlink:href=\"#i-x\"></use></svg>\r\n          </a>\r\n        </span>`)\r\n      // Form button actions\r\n      newForm.getParentPost = () => {\r\n        let maybePost = newForm._findPrevious('*:not(.i0svcel)')\r\n        return maybePost.matches('.postnode') ? maybePost : null\r\n      }\r\n      newForm.querySelector('.hide-qr-form').onclick = ev => {\r\n        ev.preventDefault()\r\n        let skip = false\r\n        if (newForm.classList.contains('qrf-floating')) {\r\n          let anchor = newForm.getParentPost()\r\n          if (anchor) {\r\n            flyTo(newForm, anchor.querySelector('a.qrl .b-icon')).then(hidePostForm)\r\n            skip = true\r\n          }\r\n        }\r\n        if (!skip) {\r\n          hidePostForm(newForm)\r\n        }\r\n      }\r\n      newForm.querySelector('.simplify-qr-form').onclick = ev => {\r\n        ev.preventDefault()\r\n        toggleFormSimplify(newForm)\r\n      }\r\n      newForm.querySelector('.pinner').onclick = function(ev) {\r\n        ev.preventDefault()\r\n        let pinned = newForm.classList.contains('qrf-builtin')\r\n        toggleFormFloating(newForm, pinned)\r\n      }\r\n      newForm.querySelector('.collapse-qr-form').onclick = ev => {\r\n        ev.preventDefault()\r\n        toggleFormCollapse(newForm)\r\n      }\r\n      // Prevent dragging of links\r\n      newForm.querySelectorAll('a').forEach(a => {\r\n        a.ondragstart = ev => false\r\n        a.ondrop = ev => false\r\n      })\r\n      // Extra hooks for the new form\r\n      initForm(newForm)\r\n\r\n      resolve(newForm)\r\n    })\r\n  })\r\n}\r\n\r\nfunction quickreply() {\r\n  let $this = $(this)\r\n  , threadID = $this.data('parent')\r\n  , postID = $(this).data('postnum') || threadID.split('-')[0]\r\n  , $post = $this.parents('.postnode')\r\n  , boardName = $post.data('board')\r\n  , fromExternalBoard = (!is_overboard && boardName !== this_board_dir)\r\n  , post = $post[0]\r\n  , $preview = $post.parents('.reflinkpreview')\r\n  , isPreview = !!$preview\r\n  , needInsert = true\r\n  , form = post._findNext('*:not(.i0svcel)')\r\n  , formExists = form && form.getAttribute('name') == 'postform'\r\n  , formHidden = formExists && form.classList.contains('hidden')\r\n  , formFloating = formExists && form.classList.contains('qrf-floating')\r\n  , isOpen = true\r\n  , preview = post._findParent('.reflinkpreview')\r\n  , quotation = needInsert ? getPostQuotation(post.querySelector('.postbody')) : ''\r\n  \r\n  if (formExists) {\r\n    if (formFloating) {\r\n      toggleFormCollapse(form, false)\r\n      toggleFormFloating(form, false)\r\n    }\r\n    else {\r\n      if (!formHidden) {\r\n        hidePostForm(form)\r\n        formHidden = true\r\n      }\r\n      else {\r\n        form.classList.remove('hidden')\r\n      }\r\n      formHidden = !formHidden\r\n    }\r\n    needInsert = false\r\n  }\r\n  else {\r\n    $this.addClass('spin-around')\r\n    clonePostForm(post.id || post.parentElement.id, preview, is_overboard && boardName).then(form => {\r\n      $this.removeClass('spin-around')\r\n      form.classList.add('qrf-builtin')\r\n      form.querySelector('.pinner').classList.toggle('pinned')\r\n      form.querySelector('input[name=replythread]').value = threadID\r\n      post.insertAdjacentElement('afterend', form)\r\n      document.querySelectorAll('.qrf-floating:not(.collapsed)')\r\n      .forEach(existingForm => toggleFormCollapse(existingForm))\r\n      form.querySelector('textarea').focus()\r\n      if (needInsert) {\r\n        insert(`>>${fromExternalBoard ? `/${boardName}/` : ''}${postID}\\n${quotation}`)\r\n      }\r\n      // Pin the post if it is in preview\r\n      if (preview && !preview._pinned) {\r\n        post.querySelector('.pinner').click()\r\n      }\r\n    })\r\n  }\r\n  // post.classList.toggle('reply-with-form-open', isOpen)\r\n  return false\r\n}\r\n\r\nfunction _getSelection() {\r\n  if (! window.getSelection) return null\r\n  let selection = window.getSelection()\r\n  if (selection.type !== \"Range\") return null\r\n  let selectedText = selection.toString()\r\n  if (! selectedText) return null\r\n  return {\r\n    text: selectedText,\r\n    node: selection.anchorNode\r\n  }\r\n}\r\n\r\n// get the selected text within the given element\r\nfunction getLocalSelection(parent) {\r\n  let sel = _getSelection()\r\n  return sel && sel.node._isChildOf(parent)  \r\n    ? sel.text \r\n    : null\r\n}\r\n\r\nfunction getPostQuotation(post) {\r\n  let text = getLocalSelection(post)\r\n  if (!text) return ''\r\n  text = text\r\n    .replace(/^\\s/, '').replace(/\\s$/, '') // remove leading and trailing whitespaces\r\n    .replace(/^>/gm, ' >').replace(/^/gm, '> ') // add quotation marks\r\n  return text/*+'\\n'*/ || ''\r\n}\r\n\r\nfunction popupMessage(content, delay=1000) {\r\n  pups.info(content, {time: delay/1000})\r\n  console.warn('popupMessage() is deprecated. Please use YOBA alerts instead.')\r\n}\r\n\r\nvar Captcha = {\r\n  init: function(forceEnable=false) {\r\n    let captchaImage = document.querySelector('.captchaimage')\r\n    this.enabled = forceEnable || !!captchaImage\r\n    if (!this.enabled) return;\r\n    injector.inject('captcha-rotting',\r\n    `.cw-running .rotting-indicator {\r\n      -webkit-animation-duration: ${captchaTimeout}s;\r\n              animation-duration: ${captchaTimeout}s;\r\n    }\r\n    .cw-running .captchaimage,\r\n    .cw-running .rotten-msg {\r\n      -webkit-animation-delay: ${captchaTimeout}s;\r\n              animation-delay: ${captchaTimeout}s;}`)\r\n    if (captchaImage) {\r\n      this.addImgLoadListener(captchaImage)\r\n    }\r\n  },\r\n  initForm: function(form) {\r\n    let cw = form.querySelector('.captchawrap')\r\n    if (!cw) return;\r\n    cw.onclick = this.onClick.bind(this)\r\n    ;['click', 'focus'].forEach(evt => {\r\n      form.querySelector('input[name=captcha]').addEventListener(evt, this.onFieldClick.bind(this))\r\n    })\r\n    let captchaImage = form.querySelector('.captchaimage')\r\n    if (captchaImage) {\r\n      this.addImgLoadListener(captchaImage)\r\n    }\r\n  },\r\n  addImgLoadListener: function(captchaImage) {\r\n    captchaImage.onload = this.onImageLoad.bind(this)\r\n    ;['animationend', 'webkitAnimationEnd', 'msAnimationEnd'].forEach(evType => {\r\n      captchaImage.addEventListener(evType, this.onAnimationEnd.bind(this))\r\n    })\r\n  },\r\n  _state: 'init',\r\n  get state() {\r\n    return this._state\r\n  },\r\n  set state(s) { // Capthca state machine\r\n    document.querySelectorAll('.captchawrap').forEach(c => {\r\n      if (s == 'init') {\r\n        c.classList.remove('cw-running')\r\n        c.classList.add('cw-initial')\r\n      }\r\n      if (s == 'init' || s == 'load') {\r\n        c.classList.add('captchaimage-invisible')\r\n      }\r\n      if (s == 'load') {\r\n        c.classList.remove('cw-initial', 'cw-running')\r\n        void c.offsetWidth //trigger a reflow\r\n        c.classList.add('cw-running', 'cw-loading')\r\n      }\r\n      else {\r\n        c.classList.remove('cw-loading')\r\n      }\r\n      if (s == 'run') {\r\n        c.classList.remove('captchaimage-invisible')\r\n      }\r\n    })\r\n    if (s !== 'run')\r\n      this.clear()\r\n    this._state = s\r\n  },\r\n  onClick: function(ev) {\r\n    this.refresh(ev.ctrlKey || ev.altKey)\r\n    ev.target._findParent('form').querySelector('input[name=captcha]').focus()\r\n  },\r\n  onFieldClick: function() {\r\n    if (this.state == 'init' || this.state == 'expired')\r\n      this.refresh()\r\n  },\r\n  onImageLoad: function() {\r\n    if (this.state == 'load')\r\n      this.state = 'run'\r\n  },\r\n  onAnimationEnd: function() {\r\n    this.state = 'expired'\r\n  },\r\n  clear: function() {\r\n    document.querySelectorAll('input[name=\"captcha\"]').forEach(i => i.value = '')\r\n  },\r\n  refresh: function(switch_lang=false) {\r\n    let cColor = $('.captchawrap').css('color').match(/([0-9]+(?:\\.[0-9]+)?)/g)\r\n    cColor = (cColor.length >= 3) ? '&color='+cColor.slice(0, 3).join(',') : ''\r\n    let url = ku_boardspath+'/captcha.php?'+Math.random()+cColor+(switch_lang ? '&switch' : '')\r\n    document.querySelectorAll('.captchaimage').forEach(img => img.src = url)\r\n    this.state = 'load'\r\n  }\r\n}\r\n\r\nfunction formatFileSize(bytes) {\r\n  if (bytes < 1000) {\r\n    return `${bytes}B`\r\n  }\r\n  else if (bytes < 1000000) {\r\n    return `${Math.round(bytes/1000)}KB`\r\n  }\r\n  else {\r\n    return `${Math.round(bytes/100000)/10}MB`\r\n  }\r\n}\r\n\r\nconst richFileInput = {\r\n  handleFiles: function(files, form, fromClipboard=false) {\r\n    let maxfiles = +form.dataset.maxfiles\r\n    , slotsLeft = maxfiles - $(form).find('.file-entry').length\r\n    , filesLeft = files.length\r\n    , i = 0\r\n    for (; slotsLeft && filesLeft; i++) {\r\n      let fileAttached = this.handleFile(files[i], form, fromClipboard)\r\n      slotsLeft -= fileAttached\r\n      filesLeft--\r\n    }\r\n    if (slotsLeft <= 0 && filesLeft)\r\n      pups.warn(_l.maxAttNumReached)\r\n  },\r\n  handleFile: function(file, form, fromClipboard=false) {\r\n    let fx = {}\r\n    // Determine the file extension\r\n    let ns = file.name.split('.')\r\n    fx.ext = (ns.length) > 1 ? ns.pop().toLowerCase() : \"\"\r\n    if (fx.ext == 'jpeg') \r\n      fx.ext = 'jpg'\r\n    if (!_.contains(form.dataset.allowedFiletypes.split(','), fx.ext)) {\r\n      pups.err(`${file.name}: ${_l.unsupportedFileType}.`)\r\n      return 0\r\n    }\r\n    fx.fname = ns.join('.')\r\n\r\n    fx.sizeFormatted = formatFileSize(file.size)\r\n    \r\n    if (file.type.indexOf(\"image\") != -1) {\r\n      let reader = new FileReader()\r\n      reader.onload = ev => {\r\n        fx.img = ev.target.result\r\n        this.addFile(file, fx, form, fromClipboard)\r\n      }\r\n      reader.readAsDataURL(file, fx, form)\r\n    }\r\n    else {\r\n      this.addFile(file, fx, form, fromClipboard)\r\n    }\r\n    return 1\r\n  },\r\n  addFile: function(file, extra, form, fromClipboard=false) {\r\n    let index = this.store.push(file)-1\r\n    form.querySelector('.fe-sort-wrapper').insertAdjacentHTML('beforeEnd', `\r\n      <div class=\"file-entry${fromClipboard ? ' fe-name-hidden' : ''}\" data-index=\"${index}\" title=\"${file.name}\">\r\n        <div class=\"fe-thumb\">\r\n          ${extra.img ? `<img src=${extra.img}>` :  `<div class=\"fe-noimg\">${extra.ext}</div>`}\r\n        </div>\r\n        <input type=\"text\" value=\"${extra.fname}\" class=\"fe-fn\" ${fromClipboard ? ' disabled' : ''}>\r\n        <button class=\"clear-filename fe-pop-button icon-wraping-button\" title=\"${_l.hideName}\"><svg class=\"icon b-icon\">\r\n          <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-hide-name\"></use>\r\n        </svg></button>\r\n        <button class=\"remove-file fe-pop-button icon-wraping-button\" title=\"${_l.removeFile}\"><svg class=\"icon b-icon\">\r\n          <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-x\"></use>\r\n        </svg></button>\r\n        <button class=\"spoiler-file fe-pop-button icon-wraping-button\" title=\"${_l.spoilerOnOff}\"><svg class=\"icon b-icon\">\r\n          <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-spoiler\"></use>\r\n        </svg></button>\r\n        <div class=\"fe-info\"></div>\r\n      </div>\r\n    `)\r\n    this.recalcForm(form)\r\n    let thisEl = form.querySelector(`.file-entry[data-index=\"${index}\"]`)\r\n    , img = false\r\n    , updateInfo = () => thisEl.querySelector(`.fe-info`).innerText = \r\n        `${extra.ext.toUpperCase()}${(img ? `, ${img.naturalWidth}×${img.naturalHeight}`: '')}, ${extra.sizeFormatted}`\r\n    if (extra.img) {\r\n      img = thisEl.querySelector('img')\r\n      img.onload = updateInfo\r\n      img.onerror = updateInfo\r\n    }\r\n    else updateInfo()\r\n    thisEl._ext = extra.ext\r\n    this.updateTitle($(thisEl))\r\n  },\r\n  recalcForm: function(form) {\r\n    let count = form.querySelectorAll('.file-entry').length\r\n    , maxfiles = +form.dataset.maxfiles\r\n    form.classList.toggle('fda-non-empty', count > 0)\r\n    form.classList.toggle('fda-form-full', count >= maxfiles)\r\n    form.querySelector('.file-count').innerHTML = count > 0\r\n      ? `${_l.files}<br>(${count}/${maxfiles})`\r\n      : `${_l.file}`\r\n  },\r\n  updateTitle: function($el) {\r\n    let v = $el.find('.fe-fn').val()\r\n    , fname = !$el.hasClass('fe-name-hidden') && v ? v : '*****'\r\n    $el[0].title = `${fname}.${$el[0]._ext}`\r\n  },\r\n  serialize: function(form, fd) {\r\n    form.querySelectorAll('.file-entry').forEach((fe, i) => {\r\n      fd.append('imagefile[]', this.store[+fe.dataset.index])\r\n      if (fe.classList.contains('fe-spoiler'))\r\n        fd.append(`spoiler-${i}`, 1)\r\n      let fname = fe.querySelector('.fe-fn').value\r\n      if (fe.classList.contains('fe-name-hidden') || fname==='')\r\n        fd.append(`hidename-${i}`, 1)\r\n      else\r\n        fd.append(`filename-${i}`, fname)\r\n    } )\r\n  },\r\n  store: [],\r\n  initiated: false,\r\n  init: function(form) {\r\n    this.enabled = form.querySelector('.file-row') && 'FileReader' in window\r\n    if (this.enabled) {\r\n      let _this = this\r\n      $('body')\r\n      .on('click', '.remove-file', function(ev) {\r\n        ev.preventDefault()\r\n        ev.stopPropagation()\r\n        let $entry = $(this).parents('.file-entry')\r\n        _this.store[+$entry.data('index')] = null\r\n        let $form = $entry.parents('form[name=postform]')\r\n        $entry.remove()\r\n        _this.recalcForm($form[0])\r\n      })\r\n      .on('click', '.file-entry', function(ev) {\r\n        $(this).toggleClass('fe-expanded')\r\n        setTimeout(() => $(this).find('input').select(), 450)\r\n      })\r\n      .on('click', '.file-entry input', function(ev) {\r\n        ev.stopPropagation()\r\n      })\r\n      .on('click', '.spoiler-file', function(ev) {\r\n        ev.preventDefault()\r\n        ev.stopPropagation()\r\n        $(this).parents('.file-entry').toggleClass('fe-spoiler')\r\n      })\r\n      .on('click', '.clear-filename', function(ev) {\r\n        ev.preventDefault()\r\n        ev.stopPropagation()\r\n        let $entry = $(this).parents('.file-entry')\r\n        $entry.find('.fe-fn').prop('disabled', !$entry.hasClass('fe-name-hidden'))\r\n        $entry.toggleClass('fe-name-hidden')\r\n        _this.updateTitle($entry)\r\n      })\r\n      .on('change', '.fe-fn', function(ev) {\r\n        _this.updateTitle($(this).parents('.file-entry'))\r\n      })\r\n      .on('change', 'input[type=file]', function(ev) {\r\n        let form = $(this).parents('form[name=postform]')[0]\r\n        _this.handleFiles(ev.target.files, form)\r\n        this.value = null\r\n      })\r\n      .on('click', '.add-files', function(ev) {\r\n        ev.preventDefault()\r\n        $(this).parents('form[name=postform]').find('input[type=file]')[0].click()\r\n      })\r\n      .on('paste', 'form[name=postform]', function(ev) {\r\n        let items = (ev.clipboardData || ev.originalEvent.clipboardData).items\r\n        , arr = [];\r\n        for (var i = 0 ; i < items.length ; i++) {\r\n          var item = items[i];\r\n          if (item.kind == 'file') {\r\n            arr.push(item.getAsFile())\r\n          }\r\n        }\r\n        _this.handleFiles(arr, this, true)\r\n      })\r\n    }\r\n    else {\r\n      $('body')\r\n      .on('click', '.remove-file', function(ev) {\r\n        ev.preventDefault()\r\n        $(this).parent().find('input[type=file]')\r\n          .val(null)\r\n          .removeClass('non-empty-file-input')\r\n      })\r\n      .on('change', 'input[type=file]', function() {\r\n        $(this).toggleClass('non-empty-file-input', this.value)\r\n      })\r\n    }\r\n    this.initiated = true\r\n    /*if (!is_overboard)\r\n      this.initForm(postform)*/\r\n  },\r\n  initForm: function(form) {\r\n    if (!this.initiated)\r\n      this.init(form)\r\n    let _this = this\r\n    if (this.enabled) {\r\n      // Drag and drop events\r\n      $(form) // I tried using plain JS, doesn't work, sorry\r\n      .on('dragenter dragend dragover drop dragleave', function(ev) {\r\n        ev.originalEvent.stopPropagation()\r\n        if (!(ev.target.nodeName == 'TEXTAREA' || ev.target.nodeName == 'INPUT')) \r\n          ev.preventDefault()\r\n      })\r\n      .on('drop', function(ev) {\r\n        ev.originalEvent.stopPropagation()\r\n        if (ev.originalEvent.dataTransfer && ev.originalEvent.dataTransfer.files.length) {\r\n          ev.originalEvent.preventDefault() \r\n          _this.handleFiles(ev.originalEvent.dataTransfer.files, this)\r\n        }\r\n      })\r\n      // File entry sorting\r\n      if(form.querySelector('.fe-sort-wrapper')) {\r\n        Sortable.create(form.querySelector('.fe-sort-wrapper'), {\r\n          animation: 150,\r\n          handle: '.fe-thumb'\r\n        })\r\n      }\r\n      // Prevent legacy file inputs from being serialized\r\n      form.querySelectorAll('input[name^=imagefile]').forEach(i => i.removeAttribute('name'))\r\n    }\r\n    else {\r\n      let area = form.querySelector('.drop-area')\r\n      if (!area) return;\r\n      area.previousElementSibling.classList.remove('noscript')\r\n      area.remove()\r\n    }\r\n  },\r\n  clear: function(form, clearStore=false) {\r\n    if (this.enabled) {\r\n      form.querySelectorAll('.file-entry').forEach(fe => {\r\n        if (clearStore)\r\n          this.store[fe.dataset.index] = null\r\n        fe.remove()\r\n      })\r\n      this.recalcForm(form)\r\n    }\r\n  }\r\n}\r\n\r\nfunction handleCtrlEnter(ev) {\r\n  ev.preventDefault()\r\n  let area = document.activeElement\r\n  , form = area._findParent('form[name=postform]')\r\n  if (form) {\r\n    Ajax.submitPost(form)\r\n  }\r\n}\r\n\r\nfunction redirectTo(href) {\r\n  // console.warn('About to redirect to:', href)\r\n  document.location.href = href\r\n}\r\n\r\nconst Ajax = {\r\n  submitPost: function(form, sage) {\r\n    if (typeof hcaptcha !== 'undefined') {\r\n      hcaptcha.execute({ async: true })\r\n      .then(({ response, key }) => {\r\n        this.actuallySubmitPost(form, sage, response)\r\n      })\r\n      .catch(err => {\r\n        console.error('hcapthca:', err)\r\n        if (err == 'challenge-expired')\r\n          this.shownErrors.push(pups.warn(_l.captchaExpired))\r\n      });\r\n    }\r\n    else {\r\n      this.actuallySubmitPost(form, sage)\r\n    }\r\n  },\r\n  actuallySubmitPost: function(form, sage, hCaptchaResponse) {\r\n    let alertsToRemove = _.clone(this.shownErrors)\r\n    setTimeout(() => {\r\n      alertsToRemove.forEach(a => {\r\n        pups.closeByID(a)\r\n      })\r\n    }, 300)\r\n    this.shownErrors = []\r\n    let showError = (a, b={}) => this.shownErrors.push(pups.err(a, b))\r\n    let showWarning = (a, b={}) => this.shownErrors.push(pups.warn(a, b))\r\n\r\n    let captchafield = form.captcha\r\n    if (captchafield && !captchafield.value.length) {\r\n      captchafield.focus()\r\n      return showWarning(_l.enterCaptcha)\r\n    }\r\n    \r\n    form.classList.add('form-sending')\r\n    let fd = new FormData(form)\r\n\r\n    if (typeof sage !== 'undefined')\r\n      fd.append('sagebtn', sage)\r\n\r\n    if (hCaptchaResponse) {\r\n      fd.append('h-captcha-response', hCaptchaResponse)\r\n    }\r\n\r\n    if (richFileInput.enabled)\r\n      richFileInput.serialize(form, fd)\r\n    let xr = new XMLHttpRequest()\r\n    fd.append('AJAX', 1)\r\n\r\n    // Token for live updates\r\n    this.postToken = randomString()\r\n    fd.append('token', this.postToken)\r\n\r\n    xr.open('POST', form.action)\r\n    xr.onload = e => {\r\n      form.classList.remove('form-sending')\r\n      if (xr.status !== 200) {\r\n        showError(_l.xhrError)\r\n        return\r\n      }\r\n      ;[].forEach.call(form.querySelectorAll('.error-in-attachment'), el => el.classList.remove('error-in-attachment'))\r\n      if (Captcha.enabled)\r\n        Captcha.state = 'init'\r\n      let res = null\r\n      try {\r\n        res = JSON.parse(xr.response)\r\n      }\r\n      catch(e) {\r\n        showError(_l.xhrError)\r\n        console.error('Malformed response (JSON expected):', xr.response)\r\n        return\r\n      }\r\n      if (res.error) {\r\n        if (res.error_verbose)\r\n          res.error = `${res.error}<br>${res.error_verbose}`\r\n        if (res.error_type) {\r\n          if (res.error_type == 'ban') {\r\n            showError(`${res.error} (<a href=\"${ku_cgipath}/banned.php\" target=\"_blank\">${_l.details}</a>)`, {time: 0, save: true})\r\n          }\r\n          if (res.error_type == 'duplicate_file') {\r\n            showError(res.error, {time: 0})\r\n            form.querySelector('input[name=\"imagefile\"]').value = null\r\n          }\r\n          if (res.error_type == 'upload_error') {\r\n            showError(res.error, {time: 0})\r\n            let badatt = form.querySelector(`.multiembedwrap[data-pos=\"${res.error_data.attachmenttype}-${res.error_data.position+1}\"]`)\r\n            if (badatt) {\r\n              badatt.classList.add('error-in-attachment')\r\n            }\r\n          }\r\n        }\r\n        else {\r\n          showError(res.error, {time: 0})\r\n        }\r\n        return\r\n      }\r\n      else {\r\n        resetForm(form)\r\n        if (form.classList.contains('quick-reply-form')) {\r\n          hidePostForm(form) // TODO: tumbach pinning?\r\n        }\r\n        /*else {\r\n        }*/\r\n        let nokoInput = form.querySelector('input[name=\"redirecttothread\"]')\r\n        , noko = nokoInput && nokoInput.checked\r\n        if (res.thread_replyto != 0) {\r\n          newposts.get({\r\n            threadid: ispage ? res.thread_replyto+'-'+res.board : null,\r\n            expectedPost: res.post_id+'-'+res.board,\r\n            onError: (err) => {\r\n              console.error(err)\r\n              redirectTo(`${ku_boardspath}/${res.board}/res/${res.thread_replyto}.html#${res.post_id}`)\r\n              if (! ispage)\r\n                document.location.reload()\r\n            },\r\n            onSuccess: () => $(`#delform div[id^=thread${res.thread_replyto}] .fresh-replies`).remove()\r\n          })\r\n        }\r\n        else {\r\n          if (noko) {\r\n            redirectTo(`${ku_boardspath}/${res.board}/res/${res.post_id}.html`)\r\n          }\r\n          else {\r\n            redirectTo(`${ku_boardspath}/${res.board}`)\r\n          }\r\n        }\r\n      }\r\n    }\r\n    xr.send(fd)\r\n  },\r\n  shownErrors: [],\r\n  reportPost: function(fd, callback=null) {\r\n    let xr = new XMLHttpRequest()\r\n    fd.append('AJAX', 1)\r\n    fd.append('reportpost', 1)\r\n    xr.open('POST', document.forms.delform.action)\r\n    xr.onload = e => {\r\n      if (xr.status !== 200) {\r\n        pups.err(_l.xhrError)\r\n        return callback(false)\r\n      }\r\n      let res = null\r\n      try {\r\n        res = JSON.parse(xr.response)\r\n      }\r\n      catch(e) {\r\n        pups.err(_l.xhrError)\r\n        console.error('Malformed response (JSON expected):', xr.response)\r\n        return callback(false)\r\n      }\r\n      if (callback)\r\n        callback(res.data)\r\n      if (res.error) {\r\n        if (res.error_verbose)\r\n          res.error = `${res.error}<br>${res.error_verbose}`\r\n        pups.err(res.error, {time: 0})\r\n        return\r\n      }\r\n      else {\r\n        $('body').removeClass('select-multiple')\r\n        $('.userdelete').removeClass('ud-active')\r\n        let postsReported = []\r\n        , postErrors = []\r\n        res.data.forEach(item => {\r\n          if (!item.success) {\r\n            postErrors.push(item)\r\n            return\r\n          }\r\n          postsReported.push(item.id)\r\n          if (! $('input[name=\"post[]\"]:checked').length)\r\n            $('.userdelete').removeClass('ud-active');\r\n        })\r\n        let msg = ''\r\n        if (postsReported.length) {\r\n          postsReported = postsReported.map(post => '#'+post)\r\n          msg += postsReported.length > 1 ?\r\n            `${_l.posts} ${postsReported.join(', ')} ${_l.reportedMulti}.`\r\n           :`${_l.post} ${postsReported[0]} ${_l.reported}.`\r\n          pups.succ(msg, {time: 2 + postsReported.length})\r\n        }\r\n        postErrors.forEach(err => {\r\n          pups.err(`${_l.post} #${err.id}: ${err.message}`)\r\n        })\r\n      }\r\n    }\r\n    xr.send(fd)\r\n  },\r\n  cancelTimer: function(fd, callback=null) {\r\n    let xr = new XMLHttpRequest()\r\n    fd.append('AJAX', 1)\r\n    fd.append('cancel_timer', 1)\r\n\r\n    // Token for live updates\r\n    this.timerToken = randomString()\r\n    fd.append('token', this.timerToken)\r\n\r\n    xr.open('POST', document.forms.delform.action)\r\n    xr.onload = e => {\r\n      if (xr.status !== 200) {\r\n        pups.err(_l.xhrError)\r\n        return callback(false)\r\n      }\r\n      let res = null\r\n      try {\r\n        res = JSON.parse(xr.response)\r\n      }\r\n      catch(e) {\r\n        pups.err(_l.xhrError)\r\n        console.error('Malformed response (JSON expected):', xr.response)\r\n        return callback(false)\r\n      }\r\n      if (res.error) {\r\n        if (res.error_verbose)\r\n          res.error = `${res.error}<br>${res.error_verbose}`\r\n        pups.err(res.error, {time: 0})\r\n        return callback(false)\r\n      }\r\n      else {\r\n        $('body').removeClass('select-multiple')\r\n        $('.userdelete').removeClass('ud-active')\r\n        let postsSaved = []\r\n        , postErrors = []\r\n        res.data.forEach(item => {\r\n          if (!item.success) {\r\n            postErrors.push(item)\r\n            return\r\n          }\r\n          postsSaved.push(item.id)\r\n          if (! $('input[name=\"post[]\"]:checked').length)\r\n            $('.userdelete').removeClass('ud-active');\r\n        })\r\n        let msg = ''\r\n        if (postsSaved.length) {\r\n          postsSaved.forEach(id => {\r\n            let $reply = $(`.postnode[data-id=${id}]`)\r\n            $reply.find('.post-ttl').remove()\r\n            $reply.find('.post-menu').hide()\r\n          } )\r\n          msg += postsSaved.length > 1 ?\r\n            `${_l.posts} #${postsSaved.join(', #')} ${_l.savedMulti}.`\r\n           :`${_l.post} #${postsSaved[0]} ${_l.saved}.`\r\n          pups.succ(msg, {time: 2 + postsSaved.length})\r\n        }\r\n        postErrors.forEach(err => {\r\n          pups.err(`${_l.post} #${err.id}: ${err.message}`)\r\n        })\r\n        callback(postErrors)\r\n      }\r\n    }\r\n    xr.send(fd)\r\n  },\r\n  modThread: function(a, action) {\r\n    let $a = $(a)\r\n    , fd = new FormData()\r\n    , xr = new XMLHttpRequest()\r\n    , $li = $a.find('li')\r\n    $li.addClass('spin-around')\r\n    fd.append('AJAX', 1)\r\n    xr.open('POST', a.getAttribute('href'))\r\n    xr.onload = e => {\r\n      $li.removeClass('spin-around')\r\n      if (xr.status !== 200) {\r\n        pups.err(_l.xhrError)\r\n        return\r\n      }\r\n      let res = null\r\n      try {\r\n        res = JSON.parse(xr.response)\r\n      }\r\n      catch(e) {\r\n        pups.err(_l.xhrError)\r\n        console.error('Malformed response (JSON expected):', xr.response)\r\n        return\r\n      }\r\n      if (res.error) {\r\n        if (res.error_verbose)\r\n          res.error = `${res.error}<br>${res.error_verbose}`\r\n        pups.err(res.error, {time: 0})\r\n        return\r\n      }\r\n      else {\r\n        let $posthead = $a.parents('.posthead')\r\n        , $extrabtns = $posthead.find('.extrabtns')\r\n        if (action == 'stickypost') {\r\n          $extrabtns.prepend(makeIcon('pin', 'i-icon i-pin'));\r\n          $posthead.addClass('thread-stickied')\r\n        }\r\n        if (action == 'unstickypost') {\r\n          $extrabtns.find('svg.i-icon.i-pin').remove()\r\n          $posthead.removeClass('thread-stickied')\r\n        }\r\n        if (action == 'lockpost') {\r\n          $extrabtns.prepend(makeIcon('lock', 'i-icon i-lock'));\r\n          $posthead.addClass('thread-locked')\r\n        }\r\n        if (action == 'unlockpost') {\r\n          $extrabtns.find('svg.i-icon.i-lock').remove()\r\n          $posthead.removeClass('thread-locked')\r\n        }\r\n        pups.succ(res.message)\r\n      }\r\n    }\r\n    xr.send(fd)\r\n  },\r\n  deleteItems: function(fd, callback=null) {\r\n    let kind = 'Items'\r\n    if (fd.has) {\r\n      if (fd.has('post[]')) {\r\n        if (!fd.has('delete-file[]'))\r\n          kind = 'Posts'\r\n        fd.append('deletepost', 1)\r\n      }\r\n      else if (fd.has('delete-file[]'))\r\n        kind = 'Files'\r\n      else return;\r\n    }\r\n    else { // FormData.has() is not supported\r\n      fd.append('deletepost', 1)\r\n    }\r\n    \r\n    let xr = new XMLHttpRequest()\r\n    fd.append('AJAX', 1)\r\n\r\n    // Token for live updates\r\n    this.delToken = randomString()\r\n    fd.append('token', this.delToken)\r\n\r\n    xr.open('POST', document.forms.delform.action)\r\n    xr.onload = e => {\r\n      if (xr.status !== 200) {\r\n        pups.err(_l.xhrError)\r\n        return callback(null)\r\n      }\r\n      let res = null\r\n      try {\r\n        res = JSON.parse(xr.response)\r\n      }\r\n      catch(e) {\r\n        pups.err(_l.xhrError)\r\n        console.error('Malformed response (JSON expected):', xr.response)\r\n        return callback(null)\r\n      }\r\n      if (callback)\r\n        callback(res.data)\r\n      if (res.error) {\r\n        if (res.error_verbose)\r\n          res.error = `${res.error}<br>${res.error_verbose}`\r\n        pups.err(res.error, {time: 0})\r\n        return\r\n      }\r\n      else {\r\n        deleteItems(res.data)\r\n      }\r\n    }\r\n    xr.send(fd)\r\n  }\r\n}\r\n\r\nfunction inspectFormData(formData) {\r\n  for (var pair of formData.entries()) {\r\n    console.log(pair[0]+ ', ' + pair[1]);\r\n  }\r\n}\r\n\r\nfunction makeIcon(i, classes=\"\", bare=false) {\r\n  return `${bare ? '' : `<svg class=\"icon ${classes}\">`}\r\n    <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-${i}\"></use>\r\n  ${bare ? '' : '</svg>'}`\r\n}\r\n\r\nfunction addCaptchaToMenu($menu) {\r\n  if ($menu.find('.captchawrap').length) {\r\n    Captcha.state = 'init';\r\n    return;\r\n  }\r\n  if (!Captcha.enabled) {\r\n    Captcha.init('only-access')\r\n  }\r\n  $menu.prepend(`<li class=\"menu-captcha\">\r\n    <div class=\"captchawrap cw-initial captchaimage-invisible\" title=\"${_l.refreshCaptcha}\">\r\n      <div class=\"captcha-show msg\">${_l.showCaptcha}</div>\r\n      <img class=\"captchaimage\" valign=\"middle\" border=\"0\" alt=\"${_l.captchaImage}\">\r\n      <div class=\"rotting-indicator\"></div>\r\n      <div class=\"rotten-msg msg\">${_l.captchaExpired}</div>\r\n    </div>\r\n    <input type=\"text\" name=\"captcha\" placeholder=\"${_l.captcha}\" autocomplete=\"off\">\r\n  </li>`)\r\n  Captcha.initForm($menu[0])\r\n  $menu.find('input[name=captcha]').keydown(ev => {\r\n    if (ev.key == 'Enter') {\r\n      ev.preventDefault()\r\n      ev.stopPropagation()\r\n    }\r\n  })\r\n}\r\n\r\nfunction expandimg(postnum, imgurl, thumburl, imgw, imgh, thumbw, thumbh) {\r\n  let element = document.getElementById(\"thumb\" + postnum);\r\n  if (element == null) return false;\r\n  let $element = $(element)\r\n  , $postbody = $element.parents('.postbody')\r\n  , $fc_filename = $element.parents('figure').find('.fc-filename')\r\n  , fc_width\r\n  if(typeof event !== 'undefined' && event.which === 2) return true;\r\n  if (element.getElementsByTagName('img')[0].getAttribute('alt').substring(0,4)!='full') {\r\n    $element.html('<img src=\"'+imgurl+'\" alt=\"full'+postnum+'\" class=\"thumb\" height=\"'+imgh+'\" width=\"'+imgw+'\">');\r\n    if (! Settings.expandImgFull()) {\r\n      let img = element.getElementsByTagName('img')[0]\r\n      , max_w = document.documentElement?document.documentElement.clientWidth : document.body.clientWidth\r\n      , offset = 50\r\n      , offset_el = img\r\n\r\n      while (offset_el != null) {\r\n        offset += offset_el.offsetLeft;\r\n        offset_el = offset_el.offsetParent;\r\n      }\r\n      var new_w = max_w - offset;\r\n      if (img.width > new_w) {\r\n        var ratio = img.width / img.height;\r\n        var zoom = 1 - new_w / img.width;\r\n        var new_h = new_w / ratio;\r\n        var notice = document.createElement('div');\r\n        notice.setAttribute('class', 'filesize');\r\n        notice.style.textDecoration = 'underline';\r\n        var textNode = document.createTextNode(_l.imageDownscaledBy + \" \" + Math.round(zoom*100) + \"% \"+_l.toFit);\r\n        notice.appendChild(textNode);\r\n        element.insertBefore(notice, img);\r\n        $(img).width(new_w);\r\n        $(img).height(new_h);\r\n      }\r\n      fc_width = new_w\r\n    }\r\n    else\r\n      fc_width = imgw\r\n    if ($postbody) $postbody.addClass('postbody-expanded')\r\n  }\r\n  else {\r\n    element.innerHTML = '<img src=\"' + thumburl + '\" alt=\"' + postnum + '\" class=\"thumb\" height=\"' + thumbh + '\" width=\"' + thumbw + '\">';\r\n    fc_width = thumbw\r\n    if ($postbody) $postbody.removeClass('postbody-expanded')\r\n  }\r\n  $fc_filename[0].style.maxWidth = `${fc_width - 50}px`\r\n  return false;\r\n}\r\n\r\n// YOBA previews\r\nvar PostPreviews = {\r\n  zindex:  3,\r\n  parent: {},\r\n\r\n  _parseLink: function(el) {\r\n    let url = el.getAttribute(\"href\")\r\n    if (url) {\r\n      let matches = url.match(/\\/(.+)\\/res\\/([0-9]+)\\.html#([0-9]+)|postbynumber\\.php\\?b=(.+)&p=([0-9]+)/i)\r\n      if (matches) return {\r\n        board: matches[1] || matches[4],\r\n        parent: matches[2] || '?',\r\n        post: matches[3] || matches[5],\r\n      }\r\n    }\r\n    let cl = [].find.call(el.classList, c => c.match(/ref\\|.+?\\|([0-9]+|\\?)\\|[0-9]+/))\r\n    if (cl) {\r\n      cl = cl.split('|')\r\n      return {\r\n        board: cl[1],\r\n        parent: cl[2],\r\n        post: cl[3],\r\n      }\r\n    }\r\n    return null\r\n  },\r\n\r\n  _mouseover: function(e) {\r\n    e.stopPropagation();\r\n    var isCatalog = $(this).hasClass('catalog-entry')\r\n    , parsedURL = PostPreviews._parseLink(this)\r\n    if (!parsedURL) return false;\r\n    let board = parsedURL['board']\r\n    , parentid = parsedURL['parent']\r\n    , postid = parsedURL['post']\r\n    , previewid = 'preview_'+board+'_'+postid\r\n    , $preview = $('#' + previewid)\r\n    if ($preview.length == 0) {\r\n      $('body').children().first().before('<div id=\"'+previewid+'\"></div>');\r\n      $preview = $('#' + previewid);\r\n      $preview.addClass('reflinkpreview content-background pre-hidden actual-reflinkpreview');\r\n      $preview.mouseleave(PostPreviews._mouseout);\r\n      $preview.mouseover(PostPreviews.mouseOverPreview);\r\n    }\r\n    else {\r\n      if ($preview[0]._pinned)\r\n        return false // No need to recreate a preview in this case\r\n    }\r\n    var parent = $(this).parents('div[id^=preview]');\r\n    if (parent.length > 0) {\r\n      if (previewid == parent.attr('id')) return; // anti-recursion\r\n      for (var id in PostPreviews.parent) { \r\n        if (id == previewid || PostPreviews.parent[id] == previewid) \r\n          return\r\n      }\r\n      PostPreviews.parent[previewid] = parent.attr('id');\r\n    }\r\n    /*else {\r\n      PostPreviews.parent = [];\r\n    }*/\r\n    let transformOrigin;\r\n    if(e.clientY < ($(window).height() / 1.5)) {\r\n      $preview.css({top:e.pageY+5});\r\n      transformOrigin = \"top \"\r\n    } else {\r\n      $preview.css({bottom:$(window).height()-e.pageY+5});\r\n      transformOrigin = \"bottom \"\r\n    }\r\n    if(e.clientX < ($(window).width() / 1.5)) {\r\n      $preview.css({left:e.pageX+15});\r\n      transformOrigin += \"left\"\r\n    } else {\r\n      $preview.css({right:$(window).width()-e.pageX+15});\r\n      transformOrigin += \"right\"\r\n    }\r\n    $preview.css({zIndex: PostPreviews.zindex++, \"transform-origin\": transformOrigin});\r\n    this.style.cursor = \"progress\"\r\n    let preview = $preview[0]\r\n    HTMLoader.getPost(board, parentid, postid, (err, post) => {\r\n      window.setTimeout(() => {\r\n        preview.getBoundingClientRect() // force reflow or how is this thing called\r\n        $preview.html(post ? post : (_l.oops + (err !== false ? ` (${err})` : '')))\r\n        .removeClass('pre-hidden')\r\n        this.style.cursor = \"pointer\"\r\n        // Add pin button\r\n        let ebtns = preview.querySelector('.extrabtns')\r\n        if (!ebtns) return;\r\n        ebtns.insertAdjacentHTML('beforeEnd', `\r\n        <a href=\"#\" class=\"pin-preview pinner unpinned\" title=\"${_l.pinUnpin}\">\r\n          <svg class=\"icon b-icon\">\r\n            <use class=\"use-pin\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-pin\"></use>\r\n            <use class=\"use-unpin\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-unpin\"></use>\r\n          </svg>\r\n        </a>`)\r\n        let pinner = ebtns.querySelector('.pinner')\r\n        pinner.onclick = (ev) => {\r\n          ev.preventDefault()\r\n          ev.stopPropagation()\r\n          let pin = !pinner.classList.contains('pinned')\r\n          pinner.classList.toggle('pinned', pin)\r\n          pinner.classList.toggle('unpinned', !pin)\r\n          let $pre = $preview\r\n          while ($pre.length > 0) {\r\n            $pre[0]._pinned = pin\r\n            $pre = $('#' + PostPreviews.parent[$pre.attr('id')])\r\n          }\r\n        }\r\n      }, 0)\r\n    })\r\n    e.preventDefault();\r\n  },\r\n\r\n  mouseOverPreview: function() {\r\n    var preview = $(this);\r\n    if ($(this).is('a')) {\r\n      let parsedURL = PostPreviews._parseLink(this)\r\n      if (!parsedURL) return;\r\n      let board = parsedURL['board']\r\n      , postid = parsedURL['post']\r\n      preview = $('#preview_'+board+\"_\"+postid).first();\r\n    }\r\n    while (preview.length > 0) {\r\n      clearTimeout(preview[0].fadeout)\r\n      preview = $('#' + PostPreviews.parent[preview.attr('id')])\r\n    }\r\n  },\r\n\r\n  _mouseout: function(ev, nodelay=false) {\r\n    var preview = $(this);\r\n    if ($(this).is('a')) {\r\n      if (this.predelay) {\r\n        clearTimeout(this.predelay)\r\n      }\r\n      let parsedURL = PostPreviews._parseLink(this)\r\n      if (!parsedURL) return;\r\n      let board = parsedURL['board']\r\n      , postid = parsedURL['post']\r\n      preview = $('#preview_'+board+\"_\"+postid).first();\r\n    }\r\n    while (preview.length > 0) {\r\n      clearTimeout(preview[0].fadeout)\r\n      let pre = preview\r\n      if (pre[0]._pinned) return;\r\n\r\n      preview[0].fadeout = setTimeout(() => {\r\n        pre.addClass('pre-hidden')\r\n        setTimeout(() => {\r\n          delete PostPreviews.parent[pre.attr('id')];\r\n          pre.remove();\r\n        }, PostPreviews._timings.transition)\r\n      }, nodelay ? 0 : PostPreviews._timings.fade)\r\n      preview = $('#' + PostPreviews.parent[preview.attr('id')]);\r\n    }\r\n  },\r\n\r\n  _timings: {\r\n    predelay: 50,\r\n    transition: 200,\r\n    fade: 400\r\n  }\r\n}\r\n\r\nfunction set_inputs(id) {\r\n  let form = document.getElementById(id)\r\n  if (form) {\r\n    let name = form.querySelector('input[name=name]')\r\n    if(name && !name.value) {\r\n      let savedName = getCookie(\"name\")\r\n      if (~savedName.indexOf('#'))\r\n        name.type = 'password'\r\n      name.value = savedName\r\n    }\r\n    if(!form.em.value) form.em.value = getCookie(\"email\");\r\n    if(!form.postpassword.value) form.postpassword.value = get_password(\"postpassword\");\r\n  }\r\n}\r\n\r\nfunction set_delpass(id) {\r\n  let form = document.getElementById(id)\r\n  if (! form) return;\r\n  let postpassword = form.postpassword\r\n  if (postpassword && !postpassword.value) {\r\n    postpassword.value = get_password(\"postpassword\");\r\n  }\r\n}\r\n\r\n(function ($) { // [!] What the fuck is this?\r\n  $.event.special.load = {\r\n    add: function (callback) {\r\n      if ( this.nodeType === 1 && this.tagName.toLowerCase() === 'img' && this.src !== '' ) {\r\n        if ( this.complete || this.readyState === 4 ) {\r\n          callback.handler.apply(this);\r\n        }\r\n        else if ( this.readyState === 'uninitialized' && this.src.indexOf('data:') === 0 ) {\r\n          $(this).trigger('error');\r\n        }\r\n\r\n        else {\r\n          $(this).bind('load', callback.handler);\r\n        }\r\n      }\r\n    }\r\n  };\r\n}(jQuery));\r\n\r\nvar Settings = {\r\n  _checkbox: function(clicked, settingName, defaultValue, perBoard=false) {\r\n    let settingNameGeneral = settingName\r\n    if (perBoard)\r\n      settingName = settingName+'.'+this_board_dir\r\n    if (localStorage == null) {\r\n      pups.err(_l.noLocalStorage);\r\n      return;\r\n    }\r\n    if (localStorage[settingName] == null) {\r\n      localStorage[settingName] = defaultValue;\r\n    }\r\n    if (clicked == true) {\r\n      // save it\r\n      localStorage[settingName] = $('#settings_' + settingNameGeneral).is(\":checked\");\r\n    } else {\r\n      // update checkbox (called on load)\r\n      if (localStorage[settingName] == 'true')\r\n        $('#settings_' + settingNameGeneral).attr(\"checked\",\"checked\");\r\n      else\r\n        $('#settings_' + settingNameGeneral).removeAttr(\"checked\");\r\n    }\r\n    return (localStorage[settingName] == 'true') || (localStorage[settingName] == true) ;\r\n  },\r\n\r\n  fxEnabled: function(changed) {\r\n    var enabled = Settings._checkbox(changed, 'fxEnabled', true);\r\n    if (changed != null) {\r\n      $.fx.off = !enabled;\r\n    }\r\n    return enabled;\r\n  },\r\n\r\n  showReplies: function(changed) {\r\n    var enabled = Settings._checkbox(changed, 'showReplies', true);\r\n    if (changed != null && (typeof is_catalog === 'undefined' || !is_catalog)) {\r\n      scrollAnchor.save('replymap', '.postnode')\r\n      if (enabled) {\r\n        replyMap.showReplies()\r\n        injector.remove('hide-replies')\r\n      }\r\n      else {\r\n        injector.inject('hide-replies', '.replieslist {display: none}')\r\n      }\r\n      scrollAnchor.restore('replymap')\r\n    }\r\n    return enabled;\r\n  },\r\n\r\n  sfwMode: function(changed) {\r\n    var enabled = Settings._checkbox(changed, 'sfwMode', false);\r\n    if (enabled) {\r\n      injector.inject('sfwMode', 'figure > *, .emoji { opacity: 0.05;} figure:hover > *, .postbody:hover .emoji { opacity: 1;}');\r\n    }\r\n    else {\r\n      injector.remove('sfwMode');\r\n    }\r\n    return enabled;\r\n  },\r\n\r\n  hideCompletely: function(changed) {\r\n    var enabled = Settings._checkbox(changed, 'hideCompletely', false, true);\r\n    if (changed) {\r\n      HiddenItems.hideCompletely = enabled\r\n      HiddenItems.updateCSS()\r\n    }\r\n    return enabled;\r\n  },\r\n\r\n  expandImgFull: function(changed) {\r\n    return Settings._checkbox(changed, 'expandImgFull', false);\r\n  },\r\n\r\n  constrainWidth: function(changed) {\r\n    var enabled = Settings._checkbox(changed, 'constrainWidth', false);\r\n    if (enabled) {\r\n      injector.inject('constrainWidth', `body {\r\n        max-width: 960px;\r\n        margin: 0px auto;\r\n      }`)\r\n    }\r\n    else {\r\n      injector.remove('constrainWidth')\r\n    }\r\n  }\r\n}\r\n\r\nvar rswap = {\r\n  i: true,\r\n  swap: function() {\r\n    if(this.i) $('#delform').before($('#rswapper')).after($('.postarea'));\r\n    else $('#delform').before($('.postarea')).after($('#rswapper'));\r\n    this.i = !this.i;\r\n  }\r\n}\r\n\r\nvar captchalang = getCookie('captchalang') || 'ru';\r\nfunction setCaptchaLang(lang) {\r\n  if(!in_array(lang, ['ru', 'en', 'num'])) return;\r\n  captchalang = lang;\r\n  set_cookie('captchalang', lang, 365);\r\n  pups.succ(_l.captchaLangChanged)\r\n}\r\n\r\nconst offClick = []\r\n\r\nfunction readyset() {\r\n  $('.make-me-readonly').each(function() {\r\n    $(this).attr('readonly', true)\r\n    .on('focus', function() {\r\n      $(this).removeAttr('readonly')\r\n    })\r\n  })\r\n\r\n  if(!ispage) $('.mgoback').show();\r\n  if(isTouch)\r\n    $('#js_settings').prepend('<a href=\"javascript: localStorage.setItem(\\'interfaceType\\', \\'desktop\\'); location.reload();\">'+_l.returnDesktop+'</a><br>');\r\n  else\r\n    $('#js_settings').prepend('<a href=\"javascript: localStorage.setItem(\\'interfaceType\\', \\'touch\\'); location.reload();\">'+_l.returnTouch+'</a><br>');\r\n\r\n  $('#js_settings').prepend(_l.captchalang+': <a href=\"javascript:setCaptchaLang(\\'ru\\');\">Cyrillic</a> | <a href=\"javascript:setCaptchaLang(\\'en\\');\">Latin</a> | <a href=\"javascript:setCaptchaLang(\\'num\\');\">Numeral</a><br />');\r\n\r\n  if(Styles.$cancelLink)\r\n    $('#js_settings').prepend(Styles.$cancelLink)\r\n\r\n  let pf = document.querySelector('#postform')\r\n  if (pf)\r\n    richFileInput.initForm(pf)\r\n\r\n  pups.init();\r\n  chpok.init(true)\r\n\r\n  LatexIT.init();\r\n  checkhighlight();\r\n  checkgotothread();\r\n  checknamesave();\r\n\r\n  bnrs.init();\r\n\r\n  if(getCookie('ku_menutype')) {\r\n    var c = Cookie('ku_menutype');\r\n    if(c != 'default' && c != '')\r\n      document.getElementById('overlay_menu').style.position = c;\r\n  }\r\n\r\n  //initial post-process\r\n  processNodeInsertion()\r\n\r\n  if(!isTouch) {\r\n    cloud20.init();\r\n    $('.sect-exr').mouseenter(function() { menu_show('ms-'+$(this).data('toexpand')); });\r\n    $('#overlay_menu').mouseleave(function() { menu_show('_off_'); });\r\n    $('body').on('mouseenter', \"a[class^='ref']\", function(ev) {\r\n      this.predelay = setTimeout(() => PostPreviews._mouseover.bind(this)(ev), PostPreviews._timings.predelay)\r\n    })\r\n    .on('mouseleave', \"a[class^='ref']\", PostPreviews._mouseout)\r\n    .on('click', \"a[class^='ref']\", function(e) {\r\n      e.preventDefault()\r\n      let href = this.getAttribute('href')\r\n      if (!highlight(href.split('#')[1], 0)) {\r\n        redirectTo(href)\r\n      }\r\n    })\r\n  }\r\n  else {\r\n    add_mob_menu();\r\n    $('body').addClass('touch-mode');\r\n    $('.sect-exr:not([data-toexpand=\"_options\"])').parent().hide();\r\n    $('.sect-exr').click(function() {\r\n      if($('#js_settings').is(':visible')) {\r\n        menu_show('_off_');\r\n      }\r\n      else {\r\n        menu_show('ms-_options');\r\n      }\r\n      return false;\r\n    });\r\n    offClick.push(ev => {\r\n      menu_show('_off_');\r\n      document.querySelectorAll('[id^=preview]').forEach(pre => PostPreviews._mouseout.bind(pre)(null, true))\r\n    })\r\n    $('body').on('click', \"a[class^='ref']\", PostPreviews._mouseover)\r\n    .on('doubletap', '.postnode', function(ev) {\r\n      ev.stopPropagation()\r\n      ev.preventDefault()\r\n      this.querySelector('.qrl').click()\r\n    })\r\n  }\r\n\r\n  $('html').click(ev => offClick.forEach(fn => fn(ev)))\r\n\r\n  /* ---------- All delegated events on body ---------- */\r\n  $('body')\r\n  .on('click', '.uib-mup', function() {\r\n    markup($(this).parents('form'), $(this).data('mups'), $(this).data('mupe'), $(this).data('imups'), $(this).data('imupe'));\r\n    return false;\r\n  })\r\n  .on('click', '.uib-bul', function() {\r\n    bullets($(this).parents('form'), $(this).data('bul'), $(this).data('imups'), $(this).data('imupe'));\r\n    return false;\r\n  })\r\n  .on('click', '.uib-tx', function() {\r\n    var target = $(this).data('target');\r\n    head.js('http://latex.codecogs.com/editor3.js', function() {\r\n      OpenLatexEditor(target,'phpBB','en-us', false, '','full');\r\n    });\r\n    return false;\r\n  })\r\n  //Video expanding\r\n  .on('click', '.movie', function(event) {expandVideo($(this), event)})\r\n  //new quick reply\r\n  .on('click', '.qrl', quickreply)\r\n  // ID highlighting\r\n  .on('click', '.hashpic', function() {\r\n    $('.highlight').removeClass('highlight')\r\n    let found = $(`.hashpic[alt=${$(this).attr('alt')}]`).each(function() {\r\n      $(this).parents('.posthead').parent().addClass('highlight')\r\n    }).length\r\n    pups.info(_l.found+': '+found, {time: 1.5})\r\n  })\r\n  .on('click', '.posttypeindicator a', function() { // TODO: what is this?\r\n    var xl = $(this);\r\n    var offset = $('[name=\"' + xl.attr('href').substr(1) + '\"]').offset() || $('[name=\"' + xl.text().split('>>')[1] + '\"]').offset() || false;\r\n    if(offset) {\r\n      $('html, body').animate({\r\n        scrollTop: offset.top - ( $('#overlay_menu').height() + 10 )\r\n      }, 250);\r\n    }\r\n    return false;\r\n  })\r\n  .on('click', '.dice', function() {\r\n    if(typeof $(this).data('html') === 'undefined') $(this).data('html', $(this).html());\r\n    var htm = stripHTML($(this).html());\r\n    $(this).html($(this).attr('title'));\r\n    $(this).attr('title', htm);\r\n  })\r\n  .on('click', '.reflink a', function(ev) {\r\n    ev.preventDefault()\r\n    let ref = this.parentElement\r\n    , postnode = ref._findParent('.postnode')\r\n    if (!lastActiveForm) {\r\n      quickreply.bind(postnode.querySelector('.qrl'))()\r\n    }\r\n    else {\r\n      let formBoard = is_overboard\r\n        ? lastActiveForm.getAttribute('id').match(/[0-9]+\\-(.+?)_qrf/)[1]\r\n        : this_board_dir\r\n      let postBody = postnode.querySelector('.postbody')\r\n      , qoutation = getPostQuotation(postBody)\r\n      insert(`>>${ref.dataset.b == formBoard ? '' : `/${ref.dataset.b}/`}${ref.dataset.id}\\n${qoutation}`)\r\n    }\r\n  })\r\n  //Ultimate YOBA Youtube embeds\r\n  .on('click','.embed-play-button', function(ev) {\r\n    ev.preventDefault()\r\n    unwrapEmbed($(this).parents('figure'))\r\n  })\r\n  .on('click','.collapse-video', function(ev) {\r\n    ev.preventDefault()\r\n    wrapEmbed($(this).parents('figure'))\r\n  })\r\n  .on('mouseenter', '._country_', function() {\r\n    if(typeof $(this).attr('title') === \"undefined\") {\r\n      $(this).attr('title', countries[$(this).attr('src').split('flags/')[1].split('.png')[0].toUpperCase()]);\r\n    }\r\n  })\r\n  .on('click', '.audiowrap', function(ev) {\r\n    ev.preventDefault();\r\n    let $this = $(this)\r\n    var src = $this.attr('href');\r\n    let $fig = $this.parents('figure')\r\n    if (! $fig.hasClass('unwrapped')) {\r\n      $fig.addClass('unwrapped unwrapped-audio')\r\n    }\r\n    let $fsz = $fig.find('.filesize');\r\n    if (! $fsz.find('.collapse-btn').length)\r\n      $fsz.append(`\r\n        <button title=\"${_l.collapse}\" class=\"emb-button collapse-video\">\r\n          ${makeIcon('shrink', 'b-icon')}\r\n        </button>`);\r\n    if (! $this.find('audio').length)\r\n      $this.append('<audio src=\"'+src+'\" controls autoplay=\"true\"></audio>')\r\n    $fsz.find('.collapse-video').click(function() {\r\n      $fig.removeClass('unwrapped unwrapped-audio')\r\n      .find('audio')[0].pause()\r\n    })\r\n  })\r\n  .on('change', '.multidel', function() {\r\n    let itemCount = $('.multidel:checked').length\r\n\r\n    if (! $('.item-count').length) {\r\n      $('.userdelete tbody').prepend(`<tr><td>\r\n        ${_l.selected}: <span class=\"item-count\"></span>\r\n        <button class=\"close-multisel icon-wraping-button\" title=\"${_l.cancel}\">${makeIcon('x', 'b-icon ', false)}</button>\r\n      </td></tr>`)\r\n      $('.close-multisel').click(function(ev) {\r\n        ev.preventDefault()\r\n        $('.multidel').prop('checked', false)\r\n        $('body').removeClass('select-multiple')\r\n        $('.userdelete').removeClass('ud-active')\r\n      })\r\n    }\r\n\r\n    if (itemCount > 0) {\r\n      $('.item-count').text(itemCount)\r\n    }\r\n    else {\r\n      $('.userdelete').removeClass('ud-active')\r\n      $('body').removeClass('select-multiple')\r\n    }\r\n  })\r\n  /* Post menu */ \r\n  .on('click', 'label.postinfo', function(ev) {\r\n    if (! $(this).find('.multidel').is(':visible')) {\r\n      ev.stopPropagation()\r\n      ev.preventDefault()\r\n      let $this = $(this)\r\n      , $menu = $this.parent().find('.post-menu')\r\n      let on = !$menu.is(':visible')\r\n      $('.post-menu').hide()\r\n      if (! $menu.length) {\r\n        let $postnode = $(this).parents('.postnode')\r\n        , board = $postnode.data('board')\r\n        , id = $postnode.data('id')\r\n        , isOP = $postnode.hasClass('op')\r\n        /*if (!isOP)\r\n          $postnode.toggleClass('post-hidden', HiddenItems.isHidden('post', id))*/\r\n        this.insertAdjacentHTML('afterend', `<div class=\"content-background post-menu\" style=\"display: none\"> \r\n          <ul>\r\n            <li class=\"menu-delete\">${makeIcon('x')}<span>${_l.del}</span></li>\r\n            ${!isOP ? `\r\n              ${typeof opmod !== 'undefined' && +opmod || 0 ? `<li class=\"menu-delete menu-delete-op\">${makeIcon('x')}<span>${_l.del} ${_l.asOP}</span></li>`: ''}\r\n              <li class=\"menu-hide\">${makeIcon('hide')}<span>${_l.hidePost}</span></li>\r\n              <li class=\"menu-unhide\">${makeIcon('unhide')}<span>${_l.unhidePost}</span></li>\r\n            `: ''}\r\n            <li class=\"menu-report\">${makeIcon('warning')}<span>${_l.report}</span></li>\r\n            <li class=\"menu-link-share\">${makeIcon('link')}<span>${_l.links}</span></li>\r\n            ${$postnode.find('.post-ttl').length ? `\r\n              <li class=\"menu-cancel-timer\">${makeIcon('untimer')}<span>${_l.cancelTimer}</span></li>\r\n            `: ''}\r\n            <li class=\"menu-select-multiple\">${makeIcon('select-multiple')}<span>${_l.selectMultiple}</span></li>\r\n            ${kumod_set ? `\r\n              <li class=\"menu-delete menu-delete-mod\">${makeIcon('x')}<span>${_l.del} ${_l.asMod}</span></li>\r\n              <a href=\"${ku_cgipath}/manage_page.php?action=bans&amp;banboard=${board}&amp;banpost=${id}\">\r\n                <li class=\"menu-ban\">${makeIcon('ban')}<span>${_l.ban}...<span></li>\r\n              </a>\r\n              ${isOP ? `\r\n                <a class=\"stickypost-btn\" onclick=\"Ajax.modThread(this, 'stickypost'); return false\"\r\n                href=\"${ku_cgipath}/manage_page.php?action=stickypost&amp;board=${board}&amp;postid=${id}\">\r\n                  <li>${makeIcon('pin')}<span>${_l.stickthread}<span></li>\r\n                </a>\r\n                <a class=\"unstickypost-btn\" onclick=\"Ajax.modThread(this, 'unstickypost'); return false\"\r\n                href=\"${ku_cgipath}/manage_page.php?action=unstickypost&amp;board=${board}&amp;postid=${id}\">\r\n                  <li>${makeIcon('unpin')}<span>${_l.unstickthread}<span></li>\r\n                </a>\r\n                <a class=\"lockpost-btn\" onclick=\"Ajax.modThread(this, 'lockpost'); return false\"\r\n                href=\"${ku_cgipath}/manage_page.php?action=lockpost&amp;board=${board}&amp;postid=${id}\">\r\n                  <li>${makeIcon('lock')}<span>${_l.lockthread}<span></li>\r\n                </a>\r\n                <a class=\"unlockpost-btn\" onclick=\"Ajax.modThread(this, 'unlockpost'); return false\"\r\n                href=\"${ku_cgipath}/manage_page.php?action=unlockpost&amp;board=${board}&amp;postid=${id}\">\r\n                  <li>${makeIcon('unlock')}<span>${_l.unlockthread}<span></li>\r\n                </a>`\r\n              : ''}`\r\n            : ''}\r\n          </ul>\r\n        </div>`)\r\n        $menu = $this.parent().find('.post-menu')\r\n      }\r\n      $menu.toggle(on)\r\n    }\r\n  })\r\n  // Figure menu is global because of FUCKING overflow\r\n  .on('click', '.file-menu-toggle', function(ev) {\r\n    ev.stopPropagation()\r\n    ev.preventDefault()\r\n    let $menu = $('.file-menu')\r\n    , $this = $(this)\r\n    , $fsz = $this.parent()\r\n    , visible = $menu.is(':visible')\r\n    $('.post-menu').hide()\r\n    if (visible && $menu[0].$boundTo[0] == $fsz[0]) return;\r\n    let ofs = $fsz.offset()\r\n    , offsetTop = $fsz.hasClass('embed-wrap') ? 22 : $fsz.outerHeight()\r\n    $menu.css({\r\n      'left': `${ofs.left}px`,\r\n      'top': `${ofs.top + offsetTop}px`,\r\n      'min-width': `${$fsz.outerWidth()}px`\r\n    }).show()\r\n    $menu[0].__menuProps = {\r\n      fileid: $fsz.parents('figure').data('fileid'),\r\n      board: $fsz.parents('.postnode').data('board')\r\n    }\r\n    $menu[0].$boundTo = $fsz\r\n  })\r\n  .on('click', '.post-menu li', ev => ev.stopPropagation())\r\n  .on('click', '.menu-select-multiple', function(ev) {\r\n    $('.post-menu').hide()\r\n    let $menu = $(this).parents('.post-menu')\r\n    , isFile = $menu.hasClass('file-menu')\r\n    , $md = (isFile ? $menu[0].$boundTo : $(this).parents('.posthead'))\r\n    .find('.multidel')\r\n    if (! $md.length) return;\r\n    $md.prop('checked', true).trigger('change')\r\n    $('.userdelete').addClass('ud-active')\r\n    $('body').addClass('select-multiple')\r\n  })\r\n  .on('click', '.menu-link-share', function(ev) {\r\n    let $this = $(this)\r\n    , isShown = $this.find('input').length\r\n    if (! isShown) {\r\n      let $postnode = $this.parents('.postnode')\r\n      , board = $postnode.data('board')\r\n      , id = $postnode.data('id')\r\n      , directLink = ku_boardspath + $postnode.find('.shl').attr('href')\r\n      $this.find('span').html(`<input class=\"pm-direct-link pm-link\" type=\"text\" value=\"${directLink}\" title=\"${_l.directLink}\">&nbsp;\r\n        <input class=\"pm-quote-link pm-link\" type=\"text\" value=\"&gt;&gt;/${board}/${id}\" title=\"${_l.quoteLink}\">`)\r\n      .css({'font-size': 0})\r\n      .find('.pm-direct-link').click()\r\n    }\r\n    else\r\n      $this.toggleClass('direct-or-quote')\r\n  })\r\n  .on('click', '.pm-link', function(ev) {\r\n    ev.stopPropagation()\r\n    let $this = $(this)\r\n    $('.pm-link').removeClass('selected')\r\n    $this.focus().select().addClass('selected')\r\n  })\r\n  .on('click', '.menu-delete', function() {\r\n    let $this = $(this)\r\n    , $menu = $this.parents('.post-menu')\r\n    , menu = $menu[0]\r\n    , isFile = $menu.hasClass('file-menu')\r\n    , $item = isFile ? $menu[0].$boundTo : $this.parents('.posthead')\r\n    , $pass = $menu.find('.menu-password')\r\n    $this.addClass('spin-around')\r\n    let fd = new FormData()\r\n    if ($menu.find('.menu-captcha').length) {\r\n      let $c = $menu.find('input[name=captcha]')\r\n      if (!$c.val()) {\r\n        $c.focus()\r\n        pups.warn(_l.enterCaptcha)\r\n        $this.removeClass('spin-around')\r\n        return;\r\n      }\r\n      fd.append('captcha', $c.val())\r\n    }\r\n    if (isFile)\r\n      fd.append('delete-file[]', menu.__menuProps.fileid)\r\n    else\r\n      fd.append('post[]', $item.parents('.postnode').data('id'))\r\n    let asMod = $this.hasClass('menu-delete-mod')\r\n    fd.append('moddelete', asMod)\r\n    fd.append('opdelete', +$this.hasClass('menu-delete-op'))\r\n    fd.append('board', isFile \r\n      ? menu.__menuProps.board\r\n      : $item.parents('.postnode').data('board'))\r\n    fd.append('postpassword', $pass.length\r\n      ? $pass.find('input').val()\r\n      : $(`#delform input[name=\"postpassword\"]`).val())\r\n    Ajax.deleteItems(fd, data => {\r\n      $this.removeClass('spin-around')\r\n      if (!data) return;\r\n      let result = data[0]\r\n      if(!result.success && $item.is(':visible')) {\r\n        if (asMod) return;\r\n        if (!$pass.length) {\r\n          $menu.prepend(`<li class=\"menu-password\">${makeIcon('password')}\r\n            <input value=\"${get_password(\"postpassword\")}\" class=\"make-me-readonly\" type=\"password\" placeholder=\"${_l.password}\" readonly onfocus=\"this.readOnly=false\"></li>`)\r\n        }\r\n        if (result.special_error && result.special_error == 'captchalocked') {\r\n          addCaptchaToMenu($menu)\r\n        }\r\n        else {\r\n          $menu.find('.menu-password input').select()\r\n          .keydown(ev => {\r\n            if (ev.key == 'Enter') {\r\n              ev.preventDefault()\r\n              ev.stopPropagation()\r\n            }\r\n          })\r\n        }\r\n      }\r\n      else if (isFile)\r\n        $('.file-menu').hide()\r\n    })\r\n  })\r\n  .on('click', '.menu-report', function() {\r\n    let $this = $(this)\r\n    , $postnode = $this.parents('.postnode')\r\n    $this.addClass('spin-around')\r\n    let fd = new FormData()\r\n    fd.append('post[]', $postnode.data('id'))\r\n    fd.append('board', $postnode.data('board'))\r\n    Ajax.reportPost(fd, data => {\r\n      $this.removeClass('spin-around')\r\n    })\r\n  })\r\n  .on('click', '.menu-hide', function() {\r\n    let $postnode = $(this).parents('.postnode')\r\n    HiddenItems.hidePost($postnode.data('id')+'-'+$postnode.data('board'))\r\n    $postnode.addClass('post-hidden')\r\n    .find('.post-menu').hide()\r\n  })\r\n  .on('click', '.menu-unhide', function() {\r\n    let $postnode = $(this).parents('.postnode')\r\n    HiddenItems.unhidePost($postnode.data('id')+'-'+$postnode.data('board'))\r\n    $postnode.removeClass('post-hidden')\r\n  })\r\n  .on('click', '.menu-cancel-timer', function() {\r\n    let $this = $(this)\r\n    , $menu = $this.parents('.post-menu')\r\n    , menu = $menu[0]\r\n    , $pass = $menu.find('.menu-password')\r\n    , $postnode = $this.parents('.postnode')\r\n    $this.addClass('spin-around')\r\n    let fd = new FormData()\r\n    if ($menu.find('.menu-captcha').length) {\r\n      let $c = $menu.find('input[name=captcha]')\r\n      if (!$c.val()) {\r\n        $c.focus()\r\n        pups.warn(_l.enterCaptcha)\r\n        $this.removeClass('spin-around')\r\n        return;\r\n      }\r\n      fd.append('captcha', $c.val())\r\n    }\r\n    fd.append('post[]', $postnode.data('id'))\r\n    fd.append('board', $postnode.data('board'))\r\n    fd.append('modsave', $this.hasClass('menu-delete-mod'))\r\n    fd.append('opsave', $this.hasClass('menu-delete-op'))\r\n    fd.append('postpassword', $pass.length\r\n      ? $pass.find('input').val()\r\n      : $(`#delform input[name=\"postpassword\"]`).val())\r\n    Ajax.cancelTimer(fd, errors => {\r\n      $this.removeClass('spin-around')\r\n      if (errors.length) {\r\n        let result = errors[0]\r\n        if (!$pass.length) {\r\n          $menu.prepend(`<li class=\"menu-password\">${makeIcon('password')}\r\n            <input value=\"${get_password(\"postpassword\")}\" class=\"make-me-readonly\" type=\"password\" placeholder=\"${_l.password}\" readonly onfocus=\"this.readOnly=false\"></li>`)\r\n        }\r\n        if (result.special_error && result.special_error == 'captchalocked') {\r\n          addCaptchaToMenu($menu)\r\n        }\r\n        else {\r\n          $menu.find('.menu-password input').select()\r\n          .keydown(ev => {\r\n            if (ev.key == 'Enter') {\r\n              ev.preventDefault()\r\n              ev.stopPropagation()\r\n            }\r\n          })\r\n        }\r\n      }\r\n      else {\r\n        $menu.find('.menu-password, .menu-captcha').remove()\r\n      }\r\n    })\r\n  })\r\n  .on('click', '.csswrap', function(ev) {\r\n    ev.preventDefault()\r\n    let cssLink = $(this).attr('href')\r\n    , styleName = $(this).parent().find('.fc-filename').text()\r\n    Styles.testStyle(cssLink, styleName)\r\n  })\r\n  .on('blur', 'input[name=\"name\"]', function() {\r\n    let isTrip = ~this.value.indexOf('#')\r\n    this.type = isTrip ? 'password' : 'text'\r\n  })\r\n  .on('focus', 'input[name=\"name\"]', function() {\r\n    this.type ='text'\r\n  })\r\n\r\n  offClick.push(ev => {\r\n    $('.post-menu').hide()\r\n  })\r\n\r\n  $(window).resize(() => {\r\n    let $fileMenu = $('.file-menu')\r\n    if (! $fileMenu.is(':visible')) return;\r\n    let $fsz = $fileMenu[0].$boundTo\r\n    , ofs = $fsz.offset()\r\n    , offsetTop = $fsz.hasClass('embed-wrap') ? 22 : $fsz.outerHeight()\r\n    $fileMenu.css({\r\n      'left': `${ofs.left}px`,\r\n      'top': `${ofs.top + offsetTop}px`,\r\n      'min-width': `${$fsz.outerWidth()}px`\r\n    })\r\n  })\r\n\r\n  $('#delform').on('submit', function(e) {\r\n    e.preventDefault()\r\n    Ajax.deleteItems(new FormData(this))\r\n    return false\r\n  })\r\n\r\n  $('.userdelete input[type=submit]').click(function(e) {\r\n    e.preventDefault()\r\n    e.stopPropagation()\r\n    let fd = new FormData($(this).parents('form')[0])\r\n    if (this.name == 'deletepost') {\r\n      Ajax.deleteItems(fd)\r\n    }\r\n    if (this.name == 'cancel_timer') {\r\n      Ajax.cancelTimer(fd)\r\n    }\r\n    if (this.name == 'reportpost') {\r\n      Ajax.reportPost(fd)\r\n    }\r\n  })\r\n\r\n  /*$('input[name=reportpost]').click(function(e) {\r\n    e.preventDefault()\r\n    Ajax.reportPost(new FormData($(this).parents('form')[0]))\r\n  })*/\r\n  if (!is_overboard)\r\n    $('#delform').after('<div id=\"rswapper\">[<a onclick=\"javascript:rswap.swap();return false;\" href=\"#\">'+(ispage ? _l.NewThread : _l.reply)+'</a>]<hr /></div>');\r\n\r\n  Settings.sfwMode(false);\r\n  if (localStorage) {\r\n    for(var s in Settings) {\r\n      if (s.substring(0,1) == \"_\") continue;\r\n      $(\"#js_settings\").append('<label><input type=\"checkbox\" onchange=\"javascript:Settings.'+s+'(true)\" name=\"settings_'+s+'\" id=\"settings_'+s+'\" value=\"true\"> '+_l['settings_'+s]+'</label><br />');\r\n      Settings[s](false);\r\n    }\r\n  } else {\r\n    $(\"#js_settings\").append(\"<span style=\\\"color:#F00\\\">\"+_l.noLocalStorage+\"</span><br />Твой браузер — говно. Скачай <a href=\\\"/web/20110329072959/http://google.com/chrome\\\" target=\\\"_blank\\\">Chome</a>, например.\");\r\n  }\r\n\r\n  var textbox = document.getElementById('message');\r\n  if(textbox) {\r\n    textbox.onfocus=function(){is_entering = true;}\r\n    textbox.onblur=function(){is_entering = false;}\r\n  }\r\n\r\n  // Figure menu is global because of FUCKING overflow\r\n  $('body').append(`\r\n    <div class=\"content-background post-menu file-menu\" style=\"display: none\"> \r\n      <ul>\r\n        <li class=\"menu-delete\">${makeIcon('x')}<span>${_l.del}</span></li>\r\n        <li class=\"menu-select-multiple\">${makeIcon('select-multiple')}<span>${_l.selectMultiple}</span></li>\r\n        ${kumod_set ? `<li class=\"menu-delete menu-delete-mod\">${makeIcon('x')}<span>${_l.del} ${_l.asMod}</span></li>` : ''}\r\n      </ul>\r\n    </div>\r\n  `)\r\n  \r\n  //animation hooks  \r\n  $(document).on('animationstart webkitAnimationStart MSAnimationStart oanimationstart', function(event) {\r\n    var $target = $(event.target)\r\n    //detect node insertions and process them\r\n    if (event.originalEvent.animationName == \"nodeInserted\" && !$target.hasClass('_inserted_'))\r\n      processNodeInsertion($target)\r\n    //detect window resize\r\n    if (event.originalEvent.animationName == \"windowSmall\") {\r\n      document.querySelectorAll('.quick-reply-form').forEach(f => {\r\n        toggleFormFloating(f, false)\r\n        toggleFormSimplify(f, true)\r\n      })\r\n    }\r\n  });\r\n\r\n  Captcha.init(is_overboard)\r\n\r\n  initForm(document.querySelector('#postform'))\r\n\r\n  if(typeof is_catalog !== 'undefined' && is_catalog) catalog.init();\r\n\r\n  $('.userdelete').addClass('content-background reflinkpreview');\r\n\r\n  $('<div id=\"tripinfo\"></div>').addClass('content-background reflinkpreview qreplyform').hide().appendTo('body');\r\n\r\n  $('#delform').on('click', '.postertrip', function(ev) {\r\n    ev.preventDefault()\r\n    ev.stopPropagation()\r\n    var trip = $(this).text().split('!')[1]\r\n    , offset = $(this).offset(), height = $(this).height()\r\n    $.getJSON('/tripinfo.php', { trip: trip })\r\n    .done(function(data) {\r\n      var active_on = [];\r\n      _.each(data.active_on, function(board) {\r\n        active_on.push('<a target=\"_blank\" href=\"'+ku_boardspath+'/'+board+'/\">'+'/'+board+'/</a>');\r\n      })\r\n      $('#tripinfo')\r\n      .html(\r\n        '<div><b class=\"postertrip\">!'+trip+'</b> ['+'<a href=\"https://www.google.com/search?q=!'+trip+'\" target=\"_blank\">G</a>]</div>'+\r\n        '<a style=\"float:left;\" href=\"#\" onclick=\"javascript:$(\\'#tripinfo\\').hide();return false;\"><svg style=\"position: absolute; top: 3px; right: 3px;\" class=\"icon b-icon\"><use xlink:href=\"#i-x\"></use></svg></a>'+\r\n        '<div class=\"trip-info-line\">'+_l.threads+': '+data.threads+', '+_l.comments+': '+data.comments+'</div>'+\r\n        '<div class=\"trip-info-line\">'+_l.active_since+': '+catalog.formatDate(data.active_since, true)+'</div>'+\r\n        '<div class=\"trip-info-line\">'+_l.last_active+': '+catalog.formatDate(data.last_active, true)+'</div>'+\r\n        (active_on.length ? '<div class=\"trip-info-line\">'+_l.active_on+': '+active_on.join(', ')+'</div>' : '')\r\n      )\r\n      .css({\r\n         top: offset.top + height,\r\n         left: offset.left\r\n       })\r\n      .fadeIn('fast');\r\n    })\r\n    .fail(function(error) {\r\n      console.error(error)\r\n    })\r\n  })\r\n\r\n  unreadCounter.update()\r\n\r\n  if(liveupd_ena && typeof io !== 'undefined')\r\n    updater.init()\r\n\r\n  onReady.ready()\r\n}\r\n\r\n/*\r\n * jQuery Double Tap https://gist.github.com/attenzione/7098476\r\n * Developer: Sergey Margaritov (github.com/attenzione)\r\n * License: MIT\r\n * Date: 22.10.2013\r\n * Based on jquery documentation http://learn.jquery.com/events/event-extensions/\r\n */\r\n(function($){\r\n  $.event.special.doubletap = {\r\n    bindType: 'touchend',\r\n    delegateType: 'touchend',\r\n\r\n    handle: function(event) {\r\n      var handleObj   = event.handleObj,\r\n          targetData  = jQuery.data(event.target),\r\n          now         = new Date().getTime(),\r\n          delta       = targetData.lastTouch ? now - targetData.lastTouch : 0,\r\n          delay       = delay == null ? 300 : delay,\r\n          e           = event.originalEvent\r\n\r\n      if (delta < delay && delta > 30 && !(e.touches && e.touches.length > 1)) {\r\n        targetData.lastTouch = null;\r\n        event.type = handleObj.origType;\r\n        ['clientX', 'clientY', 'pageX', 'pageY'].forEach(function(property) {\r\n          event[property] = event.originalEvent.changedTouches[0][property];\r\n        })\r\n\r\n        // let jQuery handle the triggering of \"doubletap\" event handlers\r\n        handleObj.handler.apply(this, arguments);\r\n      } else {\r\n        targetData.lastTouch = now;\r\n      }\r\n    }\r\n  };\r\n})(jQuery)\r\n\r\nconst NTP = {\r\n  calc: (t0, t1, t2, t3) => ((t1 - t0) + (t2 - t3)) / 2,\r\n  sync: function(force) {\r\n    this.pending = true\r\n    let _this = this\r\n    , t0 = (new Date()).valueOf()\r\n    $.ajax({\r\n      url: '/ntp.php',\r\n      success: function(servertime) {\r\n        let t1 = servertime,\r\n            t2 = servertime,\r\n            t3 = (new Date()).valueOf()\r\n\r\n        _this.offset = _this.calc(t0, t1, t2, t3)\r\n      },\r\n      error: function() {\r\n        pups.err('Failed to synchronize time with the server')\r\n      },\r\n      complete: function() {\r\n        _this.synced = true\r\n\r\n        while (_this.stack.length) {\r\n          _this.stack.shift().resolve(_this.timeWithOffset)\r\n        }\r\n      }\r\n    });\r\n  },\r\n  offset: 0,\r\n  stack: [],\r\n  get timeWithOffset() {\r\n    return new Date(new Date().getTime() + this.offset).getTime()\r\n  },\r\n  getServerTime: function() {\r\n    if (this.synced)\r\n      return Promise.resolve(this.timeWithOffset)\r\n\r\n    let promise = externallyResolvingPromise()\r\n    if (! this.pending)\r\n      this.sync()\r\n    this.stack.push(promise)\r\n    return promise.promise\r\n  }\r\n}\r\n\r\nfunction externallyResolvingPromise() {\r\n  let promiseResolve, promiseReject\r\n  , promise = new Promise((resolve, reject) => {\r\n    promiseResolve = resolve\r\n    promiseReject = reject\r\n  });\r\n\r\n  return {\r\n    promise: promise,\r\n    resolve: promiseResolve,\r\n    reject: promiseReject\r\n  }\r\n}\r\n\r\n// this will be applied to every new inserted node (post)\r\nfunction processNodeInsertion($node) {\r\n  if(typeof $node === 'undefined')\r\n    $node = $('body');\r\n  else {\r\n    $node.addClass('_inserted_');\r\n    $node = $node.parents(\":eq(1)\");\r\n  }\r\n  if($node.find('.prettyprint').length)\r\n    prettyPrint.apply(window);\r\n  LatexIT.render($node);\r\n\r\n  // Post time-to-live updating\r\n  $node.find('.post-ttl:not(._inserted_)').each(function() {\r\n    let $this = $(this)\r\n    $this.addClass('_inserted_')\r\n    let iv\r\n    , updateTTL = () => {\r\n      if ($this.length) {\r\n        NTP.getServerTime().then(srvTime => {\r\n          let ms_left = $this.data('deleted-timestamp')*1000 - srvTime\r\n          if (ms_left >= 0) {\r\n            let min_left = Math.round(ms_left / 60000)\r\n            , h_left = Math.floor(min_left / 60)\r\n            min_left -= h_left * 60\r\n            $this.text(`${_.padLeft(h_left, 2, '0')}:${_.padLeft(min_left, 2, '0')}`)\r\n          }\r\n          else {\r\n            $.get(document.forms.delform.action) // call board.php to force delete posts\r\n            deleteItems([{action: 'delete_post', id: $this.parents('.postnode').data('id')}], false, updater.markOnly)\r\n            clearInterval(iv)\r\n          }\r\n        })\r\n      }\r\n      else\r\n        clearInterval(iv)\r\n    }\r\n    iv = setInterval(updateTTL, 30 * 1000)\r\n    updateTTL()\r\n  })\r\n}\r\n\r\nconst chpok = {\r\n  init: function(atLoad = false) {\r\n    document.body.insertAdjacentHTML('beforeend', `<audio id=\"chpok-audio\" style=\"display:none\">\r\n      <source src=\"${ku_boardspath}/images/chpok.mp3\">\r\n      <source src=\"${ku_boardspath}/images/chpok.ogg\">\r\n    </audio>`)\r\n    this.initiated = true\r\n    this.audio = document.querySelector('#chpok-audio')\r\n  },\r\n  play: function() {\r\n    if (! this.initiated)\r\n      this.init()\r\n    // In chrome the sound won't play, causing a DOM exception, if a user hasn't clicked a page at least once (and it's unfixable)\r\n    this.audio.play().catch(e => _.noop)\r\n  }\r\n}\r\n\r\nconst updater = {\r\n  newThreads: [],\r\n  init: function () {\r\n    this.socket = io.connect(liveupd_api);\r\n    let subscribeTo\r\n    if(ispage) {\r\n      subscribeTo = [liveupd_sitename+this_board_dir+':threads']\r\n      document.querySelectorAll('.postnode.op').forEach(thr => subscribeTo.push(liveupd_sitename+thr.dataset.board+':'+thr.dataset.id))\r\n    }\r\n    else {\r\n      subscribeTo = [liveupd_sitename+this_board_dir+':'+$('input[name=replythread]').val()];\r\n      _l.noNewPosts += (\"<br>\" + _l.threadUpdationAutomatically)\r\n    }\r\n    this.socket\r\n    .on('update', this.dispatch.bind(this))\r\n    .emit('subscribe', subscribeTo)\r\n    Object.defineProperty(this, 'markOnly', {\r\n      value: true,\r\n      writable: false,\r\n      configurable: false\r\n    })\r\n  },\r\n  dispatch: function(data) {\r\n    if (! data.action) {\r\n      pups.warn('Event with unspecified action, see console')\r\n      console.warn(data)\r\n      return\r\n    }\r\n    if (data.action == 'new_thread') {\r\n      // Do nothing if it is my post\r\n      if (data.token && Ajax.postToken && data.token==Ajax.postToken) return;\r\n      this.notifyAboutNewThreads(data)\r\n    }\r\n    if (data.action == 'new_reply') {\r\n      // Do nothing if it is my post\r\n      if (data.token && Ajax.postToken && data.token==Ajax.postToken) return;\r\n      if (ispage) {\r\n        this.notifyAboutNewRepliesOnBoardPage(data)\r\n      }\r\n      else {\r\n        this.showNewReplies(data)\r\n      }\r\n    }\r\n    if (data.action == 'delete') {\r\n      // Do nothing if it is my post\r\n      if (data.token && Ajax.delToken && data.token==Ajax.delToken) return;\r\n      deleteItems(data.items, false, this.markOnly)\r\n    }\r\n    if (data.action == 'cancel_timer') {\r\n      // Do nothing if it is my post\r\n      if (data.token && Ajax.timerToken && data.token==Ajax.timerToken) return;\r\n      let postsSaved = [], msg = ''\r\n      data.items.forEach(item => {\r\n        $(`.postnode[data-id=${item.id}] .post-ttl`).remove()\r\n        postsSaved.push(item.id)\r\n      })\r\n      if(postsSaved.length) {\r\n        msg = postsSaved.length > 1 ?\r\n          `${_l.posts} #${postsSaved.join(', #')} ${_l.savedMulti}.`\r\n         :`${_l.post} #${postsSaved[0]} ${_l.saved}.`\r\n        pups.info(msg, {time: 2 + postsSaved.length})\r\n      }\r\n    }\r\n  },\r\n  showNewReplies: function(data) {\r\n    newposts.get({\r\n      silent: true,\r\n      timestamp: data.timestamp,\r\n      onSuccess: () => {\r\n        if (! document.hasFocus())\r\n          chpok.play()\r\n      }\r\n    })\r\n  },\r\n  notifyAboutNewThreads: function(data) {\r\n    this.newThreads.push({\r\n      board: data.board,\r\n      board_desc: data.board_desc || false,\r\n      thread: data.new_thread_id\r\n    });\r\n    if (! document.hasFocus()) {\r\n      scrollAnchor.save('autoload', '.postnode')\r\n      this.showNewThreads(() => scrollAnchor.restore('autoload'))\r\n      chpok.play()\r\n    }\r\n    else if(!$('#wild_thread_appeared').length) {\r\n      $('#delform').before('<a class=\"xlink\" onclick=\"updater.showNewThreads();return false\" id=\"wild_thread_appeared\"><span class=\"salient\">'+_l.newThreadsAvailable+'</span><hr /></a>')\r\n    }\r\n  },\r\n  notifyAboutNewRepliesOnBoardPage: function(data) {\r\n    let room = data.room + '-' + data.board\r\n    if (! this.repliesOnBoardPage[room])\r\n      this.repliesOnBoardPage[room] = [data.reply_id]\r\n    else\r\n      this.repliesOnBoardPage[room].push(data.reply_id)\r\n    this.refreshNewRepliesCount(data.board, data.room, data.timestamp)\r\n  },\r\n  refreshNewRepliesCount(board, threadID, timestamp=null) {\r\n    let thread = threadID + '-' + board\r\n    , count = (this.repliesOnBoardPage[thread] || []).length\r\n    , $target = $('[id^=replies'+thread+']')\r\n    , $counter = $target.find('.fresh-replies')\r\n    let clearCounter = () => this.repliesOnBoardPage[thread] = []\r\n    if (count) {\r\n      if (! $counter.length) {\r\n        function loadNewReplies(callback) {\r\n          newposts.get({\r\n            threadid: thread,\r\n            onSuccess: () => {\r\n              clearCounter()\r\n              if (callback)\r\n                callback()\r\n            },\r\n            onError: (e) => {\r\n              console.error(e)\r\n              pups.err(_l.oops)\r\n            },\r\n            silent: true,\r\n            timestamp: timestamp\r\n          })\r\n        }\r\n        if (! document.hasFocus()) {\r\n          scrollAnchor.save('autoload', '.postnode')\r\n          loadNewReplies(() => scrollAnchor.restore('autoload'))\r\n          chpok.play()\r\n        }\r\n        else {\r\n          let $freshReplies = $target.append('<br class=\"fresh-replies-breaker\"><a href=\"/'+ board +'/res/'+threadID+'.html\" class=\"salient fresh-replies\">'+_l.newReplies+': <span class=\"fresh-replies-number\"></span></a>')\r\n          .find('.fresh-replies')\r\n          , freshReplies = $freshReplies[0]\r\n          $freshReplies.click(function(e) {\r\n            e.preventDefault()\r\n            if ($freshReplies.__alreadyLoading)\r\n              return;\r\n            freshReplies.__alreadyLoading = true\r\n            freshReplies.insertAdjacentHTML('afterBegin', '<div class=\"spinner\"></div>')\r\n            loadNewReplies(() => $(freshReplies).remove())\r\n          })\r\n        }\r\n      }\r\n      $target.find('.fresh-replies-number').text(count)\r\n    }\r\n    else if($counter.length) {\r\n      $counter.remove()\r\n      clearCounter()\r\n    }\r\n  },\r\n  repliesOnBoardPage: {},\r\n  showNewThreads: function(callback) {\r\n    let $wta = $('#wild_thread_appeared')\r\n    if ($wta.length)\r\n    $wta.find('span')[0].insertAdjacentHTML('afterBegin', '<div class=\"spinner\"></div>')\r\n    this.newThreads.forEach(thr => {\r\n      HTMLoader.getThread(thr.board, thr.thread, null, (err, posts) => {\r\n        if (err)\r\n          return pups.err(_l.noDataLoaded)\r\n        $wta.remove()\r\n        document.querySelector('#delform').insertAdjacentHTML('afterBegin', `\r\n            ${posts}\r\n            <div id=\"replies${thr.thread}-${thr.board}\" class=\"replies\"></div>\r\n          </div>\r\n          <br clear=\"left\" />\r\n          <hr>`);\r\n        if (is_overboard && thr.board_desc) {\r\n          document.querySelector('#delform .posthead').insertAdjacentHTML('afterbegin', \r\n            `<a href=\"/${thr.board}\" target=\"_blank\" class=\"over-boardlabel\">/${thr.board}/ — ${thr.board_desc}</a>`)\r\n        }\r\n        this.socket.emit('subscribe', liveupd_sitename+thr.board+':'+thr.thread)\r\n        if (callback) \r\n          callback()\r\n      })\r\n    })\r\n    this.newThreads = [];\r\n  }\r\n}\r\n\r\nfunction deleteItems(items, bySelf=true, markOnly=false) {\r\n  let postsDeleted = []\r\n  , postErrors = []\r\n  , insideDeletedThread\r\n  , filesDeleted = []\r\n  , fileErrors = []\r\n\r\n  items.forEach(item => {\r\n    let deletedClasses = 'deleted'\r\n      + (item.by_op ? ' op-deleted' : '')\r\n      + (item.by_mod ? ' mod-deleted' : '')\r\n\r\n    if (item.action == 'delete_post' || item.itemtype == 'post') {\r\n      if (bySelf && !item.success) {\r\n        postErrors.push(item)\r\n        return\r\n      }\r\n      insideDeletedThread = false\r\n      let $thread = $(`#delform [id^=thread${item.id}]`)\r\n      , $reply = $(`#delform [id^=reply${item.id}]`)\r\n      if ($thread.length) {\r\n        if (markOnly || !ispage) {\r\n          $thread.addClass('deleted')\r\n          .find('.reply, figure').addClass(deletedClasses)\r\n          if (!ispage) {\r\n            insideDeletedThread = true\r\n            $('form[name=postform], .qrl, #rswapper').remove()\r\n            pups.warn(`${_l.thread} ${_l.deleted}!`, {time: 0})\r\n          }\r\n        }\r\n        else {\r\n          $thread.prev().remove() //unhidethread\r\n          $thread.next().remove() //br\r\n          $thread.next().remove() //hr\r\n          $thread.remove()\r\n        }\r\n      }\r\n      else if ($reply.length) {\r\n        if (markOnly)\r\n          $reply.addClass(deletedClasses)\r\n        else {\r\n          let $reply = $(`#delform [id^=reply${item.id}]`)\r\n          if ($reply.length) {\r\n            $reply.parents('.postnode').remove()\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        if (updater.repliesOnBoardPage[item.thread_id])\r\n          updater.repliesOnBoardPage[item.thread_id] = updater.repliesOnBoardPage[item.thread_id].filter(i => i!=item.id)\r\n        updater.refreshNewRepliesCount(item.thread_id)\r\n      }\r\n      if (!insideDeletedThread)\r\n        postsDeleted.push('#'+item.id)\r\n    }\r\n\r\n    if (item.action == 'delete_file'  || item.itemtype == 'file') {\r\n      if (bySelf && !item.success) {\r\n        fileErrors.push(item)\r\n        return\r\n      }\r\n      let $fig = $(`figure[data-fileid=${item.id}]`)\r\n      if (markOnly)\r\n        $fig.addClass(deletedClasses)\r\n      else\r\n        $fig.replaceWith(`<div class=\"nothumb\">${_l.fileRemoved}</div>`)\r\n      filesDeleted.push('#'+item.id)\r\n    }\r\n\r\n    if (item.action == 'delete_thread') { // A notification about deleted\r\n      updater.newThreads = updater.newThreads.filter(i => i!=item.id)\r\n      if (! updater.newThreads.length)\r\n        $('#wild_thread_appeared').remove();\r\n      pups.info(`${_l.thread} ${item.id} ${_l.deleted}.`)\r\n    }\r\n  })\r\n\r\n  if (! $('.multidel').is(\":checked\") && ! $('.multidel.delete-file').is(\":checked\")) {\r\n    $('.userdelete').removeClass('ud-active')\r\n    $('body').removeClass('select-multiple')\r\n  }\r\n    \r\n  if (postsDeleted.length) {\r\n    let msg = postsDeleted.length > 1\r\n      ? `${_l.posts} ${postsDeleted.join(', ')} ${_l.deletedMulti}.`\r\n      : `${_l.post} ${postsDeleted[0]} ${_l.deleted}.`\r\n    pups[bySelf ? 'succ' : 'info'](msg, {time: 2 + postsDeleted.length})\r\n  }\r\n  if (filesDeleted.length) {\r\n    let msg = filesDeleted.length > 1\r\n      ? `${_l.files} ${filesDeleted.join(', ')} ${_l.deletedMulti}.`\r\n      : `${_l.file} ${filesDeleted[0]} ${_l.deleted}.`\r\n    pups[bySelf ? 'succ' : 'info'](msg, {time: 2 + filesDeleted.length})\r\n  }\r\n  if (postErrors.length)\r\n    pups.err(postErrors.map(err => `${_l.post} #${err.id}: ${err.message}`).join('<br>'), \r\n      {time: 2 + postErrors.length})\r\n  if (fileErrors.length) {\r\n    pups.err(fileErrors.map(err => `${_l.file} #${err.id}: ${err.message}`).join('<br>'), \r\n      {time: 2 + fileErrors.length})\r\n  }\r\n}\r\n\r\nif (+localStorage['localmod']) {\r\n  kumod_set = true\r\n}\r\nelse {\r\n  let kumod = getCookie('kumod');\r\n  if (kumod !== '') {\r\n    if (kumod === 'allboards')\r\n      kumod_set = true\r\n    else\r\n      kumod_set = in_array(this_board_dir, kumod.split('|'));\r\n  }\r\n}\r\n\r\nfunction expandVideo($mov, ev) {\r\n  //good luck understanding this shitcode :^)\r\n  let $reply = $mov.parents('.reply')\r\n  if($mov.data('expanded') !== '1') {\r\n    ev.preventDefault();\r\n    var movieurl = $mov.attr('href'), imgh = $mov.data('height'), imgw = $mov.data('width'), dt = $mov.data('thumb'), postnum = $mov.data('id');\r\n    var uid = '_vframe_'+randomString(5)+(new Date().getTime());\r\n    $mov.replaceWith(function() {\r\n      return '<span id=\"'+uid+'\" data-thumb=\"'+dt+'\" data-width=\"'+imgw+'\"\" data-height=\"'+imgh+'\" data-href=\"'+movieurl+'\">'+this.innerHTML + '</span>';\r\n    });\r\n    $mov = $(\"#\"+uid);\r\n    $mov.find('img').hide();\r\n    var video = $mov.find('video').show(), notice = '';\r\n    if(!video.length) {\r\n      $mov.find('.playable-thumb').append('<video class=\"thumb\" src=\"'+movieurl+'\" controls loop autoplay height=\"'+imgh+'\" width=\"'+imgw+'\"></video>').promise().done(function() {\r\n        video = $mov.find('video');\r\n      });\r\n    }\r\n    else video.get(0).play();\r\n    if(!Settings.expandImgFull()) {\r\n      var offset = 50, offset_el = video[0];\r\n      var max_w = document.documentElement?document.documentElement.clientWidth : document.body.clientWidth;\r\n      while (offset_el != null) {\r\n        offset += offset_el.offsetLeft;\r\n        offset_el = offset_el.offsetParent;\r\n      }\r\n      var new_w = max_w - offset;\r\n      if(imgw > new_w) {\r\n        var ratio = imgw / imgh;\r\n        var zoom = 1 - new_w / imgw;\r\n        var new_h = new_w / ratio;\r\n        video.width(new_w);\r\n        video.height(new_h);\r\n        notice = _l.videoDownscaledBy + \" \" + Math.round(zoom*100) + \"% \"+_l.toFit;\r\n      }\r\n    }\r\n    let $fig = $mov.parents('figure');\r\n    if (! $fig.hasClass('unwrapped')) {\r\n      $fig.addClass('unwrapped')\r\n    }\r\n    let $fsz = $mov.parent().find('.filesize');\r\n    if (! $fsz.find('.collapse-btn').length) {\r\n      $fsz.append(`\r\n        <button title=\"${_l.collapse}\" class=\"emb-button collapse-video\">\r\n          ${makeIcon('shrink', 'b-icon')}\r\n        </button>`);\r\n      $mov.parent().find('.collapse-video').click(function() {\r\n        $fig.removeClass('unwrapped')\r\n        var uid = '_vframe_'+randomString(5)+(new Date().getTime());\r\n        $mov.replaceWith(function() {\r\n          return '<a class=\"movie\" id=\"'+uid+'\" data-thumb=\"'+dt+'\" data-width=\"'+imgw+'\"\" data-height=\"'+imgh+'\" href=\"'+movieurl+'\">'+this.innerHTML + '</a>';\r\n        }).data('expanded', '0');\r\n        $mov = $(\"#\"+uid);\r\n        $mov.find('video').hide()[0].pause();\r\n        $mov.find('img').show();\r\n        $(this).remove();\r\n        $mov.parents('.reply').removeClass('reply-expanded')\r\n        return false;\r\n      });\r\n    }\r\n    $mov.parents('.reply').addClass('reply-expanded')\r\n  }\r\n}\r\n\r\nfunction checknamesave() {\r\n  var checkd;\r\n  if(getCookie('name') != '') {\r\n    checkd = true;\r\n  } else {\r\n    checkd = false;\r\n  }\r\n  var doc = document.getElementById('save');\r\n  if (doc != null) doc.checked = checkd;\r\n}\r\nfunction checkgotothread() {\r\n  var checkd;\r\n  if(getCookie('tothread') == 'off') {\r\n    checkd = false;\r\n  } else {\r\n    checkd = true;\r\n  }\r\n  $(\"#gotothread\").attr('checked', checkd);\r\n}\r\n\r\nfunction navigatepages (event) {\r\n  if (!document.getElementById) return;\r\n    if (is_entering) return;\r\n  if (window.event) event = window.event;\r\n\r\n  if (event.ctrlKey) {\r\n    var link = null;\r\n    var href = null;\r\n\r\n    var docloc = document.location.toString();\r\n    if (docloc.indexOf('/res/') != -1) {\r\n      if( (event.keyCode ? event.keyCode : event.which ? event.which : null) == 13 ) {\r\n        handleCtrlEnter(event)\r\n      }\r\n    }\r\n    else {\r\n      if (docloc.indexOf('.html') == -1 || docloc.indexOf('board.html') != -1) {\r\n        var page = 0;\r\n        var docloc_trimmed = docloc.substr(0, docloc.lastIndexOf('/') + 1);\r\n      } else {\r\n        var page = docloc.substr((docloc.lastIndexOf('/') + 1));\r\n        page = (+page.substr(0, page.indexOf('.html')));\r\n        var docloc_trimmed = docloc.substr(0, docloc.lastIndexOf('/') + 1);\r\n      }\r\n      if (page == 0) {\r\n        var docloc_valid = docloc_trimmed;\r\n      } else {\r\n        var docloc_valid  = docloc_trimmed + page + '.html';\r\n      }\r\n      let match;\r\n      if(match=/#s([0-9]+)/.exec(docloc)) {\r\n        var relativepost = (+match[1]);\r\n      } else {\r\n        var relativepost = -1;\r\n      }\r\n      var maxthreads = 0;\r\n      while(document.getElementsByName('s'+(++maxthreads)).length>0){}\r\n      switch (event.keyCode ? event.keyCode : event.which ? event.which : null)\r\n      {\r\n        case 13: // ctrl+Enter\r\n          handleCtrlEnter(event)\r\n          break;\r\n\r\n        case 0x25: // ctrl+left\r\n          link = document.getElementById('prevPage');\r\n          break;\r\n        case 0x27: // ctrl+right\r\n          link = document.getElementById('nextPage');\r\n          break;\r\n\r\n        case 0x28: // ctrl+down\r\n          if (relativepost == maxthreads - 1) {\r\n            break; //var newrelativepost = 0;\r\n          } else {\r\n            var newrelativepost = relativepost + 1;\r\n          }\r\n          href = docloc_valid + '#s' + newrelativepost;\r\n          break;\r\n\r\n        case 0x26: // ctrl+up\r\n          if (relativepost == -1 || relativepost == 0) {\r\n            break; //var newrelativepost = maxthreads - 1;\r\n          } else {\r\n            var newrelativepost = relativepost - 1;\r\n          }\r\n          href = docloc_valid + '#s' + newrelativepost;\r\n          break;\r\n\r\n        case 0x24: // ctrl+home\r\n          document.location = docloc_trimmed;\r\n          break;\r\n      }\r\n\r\n      if (link && link.action) document.location = link.action;\r\n      if (href) redirectTo(href);\r\n    }\r\n  }\r\n}\r\nif (window.document.addEventListener) {\r\n   window.document.addEventListener(\"keydown\", navigatepages, false);\r\n} else {\r\n   window.document.attachEvent(\"onkeydown\", navigatepages);\r\n}\r\n\r\nNodeList.prototype.forEach = Array.prototype.forEach;\r\nNodeList.prototype.map = Array.prototype.map;\r\n\r\n// More efficient parent finder\r\nElement.prototype._findParent = function(selector) {\r\n  let node = this\r\n  while(node && !node.matches(selector)) {\r\n    node = node.parentNode\r\n    if (! node.matches) return null;\r\n  }\r\n  return node\r\n}\r\nElement.prototype._findNext = function(selector) {\r\n  let node = this.nextElementSibling\r\n  while(node && !node.matches(selector)) {\r\n    node = node.nextElementSibling\r\n    if (! node) return null\r\n  }\r\n  return node\r\n}\r\nElement.prototype._findPrevious = function(selector) {\r\n  let node = this.previousElementSibling\r\n  while(node && !node.matches(selector)) {\r\n    node = node.previousElementSibling\r\n    if (! node) return null\r\n  }\r\n  return node\r\n}\r\nNode.prototype._isChildOf = function(parent) {\r\n  let node = this.parentNode\r\n  while (node) {\r\n    if (node == parent) {\r\n      return true\r\n    }\r\n    node = node.parentNode\r\n  }\r\n  return false\r\n}\r\n\r\nvar replyMap = {\r\n  showReplies: function(root=document) {\r\n    root.querySelectorAll('.postnode').forEach(post => {\r\n      let postNum = post.dataset.id\r\n      , board = post.dataset.board\r\n      , thread = post._findParent('div[id^=thread]')\r\n      , threadID = thread && thread.dataset['threadid']\r\n      , msg = post.querySelector('.postmessage')\r\n      , repliesContainer = post.querySelector('.replieslist')\r\n      if (!this.posts[board])\r\n        this.posts[board] = {}\r\n      if (this.posts[board][postNum]) {\r\n        this.posts[board][postNum].container = repliesContainer\r\n      }\r\n      else {\r\n        this.posts[board][postNum] = {\r\n          container: repliesContainer,\r\n          replies: []\r\n        }\r\n      }\r\n      let links = msg.querySelectorAll(`a[class^=ref\\\\|]`)\r\n      if (links.length) links.forEach(link => {\r\n        let linkData = link.className.split(' ')[0].split('|')\r\n        , linkDestBoard = linkData[1]\r\n        , linkPostNum = linkData[3]\r\n        , href = `/${board}/res/${threadID}.html#${postNum}`\r\n        , htm = `<a class=\"ref-reply\" href=\"${href}\">&gt;&gt;${board == linkDestBoard ? '' : `/${board}/`}${postNum}</a>`\r\n        if (this.posts[linkDestBoard] && this.posts[linkDestBoard][linkPostNum]) {\r\n          if (! _.includes(this.posts[linkDestBoard][linkPostNum].replies, htm)) {\r\n            this.posts[linkDestBoard][linkPostNum].replies.push(htm)\r\n          }\r\n        }\r\n        else {\r\n          if (!this.posts[linkDestBoard])\r\n            this.posts[linkDestBoard] = {}\r\n          this.posts[linkDestBoard][linkPostNum] = {\r\n            replies: [htm]\r\n          }\r\n        }\r\n        this.posts[linkDestBoard][linkPostNum].skip = false\r\n      })\r\n    })\r\n    _.each(this.posts, board => _.each(board, post => {\r\n      if (!post.skip && post.replies.length && post.container) {\r\n        post.container.innerHTML = `${_l.replies}: ${post.replies.join(', ')}`\r\n        post.skip = true\r\n      }\r\n    }))\r\n  },\r\n  posts: {}\r\n}\r\n\r\nvar scrollAnchor = {\r\n  save: function(id, elements, parent=window, dimensions='v') {\r\n    if (!window.scrollY) {\r\n      this.saved[id] = {_top: true}\r\n      return\r\n    }\r\n    let mid = [window.innerWidth / 2, window.innerHeight / 2]\r\n    , elMap = []\r\n    , parentBCR = (parent != window)\r\n      ? parent.getBoundingClientRect()\r\n      : {\r\n        left: 0,\r\n        top: 0,\r\n        right: window.innerWidth,\r\n        bottom: window.innerHeight\r\n      }\r\n    if (\r\n      parent != window\r\n      &&\r\n      (\r\n        (parentBCR.left <= 0 && parentBCR.right <= 0)\r\n        ||\r\n        (parentBCR.top <= 0 && parentBCR.bottom <= 0)\r\n        ||\r\n        parentBCR.left >= window.innerWidth\r\n        ||\r\n        parentBCR.top >= window.innerHeight\r\n      )\r\n    ) {\r\n      mid = [parentBCR.left + parentBCR.width/2, parentBCR.top + parentBCR.height/2]\r\n    }\r\n    let elems = elements instanceof Node\r\n      ? [elements]\r\n      : elements instanceof NodeList\r\n        ? elements\r\n        : ((parent == window ? document : parent).querySelectorAll(elements))\r\n    if (! elems.length) return;\r\n    elems.forEach(function (el) {\r\n      let bcr = el.getBoundingClientRect()\r\n      , relativeVisibleWidth = Math.pos(bcr.width - (Math.pos(parentBCR.left - bcr.left) + Math.pos(bcr.right - parentBCR.right))) / bcr.width\r\n      , relativeVisibleHeight = Math.pos(bcr.height - (Math.pos(parentBCR.top - bcr.top) + Math.pos(bcr.bottom - parentBCR.bottom))) / bcr.height\r\n      , dx = Math.abs(mid[0] - (bcr.left + bcr.width/2))\r\n      , dy = Math.abs(mid[1] - (bcr.top + bcr.height/2))\r\n      elMap.push({\r\n        el: el,\r\n        primaryVisibility: dimensions[0] == 'h' ? relativeVisibleWidth : relativeVisibleHeight,\r\n        secondaryVisibility: dimensions[0] == 'v' ? relativeVisibleWidth : relativeVisibleHeight,\r\n        primaryOffset: dimensions[0] == 'h' ? dx : dy,\r\n        secondaryOffset: dimensions[0] == 'v' ? dx : dy\r\n      })\r\n    })\r\n    elMap.sort((a, b) => {\r\n      if (b.primaryVisibility !== a.primaryVisibility) {\r\n        return b.primaryVisibility - a.primaryVisibility\r\n      }\r\n      else if (dimensions.length > 1 && b.secondaryVisibility !== a.secondaryVisibility) {\r\n        return b.secondaryVisibility - a.secondaryVisibility\r\n      }\r\n      else if (a.primaryOffset !== b.primaryOffset) {\r\n        return a.primaryOffset - b.primaryOffset\r\n      }\r\n      else if (dimensions.length > 1) {\r\n        return a.secondaryOffset - b.secondaryOffset\r\n      }\r\n    })\r\n    let anchor = elMap[0].el\r\n    , bcrBefore = anchor.getBoundingClientRect()\r\n    this.saved[id] = {\r\n      anchor: anchor,\r\n      left: bcrBefore.left,\r\n      top: bcrBefore.top,\r\n      parent: parent,\r\n      dimensions: dimensions\r\n    }\r\n  },\r\n  restore: function(id) {\r\n    return new Promise((resolve, reject) => {\r\n      let loaded = this.saved[id]\r\n      if (loaded) window.requestAnimationFrame(() => {\r\n        if (loaded._top) {\r\n          window.scrollTo(0,0)\r\n          resolve()\r\n          return\r\n        }\r\n        let bcrAfter = loaded.anchor.getBoundingClientRect()\r\n        loaded.parent.scrollBy(\r\n          loaded.dimensions.indexOf('h') !== (-1) \r\n            ? bcrAfter.left - loaded.left \r\n            : 0, \r\n          loaded.dimensions.indexOf('v') !== (-1) \r\n            ? bcrAfter.top - loaded.top \r\n            : 0\r\n        )\r\n        resolve()\r\n      })\r\n      else reject()\r\n    })\r\n  },\r\n  saved: {}\r\n}\r\nMath.pos = x => x >= 0 ? x : 0;\r\n\r\n// requestAnimationFrame polyfill https://gist.github.com/paulirish/1579671\r\n(function() {\r\n  var lastTime = 0;\r\n  var vendors = ['ms', 'moz', 'webkit', 'o'];\r\n  for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\r\n    window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];\r\n    window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame'] || window[vendors[x]+'CancelRequestAnimationFrame'];\r\n  }\r\n\r\n  if (!window.requestAnimationFrame)\r\n    window.requestAnimationFrame = function(callback, element) {\r\n      var currTime = new Date().getTime();\r\n      var timeToCall = Math.max(0, 16 - (currTime - lastTime));\r\n      var id = window.setTimeout(function() { callback(currTime + timeToCall); }, timeToCall);\r\n      lastTime = currTime + timeToCall;\r\n      return id;\r\n    };\r\n\r\n  if (!window.cancelAnimationFrame)\r\n    window.cancelAnimationFrame = function(id) {\r\n      clearTimeout(id);\r\n    };\r\n}());\r\n\r\n/// overlay menu\r\nvar menu_current = '';\r\nvar menu_last = '';\r\nfunction menu_show(id)\r\n{\r\n  if(menu_current != '')\r\n  {\r\n    var dl = (id == '_off_') ? 125 : 0;\r\n    $('#'+menu_current).delay(dl).slideUp(100);\r\n    menu_last = menu_current;\r\n  }\r\n  if (id != '') {\r\n    if (menu_last == id && typeof $('#' + id).queue() !== 'undefined' && $('#' + id).queue().length > 0) {\r\n      $('#' + id).clearQueue();\r\n    } else {\r\n      $('#' + id).slideDown(150);\r\n    }\r\n  }\r\n  menu_current = id;\r\n}\r\nfunction menu_pin() {\r\n  if(document.getElementById('overlay_menu').style.position == 'absolute') {\r\n    document.getElementById('overlay_menu').style.position = 'fixed';\r\n    Cookie('ku_menutype', 'fixed', 365);\r\n  } else {\r\n    document.getElementById('overlay_menu').style.position = 'absolute';\r\n    Cookie('ku_menutype', 'absolute', 365);\r\n  }\r\n}\r\n\r\nfunction toggle_oldmenu(on=null) {\r\n  if (on===null)\r\n    on = getCookie('ku_oldmenu') != 'yes'\r\n  injector.inject('oldmenu', `#${on ? 'overlay_menu' : 'head_oldmenu'} { display: none }`)\r\n  if (on && !document.getElementById('head_oldmenu')) {\r\n    document.getElementById('boardlist_header').insertAdjacentHTML('afterBegin', `<div id=\"head_oldmenu\" class=\"boardlist\">\r\n      ${document.getElementById('ns_oldmenu').innerText}\r\n      <a href=\\\"#\\\" onclick=\\\"javascript:toggle_oldmenu();\\\" class=\"bl-sect\" style=\"order:1\">[overlay]</a>\r\n    </div>`)\r\n  }\r\n  Cookie('ku_oldmenu', on ? 'yes' : 'no', 90); \r\n}\r\n\r\nvar LatexIT = {\r\n  mode : 'gif',\r\n  init : function() {\r\n  if(document.implementation.hasFeature(\"http://www.w3.org/TR/SVG11/feature#BasicStructure\", \"1.1\"))\r\n    this.mode='svg';\r\n  },\r\n  odc: \"javascript:LatexIT.replaceWithSrc(this);\",\r\n  dcls: \"Double click to show source\",\r\n\r\n  pre : function(eqn) {\r\n    var txt=eqn.innerHTML;\r\n    if ( !txt.match(/<img.*?>/i) && !txt.match(/<object.*?>/i))\r\n    {\r\n      //Clean code\r\n      txt=txt.replace(/<br>/gi,\"\").replace(/<br \\/>/gi,\"\").replace(/&amp;/mg,'&');\r\n      var atxt = \"[tex]\"+txt+\"[/tex]\";\r\n      txt=escape(txt.replace(/\\\\/mg,'\\\\'));\r\n      // Add coloring according to style of text\r\n      var c = eval(\"LatexIT.normalize\"+$(eqn).parent().css('color'));\r\n      var extxt = \"{\\\\color[rgb]{\"+c.r+','+c.g+','+c.b+\"}\"+txt+\"}\";\r\n      txt = \" <img src=\\\"http://latex.codecogs.com/\"+this.mode+\".latex?\"+ extxt +\"\\\" title=\\\"\"+this.dcls+\"\\\" alt=\\\"\"+atxt+\"\\\" ondblclick=\\\"\"+this.odc+\"\\\" border=\\\"0\\\" class=\\\"latex\\\" /> \";\r\n    }\r\n    return txt;\r\n  },\r\n\r\n  replaceWithSrc: function(eqn) {\r\n    var txt = $(eqn).attr('alt');\r\n    $(eqn).parent().html(txt);\r\n  },\r\n\r\n  render : function($scope) {\r\n    var scope = (typeof $scope === 'undefined') ? window.document : $scope[0];\r\n    var eqn = scope.getElementsByTagName(\"*\");\r\n    for (var i=0; i<eqn.length; i++) {\r\n      if(eqn[i].getAttribute(\"lang\") == \"latex\" || eqn[i].getAttribute(\"xml:lang\") == \"latex\")\r\n      eqn[i].innerHTML = this.pre(eqn[i]);\r\n    }\r\n  },\r\n\r\n  normalizergb : function(r, g, b) {\r\n    return {r: (r/255).toFixed(3), g: (g/255).toFixed(2), b: (b/255).toFixed(2) }\r\n  },\r\n  normalizergba : function(r, g, b, a) {\r\n    return this.normalizergb(r, g, b);\r\n  }\r\n};\r\n\r\nfunction in_array(needle, haystack) {\r\n  return (typeof haystack !== 'object') ? (needle === haystack) : _.includes(haystack, needle)\r\n}\r\n\r\n(function($) {\r\n  $.fn.drags = function(opt) {\r\n    opt = $.extend({handle:\"\",cursor:\"move\"}, opt);\r\n\r\n    if(opt.handle === \"\") {\r\n      var $el = this;\r\n    } else {\r\n      var $el = this.find(opt.handle);\r\n    }\r\n\r\n    return $el.css('cursor', opt.cursor).on(\"mousedown\", function(e) {\r\n      if(opt.handle === \"\") {\r\n        var $drag = $(this).addClass('draggable');\r\n      } else {\r\n        var $drag = $(this).addClass('active-handle').parent().addClass('draggable');\r\n      }\r\n      var z_idx = $drag.css('z-index'),\r\n        drg_h = $drag.outerHeight(),\r\n        drg_w = $drag.outerWidth(),\r\n        pos_y = $drag.offset().top + drg_h - e.pageY,\r\n        pos_x = $drag.offset().left + drg_w - e.pageX;\r\n      $drag.css('z-index', 1000).parents().on(\"mousemove\", function(e) {\r\n        if (opt.onMove)\r\n          opt.onMove()\r\n        $('.draggable').offset({\r\n          top:e.pageY + pos_y - drg_h,\r\n          left:e.pageX + pos_x - drg_w\r\n        }).on(\"mouseup\", function() {\r\n          $(this).removeClass('draggable').css('z-index', z_idx);\r\n        });\r\n      });\r\n      e.preventDefault(); // disable selection\r\n    }).on(\"mouseup\", function() {\r\n      if(opt.handle === \"\") {\r\n        $(this).removeClass('draggable');\r\n      } else {\r\n        $(this).removeClass('active-handle').parent().removeClass('draggable');\r\n      }\r\n    });\r\n  }\r\n  $.fn.dragsOff = function(opt) {\r\n    opt = $.extend({handle:\"\",cursor:\"default\"}, opt);\r\n\r\n    if(opt.handle === \"\") {\r\n     var $el = this;\r\n     $(this).removeClass('draggable');\r\n    } else {\r\n     var $el = this.find(opt.handle);\r\n     $(this).removeClass('active-handle')\r\n        .parent()\r\n        .removeClass('draggable');\r\n    }\r\n    return $el.css('cursor', \"default\")\r\n      .off(\"mousedown\")\r\n      .off(\"mouseup\")\r\n      .off(\"mousemove\");\r\n  }\r\n  /*$.fn.pin = function() {\r\n    if(this.css('position') !== 'fixed') {\r\n      var abs = {\r\n        top: this.position().top - $(document).scrollTop(),\r\n        left: this.position().left - $(document).scrollLeft()\r\n      }\r\n      this.css({\r\n        position: 'fixed',\r\n        left: abs.left,\r\n        top: abs.top\r\n      });\r\n      this.find('.pinner').removeClass('pinned').addClass('unpinned');\r\n      localStorage['pinForm'] = 0;\r\n    }\r\n    else {\r\n      var abs = {\r\n        top: this.position().top + $(document).scrollTop(),\r\n        left: this.position().left + $(document).scrollLeft()\r\n      }\r\n      this.css({\r\n        position: 'absolute',\r\n        left: abs.left,\r\n        top: abs.top\r\n      });\r\n      this.find('.pinner').removeClass('unpinned').addClass('pinned');\r\n      localStorage['pinForm'] = 1;\r\n    }\r\n  }*/\r\n})(jQuery);\r\n\r\nfunction unwrapEmbed($fig) {\r\n  $fig.addClass('unwrapped')\r\n  let $iw = $fig.find('.emb-iframe-wrapper')\r\n  if ($iw.data('h') > $iw.data('w'))\r\n    $iw.addClass('vertical-video')\r\n  if ($iw.data('site') == \"Soundcloud\")\r\n    $iw.addClass('soundcloud-embed')\r\n  $iw.css({\r\n    paddingBottom: `${($iw.data('h')/$iw.data('w'))*100}%`\r\n  })\r\n  let code = $iw.data('code')\r\n  , iframeOptions = `frameborder=\"0\" scrolling=\"no\" webkitallowfullscreen=\"\" mozallowfullscreen=\"\" allowfullscreen=\"\"`\r\n  if ($iw.data('site') == \"Youtube\") {\r\n    let start = $iw.data('startraw')\r\n    $iw.append(`<iframe src=\"https://www.youtube-nocookie.com/embed/${code}?autoplay=1${start ? `&start=${start}` : ''}\" ${iframeOptions}></iframe>`)\r\n  }\r\n  if ($iw.data('site') == \"Vimeo\") {\r\n    let start = $iw.data('start')\r\n    $iw.append(`<iframe src=\"//player.vimeo.com/video/${code}?badge=0&autoplay=1${start ? `#t=${start}` : ''}\" ${iframeOptions}></iframe>`)\r\n  }\r\n  if ($iw.data('site') == \"Soundcloud\") {\r\n    let enccode = encodeURI(code)\r\n    let start = $iw.data('start')\r\n    $iw.append(`<iframe src=\"https://w.soundcloud.com/player/?url=https%3A%2F%2Fapi.soundcloud.com%2Ftracks%2F${enccode}\" ${iframeOptions}></iframe>`)\r\n  }\r\n  if ($iw.data('site') == \"Coub\")\r\n    $iw.append(`<iframe src=\"http://coub.com/embed/${code}?muted=false&autostart=true&originalSize=false&hideTopBar=false&noSiteButtons=false&startWithHD=false\" ${iframeOptions}></iframe>`)\r\n  let $ew = $fig.find('.embed-wrap')\r\n  if (! $ew.find('.collapse-video').length)\r\n    $fig.find('.embed-wrap').append(`\r\n      <button title=\"${_l.collapse}\" class=\"emb-button collapse-video\">\r\n        ${makeIcon('shrink')}\r\n      </button>`)\r\n}\r\n\r\nfunction wrapEmbed($fig) {\r\n  $fig.removeClass('unwrapped')\r\n  $fig.find('.emb-iframe-wrapper').empty()\r\n}\r\n\r\nfunction resetForm(form, isClone=false) {\r\n  let fields = form.querySelectorAll('input[type=text]:not([name=name]), input[type=file], textarea')\r\n  fields.forEach(field => field.value = null)\r\n  form.querySelectorAll('.site-indicator').forEach(i => i.remove())\r\n  richFileInput.clear(form, !isClone)\r\n  // Remove extra inputs\r\n  form.querySelectorAll('input[name^=addembed], input[name^=addfile], input[name=ttl-enable]').forEach(i => {\r\n    i.checked = false\r\n    if (i.name == 'ttl-enable' && i.onchange)\r\n      i.onchange()\r\n  })\r\n}\r\n\r\nfunction initForm(form) {\r\n  if (!form)\r\n    return\r\n  let $form = $(form)\r\n  form.querySelectorAll('input[name^=embed]').forEach(i => {\r\n    i.addEventListener('input', function() {\r\n      let indicator = this.parentElement.querySelector('.site-indicator')\r\n      if (indicator) \r\n        indicator.remove()\r\n      let match = embedLinks.process(this.value)\r\n      if(match)\r\n        this.insertAdjacentHTML('afterend', `<img src=\"${ku_boardspath}/images/site-logos/${match.site}.png\" class=\"site-indicator\">`)\r\n    })\r\n  })\r\n  form.querySelectorAll('input[name^=imagefile]').forEach(i => {\r\n    i.addEventListener('change', function() {\r\n      if (this.value) {\r\n        let nextCheckbox = this.parentElement.nextElementSibling\r\n        if (nextCheckbox)\r\n          nextCheckbox.checked = true\r\n      }\r\n    })\r\n  })\r\n  // Markup\r\n  form.querySelectorAll('.opt-exp').forEach(exp => {\r\n    exp.onclick = function(ev) {\r\n      ev.preventDefault()\r\n      this.querySelector('.expandee').classList.toggle('expanded')\r\n    }\r\n    exp.onmouseleave = function(ev) {\r\n      this.hideTimeout = setTimeout(() => this.querySelector('.expandee').classList.remove('expanded'), 250)\r\n    }\r\n    exp.onmouseenter = function() {\r\n      clearTimeout(this.hideTimeout)\r\n    }\r\n  })\r\n  let cms = form.querySelector('.code_markup_select')\r\n  if (cms) {\r\n    cms.onchange = function() {\r\n      markup($form, `[code=${this.value}]`, '[/code]')\r\n    }\r\n  }\r\n  form.querySelector('.quote_select').onchange = function() {\r\n    quotes($form, this.value)\r\n  }\r\n  // for TeX\r\n  let areaID = form.id + '_textarea'\r\n  form.querySelector('textarea').id = areaID\r\n  form.querySelector('.uib-tx').dataset.target = areaID\r\n  // captcha\r\n  if (Captcha.enabled && Captcha.enabled!=='only-access')\r\n    Captcha.initForm(form)\r\n  // readonly stuff\r\n  form.querySelectorAll('.make-me-readonly').forEach(ro => {\r\n    ro.readOnly = true\r\n    ro.addEventListener('focus', () => ro.readOnly = false)\r\n  })\r\n  // Name disabling\r\n  let name = form.querySelector('input[name=disable_name]')\r\n  if (name) {\r\n    name.onchange = function() {\r\n      let off = this.checked\r\n      form.querySelector('input[name=name]').disabled = off\r\n      localStorage.setItem('post_anonymously', +off)\r\n    }\r\n    name.checked = !!+localStorage['post_anonymously']\r\n    name.onchange()\r\n  }\r\n  // Submitting\r\n  form.addEventListener('submit', function(ev) {\r\n    ev.preventDefault()\r\n    ev.stopPropagation()\r\n    Ajax.submitPost(this)\r\n  })\r\n  form.querySelectorAll('.simplified-send-row button[type=\"submit\"]').forEach(sub => {\r\n    sub.onclick = function(ev) {\r\n      ev.preventDefault()\r\n      ev.stopPropagation()\r\n      let sage = +(this.name == 'sagebtn')\r\n      Ajax.submitPost(form, sage)\r\n    }\r\n  })\r\n  // TTL\r\n  let ttl = form.querySelector('input[name=\"ttl-enable\"]')\r\n  if (ttl) {\r\n    ttl.onchange = function() {\r\n      let on = this.checked\r\n      , input = form.ttl\r\n      input.disabled = !on\r\n      input.min = on ? 1 : 0\r\n      if (on && input.value == 0) {\r\n        input.value = 1\r\n      }\r\n    }\r\n    ttl.onchange()\r\n  }\r\n  // Detecting last active textarea\r\n  form.querySelectorAll('textarea, input[type=text]').forEach(el => {\r\n    el.onfocus = () => {\r\n      lastActiveForm = form\r\n    }\r\n  })\r\n  // Add file button\r\n  let fileButton = form.querySelector('.s-file')\r\n  if (fileButton) {\r\n    fileButton.onclick = ev => {\r\n      ev.preventDefault()\r\n      form.querySelector('input[type=file]').click()\r\n    }\r\n  }\r\n}\r\n\r\nvar injector = {\r\n  inject: function(alias, css) {\r\n    var id = `injector:${alias}`\r\n    var existing = document.getElementById(id)\r\n    if (existing) {\r\n      existing.innerHTML = css\r\n      return\r\n    }\r\n    var head = document.head || document.getElementsByTagName('head')[0]\r\n    , style = document.createElement('style')\r\n    style.type = 'text/css'\r\n    style.id = id\r\n    if (style.styleSheet) {\r\n      style.styleSheet.cssText = css\r\n    } else {\r\n      style.appendChild(document.createTextNode(css))\r\n    }\r\n    head.appendChild(style)\r\n  },\r\n  remove: function(alias) {\r\n    var id = `injector:${alias}`\r\n    var style = document.getElementById(id)\r\n    if (style) {\r\n      var head = document.head || document.getElementsByTagName('head')[0]\r\n      if (head)\r\n        head.removeChild(document.getElementById(id))\r\n    }\r\n  }\r\n}\r\n\r\nfunction randomString(length=10, chars='0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ') {\r\n  let result = ''\r\n  for (let i = length; i > 0; --i) \r\n    result += chars[Math.round(Math.random() * (chars.length - 1))]\r\n  return result\r\n}\r\n\r\nfunction add_mob_menu() {\r\n  let r = 20\r\n  , pos = 10\r\n  , delay = 300\r\n  $('#overlay_menu').hide()\r\n  document.body.insertAdjacentHTML('afterbegin', `<div id=\"mobile-menu\"><div id=\"mobile-menu-contents\"></div></div>`)\r\n  let mm = document.querySelector('#mobile-menu-contents')\r\n  , $mmw = $('#mobile-menu')\r\n  , htm = ''\r\n  if (overboard_dir) {\r\n    htm += `<a href=\"/${overboard_dir}\" class=\"mm-item mm-brd\">${overboard_desc}</a>`\r\n  }\r\n  $('<div id=\"mmb-_options\" style=\"display: none\"></div>').append($('#ms-_options')).appendTo($(mm))\r\n  $mmw.append(`<div id=\"mm-toggle\">\r\n    <div class=\"mm-bars\"></div>\r\n    <div id=\"mm-circle\"></div>\r\n  </div>`)\r\n  let cats = boards10.list\r\n  cloud20.getBoards().then(b20 => {\r\n    cats.sort((a,b) => +a.order > +b.order)\r\n    .push({\r\n      id: '20',\r\n      name: '2.0',\r\n      boards: b20\r\n    })\r\n    cats.forEach((cat, ix) => {\r\n      if (cat.boards) {\r\n        htm += `<a href=\"#\" class=\"mm-item mm-cat\" data-mmbx=\"${ix}\">${cat.name}</a>\r\n          <span class=\"mm-boards\" id=\"mmb-${ix}\">`\r\n        cat.boards.forEach(b => {\r\n          b.dir = b.dir || b.name\r\n          htm += `<a class=\"mm-item mm-brd\" href=\"/${b.dir}\">/${b.dir}/ — ${b.desc}</a>`\r\n        })\r\n        htm += '</span>'\r\n      }\r\n    })\r\n    htm += `<a href=\"#\" class=\"mm-item mm-toggle-options\" onclick=\"\r\n      $('.mm-boards').toggle(false); \r\n      $('#mmb-_options').slideToggle('fast');\r\n      $('.mmc-expanded').removeClass('mmc-expanded')\r\n      return false\r\n    \">Options</a>`\r\n    mm.insertAdjacentHTML('afterBegin', `${htm}`)\r\n    $('#mm-toggle').click(function() {\r\n      if ($mmw.hasClass('mm-expanded')) return;\r\n      $mmw.addClass('mm-expanded')\r\n      let bcr = $mmw[0].getBoundingClientRect()\r\n      , x = bcr.width - r - pos  // - radius/2, -position\r\n      , y = bcr.height - r - pos // - radius/2, -position\r\n      , R = Math.sqrt(x*x + y*y) // See, math is not useless after all\r\n      , scale = Math.ceil(R / r)\r\n      $('#mm-circle').css({'transform': `scale(${scale})`})\r\n      $(mm).css({\r\n        'visibility': 'visible',\r\n        'opacity': 1\r\n      })\r\n      $mmw.addClass('bars-away')\r\n      setTimeout(() => {\r\n        $mmw.addClass('mm-expanded-full')\r\n      }, delay)\r\n    })\r\n\r\n    offClick.push(() => {\r\n      if (! $mmw.hasClass('mm-expanded-full')) return;\r\n      $mmw.removeClass('mm-expanded-full bars-away')\r\n      setTimeout(() => {\r\n        $(mm).css({'visibility': 'hidden'})\r\n        $mmw.removeClass('mm-expanded')\r\n      }, delay)\r\n      $(mm).css({\r\n        'visibility': 'visible',\r\n        'opacity': 0\r\n      })\r\n      $('#mm-circle').css({'transform': `scale(1)`})\r\n    })\r\n  })\r\n  $mmw.click(function(ev) {\r\n    ev.stopPropagation()\r\n  })\r\n  .on('click', '.mm-cat[data-mmbx]', function() {\r\n    let $target = $(`#mmb-${$(this).data('mmbx')}`)\r\n    if ($target.is(':visible')) {\r\n      $target.toggle(false)\r\n      $(this).removeClass('mmc-expanded')\r\n    }\r\n    else {\r\n      $('.mm-boards').toggle(false)\r\n      $('#mmb-_options').slideUp('fast');\r\n      $target.toggle(true)\r\n      $('.mmc-expanded').removeClass('mmc-expanded')\r\n      $(this).addClass('mmc-expanded')\r\n    }\r\n    return false\r\n  })\r\n}\r\n\r\nvar boards10 = {\r\n  get list() {\r\n    if (!this.allboards) {\r\n      this.allboards = []\r\n      document.querySelectorAll('.olm-link').forEach(o => {\r\n        o = o.querySelector('a')\r\n        if (!o) return;\r\n        let s = o.dataset.toexpand\r\n        , sd = o.innerText\r\n        , sect = document.querySelector(`#ms-${s}`)\r\n        if (!s || s=='20' || s=='_options') return;\r\n        let section = {\r\n          id: s,\r\n          name: sd,\r\n          boards: []\r\n        }\r\n        sect.querySelectorAll('a').forEach(a => {\r\n          let m = a.innerText.match(/\\/(.+?)\\/ - (.+)/)\r\n          if (m) \r\n            section.boards.push({\r\n              dir: m[1],\r\n              desc: m[2]\r\n            })\r\n        })\r\n        this.allboards.push(section)\r\n      })\r\n    }\r\n    return this.allboards\r\n  }\r\n}\r\n\r\nvar cloud20 = {\r\n  init: function() {\r\n    this.getBoards().then(() => this.filter('')).catch(_.noop)\r\n    $('#boardselect').on('input', function() {\r\n      cloud20.filter($(this).val());\r\n    });\r\n  },\r\n  getBoards: function() {\r\n    return new Promise((rs, rj) => {\r\n      if (this.allboards)\r\n        rs(this.allboards)\r\n      else {\r\n        $.getJSON(ku_cgipath + '/boards20.json', data => {\r\n          this.allboards = data\r\n          rs(data)\r\n        })\r\n        .fail(e => {\r\n          pups.err(_l.unable_load_20)\r\n          rj(e)\r\n        })\r\n      }\r\n    })\r\n  },\r\n  filter: function(query) {\r\n    var res = [];\r\n    if(typeof this.allboards === \"undefined\") return;\r\n    if(query == '') res = this.allboards;\r\n    else {\r\n      query = query.toLowerCase();\r\n      _.each(this.allboards, function(board) {\r\n        if(board.name.toLowerCase().search(query) !== -1 || board.desc.toLowerCase().search(query) !== -1)\r\n          res.push(board);\r\n      });\r\n    }\r\n    this.display(res);\r\n  },\r\n  display: function(list) {\r\n    var newhtml = '', opts = '';\r\n    _.each(list, function(item) {\r\n      newhtml += '<a class=\"menu-item\" title=\"'+ item.desc +'\" href=\"'+ku_boardsfolder+item.name+'/\">/'+item.name+'/ - '+ item.desc +'</a>';\r\n      opts += '<option value=\"'+item.name+'\">/'+item.name+'/ - '+ item.desc +'</option>';\r\n    });\r\n    $('#boards20').html(newhtml);\r\n    $('.boardsel20').append(opts);\r\n  }\r\n}\r\n\r\nvar countries = {\r\n  'A1': \"Anonymous Proxy\",\r\n  'A2': \"Satellite Provider\",\r\n  'O1': \"Other Country\",\r\n  'AD': \"Andorra\",\r\n  'AE': \"United Arab Emirates\",\r\n  'AF': \"Afghanistan\",\r\n  'AG': \"Antigua and Barbuda\",\r\n  'AI': \"Anguilla\",\r\n  'AL': \"Albania\",\r\n  'AM': \"Armenia\",\r\n  'AO': \"Angola\",\r\n  'AP': \"Asia/Pacific Region\",\r\n  'AQ': \"Antarctica\",\r\n  'AR': \"Argentina\",\r\n  'AS': \"American Samoa\",\r\n  'AT': \"Austria\",\r\n  'AU': \"Australia\",\r\n  'AW': \"Aruba\",\r\n  'AX': \"Aland Islands\",\r\n  'AZ': \"Azerbaijan\",\r\n  'BA': \"Bosnia and Herzegovina\",\r\n  'BB': \"Barbados\",\r\n  'BD': \"Bangladesh\",\r\n  'BE': \"Belgium\",\r\n  'BF': \"Burkina Faso\",\r\n  'BG': \"Bulgaria\",\r\n  'BH': \"Bahrain\",\r\n  'BI': \"Burundi\",\r\n  'BJ': \"Benin\",\r\n  'BL': \"Saint Bartelemey\",\r\n  'BM': \"Bermuda\",\r\n  'BN': \"Brunei Darussalam\",\r\n  'BO': \"Bolivia\",\r\n  'BQ': \"Bonaire, Saint Eustatius and Saba\",\r\n  'BR': \"Brazil\",\r\n  'BS': \"Bahamas\",\r\n  'BT': \"Bhutan\",\r\n  'BV': \"Bouvet Island\",\r\n  'BW': \"Botswana\",\r\n  'BY': \"Belarus\",\r\n  'BZ': \"Belize\",\r\n  'CA': \"Canada\",\r\n  'CC': \"Cocos (Keeling) Islands\",\r\n  'CD': \"Congo, The Democratic Republic of the\",\r\n  'CF': \"Central African Republic\",\r\n  'CG': \"Congo\",\r\n  'CH': \"Switzerland\",\r\n  'CI': \"Cote d'Ivoire\",\r\n  'CK': \"Cook Islands\",\r\n  'CL': \"Chile\",\r\n  'CM': \"Cameroon\",\r\n  'CN': \"China\",\r\n  'CO': \"Colombia\",\r\n  'CR': \"Costa Rica\",\r\n  'CU': \"Cuba\",\r\n  'CV': \"Cape Verde\",\r\n  'CW': \"Curacao\",\r\n  'CX': \"Christmas Island\",\r\n  'CY': \"Cyprus\",\r\n  'CZ': \"Czech Republic\",\r\n  'DE': \"Germany\",\r\n  'DJ': \"Djibouti\",\r\n  'DK': \"Denmark\",\r\n  'DM': \"Dominica\",\r\n  'DO': \"Dominican Republic\",\r\n  'DZ': \"Algeria\",\r\n  'EC': \"Ecuador\",\r\n  'EE': \"Estonia\",\r\n  'EG': \"Egypt\",\r\n  'EH': \"Western Sahara\",\r\n  'ER': \"Eritrea\",\r\n  'ES': \"Spain\",\r\n  'ET': \"Ethiopia\",\r\n  'EU': \"Europe\",\r\n  'FI': \"Finland\",\r\n  'FJ': \"Fiji\",\r\n  'FK': \"Falkland Islands (Malvinas)\",\r\n  'FM': \"Micronesia, Federated States of\",\r\n  'FO': \"Faroe Islands\",\r\n  'FR': \"France\",\r\n  'GA': \"Gabon\",\r\n  'GB': \"United Kingdom\",\r\n  'GD': \"Grenada\",\r\n  'GE': \"Georgia\",\r\n  'GF': \"French Guiana\",\r\n  'GG': \"Guernsey\",\r\n  'GH': \"Ghana\",\r\n  'GI': \"Gibraltar\",\r\n  'GL': \"Greenland\",\r\n  'GM': \"Gambia\",\r\n  'GN': \"Guinea\",\r\n  'GP': \"Guadeloupe\",\r\n  'GQ': \"Equatorial Guinea\",\r\n  'GR': \"Greece\",\r\n  'GS': \"South Georgia and the South Sandwich Islands\",\r\n  'GT': \"Guatemala\",\r\n  'GU': \"Guam\",\r\n  'GW': \"Guinea-Bissau\",\r\n  'GY': \"Guyana\",\r\n  'HK': \"Hong Kong\",\r\n  'HM': \"Heard Island and McDonald Islands\",\r\n  'HN': \"Honduras\",\r\n  'HR': \"Croatia\",\r\n  'HT': \"Haiti\",\r\n  'HU': \"Hungary\",\r\n  'ID': \"Indonesia\",\r\n  'IE': \"Ireland\",\r\n  'IL': \"Israel\",\r\n  'IM': \"Isle of Man\",\r\n  'IN': \"India\",\r\n  'IO': \"British Indian Ocean Territory\",\r\n  'IQ': \"Iraq\",\r\n  'IR': \"Iran, Islamic Republic of\",\r\n  'IS': \"Iceland\",\r\n  'IT': \"Italy\",\r\n  'JE': \"Jersey\",\r\n  'JM': \"Jamaica\",\r\n  'JO': \"Jordan\",\r\n  'JP': \"Japan\",\r\n  'KE': \"Kenya\",\r\n  'KG': \"Kyrgyzstan\",\r\n  'KH': \"Cambodia\",\r\n  'KI': \"Kiribati\",\r\n  'KM': \"Comoros\",\r\n  'KN': \"Saint Kitts and Nevis\",\r\n  'KP': \"Korea, Democratic People's Republic of\",\r\n  'KR': \"Korea, Republic of\",\r\n  'KW': \"Kuwait\",\r\n  'KY': \"Cayman Islands\",\r\n  'KZ': \"Kazakhstan\",\r\n  'LA': \"Lao People's Democratic Republic\",\r\n  'LB': \"Lebanon\",\r\n  'LC': \"Saint Lucia\",\r\n  'LI': \"Liechtenstein\",\r\n  'LK': \"Sri Lanka\",\r\n  'LR': \"Liberia\",\r\n  'LS': \"Lesotho\",\r\n  'LT': \"Lithuania\",\r\n  'LU': \"Luxembourg\",\r\n  'LV': \"Latvia\",\r\n  'LY': \"Libyan Arab Jamahiriya\",\r\n  'MA': \"Morocco\",\r\n  'MC': \"Monaco\",\r\n  'MD': \"Moldova, Republic of\",\r\n  'ME': \"Montenegro\",\r\n  'MF': \"Saint Martin\",\r\n  'MG': \"Madagascar\",\r\n  'MH': \"Marshall Islands\",\r\n  'MK': \"Macedonia\",\r\n  'ML': \"Mali\",\r\n  'MM': \"Myanmar\",\r\n  'MN': \"Mongolia\",\r\n  'MO': \"Macao\",\r\n  'MP': \"Northern Mariana Islands\",\r\n  'MQ': \"Martinique\",\r\n  'MR': \"Mauritania\",\r\n  'MS': \"Montserrat\",\r\n  'MT': \"Malta\",\r\n  'MU': \"Mauritius\",\r\n  'MV': \"Maldives\",\r\n  'MW': \"Malawi\",\r\n  'MX': \"Mexico\",\r\n  'MY': \"Malaysia\",\r\n  'MZ': \"Mozambique\",\r\n  'NA': \"Namibia\",\r\n  'NC': \"New Caledonia\",\r\n  'NE': \"Niger\",\r\n  'NF': \"Norfolk Island\",\r\n  'NG': \"Nigeria\",\r\n  'NI': \"Nicaragua\",\r\n  'NL': \"Netherlands\",\r\n  'NO': \"Norway\",\r\n  'NP': \"Nepal\",\r\n  'NR': \"Nauru\",\r\n  'NU': \"Niue\",\r\n  'NZ': \"New Zealand\",\r\n  'OM': \"Oman\",\r\n  'PA': \"Panama\",\r\n  'PE': \"Peru\",\r\n  'PF': \"French Polynesia\",\r\n  'PG': \"Papua New Guinea\",\r\n  'PH': \"Philippines\",\r\n  'PK': \"Pakistan\",\r\n  'PL': \"Poland\",\r\n  'PM': \"Saint Pierre and Miquelon\",\r\n  'PN': \"Pitcairn\",\r\n  'PR': \"Puerto Rico\",\r\n  'PS': \"Palestinian Territory\",\r\n  'PT': \"Portugal\",\r\n  'PW': \"Palau\",\r\n  'PY': \"Paraguay\",\r\n  'QA': \"Qatar\",\r\n  'RE': \"Reunion\",\r\n  'RO': \"Romania\",\r\n  'RS': \"Serbia\",\r\n  'RU': \"Russian Federation\",\r\n  'RW': \"Rwanda\",\r\n  'SA': \"Saudi Arabia\",\r\n  'SB': \"Solomon Islands\",\r\n  'SC': \"Seychelles\",\r\n  'SD': \"Sudan\",\r\n  'SE': \"Sweden\",\r\n  'SG': \"Singapore\",\r\n  'SH': \"Saint Helena\",\r\n  'SI': \"Slovenia\",\r\n  'SJ': \"Svalbard and Jan Mayen\",\r\n  'SK': \"Slovakia\",\r\n  'SL': \"Sierra Leone\",\r\n  'SM': \"San Marino\",\r\n  'SN': \"Senegal\",\r\n  'SO': \"Somalia\",\r\n  'SR': \"Suriname\",\r\n  'SS': \"South Sudan\",\r\n  'ST': \"Sao Tome and Principe\",\r\n  'SV': \"El Salvador\",\r\n  'SX': \"Sint Maarten\",\r\n  'SY': \"Syrian Arab Republic\",\r\n  'SZ': \"Swaziland\",\r\n  'TC': \"Turks and Caicos Islands\",\r\n  'TD': \"Chad\",\r\n  'TF': \"French Southern Territories\",\r\n  'TG': \"Togo\",\r\n  'TH': \"Thailand\",\r\n  'TJ': \"Tajikistan\",\r\n  'TK': \"Tokelau\",\r\n  'TL': \"Timor-Leste\",\r\n  'TM': \"Turkmenistan\",\r\n  'TN': \"Tunisia\",\r\n  'TO': \"Tonga\",\r\n  'TR': \"Turkey\",\r\n  'TT': \"Trinidad and Tobago\",\r\n  'TV': \"Tuvalu\",\r\n  'TW': \"Taiwan\",\r\n  'TZ': \"Tanzania, United Republic of\",\r\n  'UA': \"Ukraine\",\r\n  'UG': \"Uganda\",\r\n  'UM': \"United States Minor Outlying Islands\",\r\n  'US': \"United States\",\r\n  'UY': \"Uruguay\",\r\n  'UZ': \"Uzbekistan\",\r\n  'VA': \"Holy See (Vatican City State)\",\r\n  'VC': \"Saint Vincent and the Grenadines\",\r\n  'VE': \"Venezuela\",\r\n  'VG': \"Virgin Islands, British\",\r\n  'VI': \"Virgin Islands, U.S.\",\r\n  'VN': \"Vietnam\",\r\n  'VU': \"Vanuatu\",\r\n  'WF': \"Wallis and Futuna\",\r\n  'WS': \"Samoa\",\r\n  'YE': \"Yemen\",\r\n  'YT': \"Mayotte\",\r\n  'ZA': \"South Africa\",\r\n  'ZM': \"Zambia\",\r\n  'ZW': \"Zimbabwe\",\r\n  'XX': \"OMCK\",\r\n  'T1': \"Tor\"\r\n}\r\n\r\nvar bnrs = {\r\n  initiated: false,\r\n  init: function() {\r\n    $.getJSON(ku_boardspath+'/bnrs.json', function(data) {\r\n      var reduced = [];\r\n      if(data.length > 1) {\r\n        _.each(data, function(bnr) {\r\n          if(bnr.link !== this_board_dir) reduced.push(bnr);\r\n        });\r\n      }\r\n      else reduced = data;\r\n      bnrs.data = reduced;\r\n      bnrs.initiated = true;\r\n      bnrs.display();\r\n    });\r\n  },\r\n  display: function() {\r\n    if(!this.initiated) return;\r\n    if(!this.data.length) return;\r\n    var reduced = [];\r\n    if(typeof this.current !== 'undefined') {\r\n      _.each(this.data, function(item) {\r\n        if(item.path !== bnrs.current) reduced.push(item)\r\n      });\r\n    }\r\n    else reduced = this.data;\r\n    var toDisplay = randomItem(reduced);\r\n    this.current = toDisplay.path;\r\n    var link = (toDisplay.link.indexOf('http') === (-1)) ? ku_boardspath+'/'+toDisplay.link : toDisplay.link;\r\n    var newhtml = '<a class=\"bnrsupdate\" href=\"#\" onclick=\"javascript:bnrs.display();return false;\"></a><a href=\"'+link+'\"><img src=\"'+ku_boardspath+'/images/bnrs/'+toDisplay.path+'\" /></a>';\r\n    if($('.bnr').length) {\r\n      $('.bnr').html(newhtml);\r\n    }\r\n    else $('.logo').before('<div class=\"bnr-wrap\"><div class=\"bnr\">'+newhtml+'</div></div>');\r\n  },\r\n}\r\n\r\nfunction getRandomInt (min, max) {\r\n  return Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\n\r\nfunction randomItem(array) {\r\n  return array[getRandomInt(0, array.length-1)];\r\n}\r\n\r\nvar embedLinks = {\r\n  sites: [\r\n    {id: 'youtube', rx: /(?:youtu(?:\\.be|be\\.com)\\/(?:.*v(?:\\/|=)|(?:.*\\/)?)([\\w'-]+))/i },\r\n    {id: 'vimeo', rx: /[\\w\\W]*vimeo\\.com\\/(?:.*?)([0-9]+)(?:.*)?/ },\r\n    {id: 'coub', rx: /[\\w\\W]*coub\\.com\\/view\\/([\\w\\W]*)[\\w\\W]*/ },\r\n    {id: 'soundcloud', rx: /[\\w\\W]*soundcloud.com\\/([\\w\\W]*)[\\w\\W]*/i },\r\n  ],\r\n  process: function(val) {\r\n    var result = null;\r\n    _.find(this.sites, function(site) {\r\n      var fruit = site.rx.exec(val);\r\n      if(fruit != null) {\r\n        result = {\r\n          site: site.id,\r\n          code: fruit[1]\r\n        }\r\n      }\r\n    })\r\n    return result;\r\n  }\r\n}\r\n\r\nvar catalog = {\r\n  conf: {\r\n    sortBy: 'bumped',\r\n    layout: 'text',\r\n    respectStickied: true,\r\n    showHidden: true,\r\n    expandOnHover: true\r\n  },\r\n  saveConfig: function() {\r\n    localStorage['catalogSettings'] = JSON.stringify(this.conf);\r\n  },\r\n  init: function() {\r\n    document.body.classList.add('is-catalog')\r\n    // apply settings\r\n    if(localStorage['catalogSettings']) {\r\n      try {\r\n        var myConf = JSON.parse(localStorage['catalogSettings']);\r\n        _.each(myConf, function(val, key) {\r\n          this.conf[key] = val\r\n        }, this)\r\n      }\r\n      catch(e) {\r\n        console.error('Invalid catalog config');\r\n        localStorage.removeItem('catalogSettings');\r\n      }\r\n    }\r\n\r\n    /*var sortOptionElements = '';\r\n    _.each([\r\n      ['bumped', 'bumpOrder'],\r\n      ['replied', 'lastReply'],\r\n      ['timestamp', 'creationDate'],\r\n      ['reply_count', 'replyCount']\r\n    ], (function(val_desc) {\r\n      sortOptionElements += '<option value=\"'+val_desc[0]+'\"'+(val_desc[0]==this.conf.sortBy ? ' selected' : '')+'>'+_l[val_desc[1]]+'</option>';\r\n    }).bind(this));*/\r\n    // Catalog refresh button\r\n    var refreshBtn = `<div class=\"refresh-catalog\" title=\"${_l.refreshCatalog}\"><svg class=\"icon i-16in20\"><use xlink:href=\"#i-refresh\"></use></svg></div>`\r\n    // catalog control buttons\r\n    var sortBtns = '<div class=\"button-group\" data-select=\"sortBy\">';\r\n    _.each([\r\n      ['bumped', 'bumpOrder', 'bump', 'i-20'],\r\n      ['timestamp', 'creationDate', 'creation', 'i-20'],\r\n      ['replied', 'lastReply', 'reply', 'i-16in20'],\r\n      ['reply_count', 'replyCount', 'replies', 'i-20']\r\n    ], (function(v_d_i) {\r\n      sortBtns += '<div class=\"bg-button'+(v_d_i[0]==this.conf.sortBy ? ' bgb-selected' : '')+\r\n      '\" data-val=\"'+v_d_i[0]+'\" title=\"'+_l.sortBy+' '+_l[v_d_i[1]]+'\">\\\r\n      <svg class=\"icon '+v_d_i[3]+'\"><use xlink:href=\"#i-'+v_d_i[2]+'\"></use></svg></div>'\r\n    }).bind(this));\r\n    sortBtns += '</div>';\r\n    var pinBtns = '<div class=\"button-group'+(this.conf.sortBy !== 'bumped' ? ' disabled' : '')+'\" data-select=\"respectStickied\" id=\"pinControl\">';\r\n    _.each([\r\n      [1, 'doStick', 'pin', 'i-16in20'],\r\n      [0, 'doNotStick', 'unpin', 'i-16in20']\r\n    ], (function(v_d_i) {\r\n      pinBtns += '<div class=\"bg-button'+(v_d_i[0]==this.conf.respectStickied ? ' bgb-selected' : '')+\r\n      '\" data-val=\"'+v_d_i[0]+'\" title=\"'+_l[v_d_i[1]]+'\">\\\r\n      <svg class=\"icon '+v_d_i[3]+'\"><use xlink:href=\"#i-'+v_d_i[2]+'\"></use></svg></div>'\r\n    }).bind(this));\r\n    pinBtns += '</div>';\r\n    var hideBtns = '<div class=\"button-group\" data-select=\"showHidden\">';\r\n    _.each([\r\n      [0, 'hideHidden', 'hide', 'i-16in20'],\r\n      [1, 'showHidden', 'unhide', 'i-16in20']\r\n    ], (function(v_d_i) {\r\n      hideBtns += '<div class=\"bg-button'+(v_d_i[0]==this.conf.showHidden ? ' bgb-selected' : '')+\r\n      '\" data-val=\"'+v_d_i[0]+'\" title=\"'+_l[v_d_i[1]]+'\">\\\r\n      <svg class=\"icon '+v_d_i[3]+'\"><use xlink:href=\"#i-'+v_d_i[2]+'\"></use></svg></div>'\r\n    }).bind(this));\r\n    hideBtns += '</div>';\r\n    var layoutBtns = '<div class=\"button-group\" data-select=\"layout\">';\r\n    _.each([\r\n      ['text', 'smallPics', 'grid-small', 'i-20'],\r\n      ['gallery', 'largePics', 'gallery-grid', 'i-20'],\r\n      /*['legacy', 'legacyMode', 'legacy-grid', 'i-20']*/\r\n    ], (function(v_d_i) {\r\n      layoutBtns += '<div class=\"bg-button'+(v_d_i[0]==this.conf.layout ? ' bgb-selected' : '')+\r\n      '\" data-val=\"'+v_d_i[0]+'\" title=\"'+_l[v_d_i[1]]+'\">\\\r\n      <svg class=\"icon '+v_d_i[3]+'\"><use xlink:href=\"#i-'+v_d_i[2]+'\"></use></svg></div>'\r\n    }).bind(this));\r\n    layoutBtns += '</div>';\r\n    // searck input\r\n    var searchInput = '<input name=\"subject\" autocomplete=\"false\" class=\"button-group\" type=\"text\" id=\"cat-search\" placeholder=\"'+_l.search+'...\" /><input type=\"text\" name=\"FUCKYOUCHROMEFUCKYOU\" style=\"display:none;\"/>'\r\n\r\n    $('#catalog-controls').html(\r\n      refreshBtn+sortBtns+pinBtns+searchInput+hideBtns+layoutBtns\r\n    );\r\n    this.load();\r\n    if(this.conf.expandOnHover)\r\n      $('#catalog-contents').addClass('expand-on-hover-enabled');\r\n    // Card events\r\n    $('#catalog-contents')\r\n    .on('click', '.namedate-overlay', function() {\r\n      $(this).toggleClass('date-on name-on');\r\n    })\r\n    .on('click', '.ce-text .bigThumb', function(ev) {\r\n      ev.stopPropagation(); ev.preventDefault();\r\n      var $card = $(this).parents('.cat-entry');\r\n      $card.toggleClass('thumbExpanded');\r\n    })\r\n    .on('click', '.bigThumb audio, .bigThumb video', function(ev) {\r\n      ev.stopPropagation();\r\n    })\r\n    .on('animationstart webkitAnimationStart MSAnimationStart oanimationstart', (function(event) {\r\n      var $target = $(event.target);\r\n      if (event.originalEvent.animationName == \"embed-image-insert\" && !$target.hasClass('_inserted_'))\r\n        this.getEmbedThumb($target);\r\n    }).bind(this))\r\n    .on('mousedown', '.cat-prv', function(ev) {\r\n      ev.preventDefault();\r\n      PostPreviews._mouseover.bind(this)(ev);\r\n    })\r\n    .on('click', '.cat-prv', function(ev) {\r\n      ev.stopPropagation();\r\n      ev.preventDefault();\r\n    })\r\n    .on('mouseleave', '.cat-prv', function(ev) {\r\n      PostPreviews._mouseout.bind(this)(/*ev*/);\r\n    })\r\n    .on('click', '.i-hide', (function(ev) {\r\n      var $target = $(ev.currentTarget)\r\n      , $card = $target.parents('.cat-entry')\r\n      , threadID = $card.data('id')\r\n      , threadIX = _.findIndex(this.model, {'id': threadID})\r\n      , thread = this.model[threadIX];\r\n      thread.hidden = !thread.hidden;\r\n      // addClass won't work here for some reason\r\n      if(thread.hidden) {\r\n        $target[0].classList.add('pressed');\r\n        $target.html(makeIcon('unhide', '', true));\r\n        HiddenItems.hideItem('thread', threadID);\r\n        $card.addClass('thread-hidden')\r\n      }\r\n      else {\r\n        $target[0].classList.remove('pressed');\r\n        $target.html(makeIcon('hide', '', true));\r\n        HiddenItems.unhideItem('thread', threadID);\r\n        $card.removeClass('thread-hidden')\r\n      }\r\n      //invalidate rendered cache\r\n      this.model[threadIX] = thread;\r\n      delete this.rendered[this.conf.layout][threadID];\r\n    }).bind(this))\r\n    // catalog configuration\r\n    $('.bg-button').click((function(ev) {\r\n      var $target = $(ev.currentTarget);\r\n      if($target.hasClass('bgb-selected')) return;\r\n      var $group = $target.parent()\r\n      , val = $target.data('val')\r\n      , key = $group.data('select');\r\n      $group.find('.bg-button').removeClass('bgb-selected');\r\n      $target.addClass('bgb-selected');\r\n      if(key !== 'sortBy' && key !== 'layout') val = !!val;\r\n      else {\r\n        if(val == 'bumped') $('#pinControl').removeClass('disabled');\r\n        else $('#pinControl').addClass('disabled');\r\n      }\r\n      this.conf[key] = val;\r\n      this.saveConfig();\r\n      if(key !== 'showHidden') this.build();\r\n      else {\r\n        if(val) $('#catalog-contents').removeClass('hideHidden');\r\n        else $('#catalog-contents').addClass('hideHidden');\r\n      }\r\n    }).bind(this))\r\n    $('.refresh-catalog').click((function(ev) {\r\n      ev.preventDefault();\r\n      this.load();\r\n    }).bind(this));\r\n    //search\r\n    $('#cat-search').on('input', function() {\r\n      var query = $(this).val().toLowerCase().replace(/\\\"/, '\\\\\"');\r\n      try {\r\n        injector.remove('cat-search');\r\n      } catch(e) {}\r\n      if(query.length)\r\n        injector.inject('cat-search', '#catalog-contents .cat-entry:not([data-search *= \"'+query+'\"]) { display:none; }');\r\n      else injector.remove('cat-search');\r\n    }).trigger('input');\r\n  },\r\n  load: function() {\r\n    // clear data\r\n    this.rendered = {text: {}, gallery: {}};\r\n    this.model = null;\r\n    // get contents\r\n    $.getJSON('catalog.json?v='+(new Date().getTime()))\r\n    .done(this.build.bind(this))\r\n    .fail(function(err) {\r\n      throw err;\r\n    })\r\n  },\r\n  fileTypes: {\r\n    image: ['jpg', 'gif', 'png'],\r\n    jpgThumb: ['webm', 'mp4', 'cob', 'vim', 'you'],\r\n    iconsAvailable: ['swf', 'mp3', 'ogg', 'css', 'flv'],\r\n    audio: ['mp3', 'ogg'],\r\n    embed: ['cob', 'vim', 'you']\r\n  },\r\n  authorities: ['', 'Admin', 'Mod', '?', 'God'],\r\n  formatDate: function(timestamp, short) {\r\n    if(typeof short === 'undefined') short = false;\r\n    var date = new Date(timestamp * 1000)\r\n    , Dow = this.dateLocal.dows.hasOwnProperty(locale) ? this.dateLocal.dows[locale][date.getDay()] : this.dateLocal.dows.en[date.getDay()]\r\n    , yy = _.padLeft(date.getFullYear() % 100, 2, 0)\r\n    , mo = _.padLeft(date.getMonth()+1, 2, 0)\r\n    , Mon = (locale === 'ru') ? this.dateLocal.mons.ru[date.getMonth()] : date.getMonth()+1\r\n    , dd = _.padLeft(date.getDate(), 2, 0)\r\n    , hh = _.padLeft(date.getHours(), 2, 0)\r\n    , mm = _.padLeft(date.getMinutes(), 2, 0)\r\n    , ss = _.padLeft(date.getSeconds(), 2, 0);\r\n    return (short\r\n      ? ( (locale === 'ru')\r\n        ? (dd+'.'+mo+'.'+yy+' в ')\r\n        : (mo+'/'+dd+'/'+yy+' @ ') )\r\n      : ( (locale === 'ru')\r\n        ? (Dow+' '+dd+' '+Mon+'’'+yy+' в ')\r\n        : (mo+'/'+dd+'/'+yy+' ('+Dow+') @ ') )\r\n    ) + hh+':'+mm+':'+ss;\r\n  },\r\n  dateLocal: {\r\n    dows: {\r\n      ru: ['Пнд','Втр','Срд','Чтв','Птн','Сбт','Вск'],\r\n      en: ['Sun','Mon','Tue','Wen','Thu','Fri','Sat']\r\n    },\r\n    mons: {\r\n      ru: ['Янв','Фев','Мар','Апр','Май','Июн','Июл','Авг','Сен','Окт','Ноя','Дек']\r\n    }\r\n  },\r\n  build: function(data) {\r\n    if(typeof data === 'undefined') data = this.model;\r\n    if(!data) return;\r\n    // normalize\r\n    _.each(data, function(entry, i) {\r\n      _.each(['id', 'reply_count', 'bumped', 'replied', 'reply_count', 'timestamp', 'page', 'locked', 'stickied', 'deleted_timestamp'], function(prop) {\r\n        entry[prop] = ~~entry[prop];\r\n      })\r\n      data[i] = entry;\r\n    })\r\n    // Sort threads\r\n    if(this.conf.sortBy === 'bumped' && this.conf.respectStickied)\r\n      this.model = _.sortByOrder(data, ['stickied', 'bumped'], ['desc', 'desc']);\r\n    else {\r\n      var sby = [this.conf.sortBy];\r\n      if(this.conf.sortBy !== 'bumped')\r\n        sby.push('bumped')\r\n      this.model = _.sortByOrder(data, sby, _.repeat('desc', sby.length));\r\n    }\r\n\r\n    var html = '';\r\n\r\n    _.each(this.model, function(thread) {\r\n      html += this.buildEntry(thread);\r\n    }, this);\r\n\r\n    $('#catalog-contents').html(html);\r\n  },\r\n  getEmbedThumb: function($el) {\r\n    var site = $el.data('site'), id = $el.data('id'), img\r\n    , $thread = $el.parents('.cat-entry')\r\n    , threadID = $thread.data('id');\r\n    if(site == 'cob')\r\n      $.get(ku_boardspath+'/corpsy.php?code='+id, (function(res) {\r\n        $el.replaceWith('<img src=\"'+res.thumbnail_url+'\">');\r\n        this.rendered[this.conf.layout][threadID] = $thread[0].outerHTML;\r\n      }).bind(this));\r\n    if(site == 'vim')\r\n      $.get('http://vimeo.com/api/v2/video/'+id+'.json', (function(res) {\r\n        $el.replaceWith('<img src=\"'+res[0].thumbnail_medium+'\">');\r\n        this.rendered[this.conf.layout][threadID] = $thread[0].outerHTML\r\n      }).bind(this));\r\n  },\r\n\r\n  buildEntry: function(thread) {\r\n    if(this.rendered[this.conf.layout].hasOwnProperty(thread.id))\r\n      return this.rendered[this.conf.layout][thread.id];\r\n\r\n    if(!thread.processed) {\r\n      thread.url = '/'+this_board_dir+'/res/'+thread.id+'.html';\r\n      // --- Building blocks ---\r\n      // Thumbnails\r\n      var expanderBtn = '<svg class=\"actor icon cat-thumb-expand\"><use xlink:href=\"#i-expand\"></use></svg>',\r\n      playerBtn = '<svg class=\"actor icon cat-thumb-expand\"><use xlink:href=\"#i-play\"></use></svg>';\r\n      // Find first non-deleted file\r\n      let embed = thread.embeds ? (thread.embeds.find(e => e.file != 'removed') || 'removed') : null\r\n      //  for images\r\n      if(!embed || embed === 'removed') {\r\n        thread.smallThumb =\r\n        '<a href=\"'+thread.url+'\" class=\"smallThumb\">\\\r\n          <div class=\"nofile-removed ctx\">'+(embed === 'removed' ? 'Удалён' : 'No File')+'</div>'\r\n        +'</a>';\r\n      }\r\n      else {\r\n        if (\r\n          _.includes(this.fileTypes.image, embed.file_type)\r\n          ||\r\n          _.includes(this.fileTypes.jpgThumb, embed.file_type)\r\n          ||\r\n          (\r\n            _.includes(this.fileTypes.audio, embed.file_type)\r\n            &&\r\n            (+embed.thumb_w) > 0\r\n            &&\r\n            (+embed.thumb_h) > 0\r\n          )\r\n        ) {\r\n          let ftype = _.includes(this.fileTypes.image, embed.file_type)\r\n            ? embed.file_type\r\n            : 'jpg'\r\n          , thumbURL = _.includes(this.fileTypes.embed, embed.file_type)\r\n            ? `${embed.file_type}-${embed.file}-`\r\n            : embed.file\r\n          , vartype = embed.file_type == 'mp3' ? ' onerror=\"switchFileType(this)\" extset=\"jpg,png,gif\"' : ''\r\n          thread.smallThumb =\r\n          '<a href=\"'+thread.url+'\" class=\"smallThumb\">\\\r\n            <img src=\"thumb/'+thumbURL+'c.'+ftype+'\"'+vartype+'>'\r\n          +'</a>';\r\n          thread.bigThumb =\r\n          '<img src=\"thumb/'+thumbURL+'s.'+ftype+'\"'+vartype+'>';\r\n        }\r\n        /*if(_.includes(this.fileTypes.image, thread.file_type)) {\r\n          thread.fileTypeClass = 'image';\r\n          thread.smallThumb =\r\n          '<a href=\"'+thread.url+'\" class=\"smallThumb\">\\\r\n            <img src=\"thumb/'+thread.file+'c.'+(thread.file_type === 'webm' ? 'jpg' : thread.file_type)+'\">'\r\n          +'</a>';\r\n          thread.bigThumb =\r\n          '<img src=\"thumb/'+thread.file+'s.'+(thread.file_type === 'webm' ? 'jpg' : thread.file_type)+'\">';\r\n        }*/\r\n        //  small thumbnail for embeds and generic files\r\n        else {\r\n          var smallSrc = (_.includes(this.fileTypes.iconsAvailable, embed.file_type))\r\n          ? '/inc/filetypes/'+embed.file_type+'.png'\r\n          : '/inc/filetypes/generic'+(_.includes(this.fileTypes.embed, embed.file_type) ? '-embed' : '')+'.png';\r\n          var expandable = _.includes(this.fileTypes.embed, embed.file_type) || _.includes(this.fileTypes.audio, embed.file_type);\r\n          thread.smallThumb =\r\n          '<a href=\"'+thread.url+'\" class=\"smallThumb\">\\\r\n            <img src=\"'+smallSrc+'\">' +\r\n            /*+ ''+(expandable ? playerBtn : '') +*/\r\n          '</a>';\r\n          //  for audios\r\n          if(_.includes(this.fileTypes.audio, embed.file_type)) {\r\n            thread.bigThumb =\r\n            '<audio src=\"src/'+embed.file+'.'+embed.file_type+'\" controls></audio>';\r\n          }\r\n        }\r\n        /*//  for embeds\r\n        if(_.includes(this.fileTypes.embed, thread.file_type)) {\r\n          thread.bigThumb = (thread.file_type == 'you')\r\n          ? '<img src=\"http://i.ytimg.com/vi/'+thread.file+'/mqdefault.jpg\">'\r\n          : '<div class=\"cat-bt-embed\" data-site=\"'+thread.file_type+'\" data-id=\"'+thread.file+'\"></div>';\r\n        }\r\n        //  for audios\r\n        if(_.includes(this.fileTypes.audio, thread.file_type)) {\r\n          thread.bigThumb =\r\n          '<audio src=\"src/'+thread.file+'.'+thread.file_type+'\" controls></audio>';\r\n        }*/\r\n        thread.bigThumb = '<a target=\"_blank\" href=\"'+thread.url+'\" class=\"bigThumb\">'+thread.bigThumb+'</a>';\r\n      }\r\n      /*if(!embed || embed === 'removed')\r\n        thread.bigThumb = '<a target=\"_blank\" href=\"'+thread.url+'\" class=\"bigThumb\">'+thread.bigThumb+'</a>';*/\r\n\r\n      //OP\r\n      thread.op = '<a target=\"_blank\" title=\"'+_l.goToThread+'\" target=\"_blank\" href=\"'+thread.url+'\" class=\"op-number ctx\">#'+thread.id+'</a>';\r\n\r\n      //preview\r\n      thread.preview =\r\n      '<a href=\"'+thread.url+'#'+thread.id+'\" class=\"actor cat-prv\">\\\r\n        <svg class=\"icon\"><use xlink:href=\"#i-eye\"></use></svg>\\\r\n      </a>';\r\n\r\n      //counters\r\n      var repliesLabel =\r\n      '<svg class=\"icon\"><use xlink:href=\"#i-reply\"></use></svg>\\\r\n      <span class=\"ctx reply-count\">'+thread.reply_count+'</span>';\r\n      if(thread.last_reply)\r\n        repliesLabel = '<a href=\"'+thread.url+'#'+thread.last_reply+'\" class=\"actor cat-prv\">'+repliesLabel+'</a>';\r\n      var replies =\r\n      '<div class=\"infolabel\">'+repliesLabel+'</div>',\r\n      images =\r\n      '<div class=\"infolabel\">\\\r\n        <svg class=\"icon\"><use xlink:href=\"#i-picture\"></use></svg>\\\r\n        <span class=\"ctx image-count\">'+thread.images+'</span>\\\r\n      </div>',\r\n      page =\r\n      '<div class=\"infolabel il-page\">\\\r\n        <a title=\"'+_l.threadOnPage+' '+thread.page+'\" target=\"_blank\" href=\"/'+this_board_dir+'/' + ((thread.page > 0) ? thread.page+'.html' : '')+'#'+thread.id+'\" class=\"actor\">\\\r\n          <svg class=\"icon\"><use xlink:href=\"#i-page\"></use></svg>\\\r\n          <span class=\"ctx page-number\">'+thread.page+'</span>\\\r\n        </a>\\\r\n      </div>';\r\n      thread.countersCombined = replies+images+page;\r\n\r\n      //Poster name+date\r\n      thread.posterauthority = +thread.posterauthority;\r\n      thread.nameDatePriority = 'date';\r\n      if(localStorage['cat_nameDatePriority'] == 'name' ||\r\n          (localStorage['cat_nameDatePriority'] != 'date' &&\r\n            (thread.name || thread.tripcode || thread.posterauthority)\r\n          )\r\n        ) thread.nameDatePriority = 'name';\r\n\r\n      // Poster name\r\n      var poster =\r\n      (thread.name ? '<span class=\"ctx postername\">'+thread.name+'</span>' : '') +\r\n      (thread.tripcode ? '<span class=\"ctx postertrip\">!'+thread.tripcode+'</span>' : '') +\r\n      (thread.posterauthority ? '<span class=\"ctx admin\">&nbsp;##'+this.authorities[thread.posterauthority]+'##</span>' : '');\r\n      thread.poster = '<div class=\"cat-poster\"><span class=\"ctx\">by&nbsp;</span>'+ (poster || '<span class=\"ctx c-postername\">'+(this_board_defaultName || _l.anonymous)+'</span>')+'</div>';\r\n\r\n      // Date\r\n      var dn = ' style=\"display:none\"';\r\n      thread.date = '<div class=\"ctx cat-date cat-date-long\">'+this.formatDate(thread.timestamp)+'</div>';\r\n      thread.dateCompact = '<div class=\"ctx cat-date cat-date-short\">'+this.formatDate(thread.timestamp, 1)+'</div>';\r\n\r\n      //search data\r\n      thread.searchData = _.escape(stripHTML(thread.subject + ' ' + thread.message).toLowerCase());\r\n\r\n      thread.message = thread.message.replace(/\\\\\"/mg, '\"');\r\n\r\n      thread.processed = true;\r\n      this.model[_.findIndex(this.model, {id: thread.id})] = thread;\r\n    }\r\n    //indicators\r\n    thread = this.buildIndicators(thread);\r\n\r\n    var html = this.layouts[this.conf.layout].bind(this)(thread);\r\n    this.rendered[this.conf.layout][thread.id] = html;\r\n    return html\r\n  },\r\n  buildIndicators: function(thread) {\r\n    thread.hidden =  HiddenItems.isHidden('thread', thread.id)\r\n    var pin = thread.stickied ? '<svg class=\"foradmin-act icon i-layer-1 i-pin\"><use xlink:href=\"#i-pin\"></use></svg>' : '',\r\n    lock = thread.locked ? '<svg class=\"foradmin-act icon i-layer-1 i-lock\"><use xlink:href=\"#i-lock\"></use></svg>' : '',\r\n    deathmark = thread.deleted_timestamp ? '<svg class=\"foradmin-act icon i-layer-1 i-deathmark\"><use xlink:href=\"#i-skull\"></use></svg>' : '',\r\n    hide = '<svg class=\"actor icon i-layer-1 i-hide'+(thread.hidden ? ' pressed' : '')+'\"><use xlink:href=\"#i-'+(thread.hidden ? 'unhide' : 'hide')+'\"></use></svg>',\r\n    burger = '<svg class=\"actor icon i-burger foradmin-show\"><use xlink:href=\"#i-burger\"></use></svg>',\r\n    del = '<svg class=\"actor icon i-layer-2 i-delete foradmin-show\"><use xlink:href=\"#i-x\"></use></svg>',\r\n    and = '<svg class=\"actor icon i-layer-2 i-dnb foradmin-show\"><use xlink:href=\"#i-and\"></use></svg>',\r\n    ban = '<svg class=\"actor icon i-layer-2 i-ban foradmin-show\"><use xlink:href=\"#i-ban\"></use></svg>';\r\n    thread.indicatorsCombined = '<div class=\"indicators\">'+burger+'<span class=\"i-layer-1\">'+deathmark+pin+lock+hide+'</span><span class=\"i-layer-2\">'+del+and+ban+'</span></div>';\r\n    return thread;\r\n  },\r\n  layouts: {\r\n    text: function(thread) {\r\n      return ''+\r\n      '<div data-id=\"'+thread.id+'\" class=\"cat-entry ce-text'+(thread.hidden ? ' thread-hidden' : '')+'\" data-search=\"'+thread.searchData+'\">\\\r\n        <div class=\"cat-card\">\\\r\n          <div class=\"ce-heda\">'\r\n            +thread.smallThumb+\r\n            '<div class=\"cat-infoline ci-op-link\">'\r\n              +thread.op\r\n              +thread.indicatorsCombined+\r\n            '</div>\\\r\n            <div class=\"cat-infoline namedate-overlay '+thread.nameDatePriority+'-on\">'\r\n              +thread.poster\r\n              +thread.date\r\n            +'</div>\\\r\n            <div class=\"cat-infoline\">'\r\n              +thread.preview\r\n              +thread.countersCombined+\r\n            '</div>\\\r\n          </div>\\\r\n          <div class=\"ce-opcontent ctx\">\\\r\n            <h5>'+thread.subject+'</h5>'+\r\n            thread.message+\r\n          '</div>\\\r\n        </div>'\r\n        +thread.bigThumb+\r\n      '</div>'\r\n    },\r\n    gallery: function(thread) {\r\n      return ''+\r\n      '<div data-id=\"'+thread.id+'\" class=\"cat-entry ce-gallery'+(thread.hidden ? ' thread-hidden' : '')+'\" data-search=\"'+thread.searchData+'\">\\\r\n        <div class=\"cat-card\">'+\r\n          thread.bigThumb+\r\n          '<div class=\"cat-infoline\">\\\r\n            <div class=\"ci-op-link\">'+thread.op+'</div>\\\r\n            <div class=\"counters\">'+thread.countersCombined+'</div>\\\r\n          </div>\\\r\n          <div class=\"cat-infoline\">'\r\n            +thread.preview+\r\n            '<div class=\"namedate-overlay '+thread.nameDatePriority+'-on\">'\r\n              +thread.poster\r\n              +thread.dateCompact\r\n            +'</div>'\r\n            +thread.indicatorsCombined+\r\n          '</div>\\\r\n          <div class=\"ce-opcontent ctx\">\\\r\n            <h5>'+thread.subject+'</h5>'+\r\n            thread.message+\r\n          '</div>\\\r\n        </div>\\\r\n      </div>'\r\n    }\r\n  }\r\n}\r\n\r\nfunction stripHTML(html) {\r\n  var tmp = document.implementation.createHTMLDocument(\"New\").body;\r\n  tmp.innerHTML = html;\r\n  return tmp.textContent || tmp.innerText || \"\";\r\n}\r\n\r\nvar overboard = {\r\n  get boards() {\r\n    if (!is_overboard)\r\n      return [boardid]\r\n    if (!this._boards)\r\n      this._boards = _.unique([].map.call(document.querySelectorAll('div[id^=thread]'), e => e.dataset.boardid))\r\n    return this._boards\r\n  },\r\n  idFromName: name => name!==null && $(`div[data-board=\"${name}\"]`).parents('div[id^=thread]').data('boardid')\r\n}\r\n\r\nvar unreadCounter = {\r\n  init: function(built) {\r\n    if (!built) {\r\n      built = + document.querySelector('meta[property=\"i0:buildtime\"]').content\r\n    }\r\n    this.lastvisits = localStorage['lastvisits'] ? (JSON.parse(localStorage['lastvisits']) || { }) : { }\r\n    overboard.boards.forEach(boardid => {\r\n      let last_ts = this.lastvisits.hasOwnProperty(boardid) ? parseInt(this.lastvisits[boardid]) : 0;\r\n      if(last_ts < built) {\r\n        this.lastvisits[boardid] = built\r\n        localStorage.setItem('lastvisits', JSON.stringify(this.lastvisits))\r\n      }\r\n    })\r\n  },\r\n  refreshTimestamp: function(timestamp, boardName=null) { // PHP standard timestamp length\r\n    if (!this.lastvisits)\r\n      this.init()\r\n    let id = !is_overboard ? boardid : overboard.idFromName(boardName)\r\n    if (id) {\r\n      if (timestamp===null || typeof timestamp === 'undefined')\r\n        timestamp = Math.round(new Date().getTime() / 1000)\r\n      this.lastvisits[id] = timestamp\r\n      localStorage.setItem('lastvisits', JSON.stringify(this.lastvisits))\r\n    }\r\n  },\r\n  update: function() {\r\n    if (!this.lastvisits)\r\n      this.init()\r\n    $.ajax({\r\n      url: '/newpostscount.php',\r\n      data: this.lastvisits,\r\n      dataType: 'json',\r\n      success: function(data) {\r\n        $('.newposts-counter').remove()\r\n        $('.got-updates').removeClass('got-updates')\r\n        _.each(data, function(val, brd) {\r\n          if ((+val) > 0) {\r\n            let valstr = `<span class=\"newposts-counter\"> (${val})</span>`\r\n            , $brd = $(`.menu-item[href=\"/${brd}/\"]`)\r\n            if ($brd.length) {\r\n              $brd.append(valstr)\r\n              $(`.sect-exr[data-toexpand=\"${$brd.parents('.menu-sect').attr('id').split('ms-')[1]}\"]`).parent().addClass('got-updates')\r\n            }\r\n            $(`.mobile-nav option[value=\"${brd}\"]`).append(valstr)\r\n          }\r\n        })\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nvar HTMLoader = {\r\n  loadThread: function(boardID, threadID, done, postID) {\r\n    $.get(threadID === '?'\r\n      ? `${ku_boardspath}/postbynumber.php?b=${boardID}&p=${postID}`\r\n      : `${ku_boardspath}/${boardID}/res/${threadID}.html?${force_html_nocache ? Math.random() : ''}`)\r\n    .then(data => {\r\n      let posts = data.match(/<div\\s*?class\\s*?=\\s*?\"[^\"]*?i0svcel[^\"]*?\"\\s*?>!i0-pd:[0-9]+\\s*?<\\/div\\s*?>[\\s\\S]+?<div\\s*?class\\s*?=\\s*?\"[^\"]*?i0svcel[^\"]*?\"\\s*?>!i0-pd-end\\s*?<\\/div\\s*?>/gi)\r\n      .map(match => {\r\n        let res = match.match(/<div\\s*?class\\s*?=\\s*?\"[^\"]*?i0svcel[^\"]*?\"\\s*?>!i0-pd:([0-9]+)\\s*?<\\/div\\s*?>([\\s\\S]+?)<div\\s*?class\\s*?=\\s*?\"[^\"]*?i0svcel[^\"]*?\"\\s*?>!i0-pd-end\\s*?<\\/div\\s*?>/i);\r\n        return {\r\n          id: +res[1],\r\n          body: res[2]\r\n        }\r\n      })\r\n      if (threadID === '?') {\r\n        let thrno = data.match(/<!--i0:thrno=([0-9]+)-->/) //wtf\r\n        if (thrno)\r\n          threadID = thrno[1]\r\n      }\r\n      if (posts.length) {\r\n        let postMap = posts.map(post => {\r\n          this.cached[`${boardID}_${post.id}`] = post.body\r\n          return post.id\r\n        })\r\n        if (threadID !== '?') {\r\n          this.threadMaps[`${boardID}_${threadID}`] = postMap\r\n        }\r\n      }\r\n      done()\r\n    })\r\n    .fail(err => {\r\n      done(err.status || 'null')\r\n    })\r\n  },\r\n  getPost: function(boardID, threadID, postID, callback, secondTry) {\r\n    let cachedPost = this.cached[`${boardID}_${postID}`]\r\n    if (cachedPost) {\r\n      callback(false, cachedPost)\r\n      return\r\n    }\r\n    else {\r\n      if (!secondTry) {\r\n        let found = false\r\n        if (boardID === this_board_dir) {\r\n          let $post = $(`a[name=${postID}]`)\r\n          if ($post.length) {\r\n            let post = $post.parents('.postnode')[0].outerHTML\r\n            this.cached[`${boardID}_${postID}`] = post\r\n            found = true\r\n            callback(false, post)\r\n          }\r\n        }\r\n        if (!found) {\r\n          this.loadThread(boardID, threadID, err => {\r\n            if (err) {\r\n              callback(err)\r\n            }\r\n            else {\r\n              this.getPost(boardID, threadID, postID, callback, true)\r\n            }\r\n          }, postID)\r\n        }\r\n      }\r\n      else {\r\n        callback(null)\r\n      }\r\n    }\r\n  },\r\n  getThread: function(boardID, threadID, range, callback, secondTry, force) {\r\n    let threadMap = force ? false : this.threadMaps[`${boardID}_${threadID}`]\r\n    if (threadMap) {\r\n      if (range) {\r\n        threadMap = threadMap.filter(n => n > range[0] && n < range[1])\r\n      }\r\n      callback(false, threadMap.reduce((htm, postID) => htm + this.cached[`${boardID}_${postID}`], ''))\r\n    }\r\n    else {\r\n      if (!secondTry) {\r\n        this.loadThread(boardID, threadID, err => {\r\n          if (err) {\r\n            callback(err)\r\n          }\r\n          else {\r\n            this.getThread(boardID, threadID, range, callback, true)\r\n          }\r\n        })\r\n      }\r\n      else {\r\n        callback(null)\r\n      }\r\n    }\r\n  },\r\n  cached: {},\r\n  threadMaps: {},\r\n  cachedPostboxes: {},\r\n  getPostbox: function(boardID) {\r\n    return new Promise((resolve, reject) => {\r\n      if (!boardID) // not overboard\r\n        return resolve(document.querySelector('#postform'))\r\n      if (this.cachedPostboxes[boardID])\r\n        return resolve(this.cachedPostboxes[boardID])\r\n      $.get(`${ku_boardspath}/${boardID}/`) // dirty deeds done dirt cheap\r\n      .then(data => {\r\n        let pb = data.match(/<div\\s*?class\\s*?=\\s*?\"[^\"]*?i0svcel[^\"]*?\"\\s*?>!i0-pb\\s*?<\\/div\\s*?>([\\s\\S]+?)<div\\s*?class\\s*?=\\s*?\"[^\"]*?i0svcel[^\"]*?\"\\s*?>!i0-pb-end\\s*?<\\/div\\s*?>/i)\r\n        if (!pb)\r\n          reject(404)\r\n        let c = document.createElement('div')\r\n        c.innerHTML = pb[1]\r\n        this.cachedPostboxes[boardID] = c.firstChild\r\n        resolve(this.cachedPostboxes[boardID])\r\n      })\r\n      .fail(err => {\r\n        reject(err.status || 'null')\r\n      })\r\n    })\r\n  }\r\n}\r\n\r\nfunction switchFileType(el) {\r\n  let exp = /\\.([a-z0-9]+)(?=$|\\?)/i\r\n  , match = el.src.match(exp)\r\n  if (!match) return;\r\n  let exts = el.getAttribute('extset').toLowerCase().split(',')\r\n  if (!exts.length) return;\r\n  let i = exts.indexOf(match[1].toLowerCase())\r\n  if (i == -1 || i >= (exts.length-1)) return;\r\n  el.src = el.src.replace(exp, `.${exts[i+1]}`)\r\n}\r\n\r\nfunction LSfetchJSON(key) {\r\n  let val = null, data = localStorage[key]\r\n  if (typeof data !== 'undefined') {\r\n    try {\r\n      val = JSON.parse(data)\r\n    }\r\n    catch(e) {\r\n      console.error(e)\r\n      localStorage.removeItem(key)\r\n    }\r\n  }\r\n  return val\r\n}\r\n\r\n// YOBA alerts\r\nvar pups = {\r\n  push: function(a) {\r\n    // generate a unique alert ID\r\n    a.id = (+_.uniqueId(_.now())).toString(16)\r\n    this.container.insertAdjacentHTML('afterBegin', this.buildAlert(a))\r\n    a.el = document.getElementById(`pup_${a.id}`)\r\n    // Add the popup to the animation queue\r\n    a.el.style.marginTop = -a.el.getBoundingClientRect().height + 'px'\r\n    a.el.getBoundingClientRect() // This forces browser to respect the element's updated position for future animations (no idea why but it works)\r\n    // Close on click\r\n    a.el.onclick = () => {\r\n      delete a.timeout\r\n      a.onHold = false\r\n      a.old = true\r\n      a.el.classList.add('pup-away')\r\n      a.el.style.marginTop = -a.el.getBoundingClientRect().height + 'px'\r\n    }\r\n    // Do not close if mouse is over\r\n    a.el.onmouseenter = () => {\r\n      // iterate stack from end to start\r\n      this.stack.slice(0).reverse().find(ar => {\r\n        ar.onHold = true\r\n        return (ar.id == a.id) // break\r\n      })\r\n    }\r\n    // Close after mouse leave\r\n    a.el.onmouseleave = () => {\r\n      this.stack.forEach(ae => {\r\n        ae.onHold = false\r\n      })\r\n      this.holdOffTimeout = setTimeout(() => {\r\n        this.stack.forEach(ae => {\r\n          if (!ae.onHold && ae.old && ae.el) {\r\n            ae.el.classList.add('pup-away')\r\n            ae.el.style.marginTop = -a.el.getBoundingClientRect().height + 'px'\r\n          }\r\n        })\r\n      }, 200)\r\n    }\r\n    this.queue.add(() => {\r\n      this.scheduleClose(a)\r\n      a.el.classList.remove('pup-pre')\r\n      a.el.style.marginTop = null\r\n      a.el.classList.remove('pup-noshadow')\r\n    })\r\n    this.stack.push(a)\r\n    this.save()\r\n    return a.id\r\n  },\r\n  closeByID: function(aid) {\r\n    let a = this.byID(aid)\r\n    if (a)\r\n      a.el.onclick()\r\n  },\r\n  queue: {\r\n    stack: [],\r\n    busy: false,\r\n    add: function(fn) {\r\n      return new Promise((resolve, reject) => {\r\n        if (! this.busy) {\r\n          this.timeout = setTimeout(this.next.bind(this), this.cooldown * 1000)\r\n          this.busy = true\r\n          resolve(fn())\r\n        }\r\n        else {\r\n          this.stack.push(() => resolve(fn()))\r\n        }\r\n      })\r\n    },\r\n    next: function() {\r\n      let next = this.stack.shift()\r\n      if (! next)\r\n        this.busy = false\r\n      else {\r\n        next()\r\n        this.timeout = setTimeout(this.next.bind(this), this.cooldown * 1000)\r\n      }\r\n    },\r\n    cooldown: .3\r\n  },\r\n  byID: function(aid) {\r\n    return this.stack.find(a => a.id == aid)\r\n  },\r\n  update: function(aid, upd) {\r\n    let a = this.byID(aid)\r\n    if (typeof upd !== 'object')\r\n      a = {msg: upd}\r\n    _.extend(a, upd)\r\n    // reset timeout\r\n    this.scheduleClose(a)\r\n    a.el.setAttribute('pupclass', a.cls)\r\n    a.el.querySelector('.pup-wrapped').innerHTML = this.buildAlert(a, 1)\r\n    this.save()\r\n  },\r\n  buildAlert: function(a, contentsOnly=false) {\r\n    let contents = `\r\n      <div class=\"alert-icon\">\r\n        <svg class=\"icon\"><use xlink:href=\"#i-${this.iconMap[a.cls]}\"></use></svg>\r\n      </div>\r\n      <div class=\"alert-msg\">${a.msg}</div>`\r\n    if (contentsOnly)\r\n      return contents\r\n    return `<div class=\"pup ${a.old ? 'pup-away pup-away-full' : 'pup-pre pup-noshadow'}\" pupclass=\"${a.cls}\" id=\"pup_${a.id}\">\r\n      <div class=\"pup-wrapped\">\r\n        ${contents}\r\n      </div>\r\n    </div>`\r\n  },\r\n  iconMap: {\r\n    succ: 'success',\r\n    err: 'error',\r\n    info: 'info',\r\n    warn: 'warning'\r\n  },\r\n  historyToggle: function() {\r\n    if (!this.stack.length) {\r\n      this.push({cls: 'info', msg: _l.historyEmpty, destroy: true})\r\n      return\r\n    }\r\n    let on = this.container.classList.toggle('history-mode')\r\n    setTimeout(() => this.container.style.overflow = (on ? 'auto' : null), on ? 300 : 0)\r\n  },\r\n  scheduleClose: function(a) {\r\n    if (a.timeout)\r\n      clearTimeout(a.timeout)\r\n    if (a.onHold)\r\n      a.onHold = false\r\n    let time = (a.time || a.time === 0) ? a.time : this.defaultTimeout\r\n    if (time) // If time is 0 it means no timeout\r\n      a.timeout = setTimeout(() => {\r\n        a.old = true\r\n        if (! a.onHold) {\r\n          a.el.classList.add('pup-away')\r\n          a.el.style.marginTop = -a.el.getBoundingClientRect().height + 'px'\r\n        }\r\n      }, time * 1000)\r\n  },\r\n  defaultTimeout: 3.5, // in seconds\r\n  init: function(container_id=\"pups-container\") {\r\n    document.body.insertAdjacentHTML('beforeEnd', `<div id=\"${container_id}\"><div class=\"pup-history-shadow\"></div></div>`)\r\n    this.container = document.getElementById(container_id)\r\n    if (! this.container) {\r\n      console.error('No popup container found')\r\n      return;\r\n    }\r\n    this.container.onclick = () => {\r\n      if (this.container.classList.contains('history-mode')) {\r\n        return this.historyToggle()\r\n      }\r\n    }\r\n    // make aliases for error classes\r\n    ['err', 'warn', 'info', 'succ', 'wait'].forEach(pupclass => {\r\n      this[pupclass] = function(a, options={}) {\r\n        if (typeof a !== 'object')\r\n          a = {msg: a}\r\n        a.cls = pupclass\r\n        _.extend(a, options)\r\n        return this.push(a)\r\n      }\r\n    })\r\n    // load history from LS\r\n    let log = LSfetchJSON('I0_event_log') || []\r\n    log.forEach(a => {\r\n      a.old = true\r\n      this.container.insertAdjacentHTML('afterBegin', this.buildAlert(a))\r\n      this.stack.push(a)\r\n    })\r\n  },\r\n  historySize: 10,\r\n  save: function() {\r\n    let ss = [] \r\n    _.cloneDeep(this.stack).forEach(a => {\r\n      if (a.save) {\r\n        // Clear stack from the properties that don't need to be saved\r\n        ['old', 'onHold', 'timeout', 'el', 'save'].forEach(junkProperty => delete a[junkProperty])\r\n        ss.push(a)\r\n      }\r\n    })\r\n    while (ss.length > this.historySize) {\r\n      ss.shift()\r\n    }\r\n    localStorage['I0_event_log'] = JSON.stringify(ss)\r\n  },\r\n  stack: []\r\n}\r\n"]}