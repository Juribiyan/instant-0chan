"use strict";function _construct(){return _construct=_isNativeReflectConstruct()?Reflect.construct.bind():function(e,t,n){var s=[null];s.push.apply(s,t);var a=Function.bind.apply(e,s),i=new a;return n&&_setPrototypeOf(i,n.prototype),i},_construct.apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _typeof(e){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,s,i,o,r=[],l=!0,d=!1;try{if(i=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;l=!1}else for(;!(l=(n=i.call(a)).done)&&(r.push(n.value),r.length!==t);l=!0);}catch(e){d=!0,s=e}finally{try{if(!l&&null!=a["return"]&&(o=a["return"](),Object(o)!==o))return}finally{if(d)throw s}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a,n=0;n<t.length;n++)a=t[n],a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,_toPropertyKey(a.key),a)}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(a!==void 0){var n=a.call(e,t||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _createForOfIteratorHelper(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,s=function(){};return{s:s,n:function n(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function e(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,l=!0,d=!1;return{s:function s(){a=a.call(e)},n:function n(){var e=a.next();return l=e.done,e},e:function e(e){d=!0,r=e},f:function f(){try{l||null==a["return"]||a["return"]()}finally{if(d)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=Array(t);a<t;a++)n[a]=e[a];return n}var style_cookie,style_cookie_txt,style_cookie_site,ispage,kumod_set=!1,is_entering=!1,_messages={en:{noLocalStorage:"Your browser does not support LocalStorage",oops:"Something went wrong...",blankResponse:"blank response",expandingThread:"Expanding thread...",newThread:"new thread",NewThread:"New thread",replyTo:"reply to",cancel:"Cancel",update:"Update",updatingCounts:"Updating...",couldntFetch:"Could not fetch this post",noNewPosts:"No new posts",replies:"Replies",settings_fxEnabled:"Animation effects",settings_showReplies:"Show replies inside posts",settings_sfwMode:"NSFW mode",settings_expandImgFull:"Expand images to full size",settings_constrainWidth:"Constrain content width",settings_newMediaViewer:"Experimental media viewer",settings_hidePostBtn:"Post hide buttons",settings_endlessScroll:"Endless scrolling",enterCaptcha:"Please enter captcha.",selectText:"Select some text",dcls:"Double click to show source",watchOn:"Watch on",captcharot:"Captcha has rotted",threadUpdationAutomatically:"Tread is being updated automatically.",stopFuckingDolls:"<b>\u041E\u0442\u043A\u043B\u044E\u0447\u0438\u0442\u0435 AJAX-\u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0443 \u043F\u043E\u0441\u0442\u043E\u0432 \u0438 AJAX-\u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435 \u0442\u0440\u0435\u0434\u0430.</b><br />(\u041A\u043B\u0438\u043A\u043D\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0437\u0430\u043A\u0440\u044B\u0442\u044C)",del:"Delete",delandban:"Delete and ban",ban:"Ban",stickthread:"Stick thread",unstickthread:"Unstick thread",lockthread:"Lock thread",unlockthread:"Unlock thread",returnDesktop:"Switch to desktop interface",returnTouch:"Switch to touch interface",forceDesktop:"Force Desktop interface",okay:"Okay",captchalang:"Captcha language",reply:"Reply",imageDownscaledBy:"Image was downscaled by",videoDownscaledBy:"Video was downscaled by",toFit:"to feet screen",newReplies:"New replies",newThreadsAvailable:"New threads available.",loading:"Loading",anonymous:"Anonymous",sortBy:"Sort by",bumpOrder:"Bump order",lastReply:"Last reply",creationDate:"Creation date",replyCount:"Reply count",doStick:"Respect stickied",showHidden:"Show hidden",doNotStick:"Ignore stickied",hideHidden:"Hide hidden",search:"Search",threadOnPage:"Thread is on page",goToThread:"Go to thread",smallPics:"Small pictures",largePics:"Large pictures",legacyMode:"Legacy mode",threads:"Threads",comments:"Replies",active_since:"Active since",last_active:"Last seen",active_on:"Active on",tryAgain:"Try again",xhrError:"XHR error",details:"details",thread:"Thread",post:"Post",posts:"Posts",deleted:"has been deleted",deletedMulti:"have been deleted",report:"Report",reported:"has been reported",reportedMulti:"have been reported",fileRemoved:"File<br>removed.",file:"File",files:"Files",collapse:"Collapse",asMod:"as Mod",asOP:"as OP",historyEmpty:"History is empty",noDataLoaded:"No data was loaded",unable_load_20:"Unable to load 2.0 boards list",captchaLangChanged:"Captcha laguage changed",found:"Found",links:"Links",selectMultiple:"Select multiple",selected:"Selected",directLink:"Direct link",quoteLink:"Quote link",maxAttNumReached:"Attachments number limit reached.",unsupportedFileType:"unsupported file type",hideName:"Hide file name",removeFile:"Remove file",spoilerOnOff:"Spoier On/Off",hidePost:"Hide post",unhidePost:"Unhide post",settings_hideCompletely:"Hide items completely",pinUnpin:"Pin/Unpin",hideForm:"Hide form",collapseExpand:"Collapse/Expand",notEmpty:"Not empty",showName:"Show/hide name/trip field",showSubject:"Show/hide subject field",showEmbeds:"Show/hide embeds",showPassword:"Show/hide password field",showTTL:"Show/hide time-to-live field",attachFile:"Attach file...",classicSimplifiedForm:"Classic/simplified form",showMarkup:"Show/hide markup",refreshCatalog:"Refresh catalog",cancelTimer:"Cancel timer",saved:"saved from deletion",savedMulti:"saved from deletion",password:"Password",captcha:"Captcha",captchaImage:"Captcha image",refreshCaptcha:"Refresh captcha",showCaptcha:"Show captcha",captchaExpired:"Captcha has expired.",mod_:"Mod.",expandAllImages:"Expand all images",getDownloadList:"Get media download list"},ru:{noLocalStorage:"localStorage \u043D\u0435 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043E\u043C",oops:"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A...",blankResponse:"\u043F\u0443\u0441\u0442\u043E\u0439 \u043E\u0442\u0432\u0435\u0442",expandingThread:"\u0420\u0430\u0437\u0432\u043E\u0440\u0430\u0447\u0438\u0432\u0430\u0435\u043C \u0442\u0440\u0435\u0434...",newThread:"\u043D\u043E\u0432\u044B\u0439 \u0442\u0440\u0435\u0434",NewThread:"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u0442\u0440\u0435\u0434",replyTo:"\u043E\u0442\u0432\u0435\u0442 \u043D\u0430",cancel:"\u041E\u0442\u043C\u0435\u043D\u0430",update:"\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C",updatingCounts:"\u0418\u0449\u0435\u043C \u043D\u043E\u0432\u044B\u0435 \u043F\u043E\u0441\u0442\u044B...",couldntFetch:"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u044D\u0442\u043E\u0442 \u043F\u043E\u0441\u0442",noNewPosts:"\u041D\u0435\u0442 \u043D\u043E\u0432\u044B\u0445 \u043F\u043E\u0441\u0442\u043E\u0432",replies:"\u041E\u0442\u0432\u0435\u0442\u044B",settings_fxEnabled:"\u0410\u043D\u0438\u043C\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0435 \u044D\u0444\u0444\u0435\u043A\u0442\u044B",settings_showReplies:"\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u043E\u0442\u0432\u0435\u0442\u044B \u0432\u043D\u0443\u0442\u0440\u0438 \u043F\u043E\u0441\u0442\u0430",settings_sfwMode:"\u041C\u0430\u043C\u043A\u0430 \u0432 \u043A\u043E\u043C\u043D\u0430\u0442\u0435",settings_expandImgFull:"\u0420\u0430\u0437\u0432\u043E\u0440\u0430\u0447\u0438\u0432\u0430\u0442\u044C \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0438 \u0434\u043E \u0438\u0441\u0445\u043E\u0434\u043D\u043E\u0433\u043E \u0440\u0430\u0437\u043C\u0435\u0440\u0430",settings_constrainWidth:"\u041E\u0433\u0440\u0430\u043D\u0438\u0447\u0438\u0432\u0430\u0442\u044C \u0448\u0438\u0440\u0438\u043D\u0443 \u043A\u043E\u043D\u0442\u0435\u043D\u0442\u0430",settings_newMediaViewer:"\u042D\u043A\u0441\u043F\u0435\u0440\u0438\u043C\u0435\u043D\u0442\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440\u0449\u0438\u043A \u043C\u0435\u0434\u0438\u0430",settings_hidePostBtn:"\u041A\u043D\u043E\u043F\u043A\u0438 \u0441\u043A\u0440\u044B\u0442\u0438\u044F \u043F\u043E\u0441\u0442\u043E\u0432",settings_endlessScroll:"\u0411\u0435\u0441\u043A\u043E\u043D\u0435\u0447\u043D\u0430\u044F \u043F\u0440\u043E\u043A\u0440\u0443\u0442\u043A\u0430",enterCaptcha:"\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043A\u0430\u043F\u0447\u0443.",selectText:"\u0422\u0435\u043A\u0441\u0442 \u043D\u0435 \u0432\u044B\u0434\u0435\u043B\u0435\u043D",dcls:"Double click to show source",watchOn:"\u0421\u043C\u043E\u0442\u0440\u0435\u0442\u044C \u043D\u0430",odc:"javascript:LatexIT.replaceWithSrc(this);",captcharot:"\u041A\u0430\u043F\u0447\u0430 \u043F\u0440\u043E\u0442\u0443\u0445\u043B\u0430",threadUpdationAutomatically:"\u0422\u0440\u0435\u0434 \u043E\u0431\u043D\u043E\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438",stopFuckingDolls:"<b>\u041E\u0442\u043A\u043B\u044E\u0447\u0438\u0442\u0435 AJAX-\u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0443 \u043F\u043E\u0441\u0442\u043E\u0432 \u0438 AJAX-\u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435 \u0442\u0440\u0435\u0434\u0430.</b><br />(\u041A\u043B\u0438\u043A\u043D\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0437\u0430\u043A\u0440\u044B\u0442\u044C)",del:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",delandban:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0438 \u0437\u0430\u0431\u0430\u043D\u0438\u0442\u044C",ban:"\u0417\u0430\u0431\u0430\u043D\u0438\u0442\u044C",stickthread:"\u041F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C \u0442\u0440\u0435\u0434",unstickthread:"\u041E\u0442\u043B\u0435\u043F\u0438\u0442\u044C \u0442\u0440\u0435\u0434",lockthread:"\u0417\u0430\u043A\u0440\u044B\u0442\u044C \u0442\u0440\u0435\u0434",unlockthread:"\u041E\u0442\u043A\u0440\u044B\u0442\u044C \u0442\u0440\u0435\u0434",returnDesktop:"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0438\u0442\u044C\u0441\u044F \u043D\u0430 \u0434\u0435\u0441\u043A\u0442\u043E\u043F\u043D\u044B\u0439 \u0438\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441",returnTouch:"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0438\u0442\u044C\u0441\u044F \u043D\u0430 \u0442\u0430\u0447-\u0438\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441",forceDesktop:"Force Desktop interface",okay:"\u042F\u0441\u043D\u043E",captchalang:"\u042F\u0437\u044B\u043A \u043A\u0430\u043F\u0447\u0438",reply:"\u041E\u0442\u0432\u0435\u0442\u0438\u0442\u044C",imageDownscaledBy:"\u041A\u0430\u0440\u0442\u0438\u043D\u043A\u0430 \u0443\u0436\u0430\u0442\u0430 \u043D\u0430",videoDownscaledBy:"\u0412\u0438\u0434\u0435\u043E \u0443\u0436\u0430\u0442\u043E \u043D\u0430",toFit:"\u043F\u043E \u0440\u0430\u0437\u043C\u0435\u0440\u0443 \u043E\u043A\u043D\u0430",newReplies:"\u041D\u043E\u0432\u044B\u0445 \u043E\u0442\u0432\u0435\u0442\u043E\u0432",newThreadsAvailable:"\u0414\u043E\u0441\u0442\u0443\u043F\u043D\u044B \u043D\u043E\u0432\u044B\u0435 \u0442\u0440\u0435\u0434\u044B.",loading:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C",anonymous:"\u0410\u043D\u043E\u043D\u0438\u043C",sortBy:"\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043F\u043E",bumpOrder:"\u0431\u0430\u043C\u043F\u0430\u043C",lastReply:"\u0434\u0430\u0442\u0435 \u043E\u0442\u0432\u0435\u0442\u043E\u0432",creationDate:"\u0434\u0430\u0442\u0435 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F",replyCount:"\u0447\u0438\u0441\u043B\u0443 \u043E\u0442\u0432\u0435\u0442\u043E\u0432",doStick:"\u041F\u0440\u0438\u043A\u0440\u0435\u043F\u043B\u044F\u0442\u044C",showHidden:"\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0441\u043A\u0440\u044B\u0442\u044B\u0435",doNotStick:"\u041D\u0435 \u043F\u0440\u0438\u043A\u0440\u0435\u043F\u043B\u044F\u0442\u044C",hideHidden:"\u0421\u043A\u0440\u044B\u0432\u0430\u0442\u044C \u0441\u043A\u0440\u044B\u0442\u044B\u0435",search:"\u041F\u043E\u0438\u0441\u043A",threadOnPage:"\u0422\u0440\u0435\u0434 \u0440\u0430\u0441\u043F\u043E\u043B\u0430\u0433\u0430\u0435\u0442\u0441\u044F \u043D\u0430 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0435",goToThread:"\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u0442\u0440\u0435\u0434",smallPics:"\u041C\u0435\u043B\u043A\u0438\u0435 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0438",largePics:"\u0411\u043E\u043B\u044C\u0448\u0438\u0435 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0438",legacyMode:"\u041E\u043B\u0434\u0444\u0430\u0436\u043D\u044B\u0439 \u0440\u0435\u0436\u0438\u043C",threads:"\u0422\u0440\u0435\u0434\u043E\u0432",comments:"\u041E\u0442\u0432\u0435\u0442\u043E\u0432",active_since:"\u041F\u0440\u0438\u0441\u043E\u0435\u0434\u0438\u043D\u0438\u043B\u0441\u044F",last_active:"\u0411\u044B\u043B \u0430\u043A\u0442\u0438\u0432\u0435\u043D",active_on:"\u0410\u043A\u0442\u0438\u0432\u0435\u043D \u043D\u0430",tryAgain:"\u041F\u043E\u043F\u0440\u043E\u0431\u043E\u0432\u0430\u0442\u044C \u0441\u043D\u043E\u0432\u0430",xhrError:"\u041E\u0448\u0438\u0431\u043A\u0430 XHR",details:"\u043F\u043E\u0434\u0440\u043E\u0431\u043D\u043E\u0441\u0442\u0438",thread:"\u0422\u0440\u0435\u0434",post:"\u041F\u043E\u0441\u0442",posts:"\u041F\u043E\u0441\u0442\u044B",deleted:"\u0443\u0434\u0430\u043B\u0435\u043D",deletedMulti:"\u0443\u0434\u0430\u043B\u0435\u043D\u044B",report:"\u041F\u043E\u0436\u0430\u043B\u043E\u0432\u0430\u0442\u044C\u0441\u044F",reported:": \u0436\u0430\u043B\u043E\u0431\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430",reportedMulti:": \u0436\u0430\u043B\u043E\u0431\u044B \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u044B",fileRemoved:"\u0424\u0430\u0439\u043B<br>\u0443\u0434\u0430\u043B\u0435\u043D.",file:"\u0424\u0430\u0439\u043B",files:"\u0424\u0430\u0439\u043B\u044B",collapse:"\u0421\u0432\u0435\u0440\u043D\u0443\u0442\u044C",asMod:"\u043E\u0442 \u043B\u0438\u0446\u0430 \u043C\u043E\u0434\u0435\u0440\u0430\u0442\u043E\u0440\u0430",asOP:"\u043E\u0442 \u043B\u0438\u0446\u0430 \u041E\u041F\u0430",historyEmpty:"\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u043F\u0443\u0441\u0442\u0430",noDataLoaded:"\u0414\u0430\u043D\u043D\u044B\u0435 \u043D\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u044B",unable_load_20:"Unable to load 2.0 boards list",captchaLangChanged:"\u042F\u0437\u044B\u043A \u043A\u0430\u043F\u0447\u0438 \u0438\u0437\u043C\u0435\u043D\u0435\u043D",found:"\u041D\u0430\u0439\u0434\u0435\u043D\u043E",links:"\u0421\u0441\u044B\u043B\u043A\u0438",selectMultiple:"\u0412\u044B\u0431\u0440\u0430\u0442\u044C \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E",selected:"\u0412\u044B\u0431\u0440\u0430\u043D\u043E",directLink:"\u041F\u0440\u044F\u043C\u0430\u044F \u0441\u0441\u044B\u043B\u043A\u0430 \u043D\u0430 \u043F\u043E\u0441\u0442",quoteLink:"\u0421\u0441\u044B\u043B\u043A\u0430 \u0434\u043B\u044F \u0446\u0438\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F",maxAttNumReached:"\u041F\u0440\u0435\u0432\u044B\u0448\u0435\u043D\u043E \u0434\u043E\u043F\u0443\u0441\u0442\u0438\u043C\u043E\u0435 \u0447\u0438\u0441\u043B\u043E \u0432\u043B\u043E\u0436\u0435\u043D\u0438\u0439.",unsupportedFileType:"\u043D\u0435\u0434\u043E\u043F\u0443\u0441\u0442\u0438\u043C\u044B\u0439 \u0442\u0438\u043F \u0444\u0430\u0439\u043B\u0430",hideName:"\u0421\u043A\u0440\u044B\u0442\u044C \u0438\u043C\u044F \u0444\u0430\u0439\u043B\u0430",removeFile:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u0430\u0439\u043B",spoilerOnOff:"\u0421\u043F\u043E\u0439\u043B\u0435\u0440 \u0412\u043A\u043B/\u0412\u044B\u043A\u043B",hidePost:"\u0421\u043A\u0440\u044B\u0442\u044C \u043F\u043E\u0441\u0442",unhidePost:"\u0420\u0430\u0441\u043A\u0440\u044B\u0442\u044C \u043F\u043E\u0441\u0442",settings_hideCompletely:"\u0421\u043A\u0440\u044B\u0432\u0430\u0442\u044C \u0442\u0440\u0435\u0434\u044B \u0438 \u043F\u043E\u0441\u0442\u044B \u043F\u043E\u043B\u043D\u043E\u0441\u0442\u044C\u044E",pinUnpin:"\u041F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C/\u041E\u0442\u043A\u0440\u0435\u043F\u0438\u0442\u044C",hideForm:"\u0421\u043A\u0440\u044B\u0442\u044C \u0444\u043E\u0440\u043C\u0443",collapseExpand:"\u0421\u0432\u0435\u0440\u043D\u0443\u0442\u044C/\u0420\u0430\u0437\u0432\u0435\u0440\u043D\u0443\u0442\u044C",notEmpty:"\u0421\u043E\u0434\u0435\u0440\u0436\u0438\u0442 \u0434\u0430\u043D\u043D\u044B\u0435",showName:"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C/\u0441\u043A\u0440\u044B\u0442\u044C \u043F\u043E\u043B\u0435 \u0438\u043C\u0435\u043D\u0438",showSubject:"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C/\u0441\u043A\u0440\u044B\u0442\u044C \u043F\u043E\u043B\u0435 \u0442\u0435\u043C\u044B",showEmbeds:"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C/\u0441\u043A\u0440\u044B\u0442\u044C \u0432\u043B\u043E\u0436\u0435\u043D\u0438\u044F",showPassword:"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C/\u0441\u043A\u0440\u044B\u0442\u044C \u043F\u043E\u043B\u0435 \u0432\u0432\u043E\u0434\u0430 \u043F\u0430\u0440\u043E\u043B\u044F",showTTL:"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C/\u0441\u043A\u0440\u044B\u0442\u044C \u0432\u0440\u0435\u043C\u044F \u0436\u0438\u0437\u043D\u0438",attachFile:"\u041F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C \u0444\u0430\u0439\u043B...",classicSimplifiedForm:"\u0423\u043F\u0440\u043E\u0449\u0435\u043D\u043D\u0430\u044F/\u043A\u043B\u0430\u0441\u0441\u0438\u0447\u0435\u0441\u043A\u0430\u044F \u0444\u043E\u0440\u043C\u0430",showMarkup:"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C/\u0441\u043A\u0440\u044B\u0442\u044C \u0440\u0430\u0437\u043C\u0435\u0442\u043A\u0443",refreshCatalog:"\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u043A\u0430\u0442\u0430\u043B\u043E\u0433",cancelTimer:"\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C \u0442\u0430\u0439\u043C\u0435\u0440",saved:"\u0441\u043F\u0430\u0441\u0435\u043D \u043E\u0442 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F",savedMulti:"\u0441\u043F\u0430\u0441\u0435\u043D\u044B \u043E\u0442 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F",password:"\u041F\u0430\u0440\u043E\u043B\u044C",captcha:"Captcha",captchaImage:"Captcha image",refreshCaptcha:"\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u043A\u0430\u043F\u0447\u0443",showCaptcha:"\u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u043A\u0430\u043F\u0447\u0443",captchaExpired:"\u041A\u0430\u043F\u0447\u0430 \u043F\u0440\u043E\u0442\u0443\u0445\u043B\u0430.",mod_:"\u041C\u043E\u0434.",expandAllImages:"\u0420\u0430\u0437\u0432\u0435\u0440\u043D\u0443\u0442\u044C \u0432\u0441\u0435 \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0438",getDownloadList:"\u0421\u043F\u0438\u0441\u043E\u043A \u043C\u0435\u0434\u0438\u0430 \u0434\u043B\u044F \u0441\u043A\u0430\u0447\u0438\u0432\u0430\u043D\u0438\u044F"}},_l="undefined"!=typeof locale&&_messages.hasOwnProperty(locale)?_messages[locale]:_messages.ru,onReady={pushTask:function pushTask(e){this.isReady?e():this.tasks.push(e)},tasks:[],ready:function ready(){this.isReady=!0,this.tasks.forEach(function(e){return e()})}};Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=Math.floor,a=Math.ceil,n=this.length,s=+arguments[1]||0;for(s=0>s?a(s):t(s),0>s&&(s+=n);s<n;s++)if(s in this&&this[s]===e)return s;return-1});var Utf8={encode:function encode(e){var t=String.fromCharCode;e=e.replace(/\r\n/g,"\n");for(var a,s="",i=0;i<e.length;i++)a=e.charCodeAt(i),128>a?s+=t(a):127<a&&2048>a?(s+=t(192|a>>6),s+=t(128|63&a)):(s+=t(224|a>>12),s+=t(128|63&a>>6),s+=t(128|63&a));return s},decode:function decode(e){for(var t=String.fromCharCode,a="",n=0,s=0,o=0,r=0;n<e.length;)s=e.charCodeAt(n),128>s?(a+=t(s),n++):191<s&&224>s?(o=e.charCodeAt(n+1),a+=t((31&s)<<6|63&o),n+=2):(o=e.charCodeAt(n+1),r=e.charCodeAt(n+2),a+=t((15&s)<<12|(63&o)<<6|63&r),n+=3);return a}};function Cookie(e){if(1==arguments.length){var t=new RegExp("(^|;\\s+)"+e+"=(.*?)(;|$)"),a=t.exec(document.cookie);return a&&2<a.length?Utf8.decode(unescape(replaceAll(a[2],"+","%20"))):""}var n=arguments[1],s=arguments[2],i="";if(s){var o=new Date;o.setTime(o.getTime()+1e3*(60*(60*(24*s)))),i="; expires="+o.toGMTString()}document.cookie=e+"="+n+i+"; path=/"}function replaceAll(e,t,a){for(var n=e.indexOf(t);-1<n;)e=e.replace(t,a),n=e.indexOf(t);return e}var _lastActiveForm=!1;Object.defineProperty(window,"lastActiveForm",{get:function get(){return _lastActiveForm&&_lastActiveForm.getClientRects().length||updateActiveForm(),_lastActiveForm},set:function set(e){if(document.querySelectorAll(".qrf-active").forEach(function(e){return e.classList.remove("qrf-active")}),e){var t=e._findParent("form");t.classList.add("qrf-active"),t.classList.contains("collapsed")&&toggleFormCollapse(t,!1,!1),_lastActiveForm=t}else _lastActiveForm=!1}});function updateActiveForm(){var e=document.querySelector(".qrf-floating:not(.collapsed)");return e?void(lastActiveForm=e):void(lastActiveForm=findClosest(".qrf-floating.collapsed, .quick-reply-form textarea"))}function findClosest(e){var t=window.innerHeight,a=document.querySelectorAll(e);if(!a)return!1;var n=[].map.call(a,function(e){var a=e.getClientRects(),n=a.length?Math.abs(t/2-(a[0].y+a[0].height/2)):null;return{el:e,offset:n}}).filter(function(e){return null!==e.offset}).sort(function(e,t){return e.offset<t.offset?-1:1});return!!n.length&&n[0].el}function insert(e){var t=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],a=!(2<arguments.length&&arguments[2]!==void 0)||arguments[2],n=lastActiveForm||document.querySelector("#postform"),s=n&&n.querySelector("textarea");if(s){n.classList.contains("collapsed")&&toggleFormCollapse(n,!1,!1);var i=s.selectionStart,o=s.selectionEnd,r=s.value.substr(0,i),l=s.value.substr(o),d=r[r.length-1],c=l[0];t&&"\n"!==e[0]&&d&&"\n"!==d&&(e="\n"+e),a&&"\n"!==e[e.length-1]&&"\n"!==c&&(e+="\n");var p=i+e.length;s.value=r+e+l,s.setSelectionRange(p,p),s.focus()}}function markup(e,t,a,n,s){var i=e.find("textarea").get(0);if(i.selectionStart||"0"==i.selectionStart){i.focus();var o=i.selectionStart,r=i.selectionEnd,l=i.value.substring(o,r);-1===l.indexOf("\n")&&"undefined"!=typeof n&&"undefined"!=typeof s&&(t=n,a=s),i.value=i.value.substring(0,o)+t+i.value.substring(o,r)+a+i.value.substring(r,i.value.length)}else i.value+=t+a}function bullets(e,t,a,n){var s=e.find("textarea"),o=s[0],r=o.selectionStart,l=o.selectionEnd,d=s.val().substring(r,l);if(!~d.indexOf("\n")&&"undefined"!=typeof a&&"undefined"!=typeof n)o.value=o.value.substring(0,r)+a+o.value.substring(r,l)+n+o.value.substring(l,o.value.length);else{d=s.val().substring(r,l).split("\n");for(var c="",p=0;p<d.length;p++)c+=t+d[p],p<d.length-1&&(c+="\n");s.val(s.val().substring(0,r)+c+s.val().substring(l))}}function quotes(e,t){var a=e.find("textarea"),n=a.val(),s=a[0],o=s.selectionStart,r=s.selectionEnd,l=n.substring(o,r),d="";if(~l.indexOf("\n")){l=n.substring(o,r).split("\n");for(var c,p=0;p<l.length;p++)c="g"==t?">":"r"==t?"<":p%2?"<":">",d+=c+" "+l[p],p<l.length-1&&(d+="\n")}else{var u="r"==t?"rq":"q";d="[".concat(u,"]").concat(l,"[/").concat(u,"]")}s.value=n.substring(0,o)+d+n.substring(r)}function quote(b,a){var v=eval("document."+a+".message");v.value+=">>"+b+"\n",v.focus()}function checkhighlight(){var e;(e=/#i([0-9]+)/.exec(document.location.toString()))&&!$("#postform textarea").val()&&insert(">>"+e[1]),(e=/#([0-9]+)/.exec(document.location.toString()))&&highlight(e[1])}function highlight(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:5e3;$(".highlight").removeClass("highlight"),(""+e).split("-")[1]||(e+="-"+this_board_dir);var a=$("#postbody".concat(e)).parents(".reply");if(!a.length)return!1;var n=a[0];a.addClass("highlight"),t&&setTimeout(function(){return a.removeClass("highlight")},t);var s=n.getBoundingClientRect(),i=document.documentElement.clientHeight;if(s.bottom>i||0>s.top){var o=s.top+document.documentElement.scrollTop,r=i-s.height;window.scrollTo(0,o-(r?Math.ceil(r/2):0))}return!0}var password_length=20;function get_password(e){var t=getCookie(e);return t?t:(t=randomString(password_length),Cookie(e,t,365),t)}function togglePassword(){var e=$("#passwordbox").html().toLowerCase(),t="<td></td><td></td>";return e==t&&(t="<td class=\"postblock\">Mod</td><td><input type=\"text\" name=\"modpassword\" size=\"28\" maxlength=\"75\">&nbsp;<acronym title=\"Display staff status (Mod/Admin)\">D</acronym>:&nbsp;<input type=\"checkbox\" name=\"displaystaffstatus\" checked>&nbsp;<acronym title=\"Lock\">L</acronym>:&nbsp;<input type=\"checkbox\" name=\"lockonpost\">&nbsp;&nbsp;<acronym title=\"Sticky\">S</acronym>:&nbsp;<input type=\"checkbox\" name=\"stickyonpost\">&nbsp;&nbsp;<acronym title=\"Raw HTML\">RH</acronym>:&nbsp;<input type=\"checkbox\" name=\"rawhtml\">&nbsp;&nbsp;<acronym title=\"Name\">N</acronym>:&nbsp;<input type=\"checkbox\" name=\"usestaffname\"></td>"),$("#passwordbox").html(t).show(),!1}function getCookie(e){return Cookie(e)}function set_cookie(e,t,a){return Cookie(e,t,a)}var Styles={all:[],titles:[],init:function init(){_.each(document.getElementsByTagName("link"),function(e){-1!=e.getAttribute("rel").indexOf("style")&&e.getAttribute("title")&&(this.all.push(e),this.titles.push(e.getAttribute("title")),-1===e.getAttribute("rel").indexOf("alternate")&&(this._default=e.getAttribute("title")),e.hasAttribute("data-custom")&&(this.custom=e.getAttribute("title")))},this),this.current=this._default;var e=getCookie("bypasscustom");this.customBypass=!!(e.length&&"undefined"!=typeof this_board_dir&&in_array(this_board_dir,e.split("|"))),this.initiated=!0},decide:function decide(){this.init();var e=LSfetchJSON("testing-css");if(e){var t=this.addStyle(e.url,e.title);this.setStyle(t);var a=$("<a href=\"#\">\u041E\u0442\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0442\u0435\u0441\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 "+t+".css</a>");return a.click(function(e){e.preventDefault(),Styles.quitTest(),$(this).parent().slideUp()}),void(this.$cancelLink=$("<div style=\"font-weight: bold\"></div>").append(a))}if(this.hasOwnProperty("custom")&&!this.customBypass)return this.setCustom();var n=getCookie(style_cookie);n&&in_array(n,this.titles)?this.setStyle(n):(this.setDefault(),set_cookie("kustyle_site",this._default,365),set_cookie("kustyle",this._default,365))},change:function change(e){in_array(e,this.titles)&&this.current!==e&&(this.setStyle(e),this.hasOwnProperty("custom")&&this.custom===e?this.removeBypass():(this.hasOwnProperty("custom")&&this.addBypass(),set_cookie("kustyle_site",e,365),set_cookie("kustyle",e,365)))},removeBypass:function removeBypass(){if(this.customBypass&&"undefined"!=typeof this_board_dir){this.customBypass=!1;var e=getCookie("bypasscustom").split("|"),t=[];_.each(e,function(e){e!==this_board_dir&&t.push(e)}),t=t.length?t.join("|"):"",set_cookie("bypasscustom",t,365)}},addBypass:function addBypass(){if(!(this.customBypass||"undefined"==typeof this_board_dir)){this.customBypass=!0;var e=getCookie("bypasscustom").split("|");in_array(this_board_dir,e)||(e.push(this_board_dir),set_cookie("bypasscustom",e.join("|"),365))}},setDefault:function setDefault(){this.hasOwnProperty("_default")&&this.current!==this._default&&this.setStyle(this._default)},setCustom:function setCustom(){this.hasOwnProperty("custom")&&this.setStyle(this.custom)},setStyle:function setStyle(e){in_array(e,this.titles)&&(scrollAnchor&&scrollAnchor.save&&scrollAnchor.save("setstyle",".postnode"),_.each(this.all,function(e){e.disabled=!0,e.setAttribute("rel","alternate stylesheet")}),_.each(this.all,function(t){t.getAttribute("title")===e&&requestAnimationFrame(function(){t.disabled=!1,t.setAttribute("rel","stylesheet")})}),scrollAnchor&&scrollAnchor.restore&&scrollAnchor.restore("setstyle"),this.current=e)},onTest:null,addStyle:function addStyle(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";if(!t){var a=/(?:.+\/)?(.+)\.css/i.exec(e);if(!a)return;t=a[1]}if(t=_.capitalize(_.escape(t)),!in_array(t,this.titles)){var n=$("<link rel=\"stylesheet\" type=\"text/css\" href=\""+e+"\" title=\""+t+"\" disabled>");$("head").append(n),this.titles.push(t),this.all.push(n[0])}return t},testStyle:function testStyle(e,t){t=this.addStyle(e,t),this.setStyle(t),this.onTest={url:e,title:t},pups.succ("\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D \u0441\u0442\u0438\u043B\u044C ".concat(t,".\n      <div class=\"styletest-form\">\n        <button onclick=\"Styles.confirmLongTermTest()\">OK</button>\n        <button onclick=\"Styles.quitTest()\">").concat(_l.cancel,"</button>\n      </div>"),{time:0,save:!0})},confirmLongTermTest:function confirmLongTermTest(){this.onTest&&localStorage.setItem("testing-css",JSON.stringify(this.onTest))},quitTest:function quitTest(){localStorage.removeItem("testing-css"),this.decide()}};style_cookie&&Styles.decide();var HiddenItems={init:function init(){var e=this;this.hideCompletely="true"==localStorage["hideCompletely."+this_board_dir],["posts","threads"].forEach(function(t){var a=localStorage["hidden".concat(_.capitalize(t))],n=a?a.split(",").filter(function(e){return e}):[];e.lists[t]=n}),document.write("<style id=\"injector:hideitems\">".concat(this.buildCSS(),"</style>"))},buildCSS:function buildCSS(){var e=this,t=[],a=[],n=[];return["posts","threads"].forEach(function(s){e.lists[s].forEach(function(i){if("posts"==s){var o="#postnode".concat(i);n.push(o),e.hideCompletely?a.push(o):a.push("#postbody".concat(i))}else ispage&&(a.push("#thread".concat(i)),e.hideCompletely?(a.push("#unhidethread".concat(i)),a.push("#thread".concat(i," + br")),a.push("#thread".concat(i," + br + hr"))):t.push("#unhidethread".concat(i)))})}),n.length&&onReady.pushTask(function(){$(n.join(",")).addClass("post-hidden")}),(a.length?a.join(",")+"{ display: none }":"")+(t.length?t.join(",")+"{ display: inline-block }":"")},updateCSS:function updateCSS(){injector.inject("hideitems",this.buildCSS())},hideCompletely:!1,lists:{},isHidden:function isHidden(e,t){return-1!=this.lists[e+"s"].indexOf(t.toString())},hideItem:function hideItem(e,t){this.isHidden(e,t)||(this.lists[e+"s"].push(t),this.saveList(e))},unhideItem:function unhideItem(e,t){this.isHidden(e,t)&&(this.lists[e+"s"]=this.lists[e+"s"].filter(function(e){return e!=t}),this.saveList(e))},hideThread:function hideThread(e){!!(1<arguments.length&&arguments[1]!==void 0)&&arguments[1];this.hideItem("thread",e),$("#unhidethread"+e).slideDown();var t=$("#thread"+e),a=t.find(".qrf-floating");t.slideUp().promise().done(updateActiveForm),a.length&&toggleFormFloating(a[0],!1,!1)},unhideThread:function unhideThread(e){!!(1<arguments.length&&arguments[1]!==void 0)&&arguments[1];this.unhideItem("thread",e),$("#thread"+e).slideDown(),$("#unhidethread"+e).slideUp()},hidePost:function hidePost(e){this.hideItem("post",e),$("#postbody"+e).slideUp("fast")},unhidePost:function unhidePost(e){this.unhideItem("post",e),$("#postbody"+e).slideDown("fast")},togglePost:function togglePost(e){var t=$("#postbody"+e),a=t.parent().find(".hide-post-btn");"none"==t.css("display")?(this.unhidePost(e),a.attr("title",_l.hidePost).find("use").attr("xlink:href","#i-hide")):(this.hidePost(e),a.attr("title",_l.unhidePost).find("use").attr("xlink:href","#i-unhide"))},saveList:function saveList(e){localStorage["hidden".concat(_.capitalize(e),"s")]=this.lists[e+"s"].join(",")}};HiddenItems.init();function expandthread(e,t,a){a.preventDefault();var n=$("#thread".concat(e,"-").concat(t));if(n.length){var s=+n.find(".postnode.op").data("id"),i=+n.find(".postnode:not(.op):first").data("id"),o=n.find(".omittedposts");o.find("a").hide(),o.find("span").length?o.find(".spinner").show():$("<div class=\"spinner\"></div><span>".concat(_l.loading,"...</span>")).prependTo(o),HTMLoader.getThread(t,+e,[s,i],function(e,t){t?(n.find(".omittedposts").replaceWith(t),replyMap.showReplies()):(setTimeout(function(){return o.find(".spinner").hide()},1e3),o.find("span").text(_l.oops+(!1===e?"":" (".concat(e,")"))),o.find("a").text(_l.tryAgain).show())})}return!1}var newposts={busy:!1,get:function get(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(e=_.defaults(e,{threadid:null,expectedPost:null,silent:!1,onError:function onError(e){return pups.err("Error geting new posts (".concat(e,")"))},onSuccess:null,timestamp:null}),!e.threadid){if(ispage)return e.onError();e.threadid=+$("input[name=replythread]").val()}return this.pushTask(e),!1},execute:function execute(e){var t=this;this.busy=!0;var a=""+e.threadid,n=e.expectedPost,s=function(a){t.next(),e.onError(a)};a.split("-")[1]||(a+="-"+this_board_dir);var i,o;if(!ispage)o=$("#newposts_get"),o.removeClass("upd-counting").addClass("upd-updating"),i=document.querySelector(".replies");else if(i=document.querySelector("#thread".concat(a," .replies")),!i)return s("No replies container!");if(n&&highlight(n))return o.removeClass("upd-updating"),void this.next();var r=$(".qrl[data-parent=\"".concat(a,"\"]")).last(),l=(r.data("postnum")||r.data("parent"))+"";if(!l)return s();var d=a.split("-"),c=d[0],p=d[1];HTMLoader.getThread(p,c,[+l.split("-")[0],1/0],function(a,r){return ispage||o.removeClass("upd-updating"),r?(i.insertAdjacentHTML("beforeend",r),replyMap.showReplies(),unreadCounter.refreshTimestamp(e.timestamp||null,p),e.onSuccess&&e.onSuccess()):!e.silent&&pups.info(""===r?_l.noNewPosts:_l.oops+(!1===a?"":" (".concat(a,")")),{time:1}),n&&!highlight(n)?s("No target reply!"):void t.next()},!1,!0)},pushTask:function pushTask(e){this.busy?this.stack.push(e):this.execute(e)},next:function(){var e=this.stack.shift();e?this.execute(e):this.busy=!1},stack:[]};function flyTo(e,t){var a=t.getBoundingClientRect(),n=a.x+a.width/2,s=a.y+a.height/2,i=e.getBoundingClientRect();return e.style.transformOrigin="".concat(n-i.x+"px"," ").concat(s-i.y+"px"),e.classList.add("fly-to-zero"),new Promise(function(t){setTimeout(function(){e.classList.remove("fly-to-zero"),e.style.transformOrigin=null,t(e)},1e3*+getComputedStyle(e).transition.match(/transform ([0-9\.]+)/)[1]+100)})}function toggleFormCollapse(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!e.classList.contains("collapsed"),a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!t,n=e.getBoundingClientRect(),s=n.right-(window.innerWidth-32);e.classList.toggle("collapsed",t);var i=e.getBoundingClientRect(),o=i.width;e.style.left=i.left+(n.width-o)-(0<s?s:0)+"px",e.querySelector(".collapser").classList.toggle("collapsed",t),a&&e.querySelector("textarea").focus()}function toggleFormRow(e,t){var a=t.dataset.toggle,n=e.querySelector(".".concat(t.dataset.toggle,"-row"));if(n){var s=n.classList.toggle("row-shown");t.querySelector("svg").classList.toggle("pressed",s);var o=s?0:isRowEmpty(n,a);if(t.classList.toggle("button-with-reminder",o),o?(!t._originalTitle&&(t._originalTitle=t.title),t.title="".concat(t._originalTitle," (").concat(_l.notEmpty,")")):t._originalTitle&&(t.title=t._originalTitle),s){var r=null;if("subject-send"==a){var l=e.querySelector("input[name=subject]");l.value||(r=l)}if("name"==a){var i=e.querySelector("input[name=name]");i.value||i.disabled||(r=i)}if("embed"==a){var d=[].filter.call(e.querySelectorAll("input[type=text][name^=embed]"),function(e){return e.getClientRects().length&&!e.value});d.length&&(r=d[0])}r&&r.focus()}}}function isRowEmpty(e,t){return!!("name"==t&&""!=e.querySelector("input[name=name]").value&&!e.querySelector("input[name=disable_name]").checked||"subject-send"==t&&""!=e.querySelector("input[name=subject]").value||"embed"==t&&[].find.call(e.querySelectorAll("input[type=text]"),function(e){return e.value.trim()})||"ttl"==t&&e.querySelector("input[name=ttl-enable]").checked)}function updateReminders(e){["name","subject-send","embed","ttl"].forEach(function(t){var a=e.querySelector(".".concat(t,"-row:not(.row-shown)")),n=a&&e.querySelector(".simplified-toggle[data-toggle=\"".concat(t,"\"]"));n&&n.classList.toggle("button-with-reminder",isRowEmpty(a,t))})}function toggleFormFloating(e,t){var a=!(2<arguments.length&&arguments[2]!==void 0)||arguments[2],n=e.querySelector(".pinner");n.classList.toggle("pinned",!t),n.classList.toggle("unpinned",t),t?(scrollAnchor.save("toggleFormFloating",e.getParentPost()),document.querySelectorAll(".qrf-floating").forEach(function(e){return toggleFormFloating(e,!1)}),scrollAnchor.restore("toggleFormFloating").then(function(){var t=e.getBoundingClientRect();e.classList.add("qrf-floating"),e.classList.remove("qrf-builtin","qrf-builtin-back"),e.style.top=t.top+"px",e.style.left=t.left+"px",$(e).drags().find("input, textarea, select, label, .fe-sort-wrapper, button, .b-icon").mousedown(function(t){t.stopPropagation()})})):(e.classList.remove("qrf-floating","collapsed"),e.querySelector(".collapser").classList.remove("collapsed"),e.classList.add("qrf-builtin","qrf-builtin-back"),$(e).dragsOff(),["top","left","zIndex"].forEach(function(t){return e.style[t]=null})),a&&e.querySelector("textarea").focus()}function hidePostForm(e){if(e.classList.add("hidden"),toggleFormFloating(e,!1),toggleFormCollapse(e,!1),setTimeout(function(){e.classList.remove("qrf-builtin-back")},200),e._preview){var t=e._preview.querySelector(".pinner");t&&(t.classList.remove("pinned"),t.classList.add("unpinned")),e._preview._pinned=!1}updateActiveForm()}function toggleFormSimplify(e,t){var a=e.classList.toggle("postform-simplified",t);a&&updateReminders(e)}function clonePostForm(e,t){var a=!!(2<arguments.length&&arguments[2]!==void 0)&&arguments[2];return new Promise(function(n){HTMLoader.getPostbox(a).then(function(a){Captcha.enabled&&(Captcha.state="init");var s=a.cloneNode(!0);s.id=e+"_qrf",s.dataset.anchorID=e,s.classList.remove("main-reply-form"),s.querySelector(".simplified-send-row .primary span").innerText=_l.reply,s.querySelector("input[name=\"postpassword\"]").value=get_password("postpassword"),s.querySelector("input.primary").value=_l.reply,s.querySelector(".noko-row").remove();var i=s.querySelector(".blotter-row");t&&(s._preview=t),i.insertAdjacentHTML("afterend","\n        <span class=\"extrabtns simplified-extras\">\n          ".concat(s.querySelector(".name-row")?"\n            <a href=\"#\" class=\"simplified-toggle\" data-toggle=\"name\" title=\"".concat(_l.showName,"\">\n              <svg class=\"icon b-icon\"><use xlink:href=\"#i-name\"></use></svg>\n            </a>\n          "):"","\n          <a href=\"#\" class=\"simplified-toggle\" data-toggle=\"subject-send\" title=\"").concat(_l.showSubject,"\">\n            <svg class=\"icon b-icon\"><use xlink:href=\"#i-subject\"></use></svg>\n          </a>\n          <a href=\"#\" class=\"s-markup\" data-toggle=\"password\" title=\"").concat(_l.showMarkup,"\">\n            <svg class=\"icon b-icon\"><use xlink:href=\"#i-markup\"></use></svg>\n          </a>\n          ").concat(s.querySelector(".embed-row")?"\n            <a href=\"#\" class=\"simplified-toggle\" data-toggle=\"embed\" title=\"".concat(_l.showEmbeds,"\">\n              <svg class=\"icon b-icon\"><use xlink:href=\"#i-embed\"></use></svg>\n            </a>\n          "):"","\n          <a href=\"#\" class=\"simplified-toggle\" data-toggle=\"password\" title=\"").concat(_l.showPassword,"\">\n            <svg class=\"icon b-icon\"><use xlink:href=\"#i-password\"></use></svg>\n          </a>\n          ").concat(s.querySelector(".ttl-row")?"\n            <a href=\"#\" class=\"simplified-toggle\" data-toggle=\"ttl\" title=\"".concat(_l.showTTL,"\">\n              <svg class=\"icon b-icon\"><use xlink:href=\"#i-timer\"></use></svg>\n            </a>\n          "):"","\n        </span>")),updateReminders(s),s.querySelectorAll(".simplified-toggle").forEach(function(e){e.onclick=function(t){t.preventDefault(),toggleFormRow(s,e)}}),s.querySelector(".s-markup").onclick=function(e){e.preventDefault(),this.querySelector(".icon").classList.toggle("pressed"),s.querySelector(".message-row").classList.toggle("markup-enabled")},i.remove();var o="_"+_.uniqueId();s.querySelectorAll("label").forEach(function(e){var t=e.getAttribute("for"),a=t+o,n=s.querySelector("#"+t);n&&(n.id=a),e.setAttribute("for",a)}),s.classList.add("quick-reply-form"),s.classList.add("postform-simplified"),resetForm(s,!0),richFileInput.initForm(s),s.insertAdjacentHTML("beforeend","\n        <span class=\"extrabtns postboxcontrol\">\n          <svg class=\"icon form-handle-icon\"><use xlink:href=\"#i-handle\"></use></svg>\n          <a href=\"#\" title=\"".concat(_l.classicSimplifiedForm,"\" class=\"simplify-qr-form\">\n            <svg class=\"icon b-icon\">\n              <use class=\"use-simplify\" xlink:href=\"#i-simplify\"></use>\n              <use class=\"use-complicate\" xlink:href=\"#i-complicate\"></use>\n            </svg>\n          </a>\n          <a href=\"#\" title=\"").concat(_l.collapseExpand,"\" class=\"collapse-qr-form collapser\">\n            <svg class=\"icon b-icon\">\n              <use class=\"use-collapse\" xlink:href=\"#i-collapse\"></use>\n              <use class=\"use-uncollapse\" xlink:href=\"#i-uncollapse\"></use>\n            </svg>\n          </a>\n          <a href=\"#\" class=\"pinner\" title=\"").concat(_l.pinUnpin,"\">\n            <svg class=\"icon b-icon\">\n              <use class=\"use-pin\" xlink:href=\"#i-float\"></use>\n              <use class=\"use-unpin\" xlink:href=\"#i-unfloat\"></use>\n            </svg>\n          </a>\n          &nbsp;\n          <a href=\"#\" title=\"").concat(_l.hideForm,"\" class=\"hide-qr-form\">\n            <svg class=\"icon b-icon\"><use xlink:href=\"#i-x\"></use></svg>\n          </a>\n        </span>")),s.getParentPost=function(){var e=s._findPrevious("*:not(.i0svcel)");return e.matches(".postnode")?e:null},s.querySelector(".hide-qr-form").onclick=function(e){e.preventDefault();var t=!1;if(s.classList.contains("qrf-floating")){var a=s.getParentPost();a&&(flyTo(s,a.querySelector("a.qrl .b-icon")).then(hidePostForm),t=!0)}t||hidePostForm(s)},s.querySelector(".simplify-qr-form").onclick=function(e){e.preventDefault(),toggleFormSimplify(s)},s.querySelector(".pinner").onclick=function(e){e.preventDefault();var t=s.classList.contains("qrf-builtin");toggleFormFloating(s,t)},s.querySelector(".collapse-qr-form").onclick=function(e){e.preventDefault(),toggleFormCollapse(s)},s.querySelectorAll("a").forEach(function(e){e.ondragstart=function(){return!1},e.ondrop=function(){return!1}}),initForm(s),n(s)})})}function quickreply(){var e=$(this),t=e.data("parent"),a=$(this).data("postnum")||t.split("-")[0],n=e.parents(".postnode"),s=n.data("board"),i=!is_overboard&&s!=this_board_dir,o=n[0],r=n.parents(".reflinkpreview"),l=!0,d=o._findNext("*:not(.i0svcel)"),c=d&&"postform"==d.getAttribute("name"),p=c&&d.classList.contains("hidden"),u=c&&d.classList.contains("qrf-floating"),m=o._findParent(".reflinkpreview"),h=l?getPostQuotation(o.querySelector(".postbody")):"";return c?(u?(toggleFormCollapse(d,!1),toggleFormFloating(d,!1)):(p?d.classList.remove("hidden"):(hidePostForm(d),p=!0),p=!p),l=!1):(e.addClass("spin-around"),clonePostForm(o.id||o.parentElement.id,m,!!is_overboard&&s).then(function(n){e.removeClass("spin-around"),n.classList.add("qrf-builtin"),n.querySelector(".pinner").classList.toggle("pinned"),n.querySelector("input[name=replythread]").value=t,o.insertAdjacentElement("afterend",n),document.querySelectorAll(".qrf-floating:not(.collapsed)").forEach(function(e){return toggleFormCollapse(e)}),n.querySelector("textarea").focus(),l&&insert(">>".concat(i?"/".concat(s,"/"):"").concat(a,"\n").concat(h)),m&&!m._pinned&&o.querySelector(".pinner").click()})),!1}function _getSelection(){if(!window.getSelection)return null;var e=window.getSelection();if("Range"!==e.type)return null;var t=e.toString();return t?{text:t,node:e.anchorNode}:null}function getLocalSelection(e){var t=_getSelection();return t&&t.node._isChildOf(e)?t.text:null}function getPostQuotation(e){var t=getLocalSelection(e);return t?(t=t.replace(/^\s/,"").replace(/\s$/,"").replace(/^>/gm," >").replace(/^/gm,"> "),t||""):""}function popupMessage(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1e3;pups.info(e,{time:t/1e3}),console.warn("popupMessage() is deprecated. Please use YOBA alerts instead.")}var Captcha={init:function init(){var e=!!(0<arguments.length&&arguments[0]!==void 0)&&arguments[0],t=document.querySelector(".captchaimage");this.enabled=e||!!t;this.enabled&&(injector.inject("captcha-rotting",".cw-running .rotting-indicator {\n      -webkit-animation-duration: ".concat(captchaTimeout,"s;\n              animation-duration: ").concat(captchaTimeout,"s;\n    }\n    .cw-running .captchaimage,\n    .cw-running .rotten-msg {\n      -webkit-animation-delay: ").concat(captchaTimeout,"s;\n              animation-delay: ").concat(captchaTimeout,"s;}")),t&&this.addImgLoadListener(t))},initForm:function(e){var t=this,a=e.querySelector(".captchawrap");if(a){a.onclick=this.onClick.bind(this),["click","focus"].forEach(function(a){e.querySelector("input[name=captcha]").addEventListener(a,t.onFieldClick.bind(t))});var n=e.querySelector(".captchaimage");n&&this.addImgLoadListener(n)}},addImgLoadListener:function addImgLoadListener(e){var t=this;e.onload=this.onImageLoad.bind(this),["animationend","webkitAnimationEnd","msAnimationEnd"].forEach(function(a){e.addEventListener(a,t.onAnimationEnd.bind(t))})},_state:"init",get state(){return this._state},set state(e){document.querySelectorAll(".captchawrap").forEach(function(t){"init"==e&&(t.classList.remove("cw-running"),t.classList.add("cw-initial")),("init"==e||"load"==e)&&t.classList.add("captchaimage-invisible"),"load"==e?(t.classList.remove("cw-initial","cw-running"),void t.offsetWidth,t.classList.add("cw-running","cw-loading")):t.classList.remove("cw-loading"),"run"==e&&t.classList.remove("captchaimage-invisible")}),"run"!==e&&this.clear(),this._state=e},onClick:function onClick(e){this.refresh(e.ctrlKey||e.altKey),e.target._findParent("form").querySelector("input[name=captcha]").focus()},onFieldClick:function onFieldClick(){("init"==this.state||"expired"==this.state)&&this.refresh()},onImageLoad:function onImageLoad(){"load"==this.state&&(this.state="run")},onAnimationEnd:function onAnimationEnd(){this.state="expired"},clear:function clear(){document.querySelectorAll("input[name=\"captcha\"]").forEach(function(e){return e.value=""})},refresh:function refresh(){var e=!!(0<arguments.length&&arguments[0]!==void 0)&&arguments[0],t=$(".captchawrap").css("color").match(/([0-9]+(?:\.[0-9]+)?)/g);t=3<=t.length?"&color="+t.slice(0,3).join(","):"";var a=ku_boardspath+"/captcha.php?"+Math.random()+t+(e?"&switch":"");document.querySelectorAll(".captchaimage").forEach(function(e){return e.src=a}),this.state="load"}};function formatFileSize(e){var t=Math.round;return 1e3>e?"".concat(e,"B"):1e6>e?"".concat(t(e/1e3),"KB"):"".concat(t(e/1e5)/10,"MB")}var richFileInput={handleFiles:function handleFiles(e,t){for(var a=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],n=+t.dataset.maxfiles,s=n-$(t).find(".file-entry").length,o=e.length,r=0;s&&o;r++){var l=this.handleFile(e[r],t,a);s-=l,o--}0>=s&&o&&pups.warn(_l.maxAttNumReached)},handleFile:function handleFile(e,t){var a=this,n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],s={},i=e.name.split(".");if(s.ext=1<i.length?i.pop().toLowerCase():"","jpeg"==s.ext&&(s.ext="jpg"),"*"!=t.dataset.allowedAllFiletypes&&!_.contains(t.dataset.allowedFiletypes.split(","),s.ext))return pups.err("".concat(e.name,": ").concat(_l.unsupportedFileType,".")),0;if(s.fname=i.join("."),s.sizeFormatted=formatFileSize(e.size),-1!=e.type.indexOf("image")){var o=new FileReader;o.onload=function(i){s.img=i.target.result,a.addFile(e,s,t,n)},o.readAsDataURL(e,s,t)}else this.addFile(e,s,t,n);return 1},addFile:function addFile(e,t,a){var n=!!(3<arguments.length&&arguments[3]!==void 0)&&arguments[3],s=this.store.push(e)-1;a.querySelector(".fe-sort-wrapper").insertAdjacentHTML("beforeEnd","\n      <div class=\"file-entry".concat(n?" fe-name-hidden":"","\" data-index=\"").concat(s,"\" title=\"").concat(e.name,"\">\n        <div class=\"fe-thumb\">\n          ").concat(t.img?"<img src=".concat(t.img,">"):makeGenericFileIcon(t.ext),"\n        </div>\n        <input type=\"text\" value=\"").concat(t.fname,"\" class=\"fe-fn\" ").concat(n?" disabled":"",">\n        <button class=\"clear-filename fe-pop-button icon-wraping-button\" title=\"").concat(_l.hideName,"\"><svg class=\"icon b-icon\">\n          <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-hide-name\"></use>\n        </svg></button>\n        <button class=\"remove-file fe-pop-button icon-wraping-button\" title=\"").concat(_l.removeFile,"\"><svg class=\"icon b-icon\">\n          <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-x\"></use>\n        </svg></button>\n        <button class=\"spoiler-file fe-pop-button icon-wraping-button\" title=\"").concat(_l.spoilerOnOff,"\"><svg class=\"icon b-icon\">\n          <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-spoiler\"></use>\n        </svg></button>\n        <div class=\"fe-info\"></div>\n      </div>\n    ")),this.recalcForm(a);var i=a.querySelector(".file-entry[data-index=\"".concat(s,"\"]")),o=!1,r=function(){return i.querySelector(".fe-info").innerText="".concat(t.ext.toUpperCase()).concat(o?", ".concat(o.naturalWidth,"\xD7").concat(o.naturalHeight):"",", ").concat(t.sizeFormatted)};t.img?(o=i.querySelector("img"),o.onload=r,o.onerror=r):r(),i._ext=t.ext,this.updateTitle($(i))},recalcForm:function recalcForm(e){var t=e.querySelectorAll(".file-entry").length,a=+e.dataset.maxfiles;e.classList.toggle("fda-non-empty",0<t),e.classList.toggle("fda-form-full",t>=a),e.querySelector(".file-count").innerHTML=0<t?"".concat(_l.files,"<br>(").concat(t,"/").concat(a,")"):"".concat(_l.file)},updateTitle:function updateTitle(e){var t=e.find(".fe-fn").val(),a=!e.hasClass("fe-name-hidden")&&t?t:"*****";e[0].title="".concat(a,".").concat(e[0]._ext)},serialize:function serialize(e,t){var a=this;e.querySelectorAll(".file-entry").forEach(function(e,n){t.append("imagefile[]",a.store[+e.dataset.index]),e.classList.contains("fe-spoiler")&&t.append("spoiler-".concat(n),1);var s=e.querySelector(".fe-fn").value;e.classList.contains("fe-name-hidden")||""===s?t.append("hidename-".concat(n),1):t.append("filename-".concat(n),s)})},store:[],initiated:!1,init:function init(e){if(this.enabled=e.querySelector(".file-row")&&"FileReader"in window,this.enabled){var t=this;$("body").on("click",".remove-file",function(e){e.preventDefault(),e.stopPropagation();var a=$(this).parents(".file-entry");t.store[+a.data("index")]=null;var n=a.parents("form[name=postform]");a.remove(),t.recalcForm(n[0])}).on("click",".file-entry",function(){var e=this;$(this).toggleClass("fe-expanded"),setTimeout(function(){return $(e).find("input").select()},450)}).on("click",".file-entry input",function(e){e.stopPropagation()}).on("click",".spoiler-file",function(e){e.preventDefault(),e.stopPropagation(),$(this).parents(".file-entry").toggleClass("fe-spoiler")}).on("click",".clear-filename",function(e){e.preventDefault(),e.stopPropagation();var a=$(this).parents(".file-entry");a.find(".fe-fn").prop("disabled",!a.hasClass("fe-name-hidden")),a.toggleClass("fe-name-hidden"),t.updateTitle(a)}).on("change",".fe-fn",function(){t.updateTitle($(this).parents(".file-entry"))}).on("change","input[type=file]",function(e){var a=$(this).parents("form[name=postform]")[0];t.handleFiles(e.target.files,a),this.value=null}).on("click",".add-files",function(e){e.preventDefault(),$(this).parents("form[name=postform]").find("input[type=file]")[0].click()}).on("paste","form[name=postform]",function(e){for(var a,n=(e.clipboardData||e.originalEvent.clipboardData).items,s=[],o=0;o<n.length;o++)a=n[o],"file"==a.kind&&s.push(a.getAsFile());t.handleFiles(s,this,!0)})}else $("body").on("click",".remove-file",function(e){e.preventDefault(),$(this).parent().find("input[type=file]").val(null).removeClass("non-empty-file-input")}).on("change","input[type=file]",function(){$(this).toggleClass("non-empty-file-input",this.value)});this.initiated=!0},initForm:function(e){this.initiated||this.init(e);var t=this;if(this.enabled)$(e).on("dragenter dragend dragover drop dragleave",function(e){e.originalEvent.stopPropagation(),"TEXTAREA"==e.target.nodeName||"INPUT"==e.target.nodeName||e.preventDefault()}).on("drop",function(e){e.originalEvent.stopPropagation(),e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files.length&&(e.originalEvent.preventDefault(),t.handleFiles(e.originalEvent.dataTransfer.files,this))}),e.querySelector(".fe-sort-wrapper")&&Sortable.create(e.querySelector(".fe-sort-wrapper"),{animation:150,handle:".fe-thumb"}),e.querySelectorAll("input[name^=imagefile]").forEach(function(e){return e.removeAttribute("name")});else{var a=e.querySelector(".drop-area");if(!a)return;a.previousElementSibling.classList.remove("noscript"),a.remove()}},clear:function clear(e){var t=this,a=!!(1<arguments.length&&arguments[1]!==void 0)&&arguments[1];this.enabled&&(e.querySelectorAll(".file-entry").forEach(function(e){a&&(t.store[e.dataset.index]=null),e.remove()}),this.recalcForm(e))}};function makeGenericFileIcon(e){var t=e.toLowerCase().split("").map(function(e){return e.charCodeAt(0)}).reverse().join("")%360;return"<div class=\"generic-file-icon\" style=\"background-color: hsl(".concat(t,", 66%, 50%)\"><div class=\"gfi-extension\">").concat(e,"</div></div>")}function handleCtrlEnter(e){e.preventDefault();var t=document.activeElement,a=t._findParent("form[name=postform]");a&&Ajax.submitPost(a)}function redirectTo(e){document.location.href=e}var Ajax={submitPost:function submitPost(e,t){var a=this;e.querySelector("script[src^=\"https://js.hcaptcha.com\"]")?hcaptcha.execute({async:!0}).then(function(n){var s=n.response,i=n.key;a.actuallySubmitPost(e,t,s)})["catch"](function(e){console.error("hcapthca:",e),"challenge-expired"==e&&a.shownErrors.push(pups.warn(_l.captchaExpired))}):this.actuallySubmitPost(e,t)},actuallySubmitPost:function actuallySubmitPost(t,a){var n=this,s=!!(2<arguments.length&&arguments[2]!==void 0)&&arguments[2],i=_.clone(this.shownErrors);setTimeout(function(){i.forEach(function(e){pups.closeByID(e)})},300),this.shownErrors=[];var o=function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return n.shownErrors.push(pups.err(e,t))},r=t.captcha;if(r&&!r.value.length)return r.focus(),function showWarning(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return n.shownErrors.push(pups.warn(e,t))}(_l.enterCaptcha);t.classList.add("form-sending");var l=new FormData(t);"undefined"!=typeof a&&l.append("sagebtn",a),s&&l.append("h-captcha-response",s),richFileInput.enabled&&richFileInput.serialize(t,l);var d=new XMLHttpRequest;l.append("AJAX",1),this.postToken=randomString(),l.append("token",this.postToken),d.open("POST",t.action),d.onload=function(){if(t.classList.remove("form-sending"),200!==d.status)return void o(_l.xhrError);[].forEach.call(t.querySelectorAll(".error-in-attachment"),function(e){return e.classList.remove("error-in-attachment")}),Captcha.enabled&&(Captcha.state="init");var e=null;try{e=JSON.parse(d.response)}catch(t){return void logJSONexpectedError(d.response)}if(e.error){if(e.error_verbose&&(e.error="".concat(e.error,"<br>").concat(e.error_verbose)),!e.error_type)o(e.error,{time:0});else if("ban"==e.error_type&&o("".concat(e.error," (<a href=\"").concat(ku_cgipath,"/banned.php\" target=\"_blank\">").concat(_l.details,"</a>)"),{time:0,save:!0}),"duplicate_file"==e.error_type&&(o(e.error,{time:0}),t.querySelector("input[name=\"imagefile\"]").value=null),"upload_error"==e.error_type){o(e.error,{time:0});var a=t.querySelector(".multiembedwrap[data-pos=\"".concat(e.error_data.attachmenttype,"-").concat(e.error_data.position+1,"\"]"));a&&a.classList.add("error-in-attachment")}return}e.timings&&console.log("timings:",e.timings),resetForm(t),t.classList.contains("quick-reply-form")&&hidePostForm(t);var n=t.querySelector("input[name=\"redirecttothread\"]"),s=n&&n.checked;0==e.thread_replyto?s?redirectTo("".concat(ku_boardspath,"/").concat(e.board,"/res/").concat(e.post_id,".html")):redirectTo("".concat(ku_boardspath,"/").concat(e.board)):newposts.get({threadid:ispage?e.thread_replyto+"-"+e.board:null,expectedPost:e.post_id+"-"+e.board,onError:function onError(t){console.error(t),redirectTo("".concat(ku_boardspath,"/").concat(e.board,"/res/").concat(e.thread_replyto,".html#").concat(e.post_id)),ispage||document.location.reload()},onSuccess:function onSuccess(){return $("#delform div[id^=thread".concat(e.thread_replyto,"] .fresh-replies")).remove()}})},d.onerror=function(a){return t.classList.remove("form-sending"),console.log(a),void o(_l.xhrError)},d.send(l)},shownErrors:[],reportPost:function reportPost(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null,a=new XMLHttpRequest;e.append("AJAX",1),e.append("reportpost",1),a.open("POST",document.forms.delform.action),a.onload=function(){if(200!==a.status)return pups.err(_l.xhrError),t(!1);var e=null;try{e=JSON.parse(a.response)}catch(n){return logJSONexpectedError(a.response),t(!1)}if(t&&t(e.data),e.error)return e.error_verbose&&(e.error="".concat(e.error,"<br>").concat(e.error_verbose)),void pups.err(e.error,{time:0});$("body").removeClass("select-multiple"),$(".userdelete").removeClass("ud-active");var n=[],s=[];e.data.forEach(function(e){return e.success?void(n.push(e.id),!$("input[name=\"post[]\"]:checked").length&&$(".userdelete").removeClass("ud-active")):void s.push(e)});var i="";n.length&&(n=n.map(function(e){return"#"+e}),i+=1<n.length?"".concat(_l.posts," ").concat(n.join(", ")," ").concat(_l.reportedMulti,"."):"".concat(_l.post," ").concat(n[0]," ").concat(_l.reported,"."),pups.succ(i,{time:2+n.length})),s.forEach(function(e){pups.err("".concat(_l.post," #").concat(e.id,": ").concat(e.message))})},a.send(e)},cancelTimer:function cancelTimer(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null,a=new XMLHttpRequest;e.append("AJAX",1),e.append("cancel_timer",1),this.timerToken=randomString(),e.append("token",this.timerToken),a.open("POST",document.forms.delform.action),a.onload=function(){if(200!==a.status)return pups.err(_l.xhrError),t(!1);var e=null;try{e=JSON.parse(a.response)}catch(n){return logJSONexpectedError(a.response),t(!1)}if(e.error)return e.error_verbose&&(e.error="".concat(e.error,"<br>").concat(e.error_verbose)),pups.err(e.error,{time:0}),t(!1);$("body").removeClass("select-multiple"),$(".userdelete").removeClass("ud-active");var n=[],s=[];e.data.forEach(function(e){return e.success?void(n.push(e.id),!$("input[name=\"post[]\"]:checked").length&&$(".userdelete").removeClass("ud-active")):void s.push(e)});var i="";n.length&&(n.forEach(function(e){var t=$(".postnode[data-id=".concat(e,"]"));t.find(".post-ttl").remove(),t.find(".post-menu").hide()}),i+=1<n.length?"".concat(_l.posts," #").concat(n.join(", #")," ").concat(_l.savedMulti,"."):"".concat(_l.post," #").concat(n[0]," ").concat(_l.saved,"."),pups.succ(i,{time:2+n.length})),s.forEach(function(e){pups.err("".concat(_l.post," #").concat(e.id,": ").concat(e.message))}),t(s)},a.send(e)},modThread:function modThread(e,t){var a=$(e),n=new FormData,s=new XMLHttpRequest,i=a.find("li");i.addClass("spin-around"),n.append("AJAX",1),s.open("POST",e.getAttribute("href")),s.onload=function(){if(i.removeClass("spin-around"),200!==s.status)return void pups.err(_l.xhrError);var e=null;try{e=JSON.parse(s.response)}catch(t){return void logJSONexpectedError(s.response)}if(e.error)return e.error_verbose&&(e.error="".concat(e.error,"<br>").concat(e.error_verbose)),void pups.err(e.error,{time:0});var n=a.parents(".posthead"),o=n.find(".extrabtns");"stickypost"==t&&(o.prepend(makeIcon("pin","i-icon i-pin")),n.addClass("thread-stickied")),"unstickypost"==t&&(o.find("svg.i-icon.i-pin").remove(),n.removeClass("thread-stickied")),"lockpost"==t&&(o.prepend(makeIcon("lock","i-icon i-lock")),n.addClass("thread-locked")),"unlockpost"==t&&(o.find("svg.i-icon.i-lock").remove(),n.removeClass("thread-locked")),pups.succ(e.message)},s.send(n)},deleteItems:function deleteItems(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,a=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],n="Items";if(a&&(console.log("yes"),e.append("moddelete",1)),!e.has)e.append("deletepost",1);else if(e.has("post[]"))e.has("delete-file[]")||(n="Posts"),e.append("deletepost",1);else if(e.has("delete-file[]"))n="Files";else return;var s=new XMLHttpRequest;e.append("AJAX",1),this.delToken=randomString(),e.append("token",this.delToken),s.open("POST",document.forms.delform.action),s.onload=function(){if(200!==s.status)return pups.err(_l.xhrError),t?t(null):null;var e=null;try{e=JSON.parse(s.response)}catch(a){return logJSONexpectedError(s.response),t(null)}return t&&t(e.data),e.error?(e.error_verbose&&(e.error="".concat(e.error,"<br>").concat(e.error_verbose)),void pups.err(e.error,{time:0})):void _deleteItems(e.data)},s.send(e)}};function inspectFormData(e){var t,a=_createForOfIteratorHelper(e.entries());try{for(a.s();!(t=a.n()).done;){var n=t.value;console.log(n[0]+", "+n[1])}}catch(e){a.e(e)}finally{a.f()}}function makeIcon(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",a=!!(2<arguments.length&&arguments[2]!==void 0)&&arguments[2];return"".concat(a?"":"<svg class=\"icon ".concat(t,"\">"),"\n    <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-").concat(e,"\"></use>\n  ").concat(a?"":"</svg>")}function addCaptchaToMenu(e){return e.find(".captchawrap").length?void(Captcha.state="init"):void(!Captcha.enabled&&Captcha.init("only-access"),e.prepend("<li class=\"menu-captcha\">\n    <div class=\"captchawrap cw-initial captchaimage-invisible\" title=\"".concat(_l.refreshCaptcha,"\">\n      <div class=\"captcha-show msg\">").concat(_l.showCaptcha,"</div>\n      <img class=\"captchaimage\" valign=\"middle\" border=\"0\" alt=\"").concat(_l.captchaImage,"\">\n      <div class=\"rotting-indicator\"></div>\n      <div class=\"rotten-msg msg\">").concat(_l.captchaExpired,"</div>\n    </div>\n    <input type=\"text\" name=\"captcha\" placeholder=\"").concat(_l.captcha,"\" autocomplete=\"off\">\n  </li>")),Captcha.initForm(e[0]),e.find("input[name=captcha]").keydown(function(e){"Enter"==e.key&&(e.preventDefault(),e.stopPropagation())}))}var MediaViewer=function(){var e=Math.min,t=Math.round,a=Math.abs;function n(t,a,s,i,o){var r=this,l=!!(7<arguments.length&&void 0!==arguments[7])&&arguments[7];_classCallCheck(this,n);var d=document.querySelector("#thumb".concat(t," img"));if(null==d)return!1;this.post=d._findParent(".postbody"),this.initZoom(),this.createContainer(),this.resetTransform();var c=d._findParent(".reflinkpreview");c&&PostPreviews.pinPreview(c,!0,!0);var p=d.getBoundingClientRect(),u=p.x,m=p.y,h=p.width,g=p.height,f=this.viewer.clientWidth,v=this.viewer.clientHeight,b=e(f/i,v/o,1),y=i*b,w=e(f,i),k=e(v,o),x="style=\"transform: translate(".concat(u+h/2-f/2,"px, ").concat(m+g/2-v/2,"px) scale(").concat(h/y,")\""),S=this.viewer._ins("afterBegin",this.createMediaElement(d.src,i,o,a,x,l));this.refreshList(),this.currentThumb=d,d.style.visibility="hidden",this.updateCounter(),this.showPercentage(b),S._isVideo=l,this.setVolume(S),S._scaleDownFactor=b,this.currentMediaItem=S,S._realWidth=i,this.imgw=i,this.imgh=o,document.body.style.overflow="hidden",requestAnimationFrame(function(){r.container.classList.remove("mvc-collapsed"),S.style.transform=null})}return _createClass(n,[{key:"refreshList",value:function refreshList(){this.list=document.querySelectorAll("img.thumb")}},{key:"findIndex",value:function findIndex(t){return Array.prototype.findIndex.call(this.list,function(a){return a==t})}},{key:"createContainer",value:function createContainer(){var e=this;this.container=document.body._ins("beforeend","<div class=\"mv-container mvc-collapsed\">\n    <div class=\"media-viewer\">\n      <div class=\"mv-label\">\n        <span class=\"item-counter\"></span>\n        <span class=\"scale-indicator\"></span>\n      </div>\n      <div class=\"mv-button mv-prev-next mv-prev\"></div>\n      <div class=\"mv-button mv-prev-next mv-next\"></div>\n      <div class=\"mv-button mv-restore\"></div>\n      <div class=\"mv-button mv-close\"></div>\n    </div></div>"),this.viewer=this.container.querySelector(".media-viewer"),this.viewer.addEventListener("wheel",this.handleZoom.bind(this)),this.viewer.addEventListener("mousemove",function(t){e.mouseX=t.clientX,e.mouseY=t.clientY,e.isMouseDown&&e.handleDrag()}),this.viewer.addEventListener("mousedown",function(t){if(2==t.button&&e.currentMediaItem._isVideo){var a=e.currentMediaItem.querySelector(".video-event-overlay");a.style.pointerEvents="none",setTimeout(function(){return a.style.pointerEvents="all"},100)}e.gripX=t.clientX,e.gripY=t.clientY,e.isMouseDown=!0,(t.target.classList.contains("media-viewer")||t.target.classList.contains("mv-under"))&&(e.emptyClick=!0)}),this.viewer.addEventListener("contextmenu",function(){if(e.currentMediaItem._isVideo){var t=e.currentMediaItem.querySelector(".video-event-overlay");t.style.pointerEvents="none",setTimeout(function(){return t.style.pointerEvents="all"},100)}}),this.viewer.addEventListener("click",function(t){e.isDragged&&(e.isDragged=!1,t.preventDefault())}),this.viewer.addEventListener("mouseup",function(t){e.isMouseDown=!1,e.currentMediaItem.classList.remove("no-transition"),e.isDragged?t.preventDefault():0==t.button&&e.collapse(),e.emptyClick=!1}),this.viewer.addEventListener("dragstart",function(e){e.preventDefault(),e.stopPropagation()}),this.viewer.querySelectorAll(".mv-button").forEach(function(t){t.addEventListener("click",function(a){a.stopPropagation(),e.refreshList();var n=e.findIndex(e.currentThumb);t.classList.contains("mv-prev")||t.classList.contains("mv-next")?(t.classList.contains("mv-prev")?(n-=1,0>n&&(n=e.list.length-1)):(n+=1,n>=e.list.length&&(n=0)),e.switchItem(e.list[n])):t.classList.contains("mv-close")?e.collapse():t.classList.contains("mv-restore")&&e.toggleFullSize(0)}),["mouseup","mousedown"].forEach(function(e){return t.addEventListener(e,function(e){return e.stopPropagation()})})}),this.viewer.addEventListener("mouseleave",function(){e.isMouseDown=!1,e.isDragged=!1})}},{key:"applyTransform",value:function applyTransform(){var e=this.currentMediaItem;e&&(e.style.transform="translate(".concat(this.translateX,"px, ").concat(this.translateY,"px) scale(").concat(this.scale,")"))}},{key:"resetTransform",value:function resetTransform(){this.translateX=0,this.translateY=0,this.scale=1}},{key:"initZoom",value:function initZoom(){this.zoomAmount=.5,this.minScale=.1,this.zoomSteps=[.1,.25,.33,.5,.75,1,1.5,2,2.5,3,4,5,6,8,10]}},{key:"handleZoom",value:function handleZoom(e){var t=Math.sign,n=this,s=this.currentMediaItem;if(s){e.stopPropagation(),e.preventDefault();var i=-t(e.deltaY),o=1/s._scaleDownFactor,r=Array.from(this.zoomSteps).filter(function(e){return .1<a((e-o)/o)}).concat([o]),l=this.viewer.clientWidth/2+this.translateX,d=this.viewer.clientHeight/2+this.translateY,c=r.map(function(e){return e-n.scale}).filter(function(e){return 0<e*i}).sort(function(e,t){return(e-t)*i})[0]+this.scale;isNaN(c)||(this.showPercentage(s._scaleDownFactor*c),this.translateX+=(l-this.mouseX)/this.scale*(c-this.scale),this.translateY+=(d-this.mouseY)/this.scale*(c-this.scale),this.scale=c,this.applyTransform(),this.flashLabel())}}},{key:"showPercentage",value:function showPercentage(e){this.viewer.querySelector(".scale-indicator").innerText="| ".concat(t(100*e),"%")}},{key:"handleDrag",value:function handleDrag(){var e=this.currentMediaItem;if(e){var t=this.mouseX-this.gripX,a=this.mouseY-this.gripY;(0!=t||0!=a)&&(!this.isDragged&&(this.currentMediaItem.classList.add("no-transition"),this.isDragged=!0,this.initialTransX=this.translateX,this.initialTransY=this.translateY),this.translateX=this.initialTransX+t,this.translateY=this.initialTransY+a,this.applyTransform())}}},{key:"switchItem",value:function switchItem(t){var a=t._findParent("a"),s=a.classList.contains("movie"),i=s?n.parseVideo(a):n.parseImg(a),o=_slicedToArray(i,7),r=o[0],l=o[1],d=o[2],c=o[3],p=o[4],u=o[5],m=o[6],h=this.viewer.clientWidth,g=this.viewer.clientHeight,f=e(h/c,g/p,1);this.showPercentage(f),this.resetTransform(),this.applyTransform(),this.currentMediaItem._isVideo=s,this.currentMediaItem._scaleDownFactor=f,this.currentMediaItem.classList.remove("no-transition"),this.currentMediaItem.innerHTML=this.createMediaElement(t.src,c,p,l,null,s),this.setVolume(this.currentMediaItem),this.currentThumb.style.visibility="visible",t.style.visibility="hidden",this.post=t._findParent(".postbody"),this.currentThumb=t,this.updateCounter(),this.refreshList()}},{key:"setVolume",value:function setVolume(e){if(e._isVideo){var t=e.querySelector("video");t.volume=localStorage.mediaVolume||1,t.onvolumechange=function(){localStorage.mediaVolume=this.muted?0:this.volume}}}},{key:"updateCounter",value:function updateCounter(){var e=this.findIndex(this.currentThumb);this.viewer.querySelector(".item-counter").innerText="".concat(e+1,"/").concat(this.list.length),this.flashLabel()}},{key:"flashLabel",value:function flashLabel(){var e=this;clearTimeout(this.flashLabelTimeout),this.viewer.querySelector(".mv-label").classList.add("mvl-visible"),this.flashLabelTimeout=setTimeout(function(){return e.viewer.querySelector(".mv-label").classList.remove("mvl-visible")},1e3)}},{key:"collapse",value:function collapse(){var t=this;document.body.style.overflow="";var a=this.currentMediaItem,n=a.clientWidth,s=a.clientHeight,i=a.querySelector(".placeholder-svg"),o=e(this.viewer.clientHeight/i.naturalHeight,this.viewer.clientWidth/i.naturalWidth);a._isVideo&&a.querySelector("video").remove(),this.isDragged=!1,1>o&&(n=i.naturalWidth*o,s=i.naturalHeight*o);var r=!0;if(document.body.contains(this.currentThumb)){var l=this.currentThumb.getBoundingClientRect();if(r=!(l.y<window.innerHeight&&0<l.y+l.height&&l.x<window.innerWidth&&0<l.x+l.width),!r){var d=l.x+l.width/2-this.viewer.clientWidth/2,c=l.y+l.height/2-this.viewer.clientHeight/2;a.style.transform="translate(".concat(d,"px, ").concat(c,"px) scale(").concat(l.width/n,")")}}r&&(a.style.transform="translate(0px, 0px) scale(0)"),a.classList.remove("no-transition"),this.container.classList.add("mvc-collapsed"),setTimeout(function(){t.container.remove(),t.currentThumb.style.visibility="visible",t.onCollapse&&t.onCollapse()},250)}},{key:"toggleFullSize",value:function toggleFullSize(e){document.body.style.overflow=e?"hidden":"",e?this.viewer.classList.remove("mv-transparent"):this.viewer.classList.add("mv-transparent")}},{key:"createMediaElement",value:function createMediaElement(t,a,n,s){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"",o=!!(5<arguments.length&&void 0!==arguments[5])&&arguments[5];return"<div class=\"media-item ".concat(o?"loaded":"","\" ").concat(i,">\n      <div style=\"background-image: url(").concat(t,"); max-width: ").concat(a,"px\" class=\"mv-under\"></div>\n      <").concat(o?"video controls autoplay loop":"img"," src=\"").concat(s,"\" class=\"mv-over\" ").concat(o?"></video><img class=\"video-event-overlay\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg' width='".concat(a,"' height='").concat(e(n,window.innerHeight)-50,"'%2F%3E\">"):"onload=\"this.parentElement.classList.add('loaded')\">","\n      <img class=\"placeholder-svg\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg' width='").concat(a,"' height='").concat(n,"'%2F%3E\">\n    </div>")}}],[{key:"parseVideo",value:function parseVideo(e){var t=e.dataset.id,a=e.href,n=e.dataset.thumb,s=e.dataset.width,i=e.dataset.height,o=e.querySelector("img"),r=o.width,l=o.height;return[t,a,n,s,i,r,l]}},{key:"parseImg",value:function parseImg(e){return e.getAttribute("onclick").match(/expandimg\('(.+?)', ?'(.+?)', ?'(.+?)', ?'(.+?)', ?'(.+?)', ?'(.+?)', ?'(.+?)'/).slice(1)}}]),n}();Element.prototype._ins=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"beforeend",t=1<arguments.length?arguments[1]:void 0;return this.insertAdjacentHTML(e,t),e=e.toLowerCase(),"afterbegin"==e?this.firstElementChild:"beforeend"==e?this.lastElementChild:"beforebegin"==e?this.previousElementSibling:this.nextElementSibling};function expandimg_old(e,t,a,n,s,i,o){var r=Math.round,l=document.getElementById("thumb"+e);if(null==l)return!1;var d,c=$(l),p=c.parents(".postbody"),u=c.parents("figure").find(".fc-filename");if("full"!=l.getElementsByTagName("img")[0].getAttribute("alt").substring(0,4)){if(c.html("<img src=\""+t+"\" alt=\"full"+e+"\" class=\"thumb\" height=\""+s+"\" width=\""+n+"\">"),!Settings.expandImgFull()){for(var m=l.getElementsByTagName("img")[0],h=document.documentElement?document.documentElement.clientWidth:document.body.clientWidth,g=50,f=m;null!=f;)g+=f.offsetLeft,f=f.offsetParent;var v=h-g;if(m.width>v){var b=m.width/m.height,y=1-v/m.width,w=document.createElement("div");w.setAttribute("class","filesize"),w.style.textDecoration="underline";var k=document.createTextNode(_l.imageDownscaledBy+" "+r(100*y)+"% "+_l.toFit);w.appendChild(k),l.insertBefore(w,m),$(m).width(v),$(m).height(v/b)}d=v}else d=n;p&&p.addClass("postbody-expanded")}else l.innerHTML="<img src=\""+a+"\" alt=\""+e+"\" class=\"thumb\" height=\""+o+"\" width=\""+i+"\">",d=i,p&&p.removeClass("postbody-expanded");return u[0].style.maxWidth="".concat(d-50,"px"),!1}function expandimg(e,t,a,n,s,i,o){if(Settings.newMediaViewer()){var r=new MediaViewer(e,t,a,n,s,i,o);r.onCollapse=function(){return r=null}}else expandimg_old(e,t,a,n,s,i,o);return!1}function expandAllImages(){document.querySelectorAll("a[onclick^=\"javascript:return expandimg\"]").forEach(function(e){var t,a;-1==(null===(t=e.querySelector("img"))||void 0===t||null===(a=t.alt)||void 0===a?void 0:a.indexOf("full"))&&expandimg_old.apply(void 0,_toConsumableArray(MediaViewer.parseImg(e)))})}function getDownloadList(){var e=window.open();e.document.body.innerHTML=[].map.call(document.querySelectorAll(".filesize a"),function(e){return e.href}).join("<br>")}var PostPreviews={zindex:3,parent:{},_parseLink:function _parseLink(e){var t=e.getAttribute("href");if(t){var a=t.match(/\/(.+)\/res\/([0-9]+)\.html#([0-9]+)|postbynumber\.php\?b=(.+)&p=([0-9]+)/i);if(a)return{board:a[1]||a[4],parent:a[2]||"?",post:a[3]||a[5]}}var n=[].find.call(e.classList,function(e){return e.match(/ref\|.+?\|([0-9]+|\?)\|[0-9]+/)});return n?(n=n.split("|"),{board:n[1],parent:n[2],post:n[3]}):null},_mouseover:function _mouseover(t){var e=this;t.stopPropagation();var a=$(this).hasClass("catalog-entry"),n=PostPreviews._parseLink(this);if(!n)return!1;var s=n.board,i=n.parent,o=n.post,r="preview_"+s+"_"+o,l=$("#"+r);if(0==l.length)$("body").children().first().before("<div id=\""+r+"\"></div>"),l=$("#"+r),l.addClass("reflinkpreview content-background pre-hidden actual-reflinkpreview"),l.mouseleave(PostPreviews._mouseout),l.mouseover(PostPreviews.mouseOverPreview);else if(l[0]._pinned)return!1;var d=$(this).parents("div[id^=preview]");if(0<d.length){if(r==d.attr("id"))return;for(var c in PostPreviews.parent)if(c==r||PostPreviews.parent[c]==r)return;PostPreviews.parent[r]=d.attr("id")}var p;t.clientY<$(window).height()/1.5?(l.css({top:t.pageY+5}),p="top "):(l.css({bottom:$(window).height()-t.pageY+5}),p="bottom "),t.clientX<$(window).width()/1.5?(l.css({left:t.pageX+15}),p+="left"):(l.css({right:$(window).width()-t.pageX+15}),p+="right"),l.css({zIndex:PostPreviews.zindex++,"transform-origin":p}),this.style.cursor="progress";var u=l[0];HTMLoader.getPost(s,i,o,function(t,a){window.setTimeout(function(){u.getBoundingClientRect(),l.html(a?a:_l.oops+(!1===t?"":" (".concat(t,")"))).removeClass("pre-hidden"),e.style.cursor="pointer";var n=u.querySelector(".extrabtns");if(n){n.insertAdjacentHTML("beforeEnd","\n        <a href=\"#\" class=\"pin-preview pinner unpinned\" title=\"".concat(_l.pinUnpin,"\">\n          <svg class=\"icon b-icon\">\n            <use class=\"use-pin\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-pin\"></use>\n            <use class=\"use-unpin\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#i-unpin\"></use>\n          </svg>\n        </a>"));var s=n.querySelector(".pinner");s.onclick=function(e){e.preventDefault(),e.stopPropagation(),PostPreviews.pinPreview(l[0])}}},0)}),t.preventDefault()},mouseOverPreview:function mouseOverPreview(){var e=$(this);if($(this).is("a")){var t=PostPreviews._parseLink(this);if(!t)return;var a=t.board,n=t.post;e=$("#preview_"+a+"_"+n).first()}for(;0<e.length;)clearTimeout(e[0].fadeout),e=$("#"+PostPreviews.parent[e.attr("id")])},_mouseout:function _mouseout(){var e=!!(1<arguments.length&&arguments[1]!==void 0)&&arguments[1],t=$(this);if($(this).is("a")){this.predelay&&clearTimeout(this.predelay);var a=PostPreviews._parseLink(this);if(!a)return;var n=a.board,s=a.post;t=$("#preview_"+n+"_"+s).first()}for(var i=function _loop(){clearTimeout(t[0].fadeout);var a=t;return a[0]._pinned?{v:void 0}:void(t[0].fadeout=setTimeout(function(){a.addClass("pre-hidden"),setTimeout(function(){delete PostPreviews.parent[a.attr("id")],a.remove()},PostPreviews._timings.transition)},e?0:PostPreviews._timings.fade),t=$("#"+PostPreviews.parent[t.attr("id")]))};0<t.length;){var o=i();if("object"===_typeof(o))return o.v}},pinPreview:function pinPreview(e,t){var a=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],n=e.querySelector(".pinner");if("undefined"==typeof t&&(t=!n.classList.contains("pinned")),n.classList.toggle("pinned",t),n.classList.toggle("unpinned",!t),a){var s=e;s.addEventListener("mouseenter",function(){return PostPreviews.pinPreview(s,!1)}),s.classList.add("temporarily-pinned")}for(;e;)e._pinned=t,e=document.querySelector("#".concat(PostPreviews.parent[e.id]))},_timings:{predelay:50,transition:200,fade:400}};function set_inputs(e){var t=document.getElementById(e);if(t){var a=t.querySelector("input[name=name]");if(a&&!a.value){var n=getCookie("name");~n.indexOf("#")&&(a.type="password"),a.value=n}t.em.value||(t.em.value=getCookie("email")),t.postpassword.value||(t.postpassword.value=get_password("postpassword"))}}function set_delpass(e){var t=document.getElementById(e);if(t){var a=t.postpassword;a&&!a.value&&(a.value=get_password("postpassword"))}}(function(e){e.event.special.load={add:function add(t){1===this.nodeType&&"img"===this.tagName.toLowerCase()&&""!==this.src&&(this.complete||4===this.readyState?t.handler.apply(this):"uninitialized"===this.readyState&&0===this.src.indexOf("data:")?e(this).trigger("error"):e(this).bind("load",t.handler))}}})(jQuery);var Settings={_checkbox:function _checkbox(e,t,a){var n=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3],s=t;return(n&&(t=t+"."+this_board_dir),null==localStorage)?void pups.err(_l.noLocalStorage):(null==localStorage[t]&&(localStorage[t]=a),!0==e?localStorage[t]=$("#settings_"+s).is(":checked"):"true"==localStorage[t]?$("#settings_"+s).attr("checked","checked"):$("#settings_"+s).removeAttr("checked"),"true"==localStorage[t]||!0==localStorage[t])},fxEnabled:function fxEnabled(e){var t=Settings._checkbox(e,"fxEnabled",!0);return null!=e&&($.fx.off=!t),t},showReplies:function showReplies(e){var t=Settings._checkbox(e,"showReplies",!0);return null==e||"undefined"!=typeof is_catalog&&is_catalog||(scrollAnchor.save("replymap",".postnode"),t?(replyMap.showReplies(),injector.remove("hide-replies")):injector.inject("hide-replies",".replieslist {display: none}"),scrollAnchor.restore("replymap")),t},sfwMode:function sfwMode(e){var t=Settings._checkbox(e,"sfwMode",!1);return t?injector.inject("sfwMode","figure > *, .emoji { opacity: 0.05;} figure:hover > *, .postbody:hover .emoji { opacity: 1;}"):injector.remove("sfwMode"),t},hideCompletely:function hideCompletely(e){var t=Settings._checkbox(e,"hideCompletely",!1,!0);return e&&(HiddenItems.hideCompletely=t,HiddenItems.updateCSS()),t},expandImgFull:function expandImgFull(e){return Settings._checkbox(e,"expandImgFull",!1)},constrainWidth:function constrainWidth(e){var t=Settings._checkbox(e,"constrainWidth",!0);t?injector.inject("constrainWidth","body {\n        max-width: 960px;\n        margin: 0px auto;\n      }"):injector.remove("constrainWidth")},newMediaViewer:function newMediaViewer(e){return Settings._checkbox(e,"newMediaViewer",!0)},hidePostBtn:function hidePostBtn(e){var t=Settings._checkbox(e,"hidePostBtn",!0);return t?injector.remove("hidePostBtn"):injector.inject("hidePostBtn",".hide-post-btn {display: none}"),e||HiddenItems.lists.posts.forEach(function(e){$("#postnode".concat(e)).find(".hide-post-btn").attr("title",_l.unhidePost).find("use").attr("xlink:href","#i-unhide")}),t},endlessScroll:function endlessScroll(e){var t=Settings._checkbox(e,"endlessScroll",!1);_endlessScroll.toggle(t)}},rswap={i:!0,swap:function swap(){this.i?$("#delform").before($("#rswapper")).after($(".postarea")):$("#delform").before($(".postarea")).after($("#rswapper")),this.i=!this.i}},captchalang=getCookie("captchalang")||"ru";function setCaptchaLang(e){in_array(e,["ru","en","num"])&&(captchalang=e,set_cookie("captchalang",e,365),pups.succ(_l.captchaLangChanged))}var offClick=[];function readyset(){$(".make-me-readonly").each(function(){$(this).attr("readonly",!0).on("focus",function(){$(this).removeAttr("readonly")})}),ispage||$(".mgoback").show(),isTouch?$("#js_settings").prepend("<a href=\"javascript: localStorage.setItem('interfaceType', 'desktop'); location.reload();\">"+_l.returnDesktop+"</a><br>"):$("#js_settings").prepend("<a href=\"javascript: localStorage.setItem('interfaceType', 'touch'); location.reload();\">"+_l.returnTouch+"</a><br>"),$("#js_settings").prepend(_l.captchalang+": <a href=\"javascript:setCaptchaLang('ru');\">Cyrillic</a> | <a href=\"javascript:setCaptchaLang('en');\">Latin</a> | <a href=\"javascript:setCaptchaLang('num');\">Numeral</a><br />"),$("#js_settings").append("\n    <a href=\"javascript:expandAllImages()\">".concat(_l.expandAllImages,"</a><br>\n    <a href=\"javascript:getDownloadList()\">").concat(_l.getDownloadList,"</a><br>")),Styles.$cancelLink&&$("#js_settings").prepend(Styles.$cancelLink);var e=document.querySelector("#postform");if(e&&richFileInput.initForm(e),pups.init(),chpok.init(!0),LatexIT.init(),checkhighlight(),checkgotothread(),checknamesave(),bnrs.init(),getCookie("ku_menutype")){var t=Cookie("ku_menutype");"default"!=t&&""!=t&&(document.getElementById("overlay_menu").style.position=t)}if(processNodeInsertion(),isTouch?(add_mob_menu(),$("body").addClass("touch-mode"),$(".sect-exr:not([data-toexpand=\"_options\"])").parent().hide(),$(".sect-exr").click(function(){return $("#js_settings").is(":visible")?menu_show("_off_"):menu_show("ms-_options"),!1}),offClick.push(function(e){menu_show("_off_"),document.querySelectorAll("[id^=preview]").forEach(function(e){return PostPreviews._mouseout.bind(e)(null,!0)})}),$("body").on("click","a[class^='ref']",PostPreviews._mouseover).on("doubletap",".postnode",function(e){e.stopPropagation(),e.preventDefault(),this.querySelector(".qrl").click()})):(cloud20.init(),$(".sect-exr").mouseenter(function(){menu_show("ms-"+$(this).data("toexpand"))}),$("#overlay_menu").mouseleave(function(){menu_show("_off_")}),$("body").on("mouseenter","a[class^='ref']",function(e){var t=this;this.predelay=setTimeout(function(){return PostPreviews._mouseover.bind(t)(e)},PostPreviews._timings.predelay)}).on("mouseleave","a[class^='ref']",PostPreviews._mouseout).on("click","a[class^='ref']",function(t){t.preventDefault();var e=this.getAttribute("href");highlight(e.split("#")[1],0)||redirectTo(e)})),$("html").click(function(e){return offClick.forEach(function(t){return t(e)})}),$("body").on("click",".uib-mup",function(){return markup($(this).parents("form"),$(this).data("mups"),$(this).data("mupe"),$(this).data("imups"),$(this).data("imupe")),!1}).on("click",".uib-bul",function(){return bullets($(this).parents("form"),$(this).data("bul"),$(this).data("imups"),$(this).data("imupe")),!1}).on("click",".uib-tx",function(){var e=$(this).data("target");return head.js("http://latex.codecogs.com/editor3.js",function(){OpenLatexEditor(e,"phpBB","en-us",!1,"","full")}),!1}).on("click",".movie",function(e){expandVideo($(this),e)}).on("click",".qrl",quickreply).on("click",".hashpic",function(){$(".highlight").removeClass("highlight");var e=$(".hashpic[alt=".concat($(this).attr("alt"),"]")).each(function(){$(this).parents(".posthead").parent().addClass("highlight")}).length;pups.info(_l.found+": "+e,{time:1.5})}).on("click",".posttypeindicator a",function(){var e=$(this),t=$("[name=\""+e.attr("href").substr(1)+"\"]").offset()||$("[name=\""+e.text().split(">>")[1]+"\"]").offset()||!1;return t&&$("html, body").animate({scrollTop:t.top-($("#overlay_menu").height()+10)},250),!1}).on("click",".dice",function(){"undefined"==typeof $(this).data("html")&&$(this).data("html",$(this).html());var e=stripHTML($(this).html());$(this).html($(this).attr("title")),$(this).attr("title",e)}).on("click",".reflink a",function(e){e.preventDefault();var t=this.parentElement,a=t._findParent(".postnode");if(!lastActiveForm)quickreply.bind(a.querySelector(".qrl"))();else{var n=is_overboard?lastActiveForm.getAttribute("id").match(/[0-9]+\-(.+?)_qrf/)[1]:this_board_dir,s=a.querySelector(".postbody"),i=getPostQuotation(s);insert(">>".concat(t.dataset.b==n?"":"/".concat(t.dataset.b,"/")).concat(t.dataset.id,"\n").concat(i))}}).on("click",".embed-play-button",function(e){e.preventDefault(),unwrapEmbed($(this).parents("figure"))}).on("click",".collapse-video",function(e){e.preventDefault(),wrapEmbed($(this).parents("figure"))}).on("mouseenter","._country_",function(){"undefined"==typeof $(this).attr("title")&&$(this).attr("title",countries[$(this).attr("src").split("flags/")[1].split(".png")[0].toUpperCase()])}).on("click",".audiowrap",function(e){e.preventDefault();var t=$(this),a=t.attr("href"),n=t.parents("figure");n.hasClass("unwrapped")||n.addClass("unwrapped unwrapped-audio");var s=n.find(".filesize");s.find(".collapse-btn").length||s.append("\n        <button title=\"".concat(_l.collapse,"\" class=\"emb-button collapse-video\">\n          ").concat(makeIcon("shrink","b-icon"),"\n        </button>")),t.find("audio").length||t.append("<audio src=\""+a+"\" controls autoplay=\"true\"></audio>"),s.find(".collapse-video").click(function(){n.removeClass("unwrapped unwrapped-audio").find("audio")[0].pause()})}).on("change",".multidel",function(){var e=$(".multidel:checked").length;$(".item-count").length||($(".userdelete tbody").prepend("<tr><td>\n        ".concat(_l.selected,":&nbsp;<span class=\"item-count\"></span>\n        <button class=\"close-multisel icon-wraping-button\" title=\"").concat(_l.cancel,"\">").concat(makeIcon("x","b-icon ",!1),"</button>\n      </td></tr>")),$(".close-multisel").click(function(e){e.preventDefault(),$(".multidel").prop("checked",!1),$("body").removeClass("select-multiple"),$(".userdelete").removeClass("ud-active")})),0<e?$(".item-count").text(e):($(".userdelete").removeClass("ud-active"),$("body").removeClass("select-multiple"))}).on("click","label.postinfo",function(e){if(!$(this).find(".multidel").is(":visible")){e.stopPropagation(),e.preventDefault();var t=$(this),a=t.parent().find(".post-menu"),n=!a.is(":visible");if($(".post-menu").hide(),!a.length){var s=$(this).parents(".postnode"),i=s.data("board"),o=s.data("id"),r=s.hasClass("op");this.insertAdjacentHTML("afterend","<div class=\"content-background post-menu\" style=\"display: none\"> \n          <ul>\n            <li class=\"menu-delete\">".concat(makeIcon("x"),"<span>").concat(_l.del,"</span></li>\n            ").concat(r?"":"\n              ".concat("undefined"!=typeof opmod&&+opmod||0?"<li class=\"menu-delete menu-delete-op\">".concat(makeIcon("x"),"<span>").concat(_l.del," ").concat(_l.asOP,"</span></li>"):"","\n              <li class=\"menu-hide\">").concat(makeIcon("hide"),"<span>").concat(_l.hidePost,"</span></li>\n              <li class=\"menu-unhide\">").concat(makeIcon("unhide"),"<span>").concat(_l.unhidePost,"</span></li>\n            "),"\n            <li class=\"menu-report\">").concat(makeIcon("warning"),"<span>").concat(_l.report,"</span></li>\n            <li class=\"menu-link-share\">").concat(makeIcon("link"),"<span>").concat(_l.links,"</span></li>\n            ").concat(s.find(".post-ttl").length?"\n              <li class=\"menu-cancel-timer\">".concat(makeIcon("untimer"),"<span>").concat(_l.cancelTimer,"</span></li>\n            "):"","\n            <li class=\"menu-select-multiple\">").concat(makeIcon("select-multiple"),"<span>").concat(_l.selectMultiple,"</span></li>\n            ").concat(kumod_set?"\n              <li class=\"menu-delete menu-delete-mod\">".concat(makeIcon("x"),"<span>").concat(_l.del," ").concat(_l.asMod,"</span></li>\n              <a href=\"").concat(ku_cgipath,"/manage_page.php?action=bans&amp;banboard=").concat(i,"&amp;banpost=").concat(o,"\">\n                <li class=\"menu-ban\">").concat(makeIcon("ban"),"<span>").concat(_l.ban,"...<span></li>\n              </a>\n              ").concat(r?"\n                <a class=\"stickypost-btn\" onclick=\"Ajax.modThread(this, 'stickypost'); return false\"\n                href=\"".concat(ku_cgipath,"/manage_page.php?action=stickypost&amp;board=").concat(i,"&amp;postid=").concat(o,"\">\n                  <li>").concat(makeIcon("pin"),"<span>").concat(_l.stickthread,"<span></li>\n                </a>\n                <a class=\"unstickypost-btn\" onclick=\"Ajax.modThread(this, 'unstickypost'); return false\"\n                href=\"").concat(ku_cgipath,"/manage_page.php?action=unstickypost&amp;board=").concat(i,"&amp;postid=").concat(o,"\">\n                  <li>").concat(makeIcon("unpin"),"<span>").concat(_l.unstickthread,"<span></li>\n                </a>\n                <a class=\"lockpost-btn\" onclick=\"Ajax.modThread(this, 'lockpost'); return false\"\n                href=\"").concat(ku_cgipath,"/manage_page.php?action=lockpost&amp;board=").concat(i,"&amp;postid=").concat(o,"\">\n                  <li>").concat(makeIcon("lock"),"<span>").concat(_l.lockthread,"<span></li>\n                </a>\n                <a class=\"unlockpost-btn\" onclick=\"Ajax.modThread(this, 'unlockpost'); return false\"\n                href=\"").concat(ku_cgipath,"/manage_page.php?action=unlockpost&amp;board=").concat(i,"&amp;postid=").concat(o,"\">\n                  <li>").concat(makeIcon("unlock"),"<span>").concat(_l.unlockthread,"<span></li>\n                </a>"):""):"","\n          </ul>\n        </div>")),a=t.parent().find(".post-menu")}a.toggle(n)}}).on("click",".file-menu-toggle",function(e){e.stopPropagation(),e.preventDefault();var t=$(".file-menu"),a=$(this),n=a.parent(),s=t.is(":visible");if($(".post-menu").hide(),!(s&&t[0].$boundTo[0]==n[0])){var i=n.offset(),o=n.hasClass("embed-wrap")?22:n.outerHeight();t.css({left:"".concat(i.left,"px"),top:"".concat(i.top+o,"px"),"min-width":"".concat(n.outerWidth(),"px")}).show();var r=n.parents("figure").data("fileid"),l=n.parents(".postnode"),d=l.data("board"),c=l.data("id");t[0].__menuProps={fileid:r,board:d},t[0].$boundTo=n,t.find(".menu-banfile").attr("href","".concat(ku_cgipath,"/manage_page.php?action=bans&banboard=").concat(d,"&banpost=").concat(c,"&banfile=").concat(r))}}).on("click",".post-menu li",function(e){return e.stopPropagation()}).on("click",".menu-select-multiple",function(e){$(".post-menu").hide();var t=$(this).parents(".post-menu"),a=t.hasClass("file-menu"),n=(a?t[0].$boundTo:$(this).parents(".posthead")).find(".multidel");n.length&&(n.prop("checked",!0).trigger("change"),$(".userdelete").addClass("ud-active"),$("body").addClass("select-multiple"))}).on("click",".menu-link-share",function(e){var t=$(this),a=t.find("input").length;if(!a){var n=t.parents(".postnode"),s=n.data("board"),i=n.data("id"),o=ku_boardspath+n.find(".shl").attr("href");t.find("span").html("<input class=\"pm-direct-link pm-link\" type=\"text\" value=\"".concat(o,"\" title=\"").concat(_l.directLink,"\">&nbsp;\n        <input class=\"pm-quote-link pm-link\" type=\"text\" value=\"&gt;&gt;/").concat(s,"/").concat(i,"\" title=\"").concat(_l.quoteLink,"\">")).css({"font-size":0}).find(".pm-direct-link").click()}else t.toggleClass("direct-or-quote")}).on("click",".pm-link",function(e){e.stopPropagation();var t=$(this);$(".pm-link").removeClass("selected"),t.focus().select().addClass("selected")}).on("click",".menu-delete",function(){var e=$(this),t=e.parents(".post-menu"),a=t[0],n=t.hasClass("file-menu"),s=n?t[0].$boundTo:e.parents(".posthead"),i=t.find(".menu-password");e.addClass("spin-around");var o=new FormData;if(t.find(".menu-captcha").length){var r=t.find("input[name=captcha]");if(!r.val())return r.focus(),pups.warn(_l.enterCaptcha),void e.removeClass("spin-around");o.append("captcha",r.val())}n?o.append("delete-file[]",a.__menuProps.fileid):o.append("post[]",s.parents(".postnode").data("id"));var l=e.hasClass("menu-delete-mod");o.append("moddelete",l),o.append("opdelete",+e.hasClass("menu-delete-op")),o.append("board",n?a.__menuProps.board:s.parents(".postnode").data("board")),o.append("postpassword",i.length?i.find("input").val():$("#delform input[name=\"postpassword\"]").val()),Ajax.deleteItems(o,function(a){if(e.removeClass("spin-around"),!!a){var o=a[0];if(!o.success&&s.is(":visible")){if(l)return;i.length||t.prepend("<li class=\"menu-password\">".concat(makeIcon("password"),"\n            <input value=\"").concat(get_password("postpassword"),"\" class=\"make-me-readonly\" type=\"password\" placeholder=\"").concat(_l.password,"\" readonly onfocus=\"this.readOnly=false\"></li>")),o.special_error&&"captchalocked"==o.special_error?addCaptchaToMenu(t):t.find(".menu-password input").select().keydown(function(e){"Enter"==e.key&&(e.preventDefault(),e.stopPropagation())})}else n&&$(".file-menu").hide()}})}).on("click",".menu-report",function(){var e=$(this),t=e.parents(".postnode");e.addClass("spin-around");var a=new FormData;a.append("post[]",t.data("id")),a.append("board",t.data("board")),Ajax.reportPost(a,function(t){e.removeClass("spin-around")})}).on("click",".menu-hide",function(){var e=$(this).parents(".postnode");HiddenItems.hidePost(e.data("id")+"-"+e.data("board")),e.addClass("post-hidden").find(".post-menu").hide()}).on("click",".menu-unhide",function(){var e=$(this).parents(".postnode");HiddenItems.unhidePost(e.data("id")+"-"+e.data("board")),e.removeClass("post-hidden")}).on("click",".menu-cancel-timer",function(){var e=$(this),t=e.parents(".post-menu"),a=t[0],n=t.find(".menu-password"),s=e.parents(".postnode");e.addClass("spin-around");var i=new FormData;if(t.find(".menu-captcha").length){var o=t.find("input[name=captcha]");if(!o.val())return o.focus(),pups.warn(_l.enterCaptcha),void e.removeClass("spin-around");i.append("captcha",o.val())}i.append("post[]",s.data("id")),i.append("board",s.data("board")),i.append("modsave",e.hasClass("menu-delete-mod")),i.append("opsave",e.hasClass("menu-delete-op")),i.append("postpassword",n.length?n.find("input").val():$("#delform input[name=\"postpassword\"]").val()),Ajax.cancelTimer(i,function(a){if(e.removeClass("spin-around"),a.length){var s=a[0];n.length||t.prepend("<li class=\"menu-password\">".concat(makeIcon("password"),"\n            <input value=\"").concat(get_password("postpassword"),"\" class=\"make-me-readonly\" type=\"password\" placeholder=\"").concat(_l.password,"\" readonly onfocus=\"this.readOnly=false\"></li>")),s.special_error&&"captchalocked"==s.special_error?addCaptchaToMenu(t):t.find(".menu-password input").select().keydown(function(e){"Enter"==e.key&&(e.preventDefault(),e.stopPropagation())})}else t.find(".menu-password, .menu-captcha").remove()})}).on("click",".csswrap",function(e){e.preventDefault();var t=$(this).attr("href"),a=$(this).parent().find(".fc-filename").text();Styles.testStyle(t,a)}).on("blur","input[name=\"name\"]",function(){var e=~this.value.indexOf("#");this.type=e?"password":"text"}).on("focus","input[name=\"name\"]",function(){this.type="text"}),offClick.push(function(e){$(".post-menu").hide()}),$(window).resize(function(){var e=$(".file-menu");if(e.is(":visible")){var t=e[0].$boundTo,a=t.offset(),n=t.hasClass("embed-wrap")?22:t.outerHeight();e.css({left:"".concat(a.left,"px"),top:"".concat(a.top+n,"px"),"min-width":"".concat(t.outerWidth(),"px")})}}),$(".userdelete").addClass("content-background reflinkpreview").find("tbody").append("<tr><td><input name=\"moddelete\" value=\"".concat(_l.del," (").concat(_l.mod_,")\" type=\"submit\" class=\"styled-button bad-button\" /></td></tr>")),$("#delform").on("submit",function(t){return t.preventDefault(),Ajax.deleteItems(new FormData(this)),!1}),$(".userdelete input[type=submit]").click(function(t){t.preventDefault(),t.stopPropagation();var e=new FormData($(this).parents("form")[0]);("deletepost"==this.name||"moddelete"==this.name)&&Ajax.deleteItems(e,null,"moddelete"==this.name),"cancel_timer"==this.name&&Ajax.cancelTimer(e),"reportpost"==this.name&&Ajax.reportPost(e)}),is_overboard||$("#delform").after("<div id=\"rswapper\">[<a onclick=\"javascript:rswap.swap();return false;\" href=\"#\">"+(ispage?_l.NewThread:_l.reply)+"</a>]<hr /></div>"),Settings.sfwMode(!1),localStorage)for(var a in Settings)"_"!=a.substring(0,1)&&($("#js_settings").append("<label><input type=\"checkbox\" onchange=\"javascript:Settings."+a+"(true)\" name=\"settings_"+a+"\" id=\"settings_"+a+"\" value=\"true\"> "+_l["settings_"+a]+"</label><br />"),Settings[a](!1));else $("#js_settings").append("<span style=\"color:#F00\">"+_l.noLocalStorage+"</span><br />\u0422\u0432\u043E\u0439 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u2014 \u0433\u043E\u0432\u043D\u043E. \u0421\u043A\u0430\u0447\u0430\u0439 <a href=\"/web/20110329072959/http://google.com/chrome\" target=\"_blank\">Chome</a>, \u043D\u0430\u043F\u0440\u0438\u043C\u0435\u0440.");var n=document.getElementById("message");n&&(n.onfocus=function(){is_entering=!0},n.onblur=function(){is_entering=!1}),$("body").append("\n    <div class=\"content-background post-menu file-menu\" style=\"display: none\"> \n      <ul>\n        <li class=\"menu-delete\">".concat(makeIcon("x"),"<span>").concat(_l.del,"</span></li>\n        <li class=\"menu-select-multiple\">").concat(makeIcon("select-multiple"),"<span>").concat(_l.selectMultiple,"</span></li>\n        ").concat(kumod_set?"\n          <li class=\"menu-delete menu-delete-mod\">".concat(makeIcon("x"),"<span>").concat(_l.del," ").concat(_l.asMod,"</span></li>\n          <a href=\"").concat(ku_cgipath,"/manage_page.php?action=bans\" class=\"menu-banfile\">\n            <li>").concat(makeIcon("ban"),"<span>").concat(_l.ban," ").concat(_l.file.toLowerCase(),"...</span></li>\n          </a>"):"","\n      </ul>\n    </div>\n  ")),$(document).on("animationstart webkitAnimationStart MSAnimationStart oanimationstart",function(e){var t=$(e.target);"nodeInserted"!=e.originalEvent.animationName||t.hasClass("_inserted_")||processNodeInsertion(t),"windowSmall"==e.originalEvent.animationName&&document.querySelectorAll(".quick-reply-form").forEach(function(e){toggleFormFloating(e,!1),toggleFormSimplify(e,!0)})}),Captcha.init(is_overboard),initForm(document.querySelector("#postform")),"undefined"!=typeof is_catalog&&is_catalog&&catalog.init(),$("<div id=\"tripinfo\"></div>").addClass("content-background reflinkpreview qreplyform").hide().appendTo("body"),$("#delform").on("click",".postertrip",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).text().split("!")[1],a=$(this).offset(),n=$(this).height();$.getJSON("/tripinfo.php",{trip:t}).done(function(e){var s=[];_.each(e.active_on,function(e){s.push("<a target=\"_blank\" href=\""+ku_boardspath+"/"+e+"/\">/"+e+"/</a>")}),$("#tripinfo").html("<div><b class=\"postertrip\">!"+t+"</b> [<a href=\"https://www.google.com/search?q=!"+t+"\" target=\"_blank\">G</a>]</div><a style=\"float:left;\" href=\"#\" onclick=\"javascript:$('#tripinfo').hide();return false;\"><svg style=\"position: absolute; top: 3px; right: 3px;\" class=\"icon b-icon\"><use xlink:href=\"#i-x\"></use></svg></a><div class=\"trip-info-line\">"+_l.threads+": "+e.threads+", "+_l.comments+": "+e.comments+"</div><div class=\"trip-info-line\">"+_l.active_since+": "+catalog.formatDate(e.active_since,!0)+"</div><div class=\"trip-info-line\">"+_l.last_active+": "+catalog.formatDate(e.last_active,!0)+"</div>"+(s.length?"<div class=\"trip-info-line\">"+_l.active_on+": "+s.join(", ")+"</div>":"")).css({top:a.top+n,left:a.left}).fadeIn("fast")}).fail(function(e){console.error(e)})}),unreadCounter.update(),liveupd_ena&&"undefined"!=typeof io&&updater.init(),onReady.ready()}(function(e){e.event.special.doubletap={bindType:"touchend",delegateType:"touchend",handle:function handle(t){var a=t.handleObj,n=jQuery.data(t.target),s=new Date().getTime(),i=n.lastTouch?s-n.lastTouch:0,o=null==o?300:o,r=t.originalEvent;i<o&&30<i&&!(r.touches&&1<r.touches.length)?(n.lastTouch=null,t.type=a.origType,["clientX","clientY","pageX","pageY"].forEach(function(e){t[e]=t.originalEvent.changedTouches[0][e]}),a.handler.apply(this,arguments)):n.lastTouch=s}}})(jQuery);var NTP={calc:function calc(e,t,a,n){return(t-e+(a-n))/2},sync:function sync(e){this.pending=!0;var t=this,a=new Date().valueOf();$.ajax({url:"/ntp.php",success:function success(e){var n=e,s=e,i=new Date().valueOf();t.offset=t.calc(a,n,s,i)},error:function error(){pups.err("Failed to synchronize time with the server")},complete:function complete(){for(t.synced=!0;t.stack.length;)t.stack.shift().resolve(t.timeWithOffset)}})},offset:0,stack:[],get timeWithOffset(){return new Date(new Date().getTime()+this.offset).getTime()},getServerTime:function getServerTime(){if(this.synced)return Promise.resolve(this.timeWithOffset);var e=externallyResolvingPromise();return this.pending||this.sync(),this.stack.push(e),e.promise}};function externallyResolvingPromise(){var e,t,a=new Promise(function(a,n){e=a,t=n});return{promise:a,resolve:e,reject:t}}function processNodeInsertion(e){"undefined"==typeof e?e=$("body"):(e.addClass("_inserted_"),e=e.parents(":eq(1)")),e.find(".prettyprint").length&&prettyPrint.apply(window),LatexIT.render(e),e.find(".post-ttl:not(._inserted_)").each(function(){var e=$(this);e.addClass("_inserted_");var t,a=function updateTTL(){e.length?NTP.getServerTime().then(function(a){var n=1e3*e.data("deleted-timestamp")-a;if(0<=n){var s=Math.round(n/6e4),i=Math.floor(s/60);s-=60*i,e.text("".concat(_.padLeft(i,2,"0"),":").concat(_.padLeft(s,2,"0")))}else $.get(document.forms.delform.action),_deleteItems([{action:"delete_post",id:e.parents(".postnode").data("id")}],!1,updater.markOnly),clearInterval(t)}):clearInterval(t)};t=setInterval(a,30000),a()})}var chpok={init:function init(){var e=!!(0<arguments.length&&arguments[0]!==void 0)&&arguments[0];document.body.insertAdjacentHTML("beforeend","<audio id=\"chpok-audio\" style=\"display:none\">\n      <source src=\"".concat(ku_boardspath,"/images/chpok.mp3\">\n      <source src=\"").concat(ku_boardspath,"/images/chpok.ogg\">\n    </audio>")),this.initiated=!0,this.audio=document.querySelector("#chpok-audio")},play:function play(){this.initiated||this.init(),this.audio.play()["catch"](function(t){return _.noop})}},updater={newThreads:[],init:function init(){this.socket=io.connect(liveupd_api);var e;ispage?(e=[liveupd_sitename+this_board_dir+":threads"],document.querySelectorAll(".postnode.op").forEach(function(t){return e.push(liveupd_sitename+t.dataset.board+":"+t.dataset.id)})):(e=[liveupd_sitename+this_board_dir+":"+$("input[name=replythread]").val()],_l.noNewPosts+="<br>"+_l.threadUpdationAutomatically),this.socket.on("update",this.dispatch.bind(this)).emit("subscribe",e),Object.defineProperty(this,"markOnly",{value:!0,writable:!1,configurable:!1})},dispatch:function dispatch(e){if(!e.action)return pups.warn("Event with unspecified action, see console"),void console.warn(e);if("new_thread"==e.action){if(e.token&&Ajax.postToken&&e.token==Ajax.postToken)return;this.notifyAboutNewThreads(e)}if("new_reply"==e.action){if(e.token&&Ajax.postToken&&e.token==Ajax.postToken)return;ispage?this.notifyAboutNewRepliesOnBoardPage(e):this.showNewReplies(e)}if("delete"==e.action){if(e.token&&Ajax.delToken&&e.token==Ajax.delToken)return;_deleteItems(e.items,!1,this.markOnly)}if("cancel_timer"==e.action){if(e.token&&Ajax.timerToken&&e.token==Ajax.timerToken)return;var t=[],a="";e.items.forEach(function(e){$(".postnode[data-id=".concat(e.id,"] .post-ttl")).remove(),t.push(e.id)}),t.length&&(a=1<t.length?"".concat(_l.posts," #").concat(t.join(", #")," ").concat(_l.savedMulti,"."):"".concat(_l.post," #").concat(t[0]," ").concat(_l.saved,"."),pups.info(a,{time:2+t.length}))}},showNewReplies:function showNewReplies(e){newposts.get({silent:!0,timestamp:e.timestamp,onSuccess:function onSuccess(){document.hasFocus()||chpok.play()}})},notifyAboutNewThreads:function notifyAboutNewThreads(e){this.newThreads.push({board:e.board,board_desc:e.board_desc||!1,thread:e.new_thread_id}),document.hasFocus()?!$("#wild_thread_appeared").length&&$("#delform").before("<a class=\"xlink\" onclick=\"updater.showNewThreads();return false\" id=\"wild_thread_appeared\"><span class=\"salient\">"+_l.newThreadsAvailable+"</span><hr /></a>"):(scrollAnchor.save("autoload",".postnode"),this.showNewThreads(function(){return scrollAnchor.restore("autoload")}),chpok.play())},notifyAboutNewRepliesOnBoardPage:function notifyAboutNewRepliesOnBoardPage(e){var t=e.room+"-"+e.board;this.repliesOnBoardPage[t]?this.repliesOnBoardPage[t].push(e.reply_id):this.repliesOnBoardPage[t]=[e.reply_id],this.refreshNewRepliesCount(e.board,e.room,e.timestamp)},refreshNewRepliesCount:function refreshNewRepliesCount(e,t){var a=this,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,s=t+"-"+e,i=(this.repliesOnBoardPage[s]||[]).length,o=$("[id^=replies"+s+"]"),r=o.find(".fresh-replies"),l=function clearCounter(){return a.repliesOnBoardPage[s]=[]};if(i){if(!r.length){var d=function loadNewReplies(e){newposts.get({threadid:s,onSuccess:function onSuccess(){l(),e&&e()},onError:function onError(t){console.error(t),pups.err(_l.oops)},silent:!0,timestamp:n})};if(!document.hasFocus())scrollAnchor.save("autoload",".postnode"),d(function(){return scrollAnchor.restore("autoload")}),chpok.play();else{var c=o.append("<br class=\"fresh-replies-breaker\"><a href=\"/"+e+"/res/"+t+".html\" class=\"salient fresh-replies\">"+_l.newReplies+": <span class=\"fresh-replies-number\"></span></a>").find(".fresh-replies"),p=c[0];c.click(function(t){t.preventDefault();c.__alreadyLoading||(p.__alreadyLoading=!0,p.insertAdjacentHTML("afterBegin","<div class=\"spinner\"></div>"),d(function(){return $(p).remove()}))})}}o.find(".fresh-replies-number").text(i)}else r.length&&(r.remove(),l())},repliesOnBoardPage:{},showNewThreads:function showNewThreads(e){var t=this,a=$("#wild_thread_appeared");a.length&&a.find("span")[0].insertAdjacentHTML("afterBegin","<div class=\"spinner\"></div>"),this.newThreads.forEach(function(n){HTMLoader.getThread(n.board,n.thread,null,function(s,i){return s?pups.err(_l.noDataLoaded):void(a.remove(),document.querySelector("#delform").insertAdjacentHTML("afterBegin","\n            ".concat(i,"\n            <div id=\"replies").concat(n.thread,"-").concat(n.board,"\" class=\"replies\"></div>\n          </div>\n          <br clear=\"left\" />\n          <hr>")),is_overboard&&n.board_desc&&document.querySelector("#delform .posthead").insertAdjacentHTML("afterbegin","<a href=\"/".concat(n.board,"\" target=\"_blank\" class=\"over-boardlabel\">/").concat(n.board,"/ \u2014 ").concat(n.board_desc,"</a>")),t.socket.emit("subscribe",liveupd_sitename+n.board+":"+n.thread),e&&e())})}),this.newThreads=[]}};function _deleteItems(e){var t,a=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],s=[],i=[],o=[],r=[];if(e.forEach(function(e){var l="deleted"+(e.by_op?" op-deleted":"")+(e.by_mod?" mod-deleted":"");if("delete_post"==e.action||"post"==e.itemtype){if(a&&!e.success)return void i.push(e);t=!1;var d=$("#delform [id^=thread".concat(e.id,"]")),c=$("#delform [id^=reply".concat(e.id,"]"));if(d.length)n||!ispage?(d.addClass("deleted").find(".reply, figure").addClass(l),!ispage&&(t=!0,$("form[name=postform], .qrl, #rswapper").remove(),pups.warn("".concat(_l.thread," ").concat(_l.deleted,"!"),{time:0}))):(d.prev().remove(),d.next().remove(),d.next().remove(),d.remove());else if(!c.length)updater.repliesOnBoardPage[e.thread_id]&&(updater.repliesOnBoardPage[e.thread_id]=updater.repliesOnBoardPage[e.thread_id].filter(function(t){return t!=e.id})),updater.refreshNewRepliesCount(e.thread_id);else if(n)c.addClass(l);else{var p=$("#delform [id^=reply".concat(e.id,"]"));p.length&&p.parents(".postnode").remove()}t||s.push("#"+e.id)}if("delete_file"==e.action||"file"==e.itemtype){if(a&&!e.success)return void r.push(e);var u=$("figure[data-fileid=".concat(e.id,"]"));n?u.addClass(l):u.replaceWith("<div class=\"nothumb\">".concat(_l.fileRemoved,"</div>")),o.push("#"+e.id)}"delete_thread"==e.action&&(updater.newThreads=updater.newThreads.filter(function(t){return t!=e.id}),!updater.newThreads.length&&$("#wild_thread_appeared").remove(),pups.info("".concat(_l.thread," ").concat(e.id," ").concat(_l.deleted,".")))}),$(".multidel").is(":checked")||$(".multidel.delete-file").is(":checked")||($(".userdelete").removeClass("ud-active"),$("body").removeClass("select-multiple")),s.length){var l=1<s.length?"".concat(_l.posts," ").concat(s.join(", ")," ").concat(_l.deletedMulti,"."):"".concat(_l.post," ").concat(s[0]," ").concat(_l.deleted,".");pups[a?"succ":"info"](l,{time:2+s.length})}if(o.length){var d=1<o.length?"".concat(_l.files," ").concat(o.join(", ")," ").concat(_l.deletedMulti,"."):"".concat(_l.file," ").concat(o[0]," ").concat(_l.deleted,".");pups[a?"succ":"info"](d,{time:2+o.length})}i.length&&pups.err(i.map(function(e){return"".concat(_l.post," #").concat(e.id,": ").concat(e.message)}).join("<br>"),{time:2+i.length}),r.length&&pups.err(r.map(function(e){return"".concat(_l.file," #").concat(e.id,": ").concat(e.message)}).join("<br>"),{time:2+r.length})}if(+localStorage.localmod)kumod_set=!0;else{var kumod=getCookie("kumod");""!==kumod&&("allboards"===kumod?kumod_set=!0:kumod_set=in_array(this_board_dir,kumod.split("|")))}function expandVideo_old(e){var t=Math.round,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"autoplay",n=e.parents(".reply");if("1"!==e.data("expanded")){var s=e.attr("href"),i=e.data("height"),o=e.data("width"),r=e.data("thumb"),l=e.data("id"),d="_vframe_"+randomString(5)+new Date().getTime();e.replaceWith(function(){return"<span id=\""+d+"\" data-thumb=\""+r+"\" data-width=\""+o+"\"\" data-height=\""+i+"\" data-href=\""+s+"\">"+this.innerHTML+"</span>"}),e=$("#"+d),e.find("img").hide();var c=e.find("video").show(),p="";if(c.length?!a&&c.get(0).pause():(e.find(".playable-thumb").append("<video class=\"thumb\" src=\"".concat(s,"\" controls loop ").concat(a," preload=\"\" height=\"").concat(i,"\" width=\"").concat(o,"\"></video>")).promise().done(function(){c=e.find("video")}),c[0].volume=localStorage.mediaVolume||1,c[0].onvolumechange=function(){localStorage.mediaVolume=this.muted?0:this.volume}),!Settings.expandImgFull()){for(var u=50,m=c[0],h=document.documentElement?document.documentElement.clientWidth:document.body.clientWidth;null!=m;)u+=m.offsetLeft,m=m.offsetParent;var g=h-u;if(o>g){var f=o/i,v=1-g/o,b=g/f;c.width(g),c.height(b),p=_l.videoDownscaledBy+" "+t(100*v)+"% "+_l.toFit}}var y=e.parents("figure");y.hasClass("unwrapped")||y.addClass("unwrapped");var w=e.parent().find(".filesize");w.find(".collapse-btn").length||(w.append("\n        <button title=\"".concat(_l.collapse,"\" class=\"emb-button collapse-video\">\n          ").concat(makeIcon("shrink","b-icon"),"\n        </button>")),e.parent().find(".collapse-video").click(function(){y.removeClass("unwrapped");var t="_vframe_"+randomString(5)+new Date().getTime();return e.replaceWith(function(){return"<a class=\"movie\" id=\""+t+"\" data-thumb=\""+r+"\" data-width=\""+o+"\"\" data-height=\""+i+"\" href=\""+s+"\">"+this.innerHTML+"</a>"}).data("expanded","0"),e=$("#"+t),e.find("video").hide()[0].pause(),e.find("img").show(),$(this).remove(),e.parents(".reply").removeClass("reply-expanded"),!1})),e.parents(".reply").addClass("reply-expanded")}}function expandVideo(e,t){if(t.preventDefault(),Settings.newMediaViewer()){var a=_construct(MediaViewer,_toConsumableArray(MediaViewer.parseVideo(e[0])).concat([!0]));a.onCollapse=function(){return a=null}}else expandVideo_old(e);return!1}function checknamesave(){var e;e=""!=getCookie("name");var t=document.getElementById("save");null!=t&&(t.checked=e)}function checkgotothread(){var e;e="off"!=getCookie("tothread"),$("#gotothread").attr("checked",e)}function navigatepages(e){if(document.getElementById&&!is_entering)if(window.event&&(e=window.event),e.ctrlKey){var t=null,a=null,n=document.location.toString();if(-1!=n.indexOf("/res/"))"Enter"==e.key&&handleCtrlEnter(e);else{if(-1==n.indexOf(".html")||-1!=n.indexOf("board.html"))var s=0,i=n.substr(0,n.lastIndexOf("/")+1);else{var s=n.substr(n.lastIndexOf("/")+1);s=+s.substr(0,s.indexOf(".html"));var i=n.substr(0,n.lastIndexOf("/")+1)}if(0==s)var o=i;else var o=i+s+".html";var r;if(r=/#s([0-9]+)/.exec(n))var l=+r[1];else var l=-1;for(var d=0;0<document.getElementsByName("s"+ ++d).length;);switch(e.key){case"Enter":handleCtrlEnter(e);break;case"ArrowLeft":t=document.getElementById("prevPage");break;case"ArrowRight":t=document.getElementById("nextPage");break;case"ArrowDown":if(l==d-1)break;else var c=l+1;a=o+"#s"+c;break;case"ArrowUp":if(-1==l||0==l)break;else var c=l-1;a=o+"#s"+c;break;case"Home":document.location=i;}t&&t.action&&(document.location=t.action),a&&redirectTo(a)}}else{var p=document.querySelector(".media-viewer:not(.mv-transparent)");p&&("ArrowLeft"==e.key&&p.querySelector(".mv-prev").click(),"ArrowRight"==e.key&&p.querySelector(".mv-next").click(),"Escape"==e.key&&p.querySelector(".mv-close").click())}}window.document.addEventListener?window.document.addEventListener("keydown",navigatepages,!1):window.document.attachEvent("onkeydown",navigatepages),NodeList.prototype.forEach=Array.prototype.forEach,NodeList.prototype.map=Array.prototype.map,Element.prototype._findParent=function(e){for(var t=this;t&&!t.matches(e);)if(t=t.parentNode,!t.matches)return null;return t},Element.prototype._findNext=function(e){for(var t=this.nextElementSibling;t&&!t.matches(e);)if(t=t.nextElementSibling,!t)return null;return t},Element.prototype._findPrevious=function(e){for(var t=this.previousElementSibling;t&&!t.matches(e);)if(t=t.previousElementSibling,!t)return null;return t},Node.prototype._isChildOf=function(e){for(var t=this.parentNode;t;){if(t==e)return!0;t=t.parentNode}return!1};var replyMap={showReplies:function showReplies(){var e=this,t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:document;t.querySelectorAll(".postnode").forEach(function(t){var a=t.dataset.id,n=t.dataset.board,s=t._findParent("div[id^=thread]"),i=s&&s.dataset.threadid,o=t.querySelector(".postmessage"),r=t.querySelector(".replieslist");e.posts[n]||(e.posts[n]={}),e.posts[n][a]?e.posts[n][a].container=r:e.posts[n][a]={container:r,replies:[]};var l=o.querySelectorAll("a[class^=ref\\|]");l.length&&l.forEach(function(t){var s=t.className.split(" ")[0].split("|"),o=s[1],r=s[3],l="/".concat(n,"/res/").concat(i,".html#").concat(a),d="<a class=\"ref-reply\" href=\"".concat(l,"\">&gt;&gt;").concat(n==o?"":"/".concat(n,"/")).concat(a,"</a>");e.posts[o]&&e.posts[o][r]?!_.includes(e.posts[o][r].replies,d)&&e.posts[o][r].replies.push(d):(!e.posts[o]&&(e.posts[o]={}),e.posts[o][r]={replies:[d]}),e.posts[o][r].skip=!1})}),_.each(this.posts,function(e){return _.each(e,function(e){!e.skip&&e.replies.length&&e.container&&(e.container.innerHTML="".concat(_l.replies,": ").concat(e.replies.join(", ")),e.skip=!0)})})},posts:{}},scrollAnchor={save:function save(e,t){var a=Math.abs,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:window,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"v";if(!window.scrollY)return void(this.saved[e]={_top:!0});var i=[window.innerWidth/2,window.innerHeight/2],o=[],r=n==window?{left:0,top:0,right:window.innerWidth,bottom:window.innerHeight}:n.getBoundingClientRect();n!=window&&(0>=r.left&&0>=r.right||0>=r.top&&0>=r.bottom||r.left>=window.innerWidth||r.top>=window.innerHeight)&&(i=[r.left+r.width/2,r.top+r.height/2]);var l=t instanceof Node?[t]:t instanceof NodeList?t:(n==window?document:n).querySelectorAll(t);if(l.length){l.forEach(function(e){var t=Math.pos,n=e.getBoundingClientRect(),l=t(n.width-(t(r.left-n.left)+t(n.right-r.right)))/n.width,d=t(n.height-(t(r.top-n.top)+t(n.bottom-r.bottom)))/n.height,c=a(i[0]-(n.left+n.width/2)),p=a(i[1]-(n.top+n.height/2));o.push({el:e,primaryVisibility:"h"==s[0]?l:d,secondaryVisibility:"v"==s[0]?l:d,primaryOffset:"h"==s[0]?c:p,secondaryOffset:"v"==s[0]?c:p})}),o.sort(function(e,t){return t.primaryVisibility===e.primaryVisibility?1<s.length&&t.secondaryVisibility!==e.secondaryVisibility?t.secondaryVisibility-e.secondaryVisibility:e.primaryOffset===t.primaryOffset?1<s.length?e.secondaryOffset-t.secondaryOffset:void 0:e.primaryOffset-t.primaryOffset:t.primaryVisibility-e.primaryVisibility});var d=o[0].el,c=d.getBoundingClientRect();this.saved[e]={anchor:d,left:c.left,top:c.top,parent:n,dimensions:s}}},restore:function restore(e){var t=this;return new Promise(function(a,n){var s=t.saved[e];s?window.requestAnimationFrame(function(){if(s._top)return window.scrollTo(0,0),void a();var e=s.anchor.getBoundingClientRect();s.parent.scrollBy(-1===s.dimensions.indexOf("h")?0:e.left-s.left,-1===s.dimensions.indexOf("v")?0:e.top-s.top),a()}):n()})},saved:{}};Math.pos=function(e){return 0<=e?e:0},function(){for(var e=0,t=["ms","moz","webkit","o"],a=0;a<t.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[t[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[a]+"CancelAnimationFrame"]||window[t[a]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,a){var n=Math.max,s=new Date().getTime(),i=n(0,16-(s-e)),o=window.setTimeout(function(){t(s+i)},i);return e=s+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var menu_current="",menu_last="";function menu_show(e){if(""!=menu_current){var t="_off_"==e?125:0;$("#"+menu_current).delay(t).slideUp(100),menu_last=menu_current}""!=e&&(menu_last==e&&"undefined"!=typeof $("#"+e).queue()&&0<$("#"+e).queue().length?$("#"+e).clearQueue():$("#"+e).slideDown(150)),menu_current=e}function menu_pin(){"absolute"==document.getElementById("overlay_menu").style.position?(document.getElementById("overlay_menu").style.position="fixed",Cookie("ku_menutype","fixed",365)):(document.getElementById("overlay_menu").style.position="absolute",Cookie("ku_menutype","absolute",365))}function toggle_oldmenu(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null;null===e&&(e="yes"!=getCookie("ku_oldmenu")),injector.inject("oldmenu","#".concat(e?"overlay_menu":"head_oldmenu"," { display: none }")),e&&!document.getElementById("head_oldmenu")&&document.getElementById("boardlist_header").insertAdjacentHTML("afterBegin","<div id=\"head_oldmenu\" class=\"boardlist\">\n      ".concat(document.getElementById("ns_oldmenu").innerText,"\n      <a href=\"#\" onclick=\"javascript:toggle_oldmenu();\" class=\"bl-sect\" style=\"order:1\">[overlay]</a>\n    </div>")),Cookie("ku_oldmenu",e?"yes":"no",90)}var LatexIT={mode:"gif",init:function init(){document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")&&(this.mode="svg")},odc:"javascript:LatexIT.replaceWithSrc(this);",dcls:"Double click to show source",pre:function pre(eqn){var txt=eqn.innerHTML;if(!txt.match(/<img.*?>/i)&&!txt.match(/<object.*?>/i)){txt=txt.replace(/<br>/gi,"").replace(/<br \/>/gi,"").replace(/&amp;/mg,"&");var atxt="[tex]"+txt+"[/tex]";txt=escape(txt.replace(/\\/mg,"\\"));var c=eval("LatexIT.normalize"+$(eqn).parent().css("color")),extxt="{\\color[rgb]{"+c.r+","+c.g+","+c.b+"}"+txt+"}";txt=" <img src=\"http://latex.codecogs.com/"+this.mode+".latex?"+extxt+"\" title=\""+this.dcls+"\" alt=\""+atxt+"\" ondblclick=\""+this.odc+"\" border=\"0\" class=\"latex\" /> "}return txt},replaceWithSrc:function replaceWithSrc(e){var t=$(e).attr("alt");$(e).parent().html(t)},render:function render(e){for(var t="undefined"==typeof e?window.document:e[0],a=t.getElementsByTagName("*"),n=0;n<a.length;n++)("latex"==a[n].getAttribute("lang")||"latex"==a[n].getAttribute("xml:lang"))&&(a[n].innerHTML=this.pre(a[n]))},normalizergb:function normalizergb(e,t,a){return{r:(e/255).toFixed(3),g:(t/255).toFixed(2),b:(a/255).toFixed(2)}},normalizergba:function normalizergba(e,t,n,s){return this.normalizergb(e,t,n)}};function in_array(e,t){return"object"===_typeof(t)?_.includes(t,e):e===t}(function(t){t.fn.drags=function(a){if(a=t.extend({handle:"",cursor:"move"},a),""===a.handle)var n=this;else var n=this.find(a.handle);return n.css("cursor",a.cursor).on("mousedown",function(n){if(""===a.handle)var e=t(this).addClass("draggable");else var e=t(this).addClass("active-handle").parent().addClass("draggable");var s=e.css("z-index"),i=e.outerHeight(),o=e.outerWidth(),r=e.offset().top+i-n.pageY,l=e.offset().left+o-n.pageX;e.css("z-index",1e3).parents().on("mousemove",function(n){a.onMove&&a.onMove(),t(".draggable").offset({top:n.pageY+r-i,left:n.pageX+l-o}).on("mouseup",function(){t(this).removeClass("draggable").css("z-index",s)})}),n.preventDefault()}).on("mouseup",function(){""===a.handle?t(this).removeClass("draggable"):t(this).removeClass("active-handle").parent().removeClass("draggable")})},t.fn.dragsOff=function(e){if(e=t.extend({handle:"",cursor:"default"},e),""===e.handle){var a=this;t(this).removeClass("draggable")}else{var a=this.find(e.handle);t(this).removeClass("active-handle").parent().removeClass("draggable")}return a.css("cursor","default").off("mousedown").off("mouseup").off("mousemove")}})(jQuery);function unwrapEmbed(e){e.addClass("unwrapped");var t=e.find(".emb-iframe-wrapper");t.data("h")>t.data("w")&&t.addClass("vertical-video"),"Soundcloud"==t.data("site")&&t.addClass("soundcloud-embed"),t.css({paddingBottom:"".concat(100*(t.data("h")/t.data("w")),"%")});var a=t.data("code"),n="frameborder=\"0\" scrolling=\"no\" webkitallowfullscreen=\"\" mozallowfullscreen=\"\" allowfullscreen=\"\"";if("Youtube"==t.data("site")){var s=t.data("startraw");t.append("<iframe src=\"https://www.youtube-nocookie.com/embed/".concat(a,"?autoplay=1").concat(s?"&start=".concat(s):"","\" ").concat("frameborder=\"0\" scrolling=\"no\" webkitallowfullscreen=\"\" mozallowfullscreen=\"\" allowfullscreen=\"\"","></iframe>"))}if("Vimeo"==t.data("site")){var i=t.data("start");t.append("<iframe src=\"//player.vimeo.com/video/".concat(a,"?badge=0&autoplay=1").concat(i?"#t=".concat(i):"","\" ").concat("frameborder=\"0\" scrolling=\"no\" webkitallowfullscreen=\"\" mozallowfullscreen=\"\" allowfullscreen=\"\"","></iframe>"))}if("Soundcloud"==t.data("site")){var o=encodeURI(a),r=t.data("start");t.append("<iframe src=\"https://w.soundcloud.com/player/?url=https%3A%2F%2Fapi.soundcloud.com%2Ftracks%2F".concat(o,"\" ").concat("frameborder=\"0\" scrolling=\"no\" webkitallowfullscreen=\"\" mozallowfullscreen=\"\" allowfullscreen=\"\"","></iframe>"))}"Coub"==t.data("site")&&t.append("<iframe src=\"http://coub.com/embed/".concat(a,"?muted=false&autostart=true&originalSize=false&hideTopBar=false&noSiteButtons=false&startWithHD=false\" ").concat("frameborder=\"0\" scrolling=\"no\" webkitallowfullscreen=\"\" mozallowfullscreen=\"\" allowfullscreen=\"\"","></iframe>"));var l=e.find(".embed-wrap");l.find(".collapse-video").length||e.find(".embed-wrap").append("\n      <button title=\"".concat(_l.collapse,"\" class=\"emb-button collapse-video\">\n        ").concat(makeIcon("shrink"),"\n      </button>"))}function wrapEmbed(e){e.removeClass("unwrapped"),e.find(".emb-iframe-wrapper").empty()}function resetForm(e){var t=!!(1<arguments.length&&arguments[1]!==void 0)&&arguments[1],a=e.querySelectorAll("input[type=text]:not([name=name]), input[type=file], textarea");a.forEach(function(e){return e.value=null}),e.querySelectorAll(".site-indicator").forEach(function(e){return e.remove()}),richFileInput.clear(e,!t),e.querySelectorAll("input[name^=addembed], input[name^=addfile], input[name=ttl-enable]").forEach(function(e){e.checked=!1,"ttl-enable"==e.name&&e.onchange&&e.onchange()})}function initForm(e){if(e){var t=$(e);e.querySelectorAll("input[name^=embed]").forEach(function(e){e.addEventListener("input",function(){var e=this.parentElement.querySelector(".site-indicator");e&&e.remove();var t=embedLinks.process(this.value);t&&this.insertAdjacentHTML("afterend","<img src=\"".concat(ku_boardspath,"/images/site-logos/").concat(t.site,".png\" class=\"site-indicator\">"))})}),e.querySelectorAll("input[name^=imagefile]").forEach(function(e){e.addEventListener("change",function(){if(this.value){var e=this.parentElement.nextElementSibling;e&&(e.checked=!0)}})}),e.querySelectorAll(".opt-exp").forEach(function(e){e.onclick=function(e){e.preventDefault(),this.querySelector(".expandee").classList.toggle("expanded")},e.onmouseleave=function(e){var t=this;this.hideTimeout=setTimeout(function(){return t.querySelector(".expandee").classList.remove("expanded")},250)},e.onmouseenter=function(){clearTimeout(this.hideTimeout)}});var a=e.querySelector(".code_markup_select");a&&(a.onchange=function(){markup(t,"[code=".concat(this.value,"]"),"[/code]")}),e.querySelector(".quote_select").onchange=function(){quotes(t,this.value)};var n=e.id+"_textarea";e.querySelector("textarea").id=n,e.querySelector(".uib-tx").dataset.target=n,Captcha.enabled&&"only-access"!==Captcha.enabled&&Captcha.initForm(e),e.querySelectorAll(".make-me-readonly").forEach(function(e){e.readOnly=!0,e.addEventListener("focus",function(){return e.readOnly=!1})});var s=e.querySelector("input[name=disable_name]");s&&(s.onchange=function(){var t=this.checked;e.querySelector("input[name=name]").disabled=t,localStorage.setItem("post_anonymously",+t)},s.checked=!!+localStorage.post_anonymously,s.onchange()),e.addEventListener("submit",function(e){e.preventDefault(),e.stopPropagation(),Ajax.submitPost(this)}),e.querySelectorAll(".simplified-send-row button[type=\"submit\"]").forEach(function(t){t.onclick=function(t){t.preventDefault(),t.stopPropagation();var a=+("sagebtn"==this.name);Ajax.submitPost(e,a)}});var i=e.querySelector("input[name=\"ttl-enable\"]");i&&(i.onchange=function(){var t=this.checked,a=e.ttl;a.disabled=!t,a.min=t?1:0,t&&0==a.value&&(a.value=1)},i.onchange()),e.querySelectorAll("textarea, input[type=text]").forEach(function(t){t.onfocus=function(){lastActiveForm=e}});var o=e.querySelector(".s-file");o&&(o.onclick=function(t){t.preventDefault(),e.querySelector("input[type=file]").click()})}}var injector={inject:function inject(e,t){var a="injector:".concat(e),n=document.getElementById(a);if(n)return void(n.innerHTML=t);var s=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.id=a,i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),s.appendChild(i)},remove:function remove(e){var t="injector:".concat(e),a=document.getElementById(t);if(a){var n=document.head||document.getElementsByTagName("head")[0];n&&n.removeChild(document.getElementById(t))}}};function randomString(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:10,t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",a="",n=e;0<n;--n)a+=t[Math.round(Math.random()*(t.length-1))];return a}function add_mob_menu(){var e=Math.ceil,t=20,a=10,n=300;$("#overlay_menu").hide(),document.body.insertAdjacentHTML("afterbegin","<div id=\"mobile-menu\"><div id=\"mobile-menu-contents\"></div></div>");var s=document.querySelector("#mobile-menu-contents"),i=$("#mobile-menu"),o="";overboard_dir&&(o+="<a href=\"/".concat(overboard_dir,"\" class=\"mm-item mm-brd\">").concat(overboard_desc,"</a>")),$("<div id=\"mmb-_options\" style=\"display: none\"></div>").append($("#ms-_options")).appendTo($(s)),i.append("<div id=\"mm-toggle\">\n    <div class=\"mm-bars\"></div>\n    <div id=\"mm-circle\"></div>\n  </div>");var r=boards10.list;cloud20.getBoards().then(function(t){r.sort(function(e,t){return+e.order>+t.order}).push({id:"20",name:"2.0",boards:t}),r.forEach(function(e,t){e.boards&&(o+="<a href=\"#\" class=\"mm-item mm-cat\" data-mmbx=\"".concat(t,"\">").concat(e.name,"</a>\n          <span class=\"mm-boards\" id=\"mmb-").concat(t,"\">"),e.boards.forEach(function(e){e.dir=e.dir||e.name,o+="<a class=\"mm-item mm-brd\" href=\"/".concat(e.dir,"\">/").concat(e.dir,"/ \u2014 ").concat(e.desc,"</a>")}),o+="</span>")}),o+="<a href=\"#\" class=\"mm-item mm-toggle-options\" onclick=\"\n      $('.mm-boards').toggle(false); \n      $('#mmb-_options').slideToggle('fast');\n      $('.mmc-expanded').removeClass('mmc-expanded')\n      return false\n    \">Options</a>",s.insertAdjacentHTML("afterBegin","".concat(o)),$("#mm-toggle").click(function(){var t=Math.sqrt;if(!i.hasClass("mm-expanded")){i.addClass("mm-expanded");var a=i[0].getBoundingClientRect(),n=a.width-20-10,o=a.height-20-10,r=t(n*n+o*o),l=e(r/20);$("#mm-circle").css({transform:"scale(".concat(l,")")}),$(s).css({visibility:"visible",opacity:1}),i.addClass("bars-away"),setTimeout(function(){i.addClass("mm-expanded-full")},300)}}),offClick.push(function(){i.hasClass("mm-expanded-full")&&(i.removeClass("mm-expanded-full bars-away"),setTimeout(function(){$(s).css({visibility:"hidden"}),i.removeClass("mm-expanded")},300),$(s).css({visibility:"visible",opacity:0}),$("#mm-circle").css({transform:"scale(1)"}))})}),i.click(function(e){e.stopPropagation()}).on("click",".mm-cat[data-mmbx]",function(){var e=$("#mmb-".concat($(this).data("mmbx")));return e.is(":visible")?(e.toggle(!1),$(this).removeClass("mmc-expanded")):($(".mm-boards").toggle(!1),$("#mmb-_options").slideUp("fast"),e.toggle(!0),$(".mmc-expanded").removeClass("mmc-expanded"),$(this).addClass("mmc-expanded")),!1})}var boards10={get list(){var e=this;return this.allboards||(this.allboards=[],document.querySelectorAll(".olm-link").forEach(function(t){if(t=t.querySelector("a"),!!t){var a=t.dataset.toexpand,n=t.innerText,s=document.querySelector("#ms-".concat(a));if(a&&"20"!=a&&"_options"!=a){var i={id:a,name:n,boards:[]};s.querySelectorAll("a").forEach(function(e){var t=e.innerText.match(/\/(.+?)\/ - (.+)/);t&&i.boards.push({dir:t[1],desc:t[2]})}),e.allboards.push(i)}}})),this.allboards}},cloud20={init:function init(){var e=this;this.getBoards().then(function(){return e.filter("")})["catch"](_.noop),$("#boardselect").on("input",function(){cloud20.filter($(this).val())})},getBoards:function getBoards(){var e=this;return new Promise(function(t,a){e.allboards?t(e.allboards):$.getJSON(ku_cgipath+"/boards20.json",function(a){e.allboards=a,t(a)}).fail(function(t){pups.err(_l.unable_load_20),a(t)})})},filter:function filter(e){var t=[];"undefined"==typeof this.allboards||(""==e?t=this.allboards:(e=e.toLowerCase(),_.each(this.allboards,function(a){(-1!==a.name.toLowerCase().search(e)||-1!==a.desc.toLowerCase().search(e))&&t.push(a)})),this.display(t))},display:function display(e){var t="",a="";_.each(e,function(e){t+="<a class=\"menu-item\" title=\""+e.desc+"\" href=\""+ku_boardsfolder+e.name+"/\">/"+e.name+"/ - "+e.desc+"</a>",a+="<option value=\""+e.name+"\">/"+e.name+"/ - "+e.desc+"</option>"}),$("#boards20").html(t),$(".boardsel20").append(a)}},countries={A1:"Anonymous Proxy",A2:"Satellite Provider",O1:"Other Country",AD:"Andorra",AE:"United Arab Emirates",AF:"Afghanistan",AG:"Antigua and Barbuda",AI:"Anguilla",AL:"Albania",AM:"Armenia",AO:"Angola",AP:"Asia/Pacific Region",AQ:"Antarctica",AR:"Argentina",AS:"American Samoa",AT:"Austria",AU:"Australia",AW:"Aruba",AX:"Aland Islands",AZ:"Azerbaijan",BA:"Bosnia and Herzegovina",BB:"Barbados",BD:"Bangladesh",BE:"Belgium",BF:"Burkina Faso",BG:"Bulgaria",BH:"Bahrain",BI:"Burundi",BJ:"Benin",BL:"Saint Bartelemey",BM:"Bermuda",BN:"Brunei Darussalam",BO:"Bolivia",BQ:"Bonaire, Saint Eustatius and Saba",BR:"Brazil",BS:"Bahamas",BT:"Bhutan",BV:"Bouvet Island",BW:"Botswana",BY:"Belarus",BZ:"Belize",CA:"Canada",CC:"Cocos (Keeling) Islands",CD:"Congo, The Democratic Republic of the",CF:"Central African Republic",CG:"Congo",CH:"Switzerland",CI:"Cote d'Ivoire",CK:"Cook Islands",CL:"Chile",CM:"Cameroon",CN:"China",CO:"Colombia",CR:"Costa Rica",CU:"Cuba",CV:"Cape Verde",CW:"Curacao",CX:"Christmas Island",CY:"Cyprus",CZ:"Czech Republic",DE:"Germany",DJ:"Djibouti",DK:"Denmark",DM:"Dominica",DO:"Dominican Republic",DZ:"Algeria",EC:"Ecuador",EE:"Estonia",EG:"Egypt",EH:"Western Sahara",ER:"Eritrea",ES:"Spain",ET:"Ethiopia",EU:"Europe",FI:"Finland",FJ:"Fiji",FK:"Falkland Islands (Malvinas)",FM:"Micronesia, Federated States of",FO:"Faroe Islands",FR:"France",GA:"Gabon",GB:"United Kingdom",GD:"Grenada",GE:"Georgia",GF:"French Guiana",GG:"Guernsey",GH:"Ghana",GI:"Gibraltar",GL:"Greenland",GM:"Gambia",GN:"Guinea",GP:"Guadeloupe",GQ:"Equatorial Guinea",GR:"Greece",GS:"South Georgia and the South Sandwich Islands",GT:"Guatemala",GU:"Guam",GW:"Guinea-Bissau",GY:"Guyana",HK:"Hong Kong",HM:"Heard Island and McDonald Islands",HN:"Honduras",HR:"Croatia",HT:"Haiti",HU:"Hungary",ID:"Indonesia",IE:"Ireland",IL:"Israel",IM:"Isle of Man",IN:"India",IO:"British Indian Ocean Territory",IQ:"Iraq",IR:"Iran, Islamic Republic of",IS:"Iceland",IT:"Italy",JE:"Jersey",JM:"Jamaica",JO:"Jordan",JP:"Japan",KE:"Kenya",KG:"Kyrgyzstan",KH:"Cambodia",KI:"Kiribati",KM:"Comoros",KN:"Saint Kitts and Nevis",KP:"Korea, Democratic People's Republic of",KR:"Korea, Republic of",KW:"Kuwait",KY:"Cayman Islands",KZ:"Kazakhstan",LA:"Lao People's Democratic Republic",LB:"Lebanon",LC:"Saint Lucia",LI:"Liechtenstein",LK:"Sri Lanka",LR:"Liberia",LS:"Lesotho",LT:"Lithuania",LU:"Luxembourg",LV:"Latvia",LY:"Libyan Arab Jamahiriya",MA:"Morocco",MC:"Monaco",MD:"Moldova, Republic of",ME:"Montenegro",MF:"Saint Martin",MG:"Madagascar",MH:"Marshall Islands",MK:"Macedonia",ML:"Mali",MM:"Myanmar",MN:"Mongolia",MO:"Macao",MP:"Northern Mariana Islands",MQ:"Martinique",MR:"Mauritania",MS:"Montserrat",MT:"Malta",MU:"Mauritius",MV:"Maldives",MW:"Malawi",MX:"Mexico",MY:"Malaysia",MZ:"Mozambique",NA:"Namibia",NC:"New Caledonia",NE:"Niger",NF:"Norfolk Island",NG:"Nigeria",NI:"Nicaragua",NL:"Netherlands",NO:"Norway",NP:"Nepal",NR:"Nauru",NU:"Niue",NZ:"New Zealand",OM:"Oman",PA:"Panama",PE:"Peru",PF:"French Polynesia",PG:"Papua New Guinea",PH:"Philippines",PK:"Pakistan",PL:"Poland",PM:"Saint Pierre and Miquelon",PN:"Pitcairn",PR:"Puerto Rico",PS:"Palestinian Territory",PT:"Portugal",PW:"Palau",PY:"Paraguay",QA:"Qatar",RE:"Reunion",RO:"Romania",RS:"Serbia",RU:"Russian Federation",RW:"Rwanda",SA:"Saudi Arabia",SB:"Solomon Islands",SC:"Seychelles",SD:"Sudan",SE:"Sweden",SG:"Singapore",SH:"Saint Helena",SI:"Slovenia",SJ:"Svalbard and Jan Mayen",SK:"Slovakia",SL:"Sierra Leone",SM:"San Marino",SN:"Senegal",SO:"Somalia",SR:"Suriname",SS:"South Sudan",ST:"Sao Tome and Principe",SV:"El Salvador",SX:"Sint Maarten",SY:"Syrian Arab Republic",SZ:"Swaziland",TC:"Turks and Caicos Islands",TD:"Chad",TF:"French Southern Territories",TG:"Togo",TH:"Thailand",TJ:"Tajikistan",TK:"Tokelau",TL:"Timor-Leste",TM:"Turkmenistan",TN:"Tunisia",TO:"Tonga",TR:"Turkey",TT:"Trinidad and Tobago",TV:"Tuvalu",TW:"Taiwan",TZ:"Tanzania, United Republic of",UA:"Ukraine",UG:"Uganda",UM:"United States Minor Outlying Islands",US:"United States",UY:"Uruguay",UZ:"Uzbekistan",VA:"Holy See (Vatican City State)",VC:"Saint Vincent and the Grenadines",VE:"Venezuela",VG:"Virgin Islands, British",VI:"Virgin Islands, U.S.",VN:"Vietnam",VU:"Vanuatu",WF:"Wallis and Futuna",WS:"Samoa",YE:"Yemen",YT:"Mayotte",ZA:"South Africa",ZM:"Zambia",ZW:"Zimbabwe",XX:"OMCK",T1:"Tor"},bnrs={initiated:!1,init:function init(){$.getJSON(ku_boardspath+"/bnrs.json",function(e){var t=[];1<e.length?_.each(e,function(e){e.link!==this_board_dir&&t.push(e)}):t=e,bnrs.data=t,bnrs.initiated=!0,bnrs.display()})},display:function display(){if(this.initiated&&this.data.length){var e=[];"undefined"==typeof this.current?e=this.data:_.each(this.data,function(t){t.path!==bnrs.current&&e.push(t)});var t=randomItem(e);this.current=t.path;var a=-1===t.link.indexOf("http")?ku_boardspath+"/"+t.link:t.link,n="<a class=\"bnrsupdate\" href=\"#\" onclick=\"javascript:bnrs.display();return false;\"></a><a href=\""+a+"\"><img src=\""+ku_boardspath+"/images/bnrs/"+t.path+"\" /></a>";$(".bnr").length?$(".bnr").html(n):$(".logo").before("<div class=\"bnr-wrap\"><div class=\"bnr\">"+n+"</div></div>")}}};function getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}function randomItem(e){return e[getRandomInt(0,e.length-1)]}var embedLinks={sites:[{id:"youtube",rx:/(?:youtu(?:\.be|be\.com)\/(?:.*v(?:\/|=)|(?:.*\/)?)([\w'-]+))/i},{id:"vimeo",rx:/[\w\W]*vimeo\.com\/(?:.*?)([0-9]+)(?:.*)?/},{id:"coub",rx:/[\w\W]*coub\.com\/view\/([\w\W]*)[\w\W]*/},{id:"soundcloud",rx:/[\w\W]*soundcloud.com\/([\w\W]*)[\w\W]*/i}],process:function process(e){var t=null;return _.find(this.sites,function(a){var n=a.rx.exec(e);null!=n&&(t={site:a.id,code:n[1]})}),t}},catalog={conf:{sortBy:"bumped",layout:"text",respectStickied:!0,showHidden:!0,expandOnHover:!0},saveConfig:function saveConfig(){localStorage.catalogSettings=JSON.stringify(this.conf)},init:function init(){if(document.body.classList.add("is-catalog"),localStorage.catalogSettings)try{var e=JSON.parse(localStorage.catalogSettings);_.each(e,function(e,t){this.conf[t]=e},this)}catch(t){console.error("Invalid catalog config"),localStorage.removeItem("catalogSettings")}var t="<div class=\"refresh-catalog\" title=\"".concat(_l.refreshCatalog,"\"><svg class=\"icon i-16in20\"><use xlink:href=\"#i-refresh\"></use></svg></div>"),a="<div class=\"button-group\" data-select=\"sortBy\">";_.each([["bumped","bumpOrder","bump","i-20"],["timestamp","creationDate","creation","i-20"],["replied","lastReply","reply","i-16in20"],["reply_count","replyCount","replies","i-20"]],function(e){a+="<div class=\"bg-button"+(e[0]==this.conf.sortBy?" bgb-selected":"")+"\" data-val=\""+e[0]+"\" title=\""+_l.sortBy+" "+_l[e[1]]+"\">      <svg class=\"icon "+e[3]+"\"><use xlink:href=\"#i-"+e[2]+"\"></use></svg></div>"}.bind(this)),a+="</div>";var n="<div class=\"button-group"+("bumped"===this.conf.sortBy?"":" disabled")+"\" data-select=\"respectStickied\" id=\"pinControl\">";_.each([[1,"doStick","pin","i-16in20"],[0,"doNotStick","unpin","i-16in20"]],function(e){n+="<div class=\"bg-button"+(e[0]==this.conf.respectStickied?" bgb-selected":"")+"\" data-val=\""+e[0]+"\" title=\""+_l[e[1]]+"\">      <svg class=\"icon "+e[3]+"\"><use xlink:href=\"#i-"+e[2]+"\"></use></svg></div>"}.bind(this)),n+="</div>";var s="<div class=\"button-group\" data-select=\"showHidden\">";_.each([[0,"hideHidden","hide","i-16in20"],[1,"showHidden","unhide","i-16in20"]],function(e){s+="<div class=\"bg-button"+(e[0]==this.conf.showHidden?" bgb-selected":"")+"\" data-val=\""+e[0]+"\" title=\""+_l[e[1]]+"\">      <svg class=\"icon "+e[3]+"\"><use xlink:href=\"#i-"+e[2]+"\"></use></svg></div>"}.bind(this)),s+="</div>";var i="<div class=\"button-group\" data-select=\"layout\">";_.each([["text","smallPics","grid-small","i-20"],["gallery","largePics","gallery-grid","i-20"]],function(e){i+="<div class=\"bg-button"+(e[0]==this.conf.layout?" bgb-selected":"")+"\" data-val=\""+e[0]+"\" title=\""+_l[e[1]]+"\">      <svg class=\"icon "+e[3]+"\"><use xlink:href=\"#i-"+e[2]+"\"></use></svg></div>"}.bind(this)),i+="</div>";var o="<input name=\"subject\" autocomplete=\"false\" class=\"button-group\" type=\"text\" id=\"cat-search\" placeholder=\""+_l.search+"...\" /><input type=\"text\" name=\"FUCKYOUCHROMEFUCKYOU\" style=\"display:none;\"/>";$("#catalog-controls").html(t+a+n+o+s+i),this.load(),this.conf.expandOnHover&&$("#catalog-contents").addClass("expand-on-hover-enabled"),$("#catalog-contents").on("click",".namedate-overlay",function(){$(this).toggleClass("date-on name-on")}).on("click",".ce-text .bigThumb",function(e){e.stopPropagation(),e.preventDefault();var t=$(this).parents(".cat-entry");t.toggleClass("thumbExpanded")}).on("click",".bigThumb audio, .bigThumb video",function(e){e.stopPropagation()}).on("animationstart webkitAnimationStart MSAnimationStart oanimationstart",function(e){var t=$(e.target);"embed-image-insert"!=e.originalEvent.animationName||t.hasClass("_inserted_")||this.getEmbedThumb(t)}.bind(this)).on("mousedown",".cat-prv",function(e){e.preventDefault(),PostPreviews._mouseover.bind(this)(e)}).on("click",".cat-prv",function(e){e.stopPropagation(),e.preventDefault()}).on("mouseleave",".cat-prv",function(e){PostPreviews._mouseout.bind(this)()}).on("click",".i-hide",function(e){var t=$(e.currentTarget),a=t.parents(".cat-entry"),n=a.data("id"),s=_.findIndex(this.model,{id:n}),i=this.model[s];i.hidden=!i.hidden,i.hidden?(t[0].classList.add("pressed"),t.html(makeIcon("unhide","",!0)),HiddenItems.hideItem("thread",n),a.addClass("thread-hidden")):(t[0].classList.remove("pressed"),t.html(makeIcon("hide","",!0)),HiddenItems.unhideItem("thread",n),a.removeClass("thread-hidden")),this.model[s]=i,delete this.rendered[this.conf.layout][n]}.bind(this)),$(".bg-button").click(function(e){var t=$(e.currentTarget);if(!t.hasClass("bgb-selected")){var a=t.parent(),n=t.data("val"),s=a.data("select");a.find(".bg-button").removeClass("bgb-selected"),t.addClass("bgb-selected"),"sortBy"!==s&&"layout"!==s?n=!!n:"bumped"==n?$("#pinControl").removeClass("disabled"):$("#pinControl").addClass("disabled"),this.conf[s]=n,this.saveConfig(),"showHidden"===s?n?$("#catalog-contents").removeClass("hideHidden"):$("#catalog-contents").addClass("hideHidden"):this.build()}}.bind(this)),$(".refresh-catalog").click(function(e){e.preventDefault(),this.load()}.bind(this)),$("#cat-search").on("input",function(){var e=$(this).val().toLowerCase().replace(/\"/,"\\\"");try{injector.remove("cat-search")}catch(t){}e.length?injector.inject("cat-search","#catalog-contents .cat-entry:not([data-search *= \""+e+"\"]) { display:none; }"):injector.remove("cat-search")}).trigger("input")},load:function load(){$("#catalog-contents").html("<div class=\"cat-loading\"><div class=\"spinner\"></div>".concat(_l.loading,"...</div>")),this.rendered={text:{},gallery:{}},this.model=null,$.getJSON("catalog.json?v="+new Date().getTime()).done(this.build.bind(this)).fail(function(e){throw e})},fileTypes:{image:["jpg","gif","png"],jpgThumb:["webm","mp4","cob","vim","you"],iconsAvailable:["swf","mp3","ogg","css","flv"],audio:["mp3","ogg"],embed:["cob","vim","you"]},authorities:["","Admin","Mod","?","God"],formatDate:function formatDate(e,t){"undefined"==typeof t&&(t=!1);var a=new Date(1e3*e),n=this.dateLocal.dows.hasOwnProperty(locale)?this.dateLocal.dows[locale][a.getDay()]:this.dateLocal.dows.en[a.getDay()],s=_.padLeft(a.getFullYear()%100,2,0),i=_.padLeft(a.getMonth()+1,2,0),o="ru"===locale?this.dateLocal.mons.ru[a.getMonth()]:a.getMonth()+1,r=_.padLeft(a.getDate(),2,0),l=_.padLeft(a.getHours(),2,0),d=_.padLeft(a.getMinutes(),2,0),c=_.padLeft(a.getSeconds(),2,0);return(t?"ru"===locale?r+"."+i+"."+s+" \u0432 ":i+"/"+r+"/"+s+" @ ":"ru"===locale?n+" "+r+" "+o+"\u2019"+s+" \u0432 ":i+"/"+r+"/"+s+" ("+n+") @ ")+l+":"+d+":"+c},dateLocal:{dows:{ru:["\u041F\u043D\u0434","\u0412\u0442\u0440","\u0421\u0440\u0434","\u0427\u0442\u0432","\u041F\u0442\u043D","\u0421\u0431\u0442","\u0412\u0441\u043A"],en:["Sun","Mon","Tue","Wen","Thu","Fri","Sat"]},mons:{ru:["\u042F\u043D\u0432","\u0424\u0435\u0432","\u041C\u0430\u0440","\u0410\u043F\u0440","\u041C\u0430\u0439","\u0418\u044E\u043D","\u0418\u044E\u043B","\u0410\u0432\u0433","\u0421\u0435\u043D","\u041E\u043A\u0442","\u041D\u043E\u044F","\u0414\u0435\u043A"]}},build:function build(e){if("undefined"==typeof e&&(e=this.model),!!e){if(_.each(e,function(t,a){_.each(["id","reply_count","bumped","replied","reply_count","timestamp","page","locked","stickied","deleted_timestamp"],function(e){t[e]=~~t[e]}),e[a]=t}),"bumped"===this.conf.sortBy&&this.conf.respectStickied)this.model=_.sortByOrder(e,["stickied","bumped"],["desc","desc"]);else{var t=[this.conf.sortBy];"bumped"!==this.conf.sortBy&&t.push("bumped"),this.model=_.sortByOrder(e,t,_.repeat("desc",t.length))}var a="";_.each(this.model,function(e){a+=this.buildEntry(e)},this),$("#catalog-contents").html(a)}},getEmbedThumb:function getEmbedThumb(e){var t,a=e.data("site"),n=e.data("id"),s=e.parents(".cat-entry"),i=s.data("id");"cob"==a&&$.get(ku_boardspath+"/corpsy.php?code="+n,function(t){e.replaceWith("<img src=\""+t.thumbnail_url+"\">"),this.rendered[this.conf.layout][i]=s[0].outerHTML}.bind(this)),"vim"==a&&$.get("http://vimeo.com/api/v2/video/"+n+".json",function(t){e.replaceWith("<img src=\""+t[0].thumbnail_medium+"\">"),this.rendered[this.conf.layout][i]=s[0].outerHTML}.bind(this))},buildEntry:function buildEntry(e){if(this.rendered[this.conf.layout].hasOwnProperty(e.id))return this.rendered[this.conf.layout][e.id];if(!e.processed){e.url="/"+this_board_dir+"/res/"+e.id+".html";var t="<svg class=\"actor icon cat-thumb-expand\"><use xlink:href=\"#i-expand\"></use></svg>",a="<svg class=\"actor icon cat-thumb-expand\"><use xlink:href=\"#i-play\"></use></svg>",n=e.embeds?e.embeds.find(function(t){return"removed"!=t.file})||"removed":null;if(!n||"removed"===n)e.smallThumb="<a href=\""+e.url+"\" class=\"smallThumb\">          <div class=\"nofile-removed ctx\">"+("removed"===n?"\u0423\u0434\u0430\u043B\u0451\u043D":"No File")+"</div></a>";else{if(_.includes(this.fileTypes.image,n.file_type)||_.includes(this.fileTypes.jpgThumb,n.file_type)||_.includes(this.fileTypes.audio,n.file_type)&&0<+n.thumb_w&&0<+n.thumb_h){var s=_.includes(this.fileTypes.image,n.file_type)?n.file_type:"jpg",i=_.includes(this.fileTypes.embed,n.file_type)?"".concat(n.file_type,"-").concat(n.file,"-"):n.file,o="mp3"==n.file_type?" onerror=\"switchFileType(this)\" extset=\"jpg,png,gif\"":"";e.smallThumb="<a href=\""+e.url+"\" class=\"smallThumb\">            <img src=\"thumb/"+i+"c."+s+"\""+o+"></a>",e.bigThumb="<img src=\"thumb/"+i+"s."+s+"\""+o+">"}else{var r=!_.includes(this.fileTypes.iconsAvailable,n.file_type),l=r?makeGenericFileIcon(n.file_type):"<img src=\"".concat(_.includes(this.fileTypes.embed,n.file_type)?"/inc/filetypes/generic-embed.png":"/inc/filetypes/".concat(n.file_type,".png"),"\">");e.smallThumb="<a target=\"_blank\" href=\"".concat(e.url,"\" class=\"smallThumb\">").concat(l,"</a>"),_.includes(this.fileTypes.audio,n.file_type)&&(e.bigThumb="<audio src=\"src/"+n.file+"."+n.file_type+"\" controls></audio>")}e.bigThumb&&(e.bigThumb="<a target=\"_blank\" href=\""+e.url+"\" class=\"bigThumb\">"+e.bigThumb+"</a>")}e.op="<a target=\"_blank\" title=\""+_l.goToThread+"\" target=\"_blank\" href=\""+e.url+"\" class=\"op-number ctx\">#"+e.id+"</a>",e.preview="<a href=\""+e.url+"#"+e.id+"\" class=\"actor cat-prv\">        <svg class=\"icon\"><use xlink:href=\"#i-eye\"></use></svg>      </a>";var d="<svg class=\"icon\"><use xlink:href=\"#i-reply\"></use></svg>      <span class=\"ctx reply-count\">"+e.reply_count+"</span>";e.last_reply&&(d="<a href=\""+e.url+"#"+e.last_reply+"\" class=\"actor cat-prv\">"+d+"</a>");var c="<div class=\"infolabel\">"+d+"</div>",p="<div class=\"infolabel\">        <svg class=\"icon\"><use xlink:href=\"#i-picture\"></use></svg>        <span class=\"ctx image-count\">"+e.images+"</span>      </div>",u="<div class=\"infolabel il-page\">        <a title=\""+_l.threadOnPage+" "+e.page+"\" target=\"_blank\" href=\"/"+this_board_dir+"/"+(0<e.page?e.page+".html":"")+"#"+e.id+"\" class=\"actor\">          <svg class=\"icon\"><use xlink:href=\"#i-page\"></use></svg>          <span class=\"ctx page-number\">"+e.page+"</span>        </a>      </div>";e.countersCombined=c+p+u,e.posterauthority=+e.posterauthority,e.nameDatePriority="date",("name"==localStorage.cat_nameDatePriority||"date"!=localStorage.cat_nameDatePriority&&(e.name||e.tripcode||e.posterauthority))&&(e.nameDatePriority="name");var m=(e.name?"<span class=\"ctx postername\">"+e.name+"</span>":"")+(e.tripcode?"<span class=\"ctx postertrip\">!"+e.tripcode+"</span>":"")+(e.posterauthority?"<span class=\"ctx admin\">&nbsp;##"+this.authorities[e.posterauthority]+"##</span>":"");e.poster="<div class=\"cat-poster\"><span class=\"ctx\">by&nbsp;</span>"+(m||"<span class=\"ctx c-postername\">"+(this_board_defaultName||_l.anonymous)+"</span>")+"</div>";var h=" style=\"display:none\"";e.date="<div class=\"ctx cat-date cat-date-long\">"+this.formatDate(e.timestamp)+"</div>",e.dateCompact="<div class=\"ctx cat-date cat-date-short\">"+this.formatDate(e.timestamp,1)+"</div>",e.searchData=_.escape(stripHTML(e.subject+" "+e.message).toLowerCase()),e.message=e.message.replace(/\\"/mg,"\""),e.processed=!0,this.model[_.findIndex(this.model,{id:e.id})]=e}e=this.buildIndicators(e);var g=this.layouts[this.conf.layout].bind(this)(e);return this.rendered[this.conf.layout][e.id]=g,g},buildIndicators:function buildIndicators(e){e.hidden=HiddenItems.isHidden("thread",e.id);var t=e.stickied?"<svg class=\"foradmin-act icon i-layer-1 i-pin\"><use xlink:href=\"#i-pin\"></use></svg>":"",a=e.locked?"<svg class=\"foradmin-act icon i-layer-1 i-lock\"><use xlink:href=\"#i-lock\"></use></svg>":"",n=e.deleted_timestamp?"<svg class=\"foradmin-act icon i-layer-1 i-deathmark\"><use xlink:href=\"#i-skull\"></use></svg>":"",s="<svg class=\"actor icon i-layer-1 i-hide"+(e.hidden?" pressed":"")+"\"><use xlink:href=\"#i-"+(e.hidden?"unhide":"hide")+"\"></use></svg>",i="<svg class=\"actor icon i-burger foradmin-show\"><use xlink:href=\"#i-burger\"></use></svg>",o="<svg class=\"actor icon i-layer-2 i-delete foradmin-show\"><use xlink:href=\"#i-x\"></use></svg>",r="<svg class=\"actor icon i-layer-2 i-dnb foradmin-show\"><use xlink:href=\"#i-and\"></use></svg>",l="<svg class=\"actor icon i-layer-2 i-ban foradmin-show\"><use xlink:href=\"#i-ban\"></use></svg>";return e.indicatorsCombined="<div class=\"indicators\"><svg class=\"actor icon i-burger foradmin-show\"><use xlink:href=\"#i-burger\"></use></svg><span class=\"i-layer-1\">"+n+t+a+s+"</span><span class=\"i-layer-2\"><svg class=\"actor icon i-layer-2 i-delete foradmin-show\"><use xlink:href=\"#i-x\"></use></svg><svg class=\"actor icon i-layer-2 i-dnb foradmin-show\"><use xlink:href=\"#i-and\"></use></svg><svg class=\"actor icon i-layer-2 i-ban foradmin-show\"><use xlink:href=\"#i-ban\"></use></svg></span></div>",e},layouts:{text:function text(e){return"<div data-id=\""+e.id+"\" class=\"cat-entry ce-text"+(e.hidden?" thread-hidden":"")+"\" data-search=\""+e.searchData+"\">        <div class=\"cat-card\">          <div class=\"ce-heda\">"+e.smallThumb+"<div class=\"cat-infoline ci-op-link\">"+e.op+e.indicatorsCombined+"</div>            <div class=\"cat-infoline namedate-overlay "+e.nameDatePriority+"-on\">"+e.poster+e.date+"</div>            <div class=\"cat-infoline\">"+e.preview+e.countersCombined+"</div>          </div>          <div class=\"ce-opcontent ctx\">            <h5>"+e.subject+"</h5>"+e.message+"</div>        </div>"+e.bigThumb+"</div>"},gallery:function gallery(e){return"<div data-id=\""+e.id+"\" class=\"cat-entry ce-gallery"+(e.hidden?" thread-hidden":"")+"\" data-search=\""+e.searchData+"\">        <div class=\"cat-card\">"+e.bigThumb+"<div class=\"cat-infoline\">            <div class=\"ci-op-link\">"+e.op+"</div>            <div class=\"counters\">"+e.countersCombined+"</div>          </div>          <div class=\"cat-infoline\">"+e.preview+"<div class=\"namedate-overlay "+e.nameDatePriority+"-on\">"+e.poster+e.dateCompact+"</div>"+e.indicatorsCombined+"</div>          <div class=\"ce-opcontent ctx\">            <h5>"+e.subject+"</h5>"+e.message+"</div>        </div>      </div>"}}};function stripHTML(e){var t=document.implementation.createHTMLDocument("New").body;return t.innerHTML=e,t.textContent||t.innerText||""}var overboard={get boards(){return is_overboard?(this._boards||(this._boards=_.unique([].map.call(document.querySelectorAll("div[id^=thread]"),function(t){return t.dataset.boardid}))),this._boards):[boardid]},idFromName:function idFromName(e){return null!==e&&$("div[data-board=\"".concat(e,"\"]")).parents("div[id^=thread]").data("boardid")}},unreadCounter={init:function init(e){var t=this;e||(e=+document.querySelector("meta[property=\"i0:buildtime\"]").content),this.lastvisits=localStorage.lastvisits?JSON.parse(localStorage.lastvisits)||{}:{},overboard.boards.forEach(function(a){var n=t.lastvisits.hasOwnProperty(a)?parseInt(t.lastvisits[a]):0;n<e&&(t.lastvisits[a]=e,localStorage.setItem("lastvisits",JSON.stringify(t.lastvisits)))})},refreshTimestamp:function refreshTimestamp(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null;this.lastvisits||this.init();var a=is_overboard?overboard.idFromName(t):boardid;a&&((null===e||"undefined"==typeof e)&&(e=Math.round(new Date().getTime()/1e3)),this.lastvisits[a]=e,localStorage.setItem("lastvisits",JSON.stringify(this.lastvisits)))},update:function update(){this.lastvisits||this.init(),$.ajax({url:"/newpostscount.php",data:this.lastvisits,dataType:"json",success:function success(e){$(".newposts-counter").remove(),$(".got-updates").removeClass("got-updates"),_.each(e,function(e,t){if(0<+e){var a="<span class=\"newposts-counter\">\xA0(".concat(e,")</span>"),n=$(".menu-item[href=\"/".concat(t,"/\"]"));n.length&&(n.append(a),$(".sect-exr[data-toexpand=\"".concat(n.parents(".menu-sect").attr("id").split("ms-")[1],"\"]")).parent().addClass("got-updates")),$(".mobile-nav option[value=\"".concat(t,"\"]")).append(a)}})}})}},HTMLoader={loadThread:function loadThread(e,t,a,n){var s=this;$.get("?"===t?"".concat(ku_boardspath,"/postbynumber.php?b=").concat(e,"&p=").concat(n):"".concat(ku_boardspath,"/").concat(e,"/res/").concat(t,".html?").concat(force_html_nocache?Math.random():"")).then(function(n){var i=n.match(/<div\s*?class\s*?=\s*?"[^"]*?i0svcel[^"]*?"\s*?>!i0-pd:[0-9]+\s*?<\/div\s*?>[\s\S]+?<div\s*?class\s*?=\s*?"[^"]*?i0svcel[^"]*?"\s*?>!i0-pd-end\s*?<\/div\s*?>/gi).map(function(e){var t=e.match(/<div\s*?class\s*?=\s*?"[^"]*?i0svcel[^"]*?"\s*?>!i0-pd:([0-9]+)\s*?<\/div\s*?>([\s\S]+?)<div\s*?class\s*?=\s*?"[^"]*?i0svcel[^"]*?"\s*?>!i0-pd-end\s*?<\/div\s*?>/i);return{id:+t[1],body:t[2]}});if("?"===t){var o=n.match(/<!--i0:thrno=([0-9]+)-->/);o&&(t=o[1])}if(i.length){var r=i.map(function(t){return s.cached["".concat(e,"_").concat(t.id)]=t.body,t.id});"?"!==t&&(s.threadMaps["".concat(e,"_").concat(t)]=r)}a()}).fail(function(e){a(e.status||"null")})},loadPage:function loadPage(e,t){var a=this,n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this_board_dir;$.get("".concat(ku_boardspath,"/").concat(n,"/").concat(0==e?"":"".concat(e,".html"))).then(function(e){var n,s=null===(n=e.match(/<div\s*?class\s*?=\s*?"[^"]*?i0svcel[^"]*?"\s*?>!i0-page-start\s*?<\/div\s*?>\s*([\s\S]+?)\s*<div\s*?class\s*?=\s*?"[^"]*?i0svcel[^"]*?"\s*?>!i0-page-end\s*?<\/div\s*?>/i))||void 0===n?void 0:n[1];s&&(document.querySelector("#delform hr:last-of-type").insertAdjacentHTML("afterend",s),a.pageCleanUp()),t()})},pageCleanUp:function pageCleanUp(){var e=[];document.querySelectorAll("div[id^=thread]").forEach(function(t){e.includes(t.id)&&(t.previousElementSibling.remove(),t.nextElementSibling.remove(),t.nextElementSibling.remove(),t.remove()),e.push(t.id)})},getPost:function getPost(e,t,a,n,s){var i=this,o=this.cached["".concat(e,"_").concat(a)];if(o)return void n(!1,o);if(!s){var r=!1;if(e===this_board_dir){var l=$("a[name=".concat(a,"]"));if(l.length){var d=l.parents(".postnode")[0].outerHTML;this.cached["".concat(e,"_").concat(a)]=d,r=!0,n(!1,d)}}r||this.loadThread(e,t,function(s){s?n(s):i.getPost(e,t,a,n,!0)},a)}else n(null)},getThread:function getThread(e,t,a,n,s,i){var o=this,r=!i&&this.threadMaps["".concat(e,"_").concat(t)];r?(a&&(r=r.filter(function(e){return e>a[0]&&e<a[1]})),n(!1,r.reduce(function(t,a){return t+o.cached["".concat(e,"_").concat(a)]},""))):s?n(null):this.loadThread(e,t,function(s){s?n(s):o.getThread(e,t,a,n,!0)})},cached:{},threadMaps:{},cachedPostboxes:{},getPostbox:function getPostbox(e){var t=this;return new Promise(function(a,n){return!1===e?a(document.querySelector("#postform")):t.cachedPostboxes[e]?a(t.cachedPostboxes[e]):void $.get("".concat(ku_boardspath,"/").concat(e,"/")).then(function(s){var i=s.match(/<div\s*?class\s*?=\s*?"[^"]*?i0svcel[^"]*?"\s*?>!i0-pb\s*?<\/div\s*?>([\s\S]+?)<div\s*?class\s*?=\s*?"[^"]*?i0svcel[^"]*?"\s*?>!i0-pb-end\s*?<\/div\s*?>/i);i||n(404);var o=document.createElement("div");o.innerHTML=i[1];var r;"undefined"==typeof hcaptcha&&(r=i[1].match(/<script src="(.+?js\.hcaptcha\.com.+?)"/))&&head.js(r[1],function(){return console.log("hcaptcha loaded")}),t.cachedPostboxes[e]=o.firstChild,a(t.cachedPostboxes[e])}).fail(function(e){n(e.status||"null")})})}},_endlessScroll={toggle:function toggle(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.enabled;e?(!this.bound&&(this.bound=this.onScroll.bind(this)),window.addEventListener("scroll",this.bound),this.onScroll()):window.removeEventListener("scroll",this.bound),this.enabled=e},enabled:!1,onScroll:function onScroll(){var e=this;if(!(this.busy||window.scrollY+window.innerHeight<document.body.scrollHeight)){this.busy=!0;var t=document.querySelector("#pagination a");if(t){var a=document.querySelector("#delform hr:last-of-type")._ins("afterend","<div class=\"endless-scroll-loading spin-around\"></div>"),n=+t.innerText;HTMLoader.loadPage(n,function(){t.insertAdjacentHTML("afterend","<span>".concat(n,"</span>")),t.remove(),a.remove(),e.busy=!1})}}}};function switchFileType(e){var t=/\.([a-z0-9]+)(?=$|\?)/i,a=e.src.match(t);if(a){var n=e.getAttribute("extset").toLowerCase().split(",");if(n.length){var s=n.indexOf(a[1].toLowerCase());-1==s||s>=n.length-1||(e.src=e.src.replace(t,".".concat(n[s+1])))}}}function LSfetchJSON(t){var a=null,n=localStorage[t];if("undefined"!=typeof n)try{a=JSON.parse(n)}catch(a){console.error(a),localStorage.removeItem(t)}return a}var pups={push:function push(e){var t=this;return e.id=(+_.uniqueId(_.now())).toString(16),this.container.insertAdjacentHTML("afterBegin",this.buildAlert(e)),e.el=document.getElementById("pup_".concat(e.id)),e.el.style.marginTop=-e.el.getBoundingClientRect().height+"px",e.el.getBoundingClientRect(),e.el.onclick=function(){delete e.timeout,e.onHold=!1,e.old=!0,e.el.classList.add("pup-away"),e.el.style.marginTop=-e.el.getBoundingClientRect().height+"px"},e.el.onmouseenter=function(){t.stack.slice(0).reverse().find(function(t){return t.onHold=!0,t.id==e.id})},e.el.onmouseleave=function(){t.stack.forEach(function(e){e.onHold=!1}),t.holdOffTimeout=setTimeout(function(){t.stack.forEach(function(t){!t.onHold&&t.old&&t.el&&(t.el.classList.add("pup-away"),t.el.style.marginTop=-e.el.getBoundingClientRect().height+"px")})},200)},this.queue.add(function(){t.scheduleClose(e),e.el.classList.remove("pup-pre"),e.el.style.marginTop=null,e.el.classList.remove("pup-noshadow")}),this.stack.push(e),this.save(),e.id},closeByID:function closeByID(e){var t=this.byID(e);t&&t.el.onclick()},queue:{stack:[],busy:!1,add:function add(e){var t=this;return new Promise(function(a,n){t.busy?t.stack.push(function(){return a(e())}):(t.timeout=setTimeout(t.next.bind(t),1e3*t.cooldown),t.busy=!0,a(e()))})},next:function next(){var e=this.stack.shift();e?(e(),this.timeout=setTimeout(this.next.bind(this),1e3*this.cooldown)):this.busy=!1},cooldown:.3},byID:function byID(e){return this.stack.find(function(t){return t.id==e})},update:function update(e,t){var n=this.byID(e);"object"!==_typeof(t)&&(n={msg:t}),_.extend(n,t),this.scheduleClose(n),n.el.setAttribute("pupclass",n.cls),n.el.querySelector(".pup-wrapped").innerHTML=this.buildAlert(n,1),this.save()},buildAlert:function buildAlert(e){var t=!!(1<arguments.length&&arguments[1]!==void 0)&&arguments[1],a="\n      <div class=\"alert-icon\">\n        <svg class=\"icon\"><use xlink:href=\"#i-".concat(this.iconMap[e.cls],"\"></use></svg>\n      </div>\n      <div class=\"alert-msg\">").concat(e.msg,"</div>");return t?a:"<div class=\"pup ".concat(e.old?"pup-away pup-away-full":"pup-pre pup-noshadow","\" pupclass=\"").concat(e.cls,"\" id=\"pup_").concat(e.id,"\">\n      <div class=\"pup-wrapped\">\n        ").concat(a,"\n      </div>\n    </div>")},iconMap:{succ:"success",err:"error",info:"info",warn:"warning"},historyToggle:function historyToggle(){var e=this;if(!this.stack.length)return void this.push({cls:"info",msg:_l.historyEmpty,destroy:!0});var t=this.container.classList.toggle("history-mode");setTimeout(function(){return e.container.style.overflow=t?"auto":null},t?300:0)},scheduleClose:function scheduleClose(e){e.timeout&&clearTimeout(e.timeout),e.onHold&&(e.onHold=!1);var t=e.time||0===e.time?e.time:this.defaultTimeout;t&&(e.timeout=setTimeout(function(){e.old=!0,e.onHold||(e.el.classList.add("pup-away"),e.el.style.marginTop=-e.el.getBoundingClientRect().height+"px")},1e3*t))},defaultTimeout:3.5,init:function init(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"pups-container";if(document.body.insertAdjacentHTML("beforeEnd","<div id=\"".concat(t,"\"><div class=\"pup-history-shadow\"></div></div>")),this.container=document.getElementById(t),!this.container)return void console.error("No popup container found");this.container.onclick=function(){if(e.container.classList.contains("history-mode"))return e.historyToggle()},["err","warn","info","succ","wait"].forEach(function(t){e[t]=function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return"object"!==_typeof(e)&&(e={msg:e}),e.cls=t,_.extend(e,n),this.push(e)}});var a=LSfetchJSON("I0_event_log")||[];a.forEach(function(t){t.old=!0,e.container.insertAdjacentHTML("afterBegin",e.buildAlert(t)),e.stack.push(t)})},historySize:10,save:function save(){var e=[];for(_.cloneDeep(this.stack).forEach(function(t){t.save&&(["old","onHold","timeout","el","save"].forEach(function(e){return delete t[e]}),e.push(t))});e.length>this.historySize;)e.shift();localStorage.I0_event_log=JSON.stringify(e)},stack:[]};function logJSONexpectedError(e){pups.err(_l.xhrError),console.error("Malformed response (JSON expected):\n",e.replace(/<br\s*\/?>/g,"\n"))}
//# sourceMappingURL=kusaba.new.js.map